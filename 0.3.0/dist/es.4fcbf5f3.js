function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire26fc,r=t.register;r("86b1c",function(r,a){let n,i,s,u,l,o,c,h,m,f,g,d,N,_,E,C,p,A,b,y,R,S,O,T,V,I,M,x,v,U,D;e(r.exports,"ErrorType",function(){return Y}),e(r.exports,"ERROR_TYPE_SET",function(){return G}),e(r.exports,"FunctionType",function(){return W}),e(r.exports,"operatorToken",function(){return Q}),e(r.exports,"compareToken",function(){return X}),e(r.exports,"matchToken",function(){return J}),e(r.exports,"normalizeSheetName",function(){return es}),e(r.exports,"matchRefDrawToken",function(){return eu}),e(r.exports,"convertUnitDataToRuntime",function(){return el}),e(r.exports,"isReferenceString",function(){return eV}),e(r.exports,"sequenceNodeType",function(){return eI}),e(r.exports,"generateStringWithSequence",function(){return eM}),e(r.exports,"getAbsoluteRefTypeWitString",function(){return eD}),e(r.exports,"serializeRange",function(){return eP}),e(r.exports,"serializeRangeWithSheet",function(){return ew}),e(r.exports,"serializeRangeWithSpreadsheet",function(){return eF}),e(r.exports,"serializeRangeToRefString",function(){return ej}),e(r.exports,"singleReferenceToGrid",function(){return eB}),e(r.exports,"deserializeRangeWithSheet",function(){return e$}),e(r.exports,"isReferenceStringWithEffectiveColumn",function(){return eY}),e(r.exports,"getRangeWithRefsString",function(){return eG}),e(r.exports,"isReferenceStrings",function(){return eq}),e(r.exports,"LexerTreeBuilder",function(){return e0}),e(r.exports,"stripErrorMargin",function(){return r7}),e(r.exports,"handleNumfmtInCell",function(){return at}),e(r.exports,"NullValueObject",function(){return as}),e(r.exports,"RangeReferenceObject",function(){return aM}),e(r.exports,"functionArray",function(){return aw}),e(r.exports,"CustomFunction",function(){return a3}),e(r.exports,"FUNCTION_NAMES_COMPATIBILITY",function(){return a8}),e(r.exports,"functionCompatibility",function(){return ne}),e(r.exports,"functionCube",function(){return nt}),e(r.exports,"FUNCTION_NAMES_CUBE",function(){return nr}),e(r.exports,"functionDatabase",function(){return na}),e(r.exports,"FUNCTION_NAMES_DATABASE",function(){return nn}),e(r.exports,"FUNCTION_NAMES_DATE",function(){return ni}),e(r.exports,"functionDate",function(){return it}),e(r.exports,"FUNCTION_NAMES_ENGINEERING",function(){return ia}),e(r.exports,"functionEngineering",function(){return st}),e(r.exports,"FUNCTION_NAMES_FINANCIAL",function(){return sr}),e(r.exports,"functionFinancial",function(){return ud}),e(r.exports,"FUNCTION_NAMES_INFORMATION",function(){return uN}),e(r.exports,"functionInformation",function(){return uD}),e(r.exports,"FUNCTION_NAMES_LOGICAL",function(){return uj}),e(r.exports,"functionLogical",function(){return u1}),e(r.exports,"FUNCTION_NAMES_LOOKUP",function(){return la}),e(r.exports,"functionLookup",function(){return lO}),e(r.exports,"FUNCTION_NAMES_MATH",function(){return on}),e(r.exports,"functionMath",function(){return oz}),e(r.exports,"functionMeta",function(){return o6}),e(r.exports,"FUNCTION_NAMES_STATISTICAL",function(){return o7}),e(r.exports,"functionStatistical",function(){return cb}),e(r.exports,"FUNCTION_NAMES_TEXT",function(){return cS}),e(r.exports,"functionText",function(){return cF}),e(r.exports,"functionUniver",function(){return cj}),e(r.exports,"functionWeb",function(){return cB}),e(r.exports,"FUNCTION_NAMES_WEB",function(){return ck}),e(r.exports,"FormulaDataModel",function(){return cz}),e(r.exports,"initSheetFormulaData",function(){return cZ}),e(r.exports,"SetArrayFormulaDataMutation",function(){return cJ}),e(r.exports,"SetFormulaCalculationStartMutation",function(){return c0}),e(r.exports,"SetFormulaCalculationStopMutation",function(){return c1}),e(r.exports,"SetFormulaCalculationNotificationMutation",function(){return c2}),e(r.exports,"SetFormulaCalculationResultMutation",function(){return c3}),e(r.exports,"SetFormulaDataMutation",function(){return c5}),e(r.exports,"IDefinedNamesService",function(){return c6}),e(r.exports,"FormulaExecuteStageType",function(){return hd}),e(r.exports,"FormulaExecutedStateType",function(){return hN}),e(r.exports,"IFunctionService",function(){return hV}),e(r.exports,"SetDefinedNameMutation",function(){return fi}),e(r.exports,"RemoveDefinedNameMutation",function(){return fs}),e(r.exports,"SetOtherFormulaMutation",function(){return fo}),e(r.exports,"RemoveOtherFormulaMutation",function(){return fc}),e(r.exports,"IActiveDirtyManagerService",function(){return fW}),e(r.exports,"UniverFormulaEnginePlugin",function(){return f5});var L,P=t("7yNYd"),w=t("1mjSk"),F=t("k2g5B"),j=Object.defineProperty,B=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>j(e,"name",{value:t,configurable:!0}),$=(e,t,r)=>B(e,"symbol"!=typeof t?t+"":t,r);function H(e,t,r,a,n){for(let i=0,s=e.length;i<s;i++){let s=e[i];if(t!==s.unitId||r!==s.sheetId)continue;let{startRow:u,startColumn:l,endRow:o,endColumn:c}=s.range;if(a>=u&&a<=o&&n>=l&&n<=c)return!0}return!1}k(H,"isInDirtyRange");var Y=((n=Y||{}).DIV_BY_ZERO="#DIV/0!",n.NAME="#NAME?",n.VALUE="#VALUE!",n.NUM="#NUM!",n.NA="#N/A",n.CYCLE="#CYCLE!",n.REF="#REF!",n.SPILL="#SPILL!",n.CALC="#CALC!",n.ERROR="#ERROR!",n.CONNECT="#GETTING_DATA",n.NULL="#NULL!",n);let G=new Set(Object.values(Y)),q=[...new Set(Object.values(Y).map(e=>e.length))];var W=((i=W||{})[i.Financial=0]="Financial",i[i.Date=1]="Date",i[i.Math=2]="Math",i[i.Statistical=3]="Statistical",i[i.Lookup=4]="Lookup",i[i.Database=5]="Database",i[i.Text=6]="Text",i[i.Logical=7]="Logical",i[i.Information=8]="Information",i[i.Engineering=9]="Engineering",i[i.Cube=10]="Cube",i[i.Compatibility=11]="Compatibility",i[i.Web=12]="Web",i[i.Array=13]="Array",i[i.Univer=14]="Univer",i[i.User=15]="User",i[i.DefinedName=16]="DefinedName",i),Q=((s=Q||{}).PLUS="+",s.MINUS="-",s.MULTIPLY="*",s.DIVIDED="/",s.CONCATENATE="&",s.POWER="^",s.EQUALS="=",s.NOT_EQUAL="<>",s.GREATER_THAN=">",s.GREATER_THAN_OR_EQUAL=">=",s.LESS_THAN="<",s.LESS_THAN_OR_EQUAL="<=",s),X=((u=X||{}).EQUALS="=",u.NOT_EQUAL="<>",u.GREATER_THAN=">",u.GREATER_THAN_OR_EQUAL=">=",u.LESS_THAN="<",u.LESS_THAN_OR_EQUAL="<=",u);let K=/* @__PURE__ */new Map([["<>",3],["<",3],[">=",3],["=",3],[">",3],["<=",3],["&",2],["+",2],["-",2],["/",1],["*",1],["^",0]]),z=new Set(K.keys()),Z=/* @__PURE__ */new Set(["=","<>",">",">=","<","<="]);var J=((l=J||{}).OPEN_BRACKET="(",l.CLOSE_BRACKET=")",l.COMMA=",",l.SINGLE_QUOTATION="'",l.DOUBLE_QUOTATION='"',l.OPEN_BRACES="{",l.CLOSE_BRACES="}",l.COLON=":",l.OPEN_SQUARE_BRACKET="[",l.CLOSE_SQUARE_BRACKET="]",l),ee=((o=ee||{}).PERCENTAGE="%",o.POUND="#",o);let et=/* @__PURE__ */new Set(["%","#"]);var er=((c=er||{}).AT="@",c.MINUS="-",c);let ea=[...Object.values(X),...Object.values(Q),...Object.values(J),...Object.values(ee),...Object.values(er)];function en(e){return ea.includes(e)}function ei(e){for(let t of ea)if(e.indexOf(t)>-1)return!0;return!1}function es(e){return"'"===e[0]&&"'"===e[e.length-1]?e.substring(1,e.length-1):e}function eu(e){return en(e)&&e!==J.CLOSE_BRACES&&e!==J.CLOSE_BRACKET&&e!==J.SINGLE_QUOTATION&&e!==J.DOUBLE_QUOTATION||" "===e}function el(e){let t={};return Object.keys(e).forEach(r=>{let a=e[r];if(null==a)return!0;null==t[r]&&(t[r]={}),Object.keys(a).forEach(e=>{let n=a[e];t[r][e]=new P.ObjectMatrix(n)})}),t}function eo(e){let t={};return Object.keys(e).forEach(r=>{let a=e[r];if(null==a)return!0;null==t[r]&&(t[r]={}),Object.keys(a).forEach(e=>{let n=a[e];t[r][e]=n.getData()})}),t}k(en,"isFormulaLexerToken"),k(ei,"includeFormulaLexerToken"),k(es,"normalizeSheetName"),k(eu,"matchRefDrawToken"),k(el,"convertUnitDataToRuntime"),k(eo,"convertRuntimeToUnitData");let ec="LR_1",eh="LO_1",em="LAMBDA",ef=class e{constructor(){$(this,"_parent"),$(this,"_token","R_1"),$(this,"_children",[]),$(this,"_lambdaId"),$(this,"_functionDefinitionPrivacyVar"),$(this,"_lambdaParameter",""),$(this,"_startIndex",-1),$(this,"_endIndex",-1),$(this,"_definedNames",[])}dispose(){var e;this._children.forEach(e=>{"string"!=typeof e&&e.dispose()}),null==(e=this._functionDefinitionPrivacyVar)||e.clear(),this._parent=null}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(e){this._lambdaId=e}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(e){this._functionDefinitionPrivacyVar=e}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(e){this._lambdaParameter=e}getParent(){return this._parent}setParent(e){this._parent=e}getChildren(){return this._children}setChildren(e){this._children=e}addChildren(e){this._children.push(e)}addChildrenFirst(e){this._children.unshift(e)}getToken(){return this._token}setToken(e){this._token=e}setIndex(e,t){this._startIndex=e,this._endIndex=t}setDefinedNames(e){this._definedNames=e}hasDefinedNames(){return this._definedNames.length>0}replaceChild(e,t){let r=this._getIndexInParent(e);null!=r&&(this.getChildren().splice(r,1,t),t.setParent(this))}changeToParent(e){let t=this.getParent();t&&t.removeChild(this),this.setParent(e),e.getChildren().push(this)}removeChild(e){let t=this._getIndexInParent(e);null!=t&&this.getChildren().splice(t,1)}serialize(){let t=this.getToken(),r=this.getChildren(),a=[],n=r.length;for(let t=0;t<n;t++){let n=r[t];n instanceof e?a.push(n.serialize()):a.push(n)}return{token:t,st:this._startIndex,ed:this._endIndex,children:a}}_getIndexInParent(e){let t=this.getChildren(),r=t.length;for(let a=0;a<r;a++)if(t[a]===e)return a}};k(ef,"LexerNode");let eg=class{constructor(e){$(this,"_cache"),this._cache=new P.LRUMap(e)}set(e,t){let r=this._hash(e);this._cache.set(r,t)}get(e){let t=this._hash(e);return this._cache.get(t)}clear(){this._cache.clear()}_hash(e){return(0,P.hashAlgorithm)(e)}};k(eg,"FormulaAstLRU");let ed='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',eN="\\s*?:\\s*?",e_="[A-Za-z]+",eE="[1-9][0-9]*",eC=`'?(${ed})?(((?![\\[\\]\\/?*\\\\]).)*!)?'?`,ep=`\\$?${e_}\\$?${eE}`,eA=`^(${er.AT})?${eC}${ep}${eN}${ep}$`,eb=`^${eC}\\s*?${ep}(${ee.POUND})?$`,ey=`^${eC}\\$?${eE}${eN}\\$?${eE}$`,eR=`^${eC}\\$?${e_}${eN}\\$?${e_}$`,eS=`^${eC}\\s*?\\$?${eE}$`,eO=`^${eC}\\s*?\\$?${e_}$`,eT="[.*?]";function eV(e){return new RegExp(eb).test(e)||new RegExp(eA).test(e)||new RegExp(ey).test(e)||new RegExp(eR).test(e)}k(eV,"isReferenceString");var eI=((h=eI||{})[h.NORMAL=0]="NORMAL",h[h.NUMBER=1]="NUMBER",h[h.STRING=2]="STRING",h[h.FUNCTION=3]="FUNCTION",h[h.REFERENCE=4]="REFERENCE",h[h.ARRAY=5]="ARRAY",h[h.DEFINED_NAME=6]="DEFINED_NAME",h);function eM(e){let t="";for(let r of e)"string"==typeof r?t+=r:t+=r.token;return t}k(eM,"generateStringWithSequence");let ex=/[^0-9]/g,ev=/[^A-Za-z]/g;function eU(e){let t="$"===e[0],r=e.substring(1),a=r.indexOf("$")>-1;return(0,P.Tools).isStringNumber(r)&&t&&!a&&(t=!1,a=!0),t&&a?P.AbsoluteRefType.ALL:t?P.AbsoluteRefType.COLUMN:a?P.AbsoluteRefType.ROW:P.AbsoluteRefType.NONE}function eD(e){let t=e.split("!");t.length>1&&(e=t[t.length-1]);let r=e.split(":");return r.length>1?{startAbsoluteRefType:eU(r[0]),endAbsoluteRefType:eU(r[1])}:{startAbsoluteRefType:eU(r[0])}}function eL(e=P.AbsoluteRefType.NONE){let t="",r="";return e===P.AbsoluteRefType.ROW?t="$":e===P.AbsoluteRefType.COLUMN?r="$":e===P.AbsoluteRefType.ALL&&(t="$",r="$"),{rowAbsoluteString:t,columnAbsoluteString:r}}function eP(e){let{startColumn:t,startRow:r,endColumn:a,endRow:n,startAbsoluteRefType:i,endAbsoluteRefType:s,rangeType:u=P.RANGE_TYPE.NORMAL}=e,l=eL(i),o=eL(s);if(u===P.RANGE_TYPE.ROW||u===P.RANGE_TYPE.ALL){let e=`${l.rowAbsoluteString}${r+1}`,t=`${o.rowAbsoluteString}${n+1}`;return`${e}:${t}`}if(u===P.RANGE_TYPE.COLUMN){let e=`${l.columnAbsoluteString}${(0,P.Tools).chatAtABC(t)}`,r=`${o.columnAbsoluteString}${(0,P.Tools).chatAtABC(a)}`;return`${e}:${r}`}let c=`${l.columnAbsoluteString}${(0,P.Tools).chatAtABC(t)}${l.rowAbsoluteString}${r+1}`,h=`${o.columnAbsoluteString}${(0,P.Tools).chatAtABC(a)}${o.rowAbsoluteString}${n+1}`;return c===h?c:`${c}:${h}`}function ew(e,t){return eW(e)?`'${e}'!${eP(t)}`:`${e}!${eP(t)}`}function eF(e,t,r){return eW(e)||eW(t)?`'[${e}]${t}'!${eP(r)}`:`[${e}]${t}!${eP(r)}`}function ej(e){let{unitId:t,sheetName:r,range:a}=e;return null!=t&&t.length>0&&null!=r&&r.length>0?eF(t,r,a):null!=r&&r.length>0?ew(r,a):eP(a)}function eB(e){return{row:Number.parseInt(e.replace(ex,""))-1,column:(0,P.Tools).ABCatNum(e.replace(ev,"")),absoluteRefType:eU(e)}}function ek(e){let t=new RegExp(ed).exec(e),r="";null!=t&&(r=(r=t[0].trim()).slice(1,r.length-1),e=e.replace(new RegExp(ed),""));let a=e.indexOf("!"),n="",i="";return a>-1?("'"===(n=e.substring(0,a))[0]&&"'"===n[n.length-1]&&(n=n.substring(1,n.length-1)),i=e.substring(a+1)):i=e,{refBody:i,sheetName:n,unitId:r}}function e$(e){let{refBody:t,sheetName:r,unitId:a}=ek(e),n=t.indexOf(":");if(-1===n){let e=eB(t),n=e.row,i=e.column,s=e.absoluteRefType;return{unitId:a,sheetName:r,range:{startRow:n,startColumn:i,endRow:n,endColumn:i,startAbsoluteRefType:s,endAbsoluteRefType:s}}}let i=t.substring(0,n),s=t.substring(n+1),u=eB(i),l=eB(s),o=u.row,c=u.column,h=l.row,m=l.column,f=P.RANGE_TYPE.NORMAL;return Number.isNaN(o)&&Number.isNaN(h)?f=P.RANGE_TYPE.COLUMN:Number.isNaN(c)&&Number.isNaN(m)&&(f=P.RANGE_TYPE.ROW),{unitId:a,sheetName:r,range:{startRow:o,startColumn:c,endRow:h,endColumn:m,startAbsoluteRefType:u.absoluteRefType,endAbsoluteRefType:l.absoluteRefType,rangeType:f}}}k(eU,"getAbsoluteRefTypeWithSingleString"),k(eD,"getAbsoluteRefTypeWitString"),k(eL,"_getAbsoluteToken"),k(eP,"serializeRange"),k(ew,"serializeRangeWithSheet"),k(eF,"serializeRangeWithSpreadsheet"),k(ej,"serializeRangeToRefString"),k(eB,"singleReferenceToGrid"),k(ek,"handleRefStringInfo"),k(e$,"deserializeRangeWithSheet");let eH=["LOG10"];function eY(e){if(!eV(e)||eH.includes(e.toUpperCase().trim()))return!1;let{range:t}=e$(e);return!(t.endColumn>=16384)}function eG(e,t){let r=(null==e?void 0:e.split(","))||[];return""===e||0===r.length?[]:eq(e)?r.map(e=>{let r=e$(e);return{unitId:r.unitId,sheetId:t(r.sheetName),range:r.range,sheetName:r.sheetName}}):[]}function eq(e){return((null==e?void 0:e.split(","))||[]).every(e=>eY(e.trim()))}function eW(e){return 0!==e.length&&!!(ei(e)||eQ(e)||eX(e)||eK(e)||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?]/.test(e))}function eQ(e){let t=e.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(e)&&null!==t}function eX(e){return/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(e)}function eK(e){return!RegExp("^\\p{Letter}","u").test(e.charAt(0))}k(eY,"isReferenceStringWithEffectiveColumn"),k(eG,"getRangeWithRefsString"),k(eq,"isReferenceStrings"),k(eW,"needsQuoting"),k(eQ,"isA1Notation"),k(eX,"isR1C1Notation"),k(eK,"startsWithNonAlphabetic");let ez=new eg(1e5),eZ=new eg(1e5),eJ=class extends P.Disposable{constructor(){super(...arguments),$(this,"_currentLexerNode",new ef),$(this,"_upLevel",0),$(this,"_segment",""),$(this,"_bracketState",[]),$(this,"_squareBracketState",0),$(this,"_bracesState",0),$(this,"_singleQuotationState",0),$(this,"_doubleQuotationState",0),$(this,"_lambdaState",!1),$(this,"_colonState",!1),$(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),ez.clear(),eZ.clear()}getUpLevel(){return this._upLevel}isColonClose(){return!1===this._colonState}isColonOpen(){return!0===this._colonState}isDoubleQuotationClose(){return 0===this._doubleQuotationState}isLambdaOpen(){return!0===this._lambdaState}isLambdaClose(){return!1===this._lambdaState}isSingleQuotationClose(){return 0===this._singleQuotationState}isBracesClose(){return 0===this._bracesState}isBracketClose(){return 0===this._bracketState.length}isSquareBracketClose(){return 0===this._squareBracketState}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){let r=this._getCurrentParamIndex(e,t);if(null==r||r===Y.VALUE)return;let a=r[0];if("string"==typeof a)return;let n=a.getParent(),i=a;for(;n;){let e=n.getToken();if("P_1"!==e&&!en(e)&&-1!==n.getStartIndex())return{functionName:e,paramIndex:n.getChildren().indexOf(i)};i=n,n=n.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,a=e[r];for(;(a===J.CLOSE_BRACKET||" "===a)&&r>=0;)a===J.CLOSE_BRACKET&&t++,a=e[--r];let n=this._getCurrentParamIndex(e,e.length-2);if(null==n||n===Y.VALUE)return 0;let i=n[0];if("string"==typeof i)return 0;let s=i.getParent(),u=0;for(n[1]===J.OPEN_BRACKET&&u++;s;){let e=s.getToken();"P_1"!==e&&e!==J.COLON&&-1!==s.getStartIndex()&&e.toUpperCase()!==em&&(0===t?u+=1:t--),s=s.getParent()}return u}sequenceNodesBuilder(e){let t=eZ.get(e);if(t)return[...t];let r=this._getSequenceArray(e);if(0===r.length)return;let a=this.getSequenceNode(r);return eZ.set(e,[...a]),a}convertRefersToAbsolute(e,t,r){let a=this.sequenceNodesBuilder(e);if(null==a)return e;let n="";e.substring(0,1)===Q.EQUALS&&(n=Q.EQUALS);for(let e=0,n=a.length;e<n;e++){let i=a[e];if("string"!=typeof i&&i.nodeType===eI.REFERENCE){let{token:s,endIndex:u}=i,l=e$(s);if(null==l)continue;let{range:o,sheetName:c,unitId:h}=l,m=ej({range:{...o,startAbsoluteRefType:t,endAbsoluteRefType:r},unitId:h,sheetName:c}),f=m.length-s.length;a[e]={...i,token:m,endIndex:u+f};for(let t=e+1;t<n;t++){let e=a[t];"string"!=typeof e&&(e.startIndex+=f,e.endIndex+=f)}}}return`${n}${eM(a)}`}moveFormulaRefOffset(e,t,r,a=!1){let n=this.sequenceNodesBuilder(e);if(null==n)return e;let i=[];for(let e=0,s=n.length;e<s;e++){let s=n[e];if("string"==typeof s||s.nodeType!==eI.REFERENCE){i.push(s);continue}let{token:u}=s,l=e$(u),{sheetName:o,unitId:c}=l,h=l.range;if(a||h.startAbsoluteRefType!==P.AbsoluteRefType.ALL||h.endAbsoluteRefType!==P.AbsoluteRefType.ALL)h=(0,P.moveRangeByOffset)(h,t,r,a);else{i.push(s);continue}let m="";m=(0,P.isValidRange)(h)?ej({range:h,unitId:c,sheetName:o}):Y.REF,i.push({...s,token:m})}return`=${eM(i)}`}_formulaSpellCheck(){if(0===this._currentLexerNode.getChildren().length)return!0;let e=this._currentLexerNode.getChildren()[0];return!!(e instanceof ef||z.has(e)||et.has(e)||e===er.AT||e===J.COMMA||e===J.COLON||e===J.OPEN_BRACKET)}getSequenceNode(e){let t=[],r=!1;for(let a=0,n=e.length;a<n;a++){let i=e[a],s=e[a-1],{segment:u,currentString:l}=i;if(l===J.DOUBLE_QUOTATION&&(r=!0),(""!==u||0===a)&&a!==n-1){t.push(l);continue}let o=(null==s?void 0:s.segment)||"",c=a-o.length,h=a-1,m=a-1;if(a===n-1&&this._isLastMergeString(l)&&(o+=l,h+=1),""===o||K.has(o)){t.push(l);continue}let f=o.trim(),g=this._replacePrefixString(f);if(!0===r&&f[f.length-1]===J.DOUBLE_QUOTATION&&f[0]!==J.OPEN_BRACES)r=!1,this._processPushSequenceNode(t,eI.STRING,o,c,h,m);else if(new RegExp(eb).test(g)&&eY(g)){if(g.length!==f.length){let e=f.length-g.length;m+=e,c+=e,o=this._replacePrefixString(o)}this._processPushSequenceNode(t,eI.REFERENCE,o,c,h,m)}else(0,P.Tools).isStringNumber(f)?this._processPushSequenceNode(t,eI.NUMBER,o,c,h,m):f.length>0&&this._processPushSequenceNode(t,eI.FUNCTION,o,c,h,m);a===n-1&&this._isLastMergeString(l)||t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,a,n,i){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:a,endIndex:n},i)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===J.DOUBLE_QUOTATION||(0,P.Tools).isStringNumber(e)||!en(e)}_mergeSequenceNodeReference(e){let t=[],r=e.length,a=0;for(;a<r;){let r=e[a];if("string"==typeof r){let n=e[a-1];if(r.trim()===J.CLOSE_BRACES&&null!=n&&"string"!=typeof n&&n.nodeType===eI.FUNCTION&&n.token.trim().substring(0,1)===J.OPEN_BRACES){n.nodeType=eI.ARRAY,n.token+=r,n.endIndex+=r.length,a++;continue}t.push(r)}else{let n=e[a+1],i=e[a+2];n===J.COLON&&"string"!=typeof r&&null!=i&&"string"!=typeof i&&eY((r.token+n+i.token).trim())&&(r.nodeType=eI.REFERENCE,r.token+=n+i.token,r.endIndex=i.endIndex,a+=2),t.push(r)}a++}return t}_pushSequenceNode(e,t,r){let a=r-t.startIndex+1;e.splice(e.length-a,a,t)}_replacePrefixString(e){let t=[],r=!1;for(let a=0,n=e.length;a<n;a++){let n=e[a];if(" "!==n||r){if(!r&&(n===er.AT||n===er.MINUS))continue;t.push(n),r=!0}else t.push(n)}return t.join("")}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r,a){if(!0===t){let t=ez.get(e),r=null==a?void 0:a(e);if(t&&!r)return t}this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1");let n=[],i=this._nodeMaker(e,n);if(i===Y.VALUE||0===n.length)return i;let s=!1,u="",l=[];if(r){let{hasDefinedName:e,sequenceString:t,definedNames:a}=r(n);s=e,u=t,l=a}if(s&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1"),(i=this._nodeMaker(`=${u}`))===Y.VALUE))return i;let o=this._getTopNode(this._currentLexerNode);if(o&&(this._currentLexerNode=o),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return Y.VALUE;ez.set(e,this._currentLexerNode)}return s&&this._currentLexerNode.setDefinedNames(l),this._currentLexerNode}_suffixExpressionHandler(e){var t;let r=e.getChildren();if(!r)return!1;let a=r.length,n=[],i=[],s=!0;for(let e=0;e<a;e++){let a=r[e];if(a instanceof ef)s=this._suffixExpressionHandler(a),n.push(a);else{let s=a.trim();if(""===s)continue;if(z.has(s)){if(s===Q.PLUS&&this._deletePlusForPreNode(r[e-1]))continue;if(s!==Q.PLUS&&s!==Q.MINUS&&this._deletePlusForPreNode(r[e-1]))return!1;for(;i.length>0;){let e=null==(t=i[i.length-1])?void 0:t.trim();if(!e||e===J.OPEN_BRACKET)break;let r=K.get(e),a=K.get(s);if(!r||!a)break;if(a>=r)n.push(i.pop());else break}i.push(a)}else if(s===J.OPEN_BRACKET)i.push(a);else if(s===J.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(n,i,r,e);else{if(this._checkCloseBracket(r[e-1]))return!1;n.push(a)}}}return!!s&&this._processSuffixExpressionRemain(n,i,e)}_processSuffixExpressionRemain(e,t,r){let a=e.length,n=e[a-1];for(;t.length>0;){let r=t.pop();if(!(n instanceof ef)&&(r===J.OPEN_BRACKET||r===J.CLOSE_BRACKET))return!1;e.push(r)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,a){var n;if(this._checkOpenBracket(r[a-1])||this._checkOperator(r[a-1]))return!1;for(;t.length>0;){let r=null==(n=t[t.length-1])?void 0:n.trim();if(!r)break;if(r===J.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===J.CLOSE_BRACKET||e instanceof ef}_checkOpenBracket(e){return e===J.OPEN_BRACKET}_checkOperator(e){return null!=e&&!(e instanceof ef)&&z.has(e)}_deletePlusForPreNode(e){if(null==e)return!0;if(!(e instanceof ef)){let t=e.trim();if(z.has(t)||t===J.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new ef}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){let e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){let t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_getLastChildCurrentLexerNode(){let e=this._currentLexerNode.getChildren();if(e&&e.length>0){let t=e[e.length-1];if(t instanceof ef)return t}return!1}_getLastChildCurrent(){let e=this._currentLexerNode.getChildren();return!!e&&e.length>0&&e[e.length-1]}_setParentCurrentLexerNode(){let e=this._currentLexerNode.getParent();return!!e&&(this._currentLexerNode=e,!0)}_setAncestorCurrentLexerNode(){var e,t,r,a,n,i;let s=null==(e=this._currentLexerNode)?void 0:e.getParent(),u=!1;if(s&&"L_1"===s.getToken()){if(null!=(t=null==s?void 0:s.getParent())&&t.getParent()){let e=null==(a=null==(r=this._currentLexerNode.getParent())?void 0:r.getParent())?void 0:a.getParent();e&&(this._currentLexerNode=e),u=!0}}else if(null!=s&&s.getParent()){let e=null==(n=this._currentLexerNode.getParent())?void 0:n.getParent();e&&(this._currentLexerNode=e),u=!0}for(let e=0;e<this._upLevel;e++){let e=null==(i=this._currentLexerNode)?void 0:i.getParent();e&&(this._currentLexerNode=e),u=!!this._currentLexerNode}return u}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(""!==r){let e=this._currentLexerNode.getChildren();if(!(r instanceof ef)&&this.isColonOpen()){let e=new ef;e.setToken(r),e.setParent(this._currentLexerNode),r=e}t?e.unshift(r):e.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){let a=new ef;a.setToken(e),a.setIndex(t-e.length,t-1),this._setCurrentLexerNode(a,r)}_getTopNode(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_findPreviousToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r--}}_negativeCondition(e){return!!(z.has(e)||e===J.OPEN_BRACKET||e===J.COMMA||""===e)}_getSequenceArray(e){let t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new ef,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1}_checkErrorState(){return this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0}_checkSimilarErrorToken(e,t,r){let a=t;if(e!==ee.POUND)return!0;let n=r[++a];for(;" "===n;)n=r[++a];return!!en(n)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<q.length;r++){let a=q[r],n=t.slice(e,e+a).join("").toUpperCase();if(G.has(n))return n}}_nodeMaker(e,t,r){let a=e.replace(/\r/g," ").replace(/\n/g," ");a.substring(0,1)===Q.EQUALS&&(a=a.substring(1));let n=!1;a.substring(0,1)===Q.MINUS&&(a=`0${a}`,n=!0);let i=a.split(""),s=i.length,u=0;for(this._resetTemp();u<s;){let e=i[u];if(r===u)return[this._currentLexerNode,e];if(e===ee.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(u,i)){let e=this._findErrorObject(u,i);if(null==e)return Y.VALUE;this._pushNodeToChildren(e);for(let r=0;r<e.length;r++){let e=i[u];this._pushSegment(e),this._addSequenceArray(t,e,u,n),u++}this._resetSegment();continue}if(e===J.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,u),this._resetSegment()),this._openBracket(1),this._closeLambda();let r=i[u+1];if(r&&r===J.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&u!==s-1)return Y.VALUE;this._addSequenceArray(t,e,u,n),u++,this._addSequenceArray(t,r,u,n),u++,this._closeBracket();continue}r&&this._newAndPushCurrentLexerNode("P_1",u)}else this._pushNodeToChildren(e),this._openBracket(0),this._resetSegment()}else if(e===J.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._pushNodeToChildren(this._segment),this._resetSegment();let t=this._getCurrentBracket();if(0===t)this._pushNodeToChildren(e);else{if(1!==t)return Y.VALUE;let e=i[u+1];if(e&&e===J.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&u!==s-1)return Y.VALUE;this._newAndPushCurrentLexerNode("L_1",u,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&u!==s-1)return Y.VALUE}this._closeBracket()}else if(e===J.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(e),this._openBraces(),!this._formulaSpellCheck())return Y.VALUE}else if(e===J.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(e),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(e===J.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(e),this._openSquareBracket();else if(e===J.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(e),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(e);else if(e===J.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{let e=i[u+1];e&&e===J.DOUBLE_QUOTATION?u++:this._closeDoubleQuotation()}this._pushSegment(e)}else if(e===J.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation();else{let e=i[u+1];e&&e===J.SINGLE_QUOTATION?u++:this._closeSingleQuotation()}this._pushSegment(e)}else if(e===J.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){let e=this._getCurrentBracket();if(1===e||null==e){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&u!==s-1&&null!=e)return Y.VALUE;this._newAndPushCurrentLexerNode("P_1",u)}else{let e=new ef;e.setToken("CUBE");let t=new ef;t.setToken("P_1"),t.changeToParent(e);let r=this._currentLexerNode.getParent();if(!r||r.getToken()!==J.COLON)return Y.VALUE;{let a=r.getParent();if(!a)return Y.VALUE;r.changeToParent(t),a.setChildren([]),e.changeToParent(a)}this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=e,this._newAndPushCurrentLexerNode("P_1",u)}}else if(e===J.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){let t=new ef;t.setToken(e);let r=new ef;r.setToken("P_1"),r.setParent(t);let a=new ef;a.setToken("P_1"),a.setParent(t),t.getChildren().push(r,a);let n=t,i=0;if(this._segmentCount()>0){let e,a,s=0,u=this._segment.trim(),l=u[0],o=u[1];if(l===er.MINUS&&((e=new ef).setToken(er.MINUS),s++),(l===er.AT||o===er.AT)&&((a=new ef).setToken(er.AT),e&&(e.addChildren(a),a.setParent(e)),s++),s>0&&(this._segment=u.slice(s)),i=s,a){if(a.addChildren(t),t.setParent(a),a.getParent()){let e=a.getParent();e&&(n=e)}else n=a}else e&&(n=e,e.addChildren(t),t.setParent(e));let c=new ef;c.setToken(this._segment),c.setParent(r),r.getChildren().push(c),this._resetSegment()}else{let e=this._getLastChildCurrentLexerNode();e&&e.changeToParent(r)}this._setCurrentLexerNode(n),this._currentLexerNode=a,this._openColon(i)}else if(et.has(e)&&this._checkSimilarErrorToken(e,u,i)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);let t=new ef;t.setToken(e);let r=this._getLastChildCurrent();r instanceof ef?r.changeToParent(t):!1!==r&&(t.getChildren().push(r),this._removeLastChild()),this._pushNodeToChildren(t),t.setParent(this._currentLexerNode),this._resetSegment()}else if(z.has(e)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let r=this._segment.trim();if(e===Q.MINUS&&""===r){let r=this._findPreviousToken(i,u-1)||"";if(this._negativeCondition(r)){this._pushSegment(Q.MINUS),this._addSequenceArray(t,e,u,n),u++;continue}}else if(this._segment.length>0&&this._isScientificNotation(i,u,e)){this._pushSegment(e),this._addSequenceArray(t,e,u,n),u++;continue}else this._segment.length>0&&""===r?r=this._segment:(this._pushNodeToChildren(this._segment),r="");if(e===Q.LESS_THAN||e===Q.GREATER_THAN){let a=i[u+1];if(a&&z.has(e+a)){this._pushNodeToChildren(r+e+a),this._resetSegment(),this._addSequenceArray(t,e,u,n),u++,this._addSequenceArray(t,a,u,n),u++;continue}this._pushNodeToChildren(r+e)}else this._pushNodeToChildren(r+e);this._resetSegment()}else this._pushSegment(e);this._addSequenceArray(t,e,u,n),u++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return Y.VALUE}_isScientificNotation(e,t,r){let a=e[t-2];if(a&&Number.isNaN(Number(a))||!(r===Q.MINUS||r===Q.PLUS))return!1;let n=e[t+1];if(n&&Number.isNaN(Number(n)))return!1;let i=e[t-1];return i&&"E"===i.toUpperCase()}_addSequenceArray(e,t,r,a){a&&0===r||null==e||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}};k(eJ,"LexerTreeBuilder");let e0=eJ,e1=class extends P.Disposable{constructor(){super(...arguments),$(this,"pattern","")}getPattern(){return this.pattern}setPattern(e){this.pattern=e}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(e){return!1}};k(e1,"ObjectClassType");let e2=e1;function e3(e){if(null===e)return 0;if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return 0;let r=t.dataStream;return(0,P.BuildTextUtils).transform.getPlainText(r)}return(null==e?void 0:e.v)||0}function e5(e,t,r,a,n){var i;for(let s of Object.keys(n)){let u=n[s],l=null==(i=null==u?void 0:u[a])?void 0:i[r];if(null==l)continue;let o=l.getValue(e,t);if(null!=o)return o}}k(e3,"getCellValue"),k(e5,"getRuntimeFeatureCell");var e4=((m=e4||{}).FALSE="FALSE",m.TRUE="TRUE",m),e6=((f=e6||{})[f.SUCCESS=0]="SUCCESS",f[f.ERROR=1]="ERROR",f),e7=((g=e7||{}).ALL="#All",g.DATA="#Data",g.HEADERS="#Headers",g.TOTALS="#Totals",g),e9=((d=e9||{})[d.FRONT=0]="FRONT",d[d.BACK=1]="BACK",d);let e8=class{constructor(){$(this,"_cache",/* @__PURE__ */new Map),$(this,"_continueBuildingCache",/* @__PURE__ */new Map)}set(e,t,r,a,n){if(!this.shouldContinueBuildingCache(e,t,r,n))return;let i=this._cache.get(e);null==i&&(i=/* @__PURE__ */new Map,this._cache.set(e,i));let s=i.get(t);null==s&&(s=/* @__PURE__ */new Map,i.set(t,s));let u=s.get(r);null==u&&(u=/* @__PURE__ */new Map,s.set(r,u));let l=u.get(a);null==l&&(l=/* @__PURE__ */new Set,u.set(a,l)),l.add(n)}getCellValuePositions(e,t,r){var a,n;return null==(n=null==(a=this._cache.get(e))?void 0:a.get(t))?void 0:n.get(r)}getCellPositions(e,t,r,a){var n,i,s;return null==(s=null==(i=null==(n=this._cache.get(e))?void 0:n.get(t))?void 0:i.get(r))?void 0:s.get(a)}getCellPosition(e,t,r,a,n,i){let s=this.getCellPositions(e,t,r,a);if(null!=s){for(let e of s)if(e>=n&&e<=i)return e}}setContinueBuildingCache(e,t,r,a,n){let i=this._continueBuildingCache.get(e);null==i&&(i=/* @__PURE__ */new Map,this._continueBuildingCache.set(e,i));let s=i.get(t);null==s&&(s=/* @__PURE__ */new Map,i.set(t,s));let u=s.get(r);if(null==u){u={startRow:a,endRow:n},s.set(r,u);return}u.startRow=Math.min(u.startRow,a),u.endRow=Math.max(u.endRow,n)}shouldContinueBuildingCache(e,t,r,a){var n,i;let s=null==(i=null==(n=this._continueBuildingCache.get(e))?void 0:n.get(t))?void 0:i.get(r);if(null==s)return!0;let{startRow:u,endRow:l}=s;return!(a>=u&&a<=l)}canUseCache(e,t,r,a,n){var i,s;if(-1===r||-1===a||-1===n)return!1;let u=null==(s=null==(i=this._continueBuildingCache.get(e))?void 0:i.get(t))?void 0:s.get(r);if(null==u)return!1;let{startRow:l,endRow:o}=u;return!(a>o||n<l)}clear(){this._cache.clear(),this._continueBuildingCache.clear()}};k(e8,"InvertedIndexCache");let te=new e8;var tt=((N=tt||{})[N.MIN=0]="MIN",N[N.MAX=1]="MAX",N),tr=((_=tr||{})[_.NORMAL=0]="NORMAL",_[_.MIN=1]="MIN",_[_.MAX=2]="MAX",_);function ta(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(e,t)=>e.localeCompare(t)}function tn(e){return e.indexOf("*")>-1||e.indexOf("?")>-1}function ti(e,t){let r=tl(t).replace(/~?[*?]/g,e=>e.startsWith("~")?`\\${e.substring(1)}`:"*"===e?".*":"?"===e?".":e);return RegExp(`^${r}$`).test(e)}function ts(e){return e.replace(/~?[*?]/g,e=>e.startsWith("~")?e.substring(1):" ")}function tu(e,t,r){let a=!1;switch(r){case X.EQUALS:a=ti(e,t);break;case X.NOT_EQUAL:a=!ti(e,t);break;case X.GREATER_THAN:case X.GREATER_THAN_OR_EQUAL:a=ti(e,t)||e>ts(t);break;case X.LESS_THAN:case X.LESS_THAN_OR_EQUAL:a=e<ts(t)}return a}function tl(e){return e.replace(/[.+^${}()|[\]\\]/g,"\\$&")}function to(e){switch(e){case 1:return 2;case 0:default:return 0;case -1:return 1}}function tc(e){return -2===e?1:0}k(ta,"getCompare"),k(tn,"isWildcard"),k(ti,"isMatchWildcard"),k(ts,"replaceWildcard"),k(tu,"compareWithWildcard"),k(tl,"escapeRegExp"),k(to,"getMatchModeValue"),k(tc,"getSearchModeValue");let th=class extends e2{constructor(e){super(),this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isError(){return!1}isNull(){return!1}sum(){return td.create(Y.VALUE)}max(){return td.create(Y.VALUE)}min(){return td.create(Y.VALUE)}count(){return td.create(Y.VALUE)}countA(){return td.create(Y.VALUE)}countBlank(){return td.create(Y.VALUE)}getNegative(){return td.create(Y.VALUE)}getReciprocal(){return td.create(Y.VALUE)}plus(e){return td.create(Y.VALUE)}minus(e){return td.create(Y.VALUE)}multiply(e){return td.create(Y.VALUE)}divided(e){return td.create(Y.VALUE)}mod(e){return td.create(Y.VALUE)}map(e){return td.create(Y.NAME)}mapValue(e){return td.create(Y.NAME)}compare(e,t,r=!1){return td.create(Y.NAME)}isEqual(e){return this.compare(e,X.EQUALS)}isNotEqual(e){return this.compare(e,X.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,X.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,X.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,X.LESS_THAN)}isGreaterThan(e){return this.compare(e,X.GREATER_THAN)}concatenateFront(e){return td.create(Y.NAME)}concatenateBack(e){return td.create(Y.NAME)}plusBy(e){return td.create(Y.VALUE)}minusBy(e){return td.create(Y.VALUE)}multiplyBy(e){return td.create(Y.VALUE)}dividedBy(e){return td.create(Y.VALUE)}modInverse(e){return td.create(Y.VALUE)}compareBy(e,t){return td.create(Y.NAME)}concatenate(e,t=e9.FRONT){let r=this.getValue().toString();if("string"==typeof e)t===e9.FRONT?r=e+r:r+=e;else if("number"==typeof e)t===e9.FRONT?r=e.toString()+r:r+=e.toString();else if("boolean"==typeof e){let a=e?"TRUE":"FALSE";t===e9.FRONT?r=a+r:r+=a}return r}pow(e){return td.create(Y.VALUE)}powInverse(e){return td.create(Y.VALUE)}sqrt(){return td.create(Y.VALUE)}cbrt(){return td.create(Y.VALUE)}cos(){return td.create(Y.VALUE)}cosh(){return td.create(Y.VALUE)}acos(){return td.create(Y.VALUE)}acosh(){return td.create(Y.VALUE)}sin(){return td.create(Y.VALUE)}sinh(){return td.create(Y.VALUE)}asin(){return td.create(Y.VALUE)}asinh(){return td.create(Y.VALUE)}tan(){return td.create(Y.VALUE)}tanh(){return td.create(Y.VALUE)}atan(){return td.create(Y.VALUE)}atan2(e){return td.create(Y.VALUE)}atan2Inverse(e){return td.create(Y.VALUE)}atanh(){return td.create(Y.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return td.create(Y.VALUE)}log10(){return td.create(Y.VALUE)}exp(){return td.create(Y.VALUE)}abs(){return td.create(Y.VALUE)}round(e){return td.create(Y.VALUE)}roundInverse(e){return td.create(Y.VALUE)}floor(e){return td.create(Y.VALUE)}floorInverse(e){return td.create(Y.VALUE)}ceil(e){return td.create(Y.VALUE)}ceilInverse(e){return td.create(Y.VALUE)}convertToNumberObjectValue(){return td.create(Y.VALUE)}convertToBooleanObjectValue(){return td.create(Y.VALUE)}};k(th,"BaseValueObject");let tm=th,tf=new eg(1e3),tg=class e extends tm{constructor(e,t=""){super(e),this._errorType=e,this._errorContent=t}static create(t,r=""){let a=`${t}-${r}`,n=tf.get(a);if(n)return n;let i=new e(t,r);return tf.set(a,i),i}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(e){return e.getErrorType()===this.getErrorType()}isError(){return!0}};k(tg,"ErrorValueObject");let td=tg;function tN(e){let t;switch(e){case X.EQUALS:t=X.EQUALS;break;case X.GREATER_THAN:t=X.LESS_THAN;break;case X.GREATER_THAN_OR_EQUAL:t=X.LESS_THAN_OR_EQUAL;break;case X.LESS_THAN:t=X.GREATER_THAN;break;case X.LESS_THAN_OR_EQUAL:t=X.GREATER_THAN_OR_EQUAL;break;case X.NOT_EQUAL:t=X.NOT_EQUAL}return t}k(tN,"reverseCompareOperator");/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var t_,tE,tC="0123456789abcdef",tp="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",tA="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",tb={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},ty=!0,tR="[DecimalError] ",tS=tR+"Invalid argument: ",tO=tR+"Precision limit exceeded",tT=tR+"crypto unavailable",tV="[object Decimal]",tI=Math.floor,tM=Math.pow,tx=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,tv=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,tU=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,tD=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,tL=tp.length-1,tP=tA.length-1,tw={toStringTag:tV};function tF(e){var t,r,a,n=e.length-1,i="",s=e[0];if(n>0){for(i+=s,t=1;t<n;t++)(r=7-(a=e[t]+"").length)&&(i+=tK(r)),i+=a;(r=7-(a=(s=e[t])+"").length)&&(i+=tK(r))}else if(0===s)return"0";for(;s%10==0;)s/=10;return i+s}function tj(e,t,r){if(e!==~~e||e<t||e>r)throw Error(tS+e)}function tB(e,t,r,a){var n,i,s,u;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=7,n=0):(n=Math.ceil((t+1)/7),t%=7),i=tM(10,7-t),u=e[n]%i|0,null==a?t<3?(0==t?u=u/100|0:1==t&&(u=u/10|0),s=r<4&&99999==u||r>3&&49999==u||5e4==u||0==u):s=(r<4&&u+1==i||r>3&&u+1==i/2)&&(e[n+1]/i/100|0)==tM(10,t-2)-1||(u==i/2||0==u)&&(e[n+1]/i/100|0)==0:t<4?(0==t?u=u/1e3|0:1==t?u=u/100|0:2==t&&(u=u/10|0),s=(a||r<4)&&9999==u||!a&&r>3&&4999==u):s=((a||r<4)&&u+1==i||!a&&r>3&&u+1==i/2)&&(e[n+1]/i/1e3|0)==tM(10,t-3)-1,s}function tk(e,t,r){for(var a,n,i=[0],s=0,u=e.length;s<u;){for(n=i.length;n--;)i[n]*=t;for(i[0]+=tC.indexOf(e.charAt(s++)),a=0;a<i.length;a++)i[a]>r-1&&(void 0===i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/r|0,i[a]%=r)}return i.reverse()}function t$(e,t){var r,a,n;if(t.isZero())return t;(a=t.d.length)<32?n=(1/t7(4,r=Math.ceil(a/3))).toString():(r=16,n="2.3283064365386962890625e-10"),e.precision+=r,t=t6(e,1,t.times(n),new e(1));for(var i=r;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}tw.absoluteValue=tw.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),tY(e)},tw.ceil=function(){return tY(new this.constructor(this),this.e+1,2)},tw.clampedTo=tw.clamp=function(e,t){var r=this.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(tS+t);return 0>this.cmp(e)?e:this.cmp(t)>0?t:new r(this)},tw.comparedTo=tw.cmp=function(e){var t,r,a,n,i=this.d,s=(e=new this.constructor(e)).d,u=this.s,l=e.s;if(!i||!s)return u&&l?u!==l?u:i===s?0:!i^u<0?1:-1:NaN;if(!i[0]||!s[0])return i[0]?u:s[0]?-l:0;if(u!==l)return u;if(this.e!==e.e)return this.e>e.e^u<0?1:-1;for(a=i.length,n=s.length,t=0,r=a<n?a:n;t<r;++t)if(i[t]!==s[t])return i[t]>s[t]^u<0?1:-1;return a===n?0:a>n^u<0?1:-1},tw.cosine=tw.cos=function(){var e,t,r=this,a=r.constructor;return r.d?r.d[0]?(e=a.precision,t=a.rounding,a.precision=e+Math.max(r.e,r.sd())+7,a.rounding=1,r=t$(a,t9(a,r)),a.precision=e,a.rounding=t,tY(2==tE||3==tE?r.neg():r,e,t,!0)):new a(1):new a(NaN)},tw.cubeRoot=tw.cbrt=function(){var e,t,r,a,n,i,s,u,l,o,c=this.constructor;if(!this.isFinite()||this.isZero())return new c(this);for(ty=!1,(i=this.s*tM(this.s*this,1/3))&&Math.abs(i)!=1/0?a=new c(i.toString()):(r=tF(this.d),(i=((e=this.e)-r.length+1)%3)&&(r+=1==i||-2==i?"0":"00"),i=tM(r,1/3),e=tI((e+1)/3)-(e%3==(e<0?-1:2)),(a=new c(r=i==1/0?"5e"+e:(r=i.toExponential()).slice(0,r.indexOf("e")+1)+e)).s=this.s),s=(e=c.precision)+3;;)if(a=tH((o=(l=(u=a).times(u).times(u)).plus(this)).plus(this).times(u),o.plus(l),s+2,1),tF(u.d).slice(0,s)===(r=tF(a.d)).slice(0,s)){if("9999"!=(r=r.slice(s-3,s+1))&&(n||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(tY(a,e+1,1),t=!a.times(a).times(a).eq(this));break}if(!n&&(tY(u,e+1,0),u.times(u).times(u).eq(this))){a=u;break}s+=4,n=1}return ty=!0,tY(a,e,c.rounding,t)},tw.decimalPlaces=tw.dp=function(){var e,t=this.d,r=NaN;if(t){if(r=((e=t.length-1)-tI(this.e/7))*7,e=t[e])for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r},tw.dividedBy=tw.div=function(e){return tH(this,new this.constructor(e))},tw.dividedToIntegerBy=tw.divToInt=function(e){var t=this.constructor;return tY(tH(this,new t(e),0,1,1),t.precision,t.rounding)},tw.equals=tw.eq=function(e){return 0===this.cmp(e)},tw.floor=function(){return tY(new this.constructor(this),this.e+1,3)},tw.greaterThan=tw.gt=function(e){return this.cmp(e)>0},tw.greaterThanOrEqualTo=tw.gte=function(e){var t=this.cmp(e);return 1==t||0===t},tw.hyperbolicCosine=tw.cosh=function(){var e,t,r,a,n,i=this,s=i.constructor,u=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return u;r=s.precision,a=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<32?t=(1/t7(4,e=Math.ceil(n/3))).toString():(e=16,t="2.3283064365386962890625e-10"),i=t6(s,1,i.times(t),new s(1),!0);for(var l,o=e,c=new s(8);o--;)l=i.times(i),i=u.minus(l.times(c.minus(l.times(c))));return tY(i,s.precision=r,s.rounding=a,!0)},tw.hyperbolicSine=tw.sinh=function(){var e,t,r,a,n=this,i=n.constructor;if(!n.isFinite()||n.isZero())return new i(n);if(t=i.precision,r=i.rounding,i.precision=t+Math.max(n.e,n.sd())+4,i.rounding=1,(a=n.d.length)<3)n=t6(i,2,n,n,!0);else{e=(e=1.4*Math.sqrt(a))>16?16:0|e,n=t6(i,2,n=n.times(1/t7(5,e)),n,!0);for(var s,u=new i(5),l=new i(16),o=new i(20);e--;)s=n.times(n),n=n.times(u.plus(s.times(l.times(s).plus(o))))}return i.precision=t,i.rounding=r,tY(n,t,r,!0)},tw.hyperbolicTangent=tw.tanh=function(){var e,t,r=this.constructor;return this.isFinite()?this.isZero()?new r(this):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,tH(this.sinh(),this.cosh(),r.precision=e,r.rounding=t)):new r(this.s)},tw.inverseCosine=tw.acos=function(){var e,t=this,r=t.constructor,a=t.abs().cmp(1),n=r.precision,i=r.rounding;return -1!==a?0===a?t.isNeg()?tQ(r,n,i):new r(0):new r(NaN):t.isZero()?tQ(r,n+4,i).times(.5):(r.precision=n+6,r.rounding=1,t=t.asin(),e=tQ(r,n+4,i).times(.5),r.precision=n,r.rounding=i,e.minus(t))},tw.inverseHyperbolicCosine=tw.acosh=function(){var e,t,r=this,a=r.constructor;return r.lte(1)?new a(r.eq(1)?0:NaN):r.isFinite()?(e=a.precision,t=a.rounding,a.precision=e+Math.max(Math.abs(r.e),r.sd())+4,a.rounding=1,ty=!1,r=r.times(r).minus(1).sqrt().plus(r),ty=!0,a.precision=e,a.rounding=t,r.ln()):new a(r)},tw.inverseHyperbolicSine=tw.asinh=function(){var e,t,r=this,a=r.constructor;return!r.isFinite()||r.isZero()?new a(r):(e=a.precision,t=a.rounding,a.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,a.rounding=1,ty=!1,r=r.times(r).plus(1).sqrt().plus(r),ty=!0,a.precision=e,a.rounding=t,r.ln())},tw.inverseHyperbolicTangent=tw.atanh=function(){var e,t,r,a,n=this,i=n.constructor;return n.isFinite()?n.e>=0?new i(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(e=i.precision,t=i.rounding,Math.max(a=n.sd(),e)<-(2*n.e)-1?tY(new i(n),e,t,!0):(i.precision=r=a-n.e,n=tH(n.plus(1),new i(1).minus(n),r+e,1),i.precision=e+4,i.rounding=1,n=n.ln(),i.precision=e,i.rounding=t,n.times(.5))):new i(NaN)},tw.inverseSine=tw.asin=function(){var e,t,r,a,n=this,i=n.constructor;return n.isZero()?new i(n):(t=n.abs().cmp(1),r=i.precision,a=i.rounding,-1!==t?0===t?((e=tQ(i,r+4,a).times(.5)).s=n.s,e):new i(NaN):(i.precision=r+6,i.rounding=1,n=n.div(new i(1).minus(n.times(n)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=a,n.times(2)))},tw.inverseTangent=tw.atan=function(){var e,t,r,a,n,i,s,u,l,o=this,c=o.constructor,h=c.precision,m=c.rounding;if(o.isFinite()){if(o.isZero())return new c(o);if(o.abs().eq(1)&&h+4<=tP)return(s=tQ(c,h+4,m).times(.25)).s=o.s,s}else{if(!o.s)return new c(NaN);if(h+4<=tP)return(s=tQ(c,h+4,m).times(.5)).s=o.s,s}for(c.precision=u=h+10,c.rounding=1,e=r=Math.min(28,u/7+2|0);e;--e)o=o.div(o.times(o).plus(1).sqrt().plus(1));for(ty=!1,t=Math.ceil(u/7),a=1,l=o.times(o),s=new c(o),n=o;-1!==e;)if(n=n.times(l),i=s.minus(n.div(a+=2)),n=n.times(l),void 0!==(s=i.plus(n.div(a+=2))).d[t])for(e=t;s.d[e]===i.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),ty=!0,tY(s,c.precision=h,c.rounding=m,!0)},tw.isFinite=function(){return!!this.d},tw.isInteger=tw.isInt=function(){return!!this.d&&tI(this.e/7)>this.d.length-2},tw.isNaN=function(){return!this.s},tw.isNegative=tw.isNeg=function(){return this.s<0},tw.isPositive=tw.isPos=function(){return this.s>0},tw.isZero=function(){return!!this.d&&0===this.d[0]},tw.lessThan=tw.lt=function(e){return 0>this.cmp(e)},tw.lessThanOrEqualTo=tw.lte=function(e){return 1>this.cmp(e)},tw.logarithm=tw.log=function(e){var t,r,a,n,i,s,u,l=this.constructor,o=l.precision,c=l.rounding;if(null==e)e=new l(10),t=!0;else{if(r=(e=new l(e)).d,e.s<0||!r||!r[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(r=this.d,this.s<0||!r||!r[0]||this.eq(1))return new l(r&&!r[0]?-1/0:1!=this.s?NaN:r?0:1/0);if(t){if(r.length>1)n=!0;else{for(a=r[0];a%10==0;)a/=10;n=1!==a}}if(ty=!1,tB((u=tH(t1(this,s=o+5),t?tW(l,s+10):t1(e,s),s,1)).d,a=o,c))do if(s+=10,u=tH(t1(this,s),t?tW(l,s+10):t1(e,s),s,1),!n){+tF(u.d).slice(a+1,a+15)+1==1e14&&(u=tY(u,o+1,0));break}while(tB(u.d,a+=10,c))return ty=!0,tY(u,o,c)},tw.minus=tw.sub=function(e){var t,r,a,n,i,s,u,l,o,c,h,m,f=this.constructor;if(e=new f(e),!this.d||!e.d)return this.s&&e.s?this.d?e.s=-e.s:e=new f(e.d||this.s!==e.s?this:NaN):e=new f(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.plus(e);if(o=this.d,m=e.d,u=f.precision,l=f.rounding,!o[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!o[0])return new f(3===l?-0:0);e=new f(this)}return ty?tY(e,u,l):e}if(r=tI(e.e/7),c=tI(this.e/7),o=o.slice(),i=c-r){for((h=i<0)?(t=o,i=-i,s=m.length):(t=m,r=c,s=o.length),i>(a=Math.max(Math.ceil(u/7),s)+2)&&(i=a,t.length=1),t.reverse(),a=i;a--;)t.push(0);t.reverse()}else{for((h=(a=o.length)<(s=m.length))&&(s=a),a=0;a<s;a++)if(o[a]!=m[a]){h=o[a]<m[a];break}i=0}for(h&&(t=o,o=m,m=t,e.s=-e.s),s=o.length,a=m.length-s;a>0;--a)o[s++]=0;for(a=m.length;a>i;){if(o[--a]<m[a]){for(n=a;n&&0===o[--n];)o[n]=1e7-1;--o[n],o[a]+=1e7}o[a]-=m[a]}for(;0===o[--s];)o.pop();for(;0===o[0];o.shift())--r;return o[0]?(e.d=o,e.e=tq(o,r),ty?tY(e,u,l):e):new f(3===l?-0:0)},tw.modulo=tw.mod=function(e){var t,r=this.constructor;return e=new r(e),this.d&&e.s&&(!e.d||e.d[0])?e.d&&(!this.d||this.d[0])?(ty=!1,9==r.modulo?(t=tH(this,e.abs(),0,3,1),t.s*=e.s):t=tH(this,e,0,r.modulo,1),t=t.times(e),ty=!0,this.minus(t)):tY(new r(this),r.precision,r.rounding):new r(NaN)},tw.naturalExponential=tw.exp=function(){return t0(this)},tw.naturalLogarithm=tw.ln=function(){return t1(this)},tw.negated=tw.neg=function(){var e=new this.constructor(this);return e.s=-e.s,tY(e)},tw.plus=tw.add=function(e){var t,r,a,n,i,s,u,l,o,c,h=this.constructor;if(e=new h(e),!this.d||!e.d)return this.s&&e.s?this.d||(e=new h(e.d||this.s===e.s?this:NaN)):e=new h(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.minus(e);if(o=this.d,c=e.d,u=h.precision,l=h.rounding,!o[0]||!c[0])return c[0]||(e=new h(this)),ty?tY(e,u,l):e;if(i=tI(this.e/7),a=tI(e.e/7),o=o.slice(),n=i-a){for(n<0?(r=o,n=-n,s=c.length):(r=c,a=i,s=o.length),n>(s=(i=Math.ceil(u/7))>s?i+1:s+1)&&(n=s,r.length=1),r.reverse();n--;)r.push(0);r.reverse()}for((s=o.length)-(n=c.length)<0&&(n=s,r=c,c=o,o=r),t=0;n;)t=(o[--n]=o[n]+c[n]+t)/1e7|0,o[n]%=1e7;for(t&&(o.unshift(t),++a),s=o.length;0==o[--s];)o.pop();return e.d=o,e.e=tq(o,a),ty?tY(e,u,l):e},tw.precision=tw.sd=function(e){var t;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(tS+e);return this.d?(t=tX(this.d),e&&this.e+1>t&&(t=this.e+1)):t=NaN,t},tw.round=function(){var e=this.constructor;return tY(new e(this),this.e+1,e.rounding)},tw.sine=tw.sin=function(){var e,t,r=this,a=r.constructor;return r.isFinite()?r.isZero()?new a(r):(e=a.precision,t=a.rounding,a.precision=e+Math.max(r.e,r.sd())+7,a.rounding=1,r=t4(a,t9(a,r)),a.precision=e,a.rounding=t,tY(tE>2?r.neg():r,e,t,!0)):new a(NaN)},tw.squareRoot=tw.sqrt=function(){var e,t,r,a,n,i,s=this.d,u=this.e,l=this.s,o=this.constructor;if(1!==l||!s||!s[0])return new o(!l||l<0&&(!s||s[0])?NaN:s?this:1/0);for(ty=!1,0==(l=Math.sqrt(+this))||l==1/0?(((t=tF(s)).length+u)%2==0&&(t+="0"),l=Math.sqrt(t),u=tI((u+1)/2)-(u<0||u%2),a=new o(t=l==1/0?"5e"+u:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+u)):a=new o(l.toString()),r=(u=o.precision)+3;;)if(a=(i=a).plus(tH(this,i,r+2,1)).times(.5),tF(i.d).slice(0,r)===(t=tF(a.d)).slice(0,r)){if("9999"!=(t=t.slice(r-3,r+1))&&(n||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(tY(a,u+1,1),e=!a.times(a).eq(this));break}if(!n&&(tY(i,u+1,0),i.times(i).eq(this))){a=i;break}r+=4,n=1}return ty=!0,tY(a,u,o.rounding,e)},tw.tangent=tw.tan=function(){var e,t,r=this,a=r.constructor;return r.isFinite()?r.isZero()?new a(r):(e=a.precision,t=a.rounding,a.precision=e+10,a.rounding=1,(r=r.sin()).s=1,r=tH(r,new a(1).minus(r.times(r)).sqrt(),e+10,0),a.precision=e,a.rounding=t,tY(2==tE||4==tE?r.neg():r,e,t,!0)):new a(NaN)},tw.times=tw.mul=function(e){var t,r,a,n,i,s,u,l,o,c=this.constructor,h=this.d,m=(e=new c(e)).d;if(e.s*=this.s,!h||!h[0]||!m||!m[0])return new c(e.s&&(!h||h[0]||m)&&(!m||m[0]||h)?h&&m?0*e.s:e.s/0:NaN);for(r=tI(this.e/7)+tI(e.e/7),(l=h.length)<(o=m.length)&&(i=h,h=m,m=i,s=l,l=o,o=s),i=[],a=s=l+o;a--;)i.push(0);for(a=o;--a>=0;){for(t=0,n=l+a;n>a;)u=i[n]+m[a]*h[n-a-1]+t,i[n--]=u%1e7|0,t=u/1e7|0;i[n]=(i[n]+t)%1e7|0}for(;!i[--s];)i.pop();return t?++r:i.shift(),e.d=i,e.e=tq(i,r),ty?tY(e,c.precision,c.rounding):e},tw.toBinary=function(e,t){return t8(this,2,e,t)},tw.toDecimalPlaces=tw.toDP=function(e,t){var r=this,a=r.constructor;return r=new a(r),void 0===e?r:(tj(e,0,1e9),void 0===t?t=a.rounding:tj(t,0,8),tY(r,e+r.e+1,t))},tw.toExponential=function(e,t){var r,a=this,n=a.constructor;return void 0===e?r=tG(a,!0):(tj(e,0,1e9),void 0===t?t=n.rounding:tj(t,0,8),r=tG(a=tY(new n(a),e+1,t),!0,e+1)),a.isNeg()&&!a.isZero()?"-"+r:r},tw.toFixed=function(e,t){var r,a,n=this.constructor;return void 0===e?r=tG(this):(tj(e,0,1e9),void 0===t?t=n.rounding:tj(t,0,8),r=tG(a=tY(new n(this),e+this.e+1,t),!1,e+a.e+1)),this.isNeg()&&!this.isZero()?"-"+r:r},tw.toFraction=function(e){var t,r,a,n,i,s,u,l,o,c,h,m,f=this.d,g=this.constructor;if(!f)return new g(this);if(o=r=new g(1),a=l=new g(0),s=(i=(t=new g(a)).e=tX(f)-this.e-1)%7,t.d[0]=tM(10,s<0?7+s:s),null==e)e=i>0?t:o;else{if(!(u=new g(e)).isInt()||u.lt(o))throw Error(tS+u);e=u.gt(t)?i>0?t:o:u}for(ty=!1,u=new g(tF(f)),c=g.precision,g.precision=i=14*f.length;h=tH(u,t,0,1,1),1!=(n=r.plus(h.times(a))).cmp(e);)r=a,a=n,n=o,o=l.plus(h.times(n)),l=n,n=t,t=u.minus(h.times(n)),u=n;return n=tH(e.minus(r),a,0,1,1),l=l.plus(n.times(o)),r=r.plus(n.times(a)),l.s=o.s=this.s,m=1>tH(o,a,i,1).minus(this).abs().cmp(tH(l,r,i,1).minus(this).abs())?[o,a]:[l,r],g.precision=c,ty=!0,m},tw.toHexadecimal=tw.toHex=function(e,t){return t8(this,16,e,t)},tw.toNearest=function(e,t){var r=this,a=r.constructor;if(r=new a(r),null==e){if(!r.d)return r;e=new a(1),t=a.rounding}else{if(e=new a(e),void 0===t?t=a.rounding:tj(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(ty=!1,r=tH(r,e,0,t,1).times(e),ty=!0,tY(r)):(e.s=r.s,r=e),r},tw.toNumber=function(){return+this},tw.toOctal=function(e,t){return t8(this,8,e,t)},tw.toPower=tw.pow=function(e){var t,r,a,n,i,s,u=this,l=u.constructor,o=+(e=new l(e));if(!u.d||!e.d||!u.d[0]||!e.d[0])return new l(tM(+u,o));if((u=new l(u)).eq(1))return u;if(a=l.precision,i=l.rounding,e.eq(1))return tY(u,a,i);if((t=tI(e.e/7))>=e.d.length-1&&(r=o<0?-o:o)<=0x1fffffffffffff)return n=tz(l,u,r,a),e.s<0?new l(1).div(n):tY(n,a,i);if((s=u.s)<0){if(t<e.d.length-1)return new l(NaN);if(1&e.d[t]||(s=1),0==u.e&&1==u.d[0]&&1==u.d.length)return u.s=s,u}return(t=0!=(r=tM(+u,o))&&isFinite(r)?new l(r+"").e:tI(o*(Math.log("0."+tF(u.d))/Math.LN10+u.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?s/0:0):(ty=!1,l.rounding=u.s=1,r=Math.min(12,(t+"").length),(n=t0(e.times(t1(u,a+r)),a)).d&&tB((n=tY(n,a+5,1)).d,a,i)&&(t=a+10,+tF((n=tY(t0(e.times(t1(u,t+r)),t),t+5,1)).d).slice(a+1,a+15)+1==1e14&&(n=tY(n,a+1,0))),n.s=s,ty=!0,l.rounding=i,tY(n,a,i))},tw.toPrecision=function(e,t){var r,a=this,n=a.constructor;return void 0===e?r=tG(a,a.e<=n.toExpNeg||a.e>=n.toExpPos):(tj(e,1,1e9),void 0===t?t=n.rounding:tj(t,0,8),r=tG(a=tY(new n(a),e,t),e<=a.e||a.e<=n.toExpNeg,e)),a.isNeg()&&!a.isZero()?"-"+r:r},tw.toSignificantDigits=tw.toSD=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(tj(e,1,1e9),void 0===t?t=r.rounding:tj(t,0,8)),tY(new r(this),e,t)},tw.toString=function(){var e=this.constructor,t=tG(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()&&!this.isZero()?"-"+t:t},tw.truncated=tw.trunc=function(){return tY(new this.constructor(this),this.e+1,1)},tw.valueOf=tw.toJSON=function(){var e=this.constructor,t=tG(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()?"-"+t:t},k(tF,"digitsToString"),k(tj,"checkInt32"),k(tB,"checkRoundingDigits"),k(tk,"convertBase"),k(t$,"cosine");var tH=function(){function e(e,t,r){var a,n=0,i=e.length;for(e=e.slice();i--;)a=e[i]*t+n,e[i]=a%r|0,n=a/r|0;return n&&e.unshift(n),e}function t(e,t,r,a){var n,i;if(r!=a)i=r>a?1:-1;else for(n=i=0;n<r;n++)if(e[n]!=t[n]){i=e[n]>t[n]?1:-1;break}return i}function r(e,t,r,a){for(var n=0;r--;)e[r]-=n,n=e[r]<t[r]?1:0,e[r]=n*a+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return k(e,"multiplyInteger"),k(t,"compare"),k(r,"subtract"),function(a,n,i,s,u,l){var o,c,h,m,f,g,d,N,_,E,C,p,A,b,y,R,S,O,T,V,I=a.constructor,M=a.s==n.s?1:-1,x=a.d,v=n.d;if(!x||!x[0]||!v||!v[0])return new I(a.s&&n.s&&(x?!v||x[0]!=v[0]:v)?x&&0==x[0]||!v?0*M:M/0:NaN);for(l?(f=1,c=a.e-n.e):(l=1e7,f=7,c=tI(a.e/f)-tI(n.e/f)),T=v.length,S=x.length,E=(_=new I(M)).d=[],h=0;v[h]==(x[h]||0);h++);if(v[h]>(x[h]||0)&&c--,null==i?(b=i=I.precision,s=I.rounding):b=u?i+(a.e-n.e)+1:i,b<0)E.push(1),g=!0;else{if(b=b/f+2|0,h=0,1==T){for(m=0,v=v[0],b++;(h<S||m)&&b--;h++)y=m*l+(x[h]||0),E[h]=y/v|0,m=y%v|0;g=m||h<S}else{for((m=l/(v[0]+1)|0)>1&&(v=e(v,m,l),x=e(x,m,l),T=v.length,S=x.length),R=T,p=(C=x.slice(0,T)).length;p<T;)C[p++]=0;(V=v.slice()).unshift(0),O=v[0],v[1]>=l/2&&++O;do m=0,(o=t(v,C,T,p))<0?(A=C[0],T!=p&&(A=A*l+(C[1]||0)),(m=A/O|0)>1?(m>=l&&(m=l-1),N=(d=e(v,m,l)).length,p=C.length,1==(o=t(d,C,N,p))&&(m--,r(d,T<N?V:v,N,l))):(0==m&&(o=m=1),d=v.slice()),(N=d.length)<p&&d.unshift(0),r(C,d,p,l),-1==o&&(p=C.length,(o=t(v,C,T,p))<1&&(m++,r(C,T<p?V:v,p,l))),p=C.length):0===o&&(m++,C=[0]),E[h++]=m,o&&C[0]?C[p++]=x[R]||0:(C=[x[R]],p=1);while((R++<S||void 0!==C[0])&&b--)g=void 0!==C[0]}E[0]||E.shift()}if(1==f)_.e=c,t_=g;else{for(h=1,m=E[0];m>=10;m/=10)h++;_.e=h+c*f-1,tY(_,u?i+_.e+1:i,s,g)}return _}}();function tY(e,t,r,a){var n,i,s,u,l,o,c,h,m,f=e.constructor;e:if(null!=t){if(!(h=e.d))return e;for(n=1,u=h[0];u>=10;u/=10)n++;if((i=t-n)<0)i+=7,s=t,l=(c=h[m=0])/tM(10,n-s-1)%10|0;else if((m=Math.ceil((i+1)/7))>=(u=h.length)){if(a){for(;u++<=m;)h.push(0);c=l=0,n=1,i%=7,s=i-7+1}else break e}else{for(c=u=h[m],n=1;u>=10;u/=10)n++;i%=7,l=(s=i-7+n)<0?0:c/tM(10,n-s-1)%10|0}if(a=a||t<0||void 0!==h[m+1]||(s<0?c:c%tM(10,n-s-1)),o=r<4?(l||a)&&(0==r||r==(e.s<0?3:2)):l>5||5==l&&(4==r||a||6==r&&(i>0?s>0?c/tM(10,n-s):0:h[m-1])%10&1||r==(e.s<0?8:7)),t<1||!h[0])return h.length=0,o?(t-=e.e+1,h[0]=tM(10,(7-t%7)%7),e.e=-t||0):h[0]=e.e=0,e;if(0==i?(h.length=m,u=1,m--):(h.length=m+1,u=tM(10,7-i),h[m]=s>0?(c/tM(10,n-s)%tM(10,s)|0)*u:0),o)for(;;)if(0==m){for(i=1,s=h[0];s>=10;s/=10)i++;for(s=h[0]+=u,u=1;s>=10;s/=10)u++;i!=u&&(e.e++,1e7==h[0]&&(h[0]=1));break}else{if(h[m]+=u,1e7!=h[m])break;h[m--]=0,u=1}for(i=h.length;0===h[--i];)h.pop()}return ty&&(e.e>f.maxE?(e.d=null,e.e=NaN):e.e<f.minE&&(e.e=0,e.d=[0])),e}function tG(e,t,r){if(!e.isFinite())return t2(e);var a,n=e.e,i=tF(e.d),s=i.length;return t?(r&&(a=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+tK(a):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):n<0?(i="0."+tK(-n-1)+i,r&&(a=r-s)>0&&(i+=tK(a))):n>=s?(i+=tK(n+1-s),r&&(a=r-n-1)>0&&(i=i+"."+tK(a))):((a=n+1)<s&&(i=i.slice(0,a)+"."+i.slice(a)),r&&(a=r-s)>0&&(n+1===s&&(i+="."),i+=tK(a))),i}function tq(e,t){var r=e[0];for(t*=7;r>=10;r/=10)t++;return t}function tW(e,t,r){if(t>tL)throw ty=!0,r&&(e.precision=r),Error(tO);return tY(new e(tp),t,1,!0)}function tQ(e,t,r){if(t>tP)throw Error(tO);return tY(new e(tA),t,r,!0)}function tX(e){var t=e.length-1,r=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function tK(e){for(var t="";e--;)t+="0";return t}function tz(e,t,r,a){var n,i=new e(1),s=Math.ceil(a/7+4);for(ty=!1;;){if(r%2&&re((i=i.times(t)).d,s)&&(n=!0),0===(r=tI(r/2))){r=i.d.length-1,n&&0===i.d[r]&&++i.d[r];break}re((t=t.times(t)).d,s)}return ty=!0,i}function tZ(e){return 1&e.d[e.d.length-1]}function tJ(e,t,r){for(var a,n=new e(t[0]),i=0;++i<t.length;)if((a=new e(t[i])).s)n[r](a)&&(n=a);else{n=a;break}return n}function t0(e,t){var r,a,n,i,s,u,l,o=0,c=0,h=0,m=e.constructor,f=m.rounding,g=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(ty=!1,l=g):l=t,u=new m(.03125);e.e>-2;)e=e.times(u),h+=5;for(l+=a=Math.log(tM(2,h))/Math.LN10*2+5|0,r=i=s=new m(1),m.precision=l;;){if(i=tY(i.times(e),l,1),r=r.times(++c),tF((u=s.plus(tH(i,r,l,1))).d).slice(0,l)===tF(s.d).slice(0,l)){for(n=h;n--;)s=tY(s.times(s),l,1);if(null!=t)return m.precision=g,s;if(!(o<3&&tB(s.d,l-a,f,o)))return tY(s,m.precision=g,f,ty=!0);m.precision=l+=10,r=i=u=new m(1),c=0,o++}s=u}}function t1(e,t){var r,a,n,i,s,u,l,o,c,h,m,f=1,g=e,d=g.d,N=g.constructor,_=N.rounding,E=N.precision;if(g.s<0||!d||!d[0]||!g.e&&1==d[0]&&1==d.length)return new N(d&&!d[0]?-1/0:1!=g.s?NaN:d?0:g);if(null==t?(ty=!1,c=E):c=t,N.precision=c+=10,a=(r=tF(d)).charAt(0),!(15e14>Math.abs(i=g.e)))return o=tW(N,c+2,E).times(i+""),g=t1(new N(a+"."+r.slice(1)),c-10).plus(o),N.precision=E,null==t?tY(g,E,_,ty=!0):g;for(;a<7&&1!=a||1==a&&r.charAt(1)>3;)a=(r=tF((g=g.times(e)).d)).charAt(0),f++;for(i=g.e,a>1?(g=new N("0."+r),i++):g=new N(a+"."+r.slice(1)),h=g,l=s=g=tH(g.minus(1),g.plus(1),c,1),m=tY(g.times(g),c,1),n=3;;){if(s=tY(s.times(m),c,1),tF((o=l.plus(tH(s,new N(n),c,1))).d).slice(0,c)===tF(l.d).slice(0,c)){if(l=l.times(2),0!==i&&(l=l.plus(tW(N,c+2,E).times(i+""))),l=tH(l,new N(f),c,1),null!=t)return N.precision=E,l;if(!tB(l.d,c-10,_,u))return tY(l,N.precision=E,_,ty=!0);N.precision=c+=10,o=s=g=tH(h.minus(1),h.plus(1),c,1),m=tY(g.times(g),c,1),n=u=1}l=o,n+=2}}function t2(e){return String(e.s*e.s/0)}function t3(e,t){var r,a,n;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(a=t.search(/e/i))>0?(r<0&&(r=a),r+=+t.slice(a+1),t=t.substring(0,a)):r<0&&(r=t.length),a=0;48===t.charCodeAt(a);a++);for(n=t.length;48===t.charCodeAt(n-1);--n);if(t=t.slice(a,n)){if(n-=a,e.e=r=r-a-1,e.d=[],a=(r+1)%7,r<0&&(a+=7),a<n){for(a&&e.d.push(+t.slice(0,a)),n-=7;a<n;)e.d.push(+t.slice(a,a+=7));a=7-(t=t.slice(a)).length}else a-=n;for(;a--;)t+="0";e.d.push(+t),ty&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function t5(e,t){var r,a,n,i,s,u,l,o,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),tD.test(t))return t3(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(tv.test(t))r=16,t=t.toLowerCase();else if(tx.test(t))r=2;else if(tU.test(t))r=8;else throw Error(tS+t);for((i=t.search(/p/i))>0?(l=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),s=(i=t.indexOf("."))>=0,a=e.constructor,s&&(i=(u=(t=t.replace(".","")).length)-i,n=tz(a,new a(r),i,2*i)),i=c=(o=tk(t,r,1e7)).length-1;0===o[i];--i)o.pop();return i<0?new a(0*e.s):(e.e=tq(o,c),e.d=o,ty=!1,s&&(e=tH(e,n,4*u)),l&&(e=e.times(54>Math.abs(l)?tM(2,l):r$.pow(2,l))),ty=!0,e)}function t4(e,t){var r,a=t.d.length;if(a<3)return t.isZero()?t:t6(e,2,t,t);r=(r=1.4*Math.sqrt(a))>16?16:0|r,t=t6(e,2,t=t.times(1/t7(5,r)),t);for(var n,i=new e(5),s=new e(16),u=new e(20);r--;)n=t.times(t),t=t.times(i.plus(n.times(s.times(n).minus(u))));return t}function t6(e,t,r,a,n){var i,s,u,l,o=e.precision,c=Math.ceil(o/7);for(ty=!1,l=r.times(r),u=new e(a);;){if(s=tH(u.times(l),new e(t++*t++),o,1),u=n?a.plus(s):a.minus(s),a=tH(s.times(l),new e(t++*t++),o,1),void 0!==(s=u.plus(a)).d[c]){for(i=c;s.d[i]===u.d[i]&&i--;);if(-1==i)break}i=u,u=a,a=s,s=i}return ty=!0,s.d.length=c+1,s}function t7(e,t){for(var r=e;--t;)r*=e;return r}function t9(e,t){var r,a=t.s<0,n=tQ(e,e.precision,1),i=n.times(.5);if((t=t.abs()).lte(i))return tE=a?4:1,t;if((r=t.divToInt(n)).isZero())tE=a?3:2;else{if((t=t.minus(r.times(n))).lte(i))return tE=tZ(r)?a?2:3:a?4:1,t;tE=tZ(r)?a?1:4:a?3:2}return t.minus(n).abs()}function t8(e,t,r,a){var n,i,s,u,l,o,c,h,m,f=e.constructor,g=void 0!==r;if(g?(tj(r,1,1e9),void 0===a?a=f.rounding:tj(a,0,8)):(r=f.precision,a=f.rounding),e.isFinite()){for(s=(c=tG(e)).indexOf("."),g?(n=2,16==t?r=4*r-3:8==t&&(r=3*r-2)):n=t,s>=0&&(c=c.replace(".",""),(m=new f(1)).e=c.length-s,m.d=tk(tG(m),10,n),m.e=m.d.length),i=l=(h=tk(c,10,n)).length;0==h[--l];)h.pop();if(h[0]){if(s<0?i--:((e=new f(e)).d=h,e.e=i,h=(e=tH(e,m,r,a,0,n)).d,i=e.e,o=t_),s=h[r],u=n/2,o=o||void 0!==h[r+1],o=a<4?(void 0!==s||o)&&(0===a||a===(e.s<0?3:2)):s>u||s===u&&(4===a||o||6===a&&1&h[r-1]||a===(e.s<0?8:7)),h.length=r,o)for(;++h[--r]>n-1;)h[r]=0,r||(++i,h.unshift(1));for(l=h.length;!h[l-1];--l);for(s=0,c="";s<l;s++)c+=tC.charAt(h[s]);if(g){if(l>1){if(16==t||8==t){for(s=16==t?4:3,--l;l%s;l++)c+="0";for(l=(h=tk(c,n,t)).length;!h[l-1];--l);for(s=1,c="1.";s<l;s++)c+=tC.charAt(h[s])}else c=c.charAt(0)+"."+c.slice(1)}c=c+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)c="0"+c;c="0."+c}else if(++i>l)for(i-=l;i--;)c+="0";else i<l&&(c=c.slice(0,i)+"."+c.slice(i))}else c=g?"0p+0":"0";c=(16==t?"0x":2==t?"0b":8==t?"0o":"")+c}else c=t2(e);return e.s<0?"-"+c:c}function re(e,t){if(e.length>t)return e.length=t,!0}function rt(e){return new this(e).abs()}function rr(e){return new this(e).acos()}function ra(e){return new this(e).acosh()}function rn(e,t){return new this(e).plus(t)}function ri(e){return new this(e).asin()}function rs(e){return new this(e).asinh()}function ru(e){return new this(e).atan()}function rl(e){return new this(e).atanh()}function ro(e,t){e=new this(e),t=new this(t);var r,a=this.precision,n=this.rounding,i=a+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(r=t.s<0?tQ(this,a,n):new this(0)).s=e.s:!e.d||t.isZero()?(r=tQ(this,i,1).times(.5)).s=e.s:t.s<0?(this.precision=i,this.rounding=1,r=this.atan(tH(e,t,i,1)),t=tQ(this,i,1),this.precision=a,this.rounding=n,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(tH(e,t,i,1)):(r=tQ(this,i,1).times(t.s>0?.25:.75)).s=e.s:r=new this(NaN),r}function rc(e){return new this(e).cbrt()}function rh(e){return tY(e=new this(e),e.e+1,2)}function rm(e,t,r){return new this(e).clamp(t,r)}function rf(e){if(!e||"object"!=typeof e)throw Error(tR+"Object expected");var t,r,a,n=!0===e.defaults,i=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(r=i[t],n&&(this[r]=tb[r]),void 0!==(a=e[r])){if(tI(a)===a&&a>=i[t+1]&&a<=i[t+2])this[r]=a;else throw Error(tS+r+": "+a)}if(r="crypto",n&&(this[r]=tb[r]),void 0!==(a=e[r])){if(!0===a||!1===a||0===a||1===a){if(a){if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(tT)}else this[r]=!1}else throw Error(tS+r+": "+a)}return this}function rg(e){return new this(e).cos()}function rd(e){return new this(e).cosh()}function rN(e){var t,r,a;function n(e){var t,r,a;if(!(this instanceof n))return new n(e);if(this.constructor=n,rA(e)){this.s=e.s,ty?!e.d||e.e>n.maxE?(this.e=NaN,this.d=null):e.e<n.minE?(this.e=0,this.d=[0]):(this.e=e.e,this.d=e.d.slice()):(this.e=e.e,this.d=e.d?e.d.slice():e.d);return}if("number"==(a=typeof e)){if(0===e){this.s=1/e<0?-1:1,this.e=0,this.d=[0];return}if(e<0?(e=-e,this.s=-1):this.s=1,e===~~e&&e<1e7){for(t=0,r=e;r>=10;r/=10)t++;ty?t>n.maxE?(this.e=NaN,this.d=null):t<n.minE?(this.e=0,this.d=[0]):(this.e=t,this.d=[e]):(this.e=t,this.d=[e]);return}if(0*e!=0){e||(this.s=NaN),this.e=NaN,this.d=null;return}return t3(this,e.toString())}if("string"!==a)throw Error(tS+e);return 45===(r=e.charCodeAt(0))?(e=e.slice(1),this.s=-1):(43===r&&(e=e.slice(1)),this.s=1),tD.test(e)?t3(this,e):t5(this,e)}if(k(n,"Decimal"),n.prototype=tw,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=rf,n.clone=rN,n.isDecimal=rA,n.abs=rt,n.acos=rr,n.acosh=ra,n.add=rn,n.asin=ri,n.asinh=rs,n.atan=ru,n.atanh=rl,n.atan2=ro,n.cbrt=rc,n.ceil=rh,n.clamp=rm,n.cos=rg,n.cosh=rd,n.div=r_,n.exp=rE,n.floor=rC,n.hypot=rp,n.ln=rb,n.log=ry,n.log10=rS,n.log2=rR,n.max=rO,n.min=rT,n.mod=rV,n.mul=rI,n.pow=rM,n.random=rx,n.round=rv,n.sign=rU,n.sin=rD,n.sinh=rL,n.sqrt=rP,n.sub=rw,n.sum=rF,n.tan=rj,n.tanh=rB,n.trunc=rk,void 0===e&&(e={}),e&&!0!==e.defaults)for(a=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<a.length;)e.hasOwnProperty(r=a[t++])||(e[r]=this[r]);return n.config(e),n}function r_(e,t){return new this(e).div(t)}function rE(e){return new this(e).exp()}function rC(e){return tY(e=new this(e),e.e+1,3)}function rp(){var e,t,r=new this(0);for(ty=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return ty=!0,new this(1/0);r=t}return ty=!0,r.sqrt()}function rA(e){return e instanceof r$||e&&e.toStringTag===tV||!1}function rb(e){return new this(e).ln()}function ry(e,t){return new this(e).log(t)}function rR(e){return new this(e).log(2)}function rS(e){return new this(e).log(10)}function rO(){return tJ(this,arguments,"lt")}function rT(){return tJ(this,arguments,"gt")}function rV(e,t){return new this(e).mod(t)}function rI(e,t){return new this(e).mul(t)}function rM(e,t){return new this(e).pow(t)}function rx(e){var t,r,a,n,i=0,s=new this(1),u=[];if(void 0===e?e=this.precision:tj(e,1,1e9),a=Math.ceil(e/7),this.crypto){if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(a));i<a;)(n=t[i])>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:u[i++]=n%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(a*=4);i<a;)(n=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((127&t[i+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,i):(u.push(n%1e7),i+=4);i=a/4}else throw Error(tT)}else for(;i<a;)u[i++]=1e7*Math.random()|0;for(a=u[--i],e%=7,a&&e&&(n=tM(10,7-e),u[i]=(a/n|0)*n);0===u[i];i--)u.pop();if(i<0)r=0,u=[0];else{for(r=-1;0===u[0];r-=7)u.shift();for(a=1,n=u[0];n>=10;n/=10)a++;a<7&&(r-=7-a)}return s.e=r,s.d=u,s}function rv(e){return tY(e=new this(e),e.e+1,this.rounding)}function rU(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function rD(e){return new this(e).sin()}function rL(e){return new this(e).sinh()}function rP(e){return new this(e).sqrt()}function rw(e,t){return new this(e).sub(t)}function rF(){var e=0,t=arguments,r=new this(t[0]);for(ty=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return ty=!0,tY(r,this.precision,this.rounding)}function rj(e){return new this(e).tan()}function rB(e){return new this(e).tanh()}function rk(e){return tY(e=new this(e),e.e+1,1)}k(tY,"finalise"),k(tG,"finiteToString"),k(tq,"getBase10Exponent"),k(tW,"getLn10"),k(tQ,"getPi"),k(tX,"getPrecision"),k(tK,"getZeroString"),k(tz,"intPow"),k(tZ,"isOdd"),k(tJ,"maxOrMin"),k(t0,"naturalExponential"),k(t1,"naturalLogarithm"),k(t2,"nonFiniteToString"),k(t3,"parseDecimal"),k(t5,"parseOther"),k(t4,"sine"),k(t6,"taylorSeries"),k(t7,"tinyPow"),k(t9,"toLessThanHalfPi"),k(t8,"toStringBinary"),k(re,"truncate"),k(rt,"abs"),k(rr,"acos"),k(ra,"acosh"),k(rn,"add"),k(ri,"asin"),k(rs,"asinh"),k(ru,"atan"),k(rl,"atanh"),k(ro,"atan2"),k(rc,"cbrt"),k(rh,"ceil$1"),k(rm,"clamp"),k(rf,"config"),k(rg,"cos"),k(rd,"cosh"),k(rN,"clone"),k(r_,"div"),k(rE,"exp"),k(rC,"floor$1"),k(rp,"hypot"),k(rA,"isDecimalInstance"),k(rb,"ln"),k(ry,"log"),k(rR,"log2"),k(rS,"log10"),k(rO,"max"),k(rT,"min"),k(rV,"mod$1"),k(rI,"mul"),k(rM,"pow$1"),k(rx,"random"),k(rv,"round$1"),k(rU,"sign"),k(rD,"sin"),k(rL,"sinh"),k(rP,"sqrt$1"),k(rw,"sub"),k(rF,"sum"),k(rj,"tan"),k(rB,"tanh"),k(rk,"trunc"),tw[Symbol.for("nodejs.util.inspect.custom")]=tw.toString,tw[Symbol.toStringTag]="Decimal";var r$=tw.constructor=rN(tb);function rH(e,t){return new r$(e).add(t).toNumber()}function rY(e,t){return new r$(e).sub(t).toNumber()}function rG(e,t){return new r$(e).mul(t).toNumber()}function rq(e,t){return new r$(e).div(t).toNumber()}function rW(e,t){let r=10**Math.trunc(t),a=rK(e,r);return Math.round(rG(e,r)+a)/r}function rQ(e,t){let r=10**Math.trunc(t),a=rK(e,r);return Math.floor(rG(e,r)+a)/r}function rX(e,t){let r=10**Math.trunc(t),a=rK(e,r);return Math.ceil(rG(e,r)-a)/r}function rK(e,t){return Number.EPSILON*Math.max(1,Math.abs(rG(e,t)))}function rz(e,t){return e-t*Math.floor(e/t)}function rZ(e,t){return e**t}function rJ(e){return Math.sqrt(e)}function r0(e,t){return e===t}function r1(e,t){return e>t}function r2(e,t){return e>=t}function r3(e,t){return e<t}function r5(e,t){return e<=t}function r4(e,t=15){return Number.parseFloat(e.toPrecision(t))}function r6(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}function r7(e,t=12,r=1e-10){let a=r4(e,t);return r6(e,a,r)?a:r4(e)}function r9(e){return e-Math.trunc(e)}tp=new r$(tp),tA=new r$(tA),k(rH,"plus"),k(rY,"minus"),k(rG,"multiply"),k(rq,"divide"),k(rW,"round"),k(rQ,"floor"),k(rX,"ceil"),k(rK,"baseEpsilon"),k(rz,"mod"),k(rZ,"pow"),k(rJ,"sqrt"),k(r0,"equals"),k(r1,"greaterThan"),k(r2,"greaterThanOrEquals"),k(r3,"lessThan"),k(r5,"lessThanOrEquals"),k(r4,"strip"),k(r6,"withinErrorMargin"),k(r7,"stripErrorMargin"),k(r9,"getFractionalPart");let r8=["$","","","","","","","","","","","","","","","","","","","","","","","","","",""],ae={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function at(e,t,r){var a,n;if(null==e||null==t)return t;let i=(null==r?void 0:r.getStyleByCell(e))||e.s,s=(null==r?void 0:r.getStyleByCell(t))||t.s;if(null==i||null==s||"object"!=typeof i||"object"!=typeof s)return t;let u=null==(a=null==i?void 0:i.n)?void 0:a.pattern,l=null==(n=null==s?void 0:s.n)?void 0:n.pattern;return null==u||null==l||(s.n.pattern=u||l),t}function ar(e){return aa(e)?3:ae[(0,P.numfmt).getInfo(e).type||"unknown"]}function aa(e){return!!r8.find(t=>e.includes(t))&&e.startsWith("_(")}function an(e,t,r){if(""===e)return t;if(""===t)return e;let a=ar(e),n=ar(t);return r===Q.PLUS||r===Q.MINUS?4===a&&4===n||11===a&&11===n?"":t:r===Q.MULTIPLY||r===Q.DIVIDED?6===a&&6===n||7===a&&7===n||8===a&&8===n||9===a&&9===n?t:"":e||t}k(at,"handleNumfmtInCell"),k(ar,"getNumberFormatType"),k(aa,"isAccounting"),k(an,"comparePatternPriority");let ai=class e extends tm{static create(){return this._instance=this._instance||new e(0),this._instance}isNull(){return!0}plus(e){return ah.create(0).plus(e)}minus(e){return ah.create(0).minus(e)}multiply(e){return ah.create(0).multiply(e)}divided(e){return ah.create(0).divided(e)}mod(e){return ah.create(0).mod(e)}compare(e,t){return e.isString()?ag.create("").compare(e,t):e.isBoolean()?al.create(!1).compare(e,t):ah.create(0).compare(e,t)}concatenateFront(e){return e.isArray()?e.concatenateBack(ag.create("")):ag.create(this.concatenate(e.getValue(),e9.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(ag.create("")):ag.create(this.concatenate(e.getValue(),e9.BACK))}plusBy(e){return ah.create(0).plusBy(e)}minusBy(e){return ah.create(0).minusBy(e)}multiplyBy(e){return ah.create(0).multiplyBy(e)}dividedBy(e){return ah.create(0).dividedBy(e)}compareBy(e,t){return"string"==typeof e?ag.create("").compareBy(e,t):"boolean"==typeof e?al.create(!1).compareBy(e,t):ah.create(0).compareBy(e,t)}pow(e){return ah.create(0).pow(e)}sqrt(){return ah.create(0).sqrt()}cbrt(){return ah.create(0).cbrt()}cos(){return ah.create(0).cos()}cosh(){return ah.create(0).cosh()}acos(){return ah.create(0).acos()}acosh(){return ah.create(0).acosh()}sin(){return ah.create(0).sin()}sinh(){return ah.create(0).sinh()}asin(){return ah.create(0).asin()}asinh(){return ah.create(0).asinh()}tan(){return ah.create(0).tan()}tanh(){return ah.create(0).tanh()}atan(){return ah.create(0).atan()}atan2(e){return ah.create(0).atan2(e)}atanh(){return ah.create(0).atanh()}log(){return td.create(Y.NUM)}log10(){return td.create(Y.NUM)}exp(){return ah.create(0).exp()}abs(){return ah.create(0).abs()}round(e){return ah.create(0).round(e)}floor(e){return ah.create(0).floor(e)}ceil(e){return ah.create(0).ceil(e)}convertToNumberObjectValue(){return ah.create(0)}convertToBooleanObjectValue(){return al.create(!1)}};k(ai,"NullValueObject"),$(ai,"_instance");let as=ai,au=class e extends tm{constructor(e){super(e),$(this,"_value",!1),this._value=e}static create(t){return t?(this._instanceTrue=this._instanceTrue||new e(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new e(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){let e=this.getValue(),t=0;return e&&(t=1),ah.create(-t)}getReciprocal(){return this.getValue()?ah.create(1):td.create(Y.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,tN(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(t,r){let a=!1;if("string"==typeof t||"number"==typeof t)a=this._compareString(r);else if("boolean"==typeof t){let e=ah.create(t?1:0);return this._convertToNumber().compare(e,r)}return e.create(a)}_compareString(e){switch(e){case X.GREATER_THAN:case X.GREATER_THAN_OR_EQUAL:return!0;case X.EQUALS:case X.LESS_THAN:case X.LESS_THAN_OR_EQUAL:case X.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){let e=this.getValue(),t=0;return e&&(t=1),ah.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return a_(this.getValue())}convertToBooleanObjectValue(){return this}};k(au,"BooleanValueObject"),$(au,"_instanceTrue"),$(au,"_instanceFalse");let al=au,ao=new eg(2e5),ac=class e extends tm{constructor(e){super(e),$(this,"_value",0),this._value=Number(e)}static create(t,r=""){let a=`${t}-${r}`,n=ao.get(a);if(n)return n;let i=new e(t);return r&&i.setPattern(r),ao.set(a,i),i}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return e.create(0).minus(this)}getReciprocal(){return e.create(1).divided(this)}plus(t){if(t.isArray())return t.plus(this);let r=this.plusBy(t.getValue());if(r.isError())return r;let a=an(this.getPattern(),t.getPattern(),Q.PLUS);return e.create(Number(r.getValue()),a)}equalZero(){return 0===this._value}minus(t){if(t.isArray()){let e=t.getNegative();return e.isError()?e:e.plus(this)}let r=this.minusBy(t.getValue());if(r.isError())return r;let a=an(this.getPattern(),t.getPattern(),Q.MINUS);return e.create(Number(r.getValue()),a)}multiply(t){if(t.isArray())return t.multiply(this);let r=this.multiplyBy(t.getValue());if(r.isError())return r;let a=an(this.getPattern(),t.getPattern(),Q.MULTIPLY);return e.create(Number(r.getValue()),a)}divided(t){if(t.isArray()){let e=t.getReciprocal();return e.isError()?e:e.multiply(this)}let r=this.dividedBy(t.getValue());if(r.isError())return r;let a=an(this.getPattern(),t.getPattern(),Q.DIVIDED);return e.create(Number(r.getValue()),a)}mod(t){if(t.isArray())return t.modInverse(this);let r=this.getValue(),a=t.getValue();if(t.isNull())return td.create(Y.DIV_BY_ZERO);if("string"==typeof a)return td.create(Y.VALUE);if("number"==typeof a){if(0===a)return td.create(Y.DIV_BY_ZERO);if(!Number.isFinite(r)||!Number.isFinite(a)||11259e8*Math.abs(a)<=Math.abs(r))return td.create(Y.NUM);let t=rz(r,a);return Number.isFinite(t)?e.create(t):td.create(Y.NUM)}if("boolean"==typeof a){let t=a?1:0;return 0===t?td.create(Y.DIV_BY_ZERO):e.create(rz(r,t))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):ag.create(this.concatenate(e.getValue(),e9.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):ag.create(this.concatenate(e.getValue(),e9.BACK))}compare(e,t){return e.isArray()?e.compare(this,tN(t)):this.compareBy(e.getValue(),t)}plusBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return td.create(Y.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let n=rH(r,a);return Number.isFinite(n)?e.create(n):td.create(Y.NUM)}minusBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return td.create(Y.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let n=rY(r,a);return Number.isFinite(n)?e.create(n):td.create(Y.NUM)}multiplyBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return td.create(Y.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let n=rG(r,a);return Number.isFinite(n)?e.create(n):td.create(Y.NUM)}dividedBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return td.create(Y.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);if(0===a)return td.create(Y.DIV_BY_ZERO);let n=rq(r,a);return Number.isFinite(n)?e.create(n):td.create(Y.NUM)}compareBy(e,t){let r=this.getValue(),a=!1;return"string"==typeof e?a=this._compareString(t):"number"==typeof e?a=this._compareNumber(r,e,t):"boolean"==typeof e&&(a=this._compareBoolean(t)),al.create(a)}_compareString(e){switch(e){case X.EQUALS:case X.GREATER_THAN:case X.GREATER_THAN_OR_EQUAL:return!1;case X.LESS_THAN:case X.LESS_THAN_OR_EQUAL:case X.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return Number.isFinite(e)&&Number.isFinite(t)?this._compareFiniteNumber(e,t,r):this._compareInfinity(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case X.EQUALS:return r0(e,t);case X.GREATER_THAN:return r1(e,t);case X.GREATER_THAN_OR_EQUAL:return r2(e,t);case X.LESS_THAN:return r3(e,t);case X.LESS_THAN_OR_EQUAL:return r5(e,t);case X.NOT_EQUAL:return!r0(e,t)}}_compareBoolean(e){switch(e){case X.EQUALS:case X.GREATER_THAN:case X.GREATER_THAN_OR_EQUAL:return!1;case X.LESS_THAN:case X.LESS_THAN_OR_EQUAL:case X.NOT_EQUAL:return!0}}pow(t){if(t.isArray())return t.powInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return td.create(Y.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let t=rZ(r,a);return Number.isFinite(t)?e.create(t):td.create(Y.NUM)}return"boolean"==typeof a?e.create(rZ(r,a?1:0)):this}sqrt(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=rJ(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}cbrt(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.cbrt(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}cos(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.cos(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}cosh(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.cosh(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}acos(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.acos(t);return Number.isNaN(r)?td.create(Y.NUM):e.create(r)}acosh(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.acosh(t);return Number.isNaN(r)?td.create(Y.NUM):e.create(r)}sin(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.sin(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}sinh(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.sinh(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}asin(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.asin(t);return Number.isNaN(r)?td.create(Y.NUM):e.create(r)}asinh(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.asinh(t);return Number.isNaN(r)?td.create(Y.NUM):e.create(r)}tan(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.tan(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}tanh(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.tanh(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}atan(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.atan(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}atan2(t){if(t.isArray())return t.atan2Inverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return td.create(Y.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);if(0===r&&0===a)return td.create(Y.DIV_BY_ZERO);let t=Math.atan2(r,a);return Number.isFinite(t)?e.create(t):td.create(Y.NUM)}return"boolean"==typeof a?e.create(Math.atan2(r,a?1:0)):this}atanh(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.atanh(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}log(){let t=this.getValue();if("number"==typeof t&&t<=0||!Number.isFinite(t))return td.create(Y.NUM);let r=Math.log(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}log10(){let t=this.getValue();if("number"==typeof t&&t<=0||!Number.isFinite(t))return td.create(Y.NUM);let r=Math.log10(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}exp(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.exp(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}abs(){let t=this.getValue();if(!Number.isFinite(t))return td.create(Y.NUM);let r=Math.abs(t);return Number.isFinite(r)?e.create(r):td.create(Y.NUM)}round(t){if(t.isArray())return t.roundInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return td.create(Y.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let t=r<0?-rW(Math.abs(r),a):rW(r,a);return Number.isFinite(t)?e.create(t):td.create(Y.NUM)}return"boolean"==typeof a?e.create(rW(r,a?1:0)):this}floor(t){if(t.isArray())return t.floorInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return td.create(Y.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let t=r<0?-rQ(Math.abs(r),a):rQ(r,a);return Number.isFinite(t)?e.create(t):td.create(Y.NUM)}return"boolean"==typeof a?e.create(rQ(r,a?1:0)):this}ceil(t){if(t.isArray())return t.ceilInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return td.create(Y.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return td.create(Y.NUM);let t=r<0?-rX(Math.abs(r),a):rX(r,a);return Number.isFinite(t)?e.create(t):td.create(Y.NUM)}return"boolean"==typeof a?e.create(rX(r,a?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return ad(!0)}_compareInfinity(e,t,r){let a=!1;switch(r){case X.EQUALS:a=e===t;break;case X.GREATER_THAN:a=e>t;break;case X.GREATER_THAN_OR_EQUAL:a=e>=t;break;case X.LESS_THAN:a=e<t;break;case X.LESS_THAN_OR_EQUAL:a=e<=t;break;case X.NOT_EQUAL:a=e!==t}return a}};k(ac,"NumberValueObject");let ah=ac,am=new eg(2e5),af=class e extends tm{constructor(e){super(e),$(this,"_value"),this._value=e}static create(t){let r=am.get(t);if(r)return r;let a=new e(t);return am.set(t,a),a}getValue(){return this._value}isString(){return!0}concatenateFront(t){return t.isArray()?t.concatenateBack(this):e.create(this.concatenate(t.getValue(),e9.FRONT))}concatenateBack(t){return t.isArray()?t.concatenateFront(this):e.create(this.concatenate(t.getValue(),e9.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,tN(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let a=this.getValue(),n=!1;if("string"==typeof e){let i=e;if(r||(a=a.toLocaleLowerCase(),i=i.toLocaleLowerCase()),tn(i))return this._checkWildcard(i,t);n=this._compareString(a,i,t)}else"number"==typeof e?n=this._compareNumber(t):"boolean"==typeof e&&(n=this._compareBoolean(t));return al.create(n)}_compareString(e,t,r){switch(r){case X.EQUALS:return e===t;case X.GREATER_THAN:return e>t;case X.GREATER_THAN_OR_EQUAL:return e>=t;case X.LESS_THAN:return e<t;case X.LESS_THAN_OR_EQUAL:return e<=t;case X.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case X.NOT_EQUAL:case X.GREATER_THAN:case X.GREATER_THAN_OR_EQUAL:return!0;case X.EQUALS:case X.LESS_THAN:case X.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case X.EQUALS:case X.GREATER_THAN:case X.GREATER_THAN_OR_EQUAL:return!1;case X.LESS_THAN:case X.LESS_THAN_OR_EQUAL:case X.NOT_EQUAL:return!0}}convertToNumberObjectValue(){return a_(this.getValue())}convertToBooleanObjectValue(){return al.create(!0)}_checkWildcard(e,t){let r=tu(this.getValue().toLocaleLowerCase(),e,t);return al.create(r)}};k(af,"StringValueObject");let ag=af;function ad(e){if("boolean"==typeof e)return al.create(e);let t=!1;if("string"==typeof e){let r=e.toLocaleUpperCase();r===e4.TRUE?t=!0:r===e4.FALSE&&(t=!1)}else t=1===e;return al.create(t)}function aN(e){let t=e.toString();return'"'===t.charAt(0)&&'"'===t.charAt(t.length-1)&&(t=(t=t.slice(1,-1)).replace(/""/g,'"')),ag.create(t)}function a_(e,t=""){if("boolean"==typeof e){let r=0;return e&&(r=1),ah.create(r,t)}return"number"==typeof e?Number.isFinite(e)?ah.create(e,t):td.create(Y.NUM):(0,P.isRealNum)(e)?ah.create(Number(e),t):td.create(Y.VALUE)}function aE(e){return""}function aC(e=[]){let t=[];for(let r=0;r<e.length;r++){let a=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<a.length;e++){let n=a[e];t[r][e]=ay.create(n)}}return t}function ap(e=[]){let t=[];for(let r=0;r<e.length;r++){let a=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<a.length;e++){let n=a[e];null==n?t[r][e]=null:n.isError()?t[r][e]=n.getErrorType():t[r][e]=n.getValue()}}return t}k(ad,"createBooleanValueObjectByRawValue"),k(aN,"createStringValueObjectByRawValue"),k(a_,"createNumberValueObjectByRawValue"),k(aE,"fromObjectToString"),k(aC,"transformToValueObject"),k(ap,"transformToValue");let aA=class e extends tm{constructor(e){super("string"==typeof e?e:aE()),$(this,"_values",[]),$(this,"_rowCount",-1),$(this,"_columnCount",-1),$(this,"_unitId",""),$(this,"_sheetId",""),$(this,"_currentRow",-1),$(this,"_currentColumn",-1),$(this,"_sliceCache",/* @__PURE__ */new Map),$(this,"_flattenCache"),$(this,"_defaultValue",null),$(this,"_flattenPosition"),this._values=this._formatValue(e)}static create(t){return new e(t)}static createByArray(t){return new e({calculateValueList:aC(t),rowCount:t.length,columnCount:t[0].length||0,unitId:"",sheetId:"",row:-1,column:-1})}dispose(){this._values.forEach(e=>{e.forEach(e=>{null==e||e.dispose()})}),this._values=[],this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return(null==(r=this._values[e])?void 0:r[t])||this._defaultValue}getRealValue(e,t){let r=this._values[e];if(null==r)return null;let a=r[t];return null==a?null:a}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){return{startRow:0,endRow:this.getRowCount()-1,startColumn:0,endColumn:this.getColumnCount()-1}}iterator(e){var t;let{startRow:r,endRow:a,startColumn:n,endColumn:i}=this.getRangePosition(),s=this.getArrayValue();for(let u=r;u<=a;u++)for(let r=n;r<=i;r++)if(!1===e((null==(t=s[u])?void 0:t[r])||this._defaultValue,u,r))return}iteratorReverse(e){var t;let{startRow:r,endRow:a,startColumn:n,endColumn:i}=this.getRangePosition(),s=this.getArrayValue();for(let u=a;u>=r;u--)for(let r=i;r>=n;r--)if(!1===e((null==(t=s[u])?void 0:t[r])||this._defaultValue,u,r))return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,a)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:a},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,a)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:a},!1}),e}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||as.create()}getLastCell(){let{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||as.create()}pick(e){let t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){let t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[as.create()]];let a=[];a[0]=[];for(let n=0;n<t;n++)for(let t=0;t<r;t++){let r=e.get(n,t);if(!(null==r||r.isError())&&!0===r.getValue()){let e=this.get(n,t);a[0].push(e)}}return a}flatten(){if(null!=this._flattenCache)return this._flattenCache;let e=[];e[0]=[];for(let t=0;t<this._rowCount;t++)for(let r=0;r<this._columnCount;r++){let a=this.get(t,r);e[0].push(a)}let t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(null!=this._flattenPosition)return this._flattenPosition;let e=[],t=[],r=[],a=[],n=0;for(let i=0;i<this._rowCount;i++)for(let s=0;s<this._columnCount;s++){let u=this.get(i,s);if(null==u||u.isError()||u.isNull()){n++;continue}u.isString()?(e.push(u),r.push(n++)):(t.push(u),a.push(n++))}let i={stringArray:e,numberArray:t,stringPosition:r,numberPosition:a};return this._flattenPosition=i,i}slice(e,t){let r=0,a=this._rowCount,n=1,i=0,s=this._columnCount,u=1;if(null!=e&&(r=e[0]||0,a=e[1]||this._rowCount,n=e[2]||1),null!=t&&(i=t[0]||0,s=t[1]||this._columnCount,u=t[2]||1),r>=this._rowCount||i>=this._columnCount)return;let l=`${r}_${a}_${n}_${i}_${s}_${u}`,o=this._sliceCache.get(l);if(null!=o)return o;let c=[],h=this._values,m=0,f=0;for(let e=r;e<a;e+=n){f=0,null==c[m]&&(c[m]=[]);for(let t=i;t<s;t+=u){if(!h[e])return;let r=h[e][t]||this._defaultValue;null==r&&(r=as.create()),c[m][f]=r,f++}m++}if(0===c.length||0===c[0].length)return;let g=n>1?-1:r+this._currentRow,d=u>1?-1:i+this._currentColumn,N=this._createNewArray(c,c.length,c[0].length,g,d);return N.setDefaultValue(this._defaultValue),this._sliceCache.set(l,N),N}sortByRow(e){let t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){let e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,a=this._createNewArray(e,r,t);return a.setDefaultValue(this._defaultValue),a}orderSearch(e,t=tr.MIN,r=!1,a=!1){let n,i,s,u;let l=/* @__PURE__ */k((r,l,o)=>{let c;return null==r||((null==(c=!0===a?r.compare(e,X.EQUALS):r.isEqual(e))?void 0:c.getValue())===!0?(n=r,s={row:l,column:o},!1):void(t===tr.MAX?!0===r.isGreaterThan(e).getValue()&&(null==i||!0===r.minus(e).abs().isLessThanOrEqual(i.minus(e).abs()).getValue())&&(i=r,u={row:l,column:o}):t===tr.MIN&&!0===r.isLessThan(e).getValue()&&(null==i||!0===r.minus(e).abs().isLessThanOrEqual(i.minus(e).abs()).getValue())&&(i=r,u={row:l,column:o})))},"_handleMatch");return(r?this.iteratorReverse((e,t,r)=>l(e,t,r)):this.iterator((e,t,r)=>l(e,t,r)),null!=n)?s:null!=i?u:void 0}binarySearch(e,t=tt.MIN,r=tr.MIN){if(e.isError())return;let{stringArray:a,stringPosition:n,numberArray:i,numberPosition:s}=this.flattenPosition();return e.isString()?this._binarySearch(e,a,n,t,r):this._binarySearch(e,i,s,t,r)}_binarySearch(e,t,r,a=tt.MIN,n=tr.MIN){let i=ta(),s=Number(e.getValue()),u=!Number.isNaN(s),l=0,o=t.length-1,c=-1,h=-1,m=-1;for(;l<=o;){let r;let n=Math.floor((l+o)/2),f=t[n];if(f.isNull())r=a===tt.MIN?1:-1;else{let t=f.getValue();if(u){let e=Number(t);r=Number.isNaN(e)?1:Math.sign(e-s)}else r=i(t.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(a===tt.MAX&&(r=-r),0===r){c=n;break}r<0?(h=n,l=n+1):(m=n,o=n-1)}return n===tr.NORMAL?-1!==c?r[c]:void 0:n===tr.MIN?-1!==c?r[c]:a===tt.MIN?r[h]:r[m]:n===tr.MAX?-1!==c?r[c]:a===tt.MIN?r[m]:r[h]:void 0}sum(){let e=ah.create(0);return this.iterator(t=>!!(null==t||t.isString()||t.isBoolean()||t.isNull())||(t.isError()?(e=t,!1):void(e=e.plus(t)))),e}max(){let e=ah.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isLessThan(t).getValue()&&(e=t)))),e}min(){let e=ah.create(Number.POSITIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isGreaterThan(t).getValue()&&(e=t)))),e}count(){let e=ah.create(0);return this.iterator(t=>{if(null==t||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=ah.create(0);return this.iterator(t=>{if(null==t||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=ah.create(0);return this.iterator(t=>{(null==t||t.isNull()||""===t.getValue())&&(e=e.plusBy(1))}),e}getNegative(){return e.create("{0}").minus(this)}getReciprocal(){return e.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){let t=/* @__PURE__ */k((t,r,a)=>null==t?as.create():t.isError()?t:e(t,r,a),"wrappedCallbackFn");return this.mapValue(t)}mapValue(e){var t;let r=this._rowCount,a=this._columnCount,n=[];for(let i=0;i<r;i++){let r=[];for(let n=0;n<a;n++){let a=null==(t=this._values)?void 0:t[i];if(null==a)r[n]=td.create(Y.VALUE);else{let t=a[n]||this._defaultValue;t?r[n]=e(t,i,n):r[n]=as.create()}}n.push(r)}return this._createNewArray(n,r,a)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){let t=this.sum(),r=this.count();return t.divided(0===e?r:r.minusBy(1))}median(){let e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||as.create();if(t.sortByRow(0),r%2==0){let e=t.get(0,r/2)||as.create(),a=t.get(0,r/2-1)||as.create();return e.plus(a).divided(ah.create(2))}return t.get(0,(r-1)/2)||as.create()}var(t=0){let r=this.mean(),a=[[]];this.iterator(e=>{if(null==e||e.isError()||e.isString()||e.isBoolean()||e.isNull())return;let t=e.minus(r).pow(ah.create(2));t.isError()||a[0].push(t)});let{_unitId:n,_sheetId:i,_currentRow:s,_currentColumn:u}=this;return e.create({calculateValueList:a,rowCount:1,columnCount:a[0].length,unitId:n,sheetId:i,row:s,column:u}).mean(t)}std(e=0){let t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return ap(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){let t=ta();return(r,a)=>{let n=r[e],i=a[e];return null==n?1:null==i?-1:n.isError()&&n.isError()?0:n.isError()?1:i.isError()?-1:t(n.getValue(),i.getValue())}}_transposeArray(e){let t=e.length,r=e[0].length,a=[];for(let n=0;n<r;n++){a[n]=[];for(let r=0;r<t;r++)a[n][r]=e[r][n]}return a}_batchOperator(e,t,r,a){let n=[],i=this._rowCount,s=this._columnCount;if(e.isArray()){let u=e.getRowCount(),l=e.getColumnCount();if(i=Math.max(u,i),s=Math.max(l,s),1===u&&1===l){let t=e.getFirstCell();for(let e=0;e<s;e++)n.push(t)}else{if(1!==u||!(this._columnCount>1))return this._batchOperatorArray(e,t,r,a);let i=e.getArrayValue();for(let e=0;e<s;e++)n.push(i[0][e])}}else for(let t=0;t<s;t++)n.push(e);let u=[];for(let e=0;e<s;e++){let i=n[e];this._batchOperatorValue(i,e,u,t,r,a)}let l=this._createNewArray(u,i,s);return l.setDefaultValue(al.create(!1)),l}_batchOperatorValue(e,t,r,a,n,i){let s=this._rowCount,u=this.getUnitId(),l=this.getSheetId(),o=this.getCurrentRow(),c=this.getCurrentColumn();if(5===a&&!0===te.canUseCache(u,l,t+c,o,o+s-1)){if(n===X.EQUALS){let a=te.getCellPositions(u,l,t+c,e.getValue());null!=a&&a.forEach(e=>{let a=e-o;null==r[a]&&(r[a]=[]),r[a][t]=al.create(!0)})}else{let a=te.getCellValuePositions(u,l,t+c);null!=a&&a.forEach((a,u)=>{let l=as.create();"string"==typeof u?l=ag.create(u):"number"==typeof u?l=ah.create(u):"boolean"==typeof u&&(l=al.create(u)),!0===l.compare(e,n,i).getValue()&&a.forEach(e=>{e>=o&&e<=o+s-1&&(null==r[e-o]&&(r[e-o]=[]),r[e-o][t]=al.create(!0))})})}return}for(let h=0;h<s;h++){let s=this.getValueOrDefault(h,t);if(null==r[h]&&(r[h]=[]),s&&e){if(s.isError())r[h][t]=s;else if(e.isError())r[h][t]=e;else switch(a){case 1:r[h][t]=s.plus(e);break;case 0:r[h][t]=s.minus(e);break;case 2:r[h][t]=s.multiply(e);break;case 3:r[h][t]=s.divided(e);break;case 4:r[h][t]=s.mod(e);break;case 5:n?r[h][t]=s.compare(e,n,i):r[h][t]=td.create(Y.VALUE);break;case 6:r[h][t]=s.concatenateFront(e);break;case 7:r[h][t]=s.concatenateBack(e);break;case 8:r[h][t]=s.pow(e);break;case 9:r[h][t]=s.round(e);break;case 10:r[h][t]=s.floor(e);break;case 12:r[h][t]=s.atan2(e);break;case 11:r[h][t]=s.ceil(e)}}else r[h][t]=td.create(Y.NA);null!=s&&(s.isError()?te.set(u,l,t+c,s.getErrorType(),h+o):te.set(u,l,t+c,s.getValue(),h+o))}te.setContinueBuildingCache(u,l,t+c,o,o+s-1)}_batchOperatorArray(e,t,r,a){let n=e.getRowCount(),i=e.getColumnCount();n<this._rowCount&&(n=this._rowCount),i<this._columnCount&&(i=this._columnCount);let s=[],u=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let o=0;o<n;o++){let n=[];for(let s=0;s<i;s++){let i,c;if(i=3===u?this.getValueOrDefault(0,0):1===u?this.getValueOrDefault(0,s):2===u?this.getValueOrDefault(o,0):this.getValueOrDefault(o,s),c=3===l?e.getValueOrDefault(0,0):1===l?e.getValueOrDefault(0,s):2===l?e.getValueOrDefault(o,0):e.getValueOrDefault(o,s),i&&c){if(i.isError())n[s]=i;else if(c.isError())n[s]=c;else switch(t){case 1:n[s]=i.plus(c);break;case 0:n[s]=i.minus(c);break;case 2:n[s]=i.multiply(c);break;case 3:n[s]=i.divided(c);break;case 4:n[s]=i.mod(c);break;case 5:r?n[s]=i.compare(c,r,a):n[s]=td.create(Y.VALUE);break;case 6:n[s]=i.concatenateFront(c);break;case 7:n[s]=i.concatenateBack(c);break;case 8:n[s]=i.pow(c);break;case 9:n[s]=i.round(c);break;case 12:n[s]=i.atan2(c);break;case 10:n[s]=i.floor(c);break;case 11:n[s]=i.ceil(c)}}else n[s]=td.create(Y.NA)}s.push(n)}return this._createNewArray(s,n,i)}_checkArrayCalculateType(e){return 1===e.getRowCount()&&1===e.getColumnCount()?3:1===e.getRowCount()?1:1===e.getColumnCount()?2:0}_formatValue(e){if("string"!=typeof e)return this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;let t=(e=e.slice(1,-1)).split(";"),r=t.length,a=[],n=0;for(let e=0;e<r;e++){let r=t[e].split(","),i=r.length;n<i&&(n=i);let s=[];for(let e=0;e<i;e++){let t=r[e].trim();s.push(ay.create(t))}a.push(s)}return this._rowCount=r,this._columnCount=n,a}_createNewArray(t,r,a,n=-1,i=-1){(-1===this._currentColumn||-1===this._currentRow)&&(n=-1,i=-1);let s={calculateValueList:t,rowCount:r,columnCount:a,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:i};return e.create(s)}};k(aA,"ArrayValueObject");let ab=class{static create(e){if(null==e)return as.create();if("boolean"==typeof e)return al.create(e);if("string"==typeof e){let t=e.toLocaleUpperCase().trim();return G.has(t)?td.create(t):t===e4.TRUE||t===e4.FALSE?ad(e):(0,P.isRealNum)(e)?ah.create(Number(e)):RegExp("{.*?}","g").test(e.replace(/\n/g,"").replace(/\r/g,""))?aA.create(e.replace(/\n/g,"").replace(/\r/g,"")):aN(e)}return"number"==typeof e?a_(e):td.create(Y.VALUE)}};k(ab,"ValueObjectFactory");let ay=ab,aR=new eg(1e5),aS=class extends e2{constructor(e){super(),$(this,"_forcedSheetId",""),$(this,"_forcedSheetName",""),$(this,"_defaultSheetId",""),$(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1}),$(this,"_unitData",{}),$(this,"_unitStylesData",{}),$(this,"_defaultUnitId",""),$(this,"_forcedUnitId",""),$(this,"_runtimeData",{}),$(this,"_arrayFormulaCellData",{}),$(this,"_runtimeArrayFormulaCellData",{}),$(this,"_runtimeFeatureCellData",{}),$(this,"_refOffsetX",0),$(this,"_refOffsetY",0),this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){let{startRow:e,endRow:t,startColumn:r,endColumn:a}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||a>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){let{startRow:e,startColumn:t,endRow:r,endColumn:a}=(0,P.moveRangeByOffset)(this._rangeData,this._refOffsetX,this._refOffsetY);return Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=this.getActiveSheetRowCount()-1),Number.isNaN(a)&&(a=this.getActiveSheetColumnCount()-1),{startRow:e,endRow:r,startColumn:t,endColumn:a}}isReferenceObject(){return!0}iterator(e){let{startRow:t,endRow:r,startColumn:a,endColumn:n}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(td.create(Y.VALUE),t,a);let i=this._forcedUnitId||this._defaultUnitId,s=this._forcedSheetId||this._defaultSheetId;for(let u=t;u<=r;u++)for(let r=a;r<=n;r++){if(u<0||r<0)return e(td.create(Y.REF),u,r);let n=this.getCellData(u,r);if((0,P.isNullCell)(n)){e(null,u,r);continue}let l=this.getCellValueObject(n);if(u===t&&r===a){let e=this.getCellPattern(i,s,u,r);if(e&&l.isNumber()){let t=Number(l.getValue());l=ah.create(t,e)}}if(!1===e(l,u,r))return}}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return ah.create(0);let a=this.getCellValueObject(r),n=this._forcedUnitId||this._defaultUnitId,i=this._forcedSheetId||this._defaultSheetId,s=this.getCellPattern(n,i,e,t);if(s&&a.isNumber()){let e=Number(a.getValue());a=ah.create(e,s)}return a}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=null==(t=e[this.getUnitId()])?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnCount)||0}getRowCount(){return this._rangeData.endRow-this._rangeData.startRow+1}getColumnCount(){return this._rangeData.endColumn-this._rangeData.startColumn+1}getRowData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowData)||{}}getColumnData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}unionBy(e){return td.create(Y.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){let t=e3(e);return G.has(t)?td.create(t):e.t===P.CellValueType.NUMBER?a_(t,this._getPatternByCell(e)):e.t===P.CellValueType.STRING||e.t===P.CellValueType.FORCE_STRING?ag.create(t.toString()):e.t===P.CellValueType.BOOLEAN?ad(t):ay.create(t)}_getPatternByCell(e){var t;let r=this._unitStylesData[this.getUnitId()];if(!r)return"";let a=r.getStyleByCell(e);return(null==(t=null==a?void 0:a.n)?void 0:t.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return null==(e=this._unitData[this.getUnitId()])?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return null==(t=null==(e=this._runtimeData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._arrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._runtimeArrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCellData(e,t){let r=this.getCurrentActiveSheetData(),a=this.getCurrentRuntimeSheetData(),n=this.getCurrentActiveArrayFormulaCellData(),i=this.getCurrentRuntimeActiveArrayFormulaCellData();return(null==a?void 0:a.getValue(e,t))||(null==i?void 0:i.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(null==n?void 0:n.getValue(e,t))||(null==r?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return e5(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){e||(e=this._rangeData.startRow),t||(t=this._rangeData.startColumn);let r=this.getCellData(e,t);return r?this.getCellValueObject(r):td.create(Y.VALUE)}getCellPattern(e,t,r,a){var n,i,s,u;let l=this._unitStylesData[e];if(!l)return"";let o=null==(s=null==(i=null==(n=this._unitData[e])?void 0:n[t])?void 0:i.cellData)?void 0:s.getValue(r,a);if(!o)return"";let c=l.getStyleByCell(o);return(null==(u=null==c?void 0:c.n)?void 0:u.pattern)||""}toArrayValueObject(e=!0){var t;let{startRow:r,endRow:a,startColumn:n,endColumn:i}=this.getRangePosition(),s=`${this.getUnitId()}_${this.getSheetId()}_${r}_${a}_${n}_${i}`,u=aR.get(s);if(u&&e)return u;let l=a-r+1,o=i-n+1;if(l<0||o<0)return this._getBlankArrayValueObject();let c=Array(l);this.iterator((e,t,a)=>{let i=t-r,s=a-n;c[i]||(c[i]=Array(o)),null==e&&(e=as.create()),c[i][s]=e});let h={calculateValueList:c,rowCount:c.length,columnCount:(null==(t=c[0])?void 0:t.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:r,column:n},m=aA.create(h);return e&&aR.set(s,m),m}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(null==this._forcedSheetId||0===this._forcedSheetId.length)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){let e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return aA.create(e)}};k(aS,"BaseReferenceObject");let aO=aS,aT=class extends e2{constructor(e){super(),this._promise=e}isAsyncObject(){return!0}async getValue(){return this._promise}};k(aT,"AsyncObject");let aV=class extends e2{constructor(e){super(),this._promiseList=e}isAsyncArrayObject(){return!0}async getValue(){var e;let t=[];for(let e=0;e<this._promiseList.length;e++){let r=this._promiseList[e];null==t[e]&&(t[e]=[]);for(let a=0;a<r.length;a++){let n=r[a];n.isAsyncObject()?t[e][a]=await n.getValue():t[e][a]=n}}let r={calculateValueList:t,rowCount:t.length,columnCount:(null==(e=t[0])?void 0:e.length)||0,unitId:"",sheetId:"",row:0,column:0};return aA.create(r)}};k(aV,"AsyncArrayObject");let aI=class extends aO{constructor(e,t,r){super(""),this.setRangeData(e),t&&this.setForcedSheetIdDirect(t),r&&this.setForcedUnitIdDirect(r)}isRange(){return!0}};k(aI,"RangeReferenceObject");let aM=aI,ax=/[\[\]]/g;function av(e,t){return ax.test(e)?t+Number(e.replace(ax,"")):Number(e)-1}function aU(e,t=0,r=0){let a=(e=e.toLocaleUpperCase()).split(/[RC]/),n=a[1],i=a[2];return{row:av(n,t),column:av(i,r),absoluteRefType:P.AbsoluteRefType.NONE}}function aD(e,t=0,r=0){let{refBody:a,sheetName:n,unitId:i}=ek(e),s=a.indexOf(":");if(-1===s){let e=aU(a,t,r),s=e.row,u=e.column,l=e.absoluteRefType;return{unitId:i,sheetName:n,range:{startRow:s,startColumn:u,endRow:s,endColumn:u,startAbsoluteRefType:l,endAbsoluteRefType:l}}}let u=a.substring(0,s),l=a.substring(s+1),o=aU(u,t,r),c=aU(l,t,r),h=o.row;return{unitId:i,sheetName:n,range:{startRow:h,startColumn:o.column,endRow:c.row,endColumn:c.column,startAbsoluteRefType:o.absoluteRefType,endAbsoluteRefType:c.absoluteRefType}}}function aL(e){let t=aP(e.startRow,e.startAbsoluteRefType,!0),r=aP(e.startColumn,e.startAbsoluteRefType,!1),a=aP(e.endRow,e.endAbsoluteRefType,!0),n=aP(e.endColumn,e.endAbsoluteRefType,!1);return t===a&&r===n?`R${t}C${r}`:`R${t}C${r}:R${a}C${n}`}function aP(e,t=P.AbsoluteRefType.ALL,r){switch(e+=1,t){case P.AbsoluteRefType.ALL:return`${e}`;case P.AbsoluteRefType.ROW:return r?`${e}`:`[${e}]`;case P.AbsoluteRefType.COLUMN:return r?`[${e}]`:`${e}`;case P.AbsoluteRefType.NONE:return`[${e}]`}}k(av,"handleR1C1"),k(aU,"singleReference"),k(aD,"deserializeRangeForR1C1"),k(aL,"serializeRangeToR1C1"),k(aP,"getR1C1Ref");let aw=[],aF=class extends aO{constructor(e){super(e);let t=e$(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName),this.setRangeData(t.range)}isCell(){return!0}unionBy(e){if(!e.isCell())return td.create(Y.REF);let t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(e,t){let r=e.startRow,a=e.startColumn,n=t.startRow,i=t.startColumn,s={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return r>n?(s.startRow=n,s.endRow=r):(s.startRow=r,s.endRow=n),a>i?(s.startColumn=i,s.endColumn=a):(s.startColumn=a,s.endColumn=i),e.startAbsoluteRefType&&(s.startAbsoluteRefType=e.startAbsoluteRefType),t.startAbsoluteRefType&&(s.endAbsoluteRefType=t.startAbsoluteRefType),s}_createRange(e){let t=new aM(e,this.getForcedSheetId(),this.getForcedUnitId());t.setUnitData(this.getUnitData()),t.setDefaultSheetId(this.getDefaultSheetId()),t.setDefaultUnitId(this.getDefaultUnitId()),t.setRuntimeData(this.getRuntimeData()),t.setUnitStylesData(this.getUnitStylesData()),t.setArrayFormulaCellData(this.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),t.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());let{x:r,y:a}=this.getRefOffset();t.setRefOffset(r,a);let n=this.getForcedSheetId();t.setForcedSheetName(this.getForcedSheetName()),null!=n&&t.setForcedSheetIdDirect(n);let i=this.getForcedUnitId();return i&&t.setForcedUnitIdDirect(i),t}};k(aF,"CellReferenceObject");let aj=class extends aO{constructor(e){super(e);let t=e$(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={startColumn:t.range.startColumn,startRow:Number.NaN,endColumn:-1,endRow:Number.NaN};this.setRangeData(r)}isColumn(){return!0}unionBy(e){if(!e.isColumn()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return td.create(Y.REF);let t=this.getRangeData(),r=e.getRangeData(),a=r.startColumn,n=t.startColumn;return a>n?t.endColumn=a:(t.startColumn=a,t.endColumn=n),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=P.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${J.COLON}${e.getToken()}`),this}};k(aj,"ColumnReferenceObject");let aB=class extends aO{constructor(e){super(e);let t=e$(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={startColumn:Number.NaN,startRow:t.range.startRow,endColumn:Number.NaN,endRow:-1};this.setRangeData(r)}isRow(){return!0}unionBy(e){if(!e.isRow()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return td.create(Y.REF);let t=this.getRangeData(),r=e.getRangeData(),a=r.startRow,n=t.startRow;return a>n?t.endRow=a:(t.startRow=a,t.endRow=n),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=P.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${J.COLON}${e.getToken()}`),this}};function ak(e,t,r,a){let n=[];if(r.isArray()){let i=r.getRowCount(),s=r.getColumnCount();if(1===i&&1===s){let a=r.getFirstCell();for(let r=0;r<e;r++){let e=[];for(let r=0;r<t;r++)e.push(a);n.push(e)}}else if(1===i&&s>1)for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.getRealValue(0,n)||(null!=a?a:as.create());e.push(t)}n.push(e)}else if(1===s&&i>1)for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.getRealValue(i,0)||(null!=a?a:as.create());e.push(t)}n.push(e)}else for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.getRealValue(i,n)||(null!=a?a:as.create());e.push(t)}n.push(e)}}else for(let a=0;a<e;a++){let e=[];for(let a=0;a<t;a++)e.push(r);n.push(e)}return a$(n,e,t)}function a$(e,t,r,a="",n=""){return aA.create({calculateValueList:e,rowCount:t,columnCount:r,unitId:a,sheetId:n,row:-1,column:-1})}function aH(e){for(let t of[X.EQUALS,X.NOT_EQUAL,X.GREATER_THAN_OR_EQUAL,X.GREATER_THAN,X.LESS_THAN_OR_EQUAL,X.LESS_THAN])if(e.startsWith(t)){let r=e.substring(t.length);return[t,ay.create(r)]}return[X.EQUALS,ay.create(e)]}function aY(e,t,r,a){if(!r){if(t.isString()){let[e,a]=aH(`${t.getValue()}`);r=e,t=a}else r=X.EQUALS}return e.compare(t,r,a)}function aG(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e),i=ak(r,a,t);return n.mapValue((e,t,r)=>{let a=i.get(t,r);return null!=e&&e.isError()?e:null!=a&&a.isError()?a:null!=e&&e.isBoolean()&&null!=a&&a.isBoolean()?ad(e.getValue()&&a.getValue()):al.create(!1)})}function aq(e){let t=e.getValue(),r=0;return t&&(r=1),ah.create(r)}function aW(e){return!!e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()||(e.isReferenceObject()?!!(e.isCell()||1===e.getRowCount()&&1===e.getColumnCount()):!!(e.isString()||e.isNumber()||e.isBoolean()||e.isError()||e.isNull()))}function aQ(e){let t=null==e?void 0:e.getPattern(),r={};if(t&&(r={s:{n:{pattern:t}}}),null==e)return{v:null,...r};if(e.isError())return{v:e.getErrorType(),t:P.CellValueType.STRING,...r};if(e.isValueObject()){let t=e.getValue();return e.isNumber()?{v:t,t:P.CellValueType.NUMBER,...r}:e.isBoolean()?{v:t?1:0,t:P.CellValueType.BOOLEAN,...r}:e.isString()?{v:t,t:P.CellValueType.STRING,...r}:e.isNull()?{v:null,...r}:{v:t,t:P.CellValueType.STRING,...r}}}function aX(e){let t=0,r=0;return e.forEach((e,a)=>{a%2==1&&(e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1)))}),{maxRowLength:t,maxColumnLength:r}}function aK(e,t,r,a){let n=t.getRowCount(),i=t.getColumnCount();for(let t=0;t<e.length;t++){if(t%2==1)continue;let s=e[t],u=s.getRowCount(),l=s.getColumnCount();if(u!==n||l!==i)return ak(r,a,td.create(Y.VALUE))}return null}function az(e,t,r,a=!1){let n=[];for(let i=0;i<e.length;i++){if(i%2==1)continue;let s=e[i];ak(t,r,e[i+1],td.create(Y.NA)).iterator((e,t,r)=>{if(!e)return;let i=aY(s,e),[,u]=aH(`${e.getValue()}`);if(a&&(i=aZ(i,s,u)),void 0===n[t]&&(n[t]=[]),void 0===n[t][r]){n[t][r]=i;return}n[t][r]=aG(n[t][r],i)})}return n}function aZ(e,t,r){return e.mapValue((e,a,n)=>{let i=t.get(a,n);return i&&aJ(i,r)?e:null!=i&&i.isError()&&r.isError()&&i.getValue()===r.getValue()?al.create(!0):al.create(!1)})}function aJ(e,t){if(e.isNumber()&&t.isNumber()||e.isBoolean()&&t.isBoolean())return!0;let r=e.isString()&&""===e.getValue(),a=t.isString()&&""===t.getValue();return!!((r||e.isNull())&&(a||t.isNull())||e.isString()&&!r&&t.isString()&&!a)}k(aB,"RowReferenceObject"),k(ak,"expandArrayValueObject"),k(a$,"createNewArray"),k(aH,"findCompareToken"),k(aY,"valueObjectCompare"),k(aG,"booleanObjectIntersection"),k(aq,"convertTonNumber"),k(aW,"isSingleValueObject"),k(aQ,"objectValueToCellValue"),k(aX,"calculateMaxDimensions"),k(aK,"getErrorArray"),k(az,"getBooleanResults"),k(aZ,"filterSameValueObjectResult"),k(aJ,"isSameValueObjectType");let a0=class extends P.Disposable{constructor(e){super(),$(this,"_unitId"),$(this,"_subUnitId"),$(this,"_row",-1),$(this,"_column",-1),$(this,"_definedNames"),$(this,"needsExpandParams",!1),$(this,"needsReferenceObject",!1),$(this,"minParams",-1),$(this,"maxParams",-1),this._name=e}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}getDefinedName(e){var t;let r=this._definedNames;return null==r?null:null==(t=Array.from(Object.values(r)).filter(t=>t.name===e))?void 0:t[0]}setDefinedNames(e){this._definedNames=e}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}setRefInfo(e,t,r,a){this._unitId=e,this._subUnitId=t,this._row=r,this._column=a}calculateCustom(...e){return null}calculate(...e){return td.create(Y.VALUE)}checkArrayType(e){return e.isReferenceObject()||e.isValueObject()&&e.isArray()}getIndexNumValue(e,t=1){let r=e;if(r.isArray()&&(r=r.getFirstCell()),r.isBoolean())return!1===r.getValue()?td.create(Y.VALUE):t;if(r.isString()){let e=Number(r.getValue());return Number.isNaN(e)?td.create(Y.REF):e}return r.isNumber()?r.getValue():td.create(Y.VALUE)}getZeroOrOneByOneDefault(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;e.isNumber()&&0===e.getValue()&&(t=0)}return t}getMatchTypeValue(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;if(e.isNumber()){let r=e.getValue();r<=0&&(t=r)}}return t}binarySearch(e,t,r,a,n){let i;let s=t.binarySearch(e,a,n);return null==s?td.create(Y.NA):(i=1===r.getRowCount()?r.get(0,s)||as.create():r.get(s,0)||as.create()).isNull()?td.create(Y.NA):i}_getOneFirstByRaw(e){return 0===e.length?td.create(Y.NA):e[0][0]||td.create(Y.NA)}_getOneLastByRaw(e){return 0===e.length?td.create(Y.NA):e[e.length-1][e[0].length-1]||td.create(Y.NA)}equalSearch(e,t,r,a=!0){let n=r.pickRaw(t.isEqual(e));return a?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}fuzzySearch(e,t,r,a=!0){let n=r.pickRaw(t.compare(e,X.EQUALS));return a?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}orderSearch(e,t,r,a=tr.MIN,n=!1){let i=t.orderSearch(e,a,n);if(null==i)return td.create(Y.NA);let s=r.get(i.row,i.column)||as.create();return s.isNull()?td.create(Y.NA):s}binarySearchExpand(e,t,r,a=0,n,i){let s=t.binarySearch(e,n,i);return null==s?td.create(Y.NA):0===a?r.slice([s,s+1]):r.slice(void 0,[s,s+1])}equalSearchExpand(e,t,r,a=!0,n=0){let i;let s=t.isEqual(e);return null==(i=a?s.getFirstTruePosition():s.getLastTruePosition())?td.create(Y.NA):0===n?r.slice([i.row,i.row+1]):r.slice(void 0,[i.column,i.column+1])}fuzzySearchExpand(e,t,r,a=!0,n=0){let i;let s=t.compare(e,X.EQUALS);return null==(i=a?s.getFirstTruePosition():s.getLastTruePosition())?td.create(Y.NA):0===n?r.slice([i.row,i.row+1]):r.slice(void 0,[i.column,i.column+1])}orderSearchExpand(e,t,r,a=tr.MIN,n=!1,i=0){let s=t.orderSearch(e,a,n);return null==s?td.create(Y.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}flattenArray(e,t=!0){let r=[];r[0]=[];for(let a=0;a<e.length;a++){let n=e[a];if((n.isString()||n.isBoolean()||n.isNull())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){let e;if(n.iterator(a=>!!(null==a||a.isNull()||t&&(a.isString()||a.isBoolean()))||((a=this._includingLogicalValuesAndText(a)).isError()?(e=a,!1):void r[0].push(a))),null!=e&&e.isError())return e}else r[0].push(n)}return a$(r,1,r[0].length)}_includingLogicalValuesAndText(e){if(e.isBoolean()&&(e=aq(e)),e.isString()){let t=Number(e.getValue());e=ah.create(Number.isNaN(t)?0:t)}return e}createReferenceObject(e,t){let r;let a=e.getForcedUnitId(),n=e.getForcedSheetId()||"",i=ej({unitId:a,sheetName:e.getForcedSheetName(),range:t});return r=new RegExp(eb).test(i)?new aF(i):new RegExp(eS).test(i)?new aB(i):new RegExp(eO).test(i)?new aj(i):new aM(t,n,a),this._setReferenceDefault(e,r)}_setReferenceDefault(e,t){return null==this.unitId||null==this.subUnitId?td.create(Y.REF):(t.setDefaultUnitId(this.unitId),t.setDefaultSheetId(this.subUnitId),t.setUnitData(e.getUnitData()),t.setRuntimeData(e.getRuntimeData()),t.setArrayFormulaCellData(e.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(e.getRuntimeArrayFormulaCellData()),t)}};k(a0,"BaseFunction");let a1=a0,a2=class extends a1{isCustom(){return!0}};k(a2,"CustomFunction");let a3=a2,a5=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std()}};k(a5,"StdevP");let a4=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std(1)}};k(a4,"StdevS");let a6=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var()}};k(a6,"VarP");let a7=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var(1)}};k(a7,"VarS");let a9=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3),$(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject());let{refHasError:n,refErrorObject:i,refNumbers:s}=this._checkRefReferenceObject(t),u=null!=r?r:ah.create(0);u.isReferenceObject()&&(u=u.toArrayValueObject());let l=Math.max(a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,a,td.create(Y.NA)),h=ak(l,o,u,td.create(Y.NA)),m=c.map((t,r,a)=>{let u=h.get(r,a);if(!e.isReferenceObject()&&e.isNull())return td.create(Y.NA);if(n)return i;if(u.isError())return u;let l=+t.getValue(),o=+u.getValue();if(Number.isNaN(l)||Number.isNaN(o))return td.create(Y.VALUE);let c=s.sort((e,t)=>o?e-t:t-e).indexOf(l);return -1===c?td.create(Y.NA):ah.create(c+1)});return 1===l&&1===o?m.get(0,0):m}_checkRefReferenceObject(e){let t=!1,r=td.create(Y.NA),a=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;a.push(n)}),{refHasError:t,refErrorObject:r,refNumbers:a}):{refHasError:!0,refErrorObject:r,refNumbers:a}}};k(a9,"Rank");var a8=((E=a8||{}).BETADIST="BETADIST",E.BETAINV="BETAINV",E.BINOMDIST="BINOMDIST",E.CHIDIST="CHIDIST",E.CHIINV="CHIINV",E.CHITEST="CHITEST",E.CONFIDENCE="CONFIDENCE",E.COVAR="COVAR",E.CRITBINOM="CRITBINOM",E.EXPONDIST="EXPONDIST",E.FDIST="FDIST",E.FINV="FINV",E.FTEST="FTEST",E.GAMMADIST="GAMMADIST",E.GAMMAINV="GAMMAINV",E.HYPGEOMDIST="HYPGEOMDIST",E.LOGINV="LOGINV",E.LOGNORMDIST="LOGNORMDIST",E.MODE="MODE",E.NEGBINOMDIST="NEGBINOMDIST",E.NORMDIST="NORMDIST",E.NORMINV="NORMINV",E.NORMSDIST="NORMSDIST",E.NORMSINV="NORMSINV",E.PERCENTILE="PERCENTILE",E.PERCENTRANK="PERCENTRANK",E.POISSON="POISSON",E.QUARTILE="QUARTILE",E.RANK="RANK",E.STDEV="STDEV",E.STDEVP="STDEVP",E.TDIST="TDIST",E.TINV="TINV",E.TTEST="TTEST",E.VAR="VAR",E.VARP="VARP",E.WEIBULL="WEIBULL",E.ZTEST="ZTEST",E);let ne=[[a9,a8.RANK],[a4,a8.STDEV],[a5,a8.STDEVP],[a7,a8.VAR],[a6,a8.VARP]],nt=[];var nr=((C=nr||{}).CUBEKPIMEMBER="CUBEKPIMEMBER",C.CUBEMEMBER="CUBEMEMBER",C.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",C.CUBERANKEDMEMBER="CUBERANKEDMEMBER",C.CUBESET="CUBESET",C.CUBESETCOUNT="CUBESETCOUNT",C.CUBEVALUE="CUBEVALUE",C);let na=[];var nn=((p=nn||{}).DAVERAGE="DAVERAGE",p.DCOUNT="DCOUNT",p.DCOUNTA="DCOUNTA",p.DGET="DGET",p.DMAX="DMAX",p.DMIN="DMIN",p.DPRODUCT="DPRODUCT",p.DSTDEV="DSTDEV",p.DSTDEVP="DSTDEVP",p.DSUM="DSUM",p.DVAR="DVAR",p.DVARP="DVARP",p),ni=((A=ni||{}).DATE="DATE",A.DATEDIF="DATEDIF",A.DATEVALUE="DATEVALUE",A.DAY="DAY",A.DAYS="DAYS",A.DAYS360="DAYS360",A.EDATE="EDATE",A.EOMONTH="EOMONTH",A.HOUR="HOUR",A.ISOWEEKNUM="ISOWEEKNUM",A.MINUTE="MINUTE",A.MONTH="MONTH",A.NETWORKDAYS="NETWORKDAYS",A.NETWORKDAYS_INTL="NETWORKDAYS.INTL",A.NOW="NOW",A.SECOND="SECOND",A.TIME="TIME",A.TIMEVALUE="TIMEVALUE",A.TODAY="TODAY",A.WEEKDAY="WEEKDAY",A.WEEKNUM="WEEKNUM",A.WORKDAY="WORKDAY",A.WORKDAY_INTL="WORKDAY.INTL",A.YEAR="YEAR",A.YEARFRAC="YEARFRAC",A);let ns="yyyy/mm/dd;@";function nu(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),a=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),n=(a-t.getTime())/864e5;return a>r.getTime()&&(n+=1),Math.floor(n)+1}function nl(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),a=(e.getTime()-t.getTime())/864e5;return e>r&&(a+=1),a+1}function no(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),a=Math.floor(e)-1;return a>(r.getTime()-t.getTime())/864e5&&(a-=1),new Date(t.getTime()+864e5*a)}function nc(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),a=e-1;return a>(r.getTime()-t.getTime())/864e5&&(a-=1),a<0&&(a=e),new Date(t.getTime()+864e5*a)}function nh(e){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(e))return!1;let t=e.replace(/-/g,"/").replace(/T.+/,""),r=/* @__PURE__ */new Date(`${t}`);if(Number.isNaN(r.getTime()))return!1;let a=r.getFullYear(),n=(r.getMonth()+1).toString().padStart(2,"0"),i=r.getDate().toString().padStart(2,"0"),s=`${a}-${n}-${i}`;return e.replace(/\//g,"-").split("-").map(e=>e.padStart(2,"0")).join("-")===s}function nm(e){return(0,P.numfmt).parseDate(e)}function nf(e){return(0,P.numfmt).parseValue(e)}function ng(e){return(0,P.numfmt).parseTime(e)}function nd(e){return(0,P.numfmt).isDate(e)}k(nu,"excelDateSerial"),k(nl,"excelDateTimeSerial"),k(no,"excelSerialToDate"),k(nc,"excelSerialToDateTime"),k(nh,"isValidDateStr"),k(nm,"parseFormattedDate"),k(nf,"parseFormattedValue"),k(ng,"parseFormattedTime"),k(nd,"isDate");let nN={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function n_(e){return!!("string"==typeof e&&/^[0|1]{7}/.test(e)||nN[Number(e)])}function nE(e){if(!n_(e))return[];if("string"==typeof e&&/^[0|1]{7}/.test(e)){let t=[];for(let r=1;r<=e.length;r++)"1"==`${e[r-1]}`&&(r===e.length?t.push(0):t.push(r));return t}return nN[Number(e)]||[]}function nC(e,t,r=1,a){let n=nE(r),i=Math.floor(e),s=Math.floor(t),u=s>i?i:s,l=0,o=Math.abs(Math.floor(t)-Math.floor(e))+1;for(let e=0;e<o;e++){let t=u+e;if(a&&a.length>0&&a.some(e=>Math.floor(e)===t))continue;let r=nb(t);n.includes(r)||l++}return s>i?l:-l}function np(e,t,r=1,a){let n=nE(r),i=Math.floor(e),s=i,u=Math.abs(t);for(let e=1;e<=u;e++){let r=t<0?i-e:i+e;if(r<0)return td.create(Y.NUM);if(a&&a.length>0&&a.some(e=>Math.floor(e)===r)){u++;continue}let l=nb(r);if(n.includes(l)){u++;continue}s=r}return s}function nA(e){if(e.isError())return e;let t=e.getValue();if(e.isString()){let e;if(nm(`${t}`))e=nm(`${t}`).v;else if(ng(`${t}`))e=ng(`${t}`).v;else{if(!(0,P.isRealNum)(t))return td.create(Y.VALUE);e=+t}return e instanceof Date&&(e=nl(e)),0>+e||+e>2958465?td.create(Y.NUM):+e}{let t=+e.getValue();return t<0||t>2958465?td.create(Y.NUM):t}}function nb(e){let t=60===Math.floor(e),r=no(e),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getTime(),n=new Date(Date.UTC(1900,1,28)).getTime();return!t&&a<=n&&(r=new Date(a-864e5)),new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getUTCDay()}function ny(e,t,r){switch(r){case 0:return nR(e,t);case 1:return nS(e,t);case 2:return{days:Math.abs(t-e),yearDays:360};case 3:default:return{days:Math.abs(t-e),yearDays:365};case 4:return nO(e,t)}}function nR(e,t){let r=no(e),a=e>0?r.getUTCFullYear():1900,n=e>0?r.getUTCMonth()+1:1,i=e>0?r.getUTCDate():0,s=no(t),u=t>0?s.getUTCFullYear():1900,l=t>0?s.getUTCMonth()+1:1,o=t>0?s.getUTCDate():0;return 2===n?no(e+1).getUTCMonth()+1===3&&(i=30):31===i&&(i=30),31===o&&(i<30?(u=(s=no(t+1)).getUTCFullYear(),l=s.getUTCMonth()+1,o=s.getUTCDate()):o=30),{days:Math.abs((u-a)*360+(t>=e?30-i:-i)+(t>=e?o:o-30)+(t>=e?l-n-1:l-n+1)*30),yearDays:360}}function nS(e,t){let r,a;let n=no(e),i=e>0?n.getUTCFullYear():1900,s=no(t),u=t>0?s.getUTCFullYear():1900,l=Math.abs(t-e),o=Math.abs(u-i)+1;if(u<i){let e=new Date(Date.UTC(u,0,1)),t=new Date(Date.UTC(i,11,31));r=nu(e),a=nu(t),1900===u&&(r+=1)}else{let e=new Date(Date.UTC(i,0,1)),t=new Date(Date.UTC(u,11,31));r=nu(e),a=nu(t),1900===i&&(r+=1)}return{days:l,yearDays:(a-r+1)/o}}function nO(e,t){let r=no(e),a=e>0?r.getUTCFullYear():1900,n=e>0?r.getUTCMonth()+1:1,i=e>0?r.getUTCDate():0,s=no(t),u=t>0?s.getUTCFullYear():1900,l=t>0?s.getUTCMonth()+1:1,o=t>0?s.getUTCDate():0;return 31===i&&(i=30),31===o&&(o=30),{days:Math.abs((u-a)*360+(t>=e?30-i:-i)+(t>=e?o:o-30)+(t>=e?l-n-1:l-n+1)*30),yearDays:360}}function nT(e){return e%4==0&&e%100!=0||e%400==0}function nV(e){return e%4==0&&e%100!=0||e%400==0||1900===e}k(n_,"isValidWeekend"),k(nE,"getWeekendArray"),k(nC,"countWorkingDays"),k(np,"getDateSerialNumberByWorkingDays"),k(nA,"getDateSerialNumberByObject"),k(nb,"getWeekDayByDateSerialNumber"),k(ny,"getTwoDateDaysByBasis"),k(nR,"getDaysByNASD"),k(nS,"getDaysByActual"),k(nO,"getDaysByEuropean"),k(nT,"isLeapYear"),k(nV,"isLeapYear1900");let nI=[31,29,31,30,31,30,31,31,30,31,30,31],nM=[31,28,31,30,31,30,31,31,30,31,30,31];function nx(e,t){return nT(e)?nI[t]:nM[t]}function nv(e){return nV(e)?366:365}function nU(e,t){switch(t){case 0:case 2:case 4:return 360;case 1:return nv(no(e).getUTCFullYear());case 3:return 365;default:return -1}}function nD(e,t,r){return nx(e,t)===r}function nL(e,t){let r=e.getUTCFullYear(),a=e.getUTCMonth();return nD(r,a,e.getUTCDate())?(e.setUTCDate(1),e.setUTCMonth(e.getUTCMonth()+t),r=e.getUTCFullYear(),a=e.getUTCMonth(),e.setUTCDate(nx(r,a))):e.setUTCMonth(e.getUTCMonth()+t),e}k(nx,"getDaysInMonth"),k(nv,"getDaysInYear"),k(nU,"getNormalYearDaysByBasis"),k(nD,"lastDayOfMonth"),k(nL,"dateAddMonths");let nP=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e),s=ak(a,n,t),u=ak(a,n,r);return i.map((e,t,r)=>{let a=s.get(t,r)||as.create(),n=u.get(t,r)||as.create();if(e.isError())return e;if(a.isError())return a;if(n.isError())return n;if(e.isString()||a.isString()||n.isString())return td.create(Y.VALUE);let i=+e.getValue(),l=Math.floor(+a.getValue()),o=+n.getValue();if(i<0||i>9999)return td.create(Y.NUM);i>=0&&i<1899&&(i+=1900);let c=nu(new Date(i,l-1,o));return c<0?td.create(Y.NUM):ah.create(c,ns)})}};k(nP,"DateFunction");let nw=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let a=e,n=t,i=r;if(a.isArray()&&(a=a.get(0,0)),n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),a.isError())return a;if(n.isError())return n;if(i.isError())return i;let s=nA(a);if("number"!=typeof s)return s;let u=nA(n);return"number"!=typeof u?u:u<s||!i.isString()?td.create(Y.NUM):this._getResultByUnit(s,u,i)}_getResultByUnit(e,t,r){let a;let n=no(e),i=n.getUTCFullYear(),s=n.getUTCMonth()+1,u=n.getUTCDate(),l=no(t),o=l.getUTCFullYear(),c=l.getUTCMonth()+1,h=l.getUTCDate();switch(`${r.getValue()}`.toLocaleUpperCase()){case"Y":return ah.create(o-i);case"M":return ah.create((o-i)*12+c-s);case"D":return ah.create(Math.floor(t)-Math.floor(e));case"MD":return ah.create(h-u);case"YM":return ah.create(c-s);case"YD":return a=nu(new Date(Date.UTC(i,c-1,h))),ah.create(Math.floor(a)-Math.floor(e));default:return td.create(Y.NUM)}}};k(nw,"Datedif");let nF=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=nf(`${e.getValue()}`);if(t){let{v:e,z:r}=t;if(r&&nd(r))return e instanceof Date&&(e=nl(e)),ah.create(Math.trunc(+e))}}return td.create(Y.VALUE)}};k(nF,"Datevalue");let nj=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;let r=e.getValue();if(e.isString()){if(!nh(`${r}`))return td.create(Y.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return td.create(Y.NUM);if(0===r)return ah.create(0);t=no(r)}let a=t.getDate();return ah.create(a)}};k(nj,"Day");let nB=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e),i=ak(r,a,t),s=n.map((e,t,r)=>{let a=i.get(t,r);if(e.isError())return e;if(a.isError())return a;let n=nA(e);if("number"!=typeof n)return n;let s=nA(a);if("number"!=typeof s)return s;let u=Math.floor(n)-Math.floor(s);return ah.create(u)});return 1===r&&1===a?s.get(0,0):s}};k(nB,"Days");let nk=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:al.create(!1);if(e.isError())return e;if(t.isError())return t;if(a.isError())return a;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=ak(n,i,e,td.create(Y.NA)),u=ak(n,i,t,td.create(Y.NA)),l=ak(n,i,a,td.create(Y.NA)),o=s.map((e,t,r)=>{let a=u.get(t,r),n=l.get(t,r);if(e.isError())return e;let i=nA(e);if("number"!=typeof i)return i;if(a.isError())return a;let s=nA(a);if("number"!=typeof s)return s;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let{days:o}=ny(i,s,+n.getValue()?4:0);return ah.create(s>=i?o:-o)});return 1===n&&1===i?o.get(0,0):o}};k(nk,"Days360");let n$=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e),i=ak(r,a,t);return n.map((e,t,r)=>{let a=i.get(t,r)||as.create();if(e.isError())return e;if(a.isError())return a;if(e.isString()||e.isBoolean()||a.isString()||a.isBoolean())return td.create(Y.VALUE);let n=+e.getValue();if(n<0)return td.create(Y.NUM);let s=Math.floor(+a.getValue()),u=no(n),l=nu(new Date(Date.UTC(u.getUTCFullYear(),u.getUTCMonth()+s,u.getUTCDate())));return ah.create(l,ns)})}};k(n$,"Edate");let nH=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e,a=t;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);r=r.get(0,0)}if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);a=a.get(0,0)}if(r.isError())return r;if(a.isError())return a;let n=nA(r);if("number"!=typeof n)return n;if(a.isBoolean())return td.create(Y.VALUE);let i=no(n),s=n>0?i.getUTCFullYear():1900,u=n>0?i.getUTCMonth():0,l=Math.floor(+a.getValue());if(Number.isNaN(l))return td.create(Y.VALUE);let o=nu(new Date(Date.UTC(s,u+l+1,0)));return ah.create(o)}};k(nH,"Eomonth");let nY=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=nA(e);if("number"!=typeof t)return t;if(0===t)return ah.create(0);let r=nc(t).getUTCHours();return ah.create(r)}};k(nY,"Hour");let nG=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=nA(e);if("number"!=typeof t)return t;let r=no(t),a=t>0?r.getUTCFullYear():1900,n=new Date(Date.UTC(a,0,1)),i=nu(n),s=nb(i),u;t<(u=s<1?i+1:s<=4?i-(s-1):i+(11-s))&&(u=(s=nb(i=nu(n=new Date(Date.UTC(a-1,0,1)))))<1?i+1:s<=4?i-(s-1):i+(11-s));let l=Math.ceil((t-u+1)/7);return ah.create(l)}};k(nG,"Isoweeknum");let nq=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=nA(e);if("number"!=typeof t)return t;if(0===t)return ah.create(0);let r=nc(t).getUTCMinutes();return ah.create(r)}};k(nq,"Minute");let nW=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!nh(`${r}`))return td.create(Y.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return td.create(Y.NUM);if(0===r)return ah.create(1);t=no(r)}let a=t.getUTCMonth()+1;return ah.create(a)}};k(nW,"Month");let nQ=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=e,n=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);a=a.get(0,0)}if(a.isError())return a;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);n=n.get(0,0)}if(n.isError())return n;if(null!=r&&r.isError())return r;if(a.isBoolean()||n.isBoolean())return td.create(Y.VALUE);let i=nA(a);if("number"!=typeof i)return i;let s=nA(n);if("number"!=typeof s)return s;if(r)return this._getResultByHolidays(i,s,r);let u=nC(i,s);return ah.create(u)}_getResultByHolidays(e,t,r){let a=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let n=0;n<e;n++)for(let e=0;e<t;e++){let t=r.get(n,e);if(t.isBoolean())return td.create(Y.VALUE);let i=nA(t);if("number"!=typeof i)return i;a.push(i)}}else{if(r.isBoolean())return td.create(Y.VALUE);let e=nA(r);if("number"!=typeof e)return e;a.push(e)}let n=nC(e,t,1,a);return ah.create(n)}};k(nQ,"Networkdays");let nX=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",4)}calculate(e,t,r,a){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=a&&a.isError()?a:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,a)):this._handleSingleObject(e,t,r,a)}_handleSingleObject(e,t,r,a){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);i=i.get(0,0)}if(i.isError())return i;let s=1;if(r){if(s=r.getValue(),r.isBoolean()&&(s=+s),r.isString()&&!n_(s))return td.create(Y.VALUE);if(!n_(s))return td.create(Y.NUM)}if(n.isBoolean()||i.isBoolean())return td.create(Y.VALUE);let u=nA(n);if("number"!=typeof u)return u;let l=nA(i);if("number"!=typeof l)return l;if(a)return this._getResultByHolidays(u,l,s,a);let o=nC(u,l,s);return ah.create(o)}_getResultByHolidays(e,t,r,a){let n=[];if(null!=a&&a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=a.get(r,e);if(t.isBoolean())return td.create(Y.VALUE);let i=nA(t);if("number"!=typeof i)return i;n.push(i)}}else{if(a.isBoolean())return td.create(Y.VALUE);let e=nA(a);if("number"!=typeof e)return e;n.push(e)}let i=nC(e,t,r,n);return ah.create(i)}};k(nX,"NetworkdaysIntl");let nK=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){let e=/* @__PURE__ */new Date,t=nl(new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())));return ah.create(t,"yyyy/mm/dd hh:mm")}};k(nK,"Now");let nz=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=nA(e);if("number"!=typeof t)return t;if(0===t)return ah.create(0);let r=nc(t).getUTCSeconds();return ah.create(r)}};k(nz,"Second");let nZ=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e),s=ak(a,n,t),u=ak(a,n,r);return i.map((e,t,r)=>this._calculateTime(e,s,u,t,r))}_calculateTime(e,t,r,a,n){let i=e,s=t.get(a,n)||as.create(),u=r.get(a,n)||as.create();if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),(s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),(u.isString()||u.isBoolean())&&(u=u.convertToNumberObjectValue()),i.isError())return i;if(s.isError())return s;if(u.isError())return u;let l=Math.floor(+i.getValue()),o=Math.floor(+s.getValue()),c=Math.floor(+u.getValue());if(l<0||o<0||c<0||l>32767||o>32767||c>32767)return td.create(Y.NUM);o+=Math.floor(c/60),c%=60,l+=Math.floor(o/60);let h=(3600*(l%=24)+60*(o%=60)+c)/86400;return ah.create(h,"h:mm A/P")}};k(nZ,"Time");let nJ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=nf(`${e.getValue()}`);if(t){let{v:e,z:r}=t;if(r&&nd(r))return e instanceof Date&&(e=nl(e)),ah.create(r9(+e))}}return td.create(Y.VALUE)}};k(nJ,"Timevalue");let n0=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){let e=nu(/* @__PURE__ */new Date);return ah.create(e,ns)}};k(n0,"Today");let n1=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2),$(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){let r=null!=t?t:ah.create(1);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,r,td.create(Y.NA)),u=i.map((e,t,r)=>{let a=s.get(t,r);return this._handleSingleObject(e,a)});return 1===a&&1===n?u.get(0,0):u}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;let a=nA(e);if("number"!=typeof a)return a;if(r.isString()&&(r=r.convertToNumberObjectValue()).isError())return r;let n=Math.floor(+r.getValue());if(!this._returnTypeMap[n])return td.create(Y.NUM);let i=nb(a),s=this._returnTypeMap[n][i];return ah.create(s)}};k(n1,"Weekday");let n2=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2),$(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,a=null!=t?t:ah.create(1);if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);r=r.get(0,0)}if(r.isError())return r;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);a=a.get(0,0)}if(a.isError())return a;if(r.isBoolean())return td.create(Y.VALUE);let n=nA(r);if("number"!=typeof n)return n;if(a.isBoolean())return td.create(Y.VALUE);let i=Math.floor(+a.getValue());return Number.isNaN(i)?td.create(Y.VALUE):i in this._returnTypeMap?this._getResult(n,i):td.create(Y.NUM)}_getResult(e,t){let r=no(e),a=e>0?r.getUTCFullYear():1900,n=new Date(Date.UTC(a,0,1)),i=nu(n),s=nb(i),u;if(21===t)e<(u=s<1?i+1:s<=4?i-(s-1):i+(11-s))&&(u=(s=nb(i=nu(n=new Date(Date.UTC(a-1,0,1)))))<1?i+1:s<=4?i-(s-1):i+(11-s));else{let e=this._returnTypeMap[t];u=s<e?i-(s+7-e):i-(s-e)}let l=Math.ceil((e-u+1)/7);return ah.create(l)}};k(n2,"Weeknum");let n3=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=e,n=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);a=a.get(0,0)}if(a.isError())return a;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);n=n.get(0,0)}if(n.isError())return n;if(null!=r&&r.isError())return r;if(a.isBoolean()||n.isBoolean())return td.create(Y.VALUE);let i=nA(a);if("number"!=typeof i)return i;let s=+n.getValue();if(Number.isNaN(s))return td.create(Y.VALUE);if(r)return this._getResultByHolidays(i,s,r);let u=np(i,s);return"number"!=typeof u?u:ah.create(u)}_getResultByHolidays(e,t,r){let a=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let n=0;n<e;n++)for(let e=0;e<t;e++){let t=r.get(n,e);if(t.isBoolean())return td.create(Y.VALUE);let i=nA(t);if("number"!=typeof i)return i;a.push(i)}}else{if(r.isBoolean())return td.create(Y.VALUE);let e=nA(r);if("number"!=typeof e)return e;a.push(e)}let n=np(e,t,1,a);return"number"!=typeof n?n:ah.create(n)}};k(n3,"Workday");let n5=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",4)}calculate(e,t,r,a){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=a&&a.isError()?a:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,a)):this._handleSingleObject(e,t,r,a)}_handleSingleObject(e,t,r,a){let n=null!=r?r:ah.create(1),i=this._checkArrayError(e);if(i.isError())return i;let s=this._checkArrayError(t);if(s.isError())return s;if(i.isBoolean()||s.isBoolean())return td.create(Y.VALUE);let u=nA(e);if("number"!=typeof u)return u;let l=+t.getValue();if(Number.isNaN(l))return td.create(Y.VALUE);let o=n.getValue();if(n.isBoolean()&&(o=+o),n.isString()&&(!n_(o)||"1111111"===o))return td.create(Y.VALUE);if(!n_(o))return td.create(Y.NUM);if(a)return this._getResultByHolidays(u,l,o,a);let c=np(u,l,o);return"number"!=typeof c?c:ah.create(c)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return td.create(Y.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,a){let n=[];if(null!=a&&a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=a.get(r,e);if(t.isBoolean())return td.create(Y.VALUE);let i=nA(t);if("number"!=typeof i)return i;n.push(i)}}else{if(a.isBoolean())return td.create(Y.VALUE);let e=nA(a);if("number"!=typeof e)return e;n.push(e)}let i=np(e,t,r,n);return"number"!=typeof i?i:ah.create(i)}};k(n5,"WorkdayIntl");let n4=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!nh(`${r}`))return td.create(Y.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let e=+r;if(e<0)return td.create(Y.NUM);if(0===e)return ah.create(1900);t=no(e)}let a=t.getUTCFullYear();return ah.create(a)}};function n6(e){let t=e;if(e.isArray()){let r=e.getRowCount(),a=e.getColumnCount();if(r>1||a>1)return td.create(Y.VALUE);t=e.get(0,0)}return t.isError(),t}function n7(...e){for(let t=0;t<e.length;t++){let r=n6(e[t]);if(r.isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:td.create(Y.VALUE)};e[t]=r}return{isError:!1,variants:e}}function n9(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return{isError:!0,errorObject:r};if(r.isNull())return{isError:!0,errorObject:td.create(Y.NA)};if((r=n6(e[t])).isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:td.create(Y.VALUE)};e[t]=r}return{isError:!1,variants:e}}function n8(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}k(n4,"Year"),k(n6,"checkVariantErrorIsArray"),k(n7,"checkVariantsErrorIsArrayOrBoolean"),k(n9,"checkVariantsErrorIsNullorArrayOrBoolean"),k(n8,"checkVariantsErrorIsStringToNumber");let ie=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:ah.create(0),n=n6(e);if(n.isError())return n;let i=n6(t);if(i.isError())return i;if((a=n6(a)).isError())return a;if(n.isBoolean()||i.isBoolean()||a.isBoolean())return td.create(Y.VALUE);let s=nA(n);if("number"!=typeof s)return s;let u=nA(i);if("number"!=typeof u)return u;let l=Math.floor(+a.getValue());if(Number.isNaN(l))return td.create(Y.VALUE);if(l<0||l>4)return td.create(Y.NUM);let{days:o,yearDays:c}=ny(s,u,l);return ah.create(o/c)}};k(ie,"Yearfrac");let it=[[nP,ni.DATE],[nw,ni.DATEDIF],[nF,ni.DATEVALUE],[nj,ni.DAY],[nB,ni.DAYS],[nk,ni.DAYS360],[n$,ni.EDATE],[nH,ni.EOMONTH],[nY,ni.HOUR],[nG,ni.ISOWEEKNUM],[nq,ni.MINUTE],[nW,ni.MONTH],[nQ,ni.NETWORKDAYS],[nX,ni.NETWORKDAYS_INTL],[nK,ni.NOW],[nz,ni.SECOND],[nZ,ni.TIME],[nJ,ni.TIMEVALUE],[n0,ni.TODAY],[n1,ni.WEEKDAY],[n2,ni.WEEKNUM],[n3,ni.WORKDAY],[n5,ni.WORKDAY_INTL],[n4,ni.YEAR],[ie,ni.YEARFRAC]];var ir,ia=((b=ia||{}).BESSELI="BESSELI",b.BESSELJ="BESSELJ",b.BESSELK="BESSELK",b.BESSELY="BESSELY",b.BIN2DEC="BIN2DEC",b.BIN2HEX="BIN2HEX",b.BIN2OCT="BIN2OCT",b.BITAND="BITAND",b.BITLSHIFT="BITLSHIFT",b.BITOR="BITOR",b.BITRSHIFT="BITRSHIFT",b.BITXOR="BITXOR",b.COMPLEX="COMPLEX",b.CONVERT="CONVERT",b.DEC2BIN="DEC2BIN",b.DEC2HEX="DEC2HEX",b.DEC2OCT="DEC2OCT",b.DELTA="DELTA",b.ERF="ERF",b.ERF_PRECISE="ERF.PRECISE",b.ERFC="ERFC",b.ERFC_PRECISE="ERFC.PRECISE",b.GESTEP="GESTEP",b.HEX2BIN="HEX2BIN",b.HEX2DEC="HEX2DEC",b.HEX2OCT="HEX2OCT",b.IMABS="IMABS",b.IMAGINARY="IMAGINARY",b.IMARGUMENT="IMARGUMENT",b.IMCONJUGATE="IMCONJUGATE",b.IMCOS="IMCOS",b.IMCOSH="IMCOSH",b.IMCOT="IMCOT",b.IMCSC="IMCSC",b.IMCSCH="IMCSCH",b.IMDIV="IMDIV",b.IMEXP="IMEXP",b.IMLN="IMLN",b.IMLOG10="IMLOG10",b.IMLOG2="IMLOG2",b.IMPOWER="IMPOWER",b.IMPRODUCT="IMPRODUCT",b.IMREAL="IMREAL",b.IMSEC="IMSEC",b.IMSECH="IMSECH",b.IMSIN="IMSIN",b.IMSINH="IMSINH",b.IMSQRT="IMSQRT",b.IMSUB="IMSUB",b.IMSUM="IMSUM",b.IMTAN="IMTAN",b.OCT2BIN="OCT2BIN",b.OCT2DEC="OCT2DEC",b.OCT2HEX="OCT2HEX",b);function ii(e){return/^[01]{1,10}$/.test(e)}function is(e){return/^[0-7]{1,10}$/.test(e)}function iu(e){return/^[0-9A-Fa-f]{1,10}$/.test(e)}function il(e){if(0===e)return 0;let t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-946595344482036e-18,366839497852761e-18,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],r=e,a=!1;r<0&&(r=-r,a=!0);let n=2/(2+r),i=4*n-2,s=0,u=0,l;for(let e=t.length-1;e>0;e--)l=s,s=i*s-u+t[e],u=l;let o=n*Math.exp(-r*r+.5*(t[0]+i*s)-u);return a?o-1:1-o}(e=>{function t(e,t){let r=0;for(let a=0;a<e.length;++a)r=t*r+e[a];return r}function r(e,t,r,a,n){if(0===t)return r;if(1===t)return a;let i=2/e,s=r,u=a,l=a;for(let e=1;e<t;++e)l=u*e*i+n*s,s=u,u=l;return l}function a(e,t,a,n){return /* @__PURE__ */k(function(i,s){if(a){if(0===i)return 1===a?-1/0:1/0;if(i<0)return Number.NaN}if(0===s)return e(i);if(1===s)return t(i);if(s<0)return Number.NaN;let u=e(i),l=t(i);return r(i,0|s,u,l,n)},"bessel")}k(t,"_horner"),k(r,"_bessel_iter"),k(a,"_bessel_wrap"),e.besselj=/* @__PURE__ */(()=>{let e=[-184.9052456,77392.33017,-11214424.18,651619640.7,-0x31c78f292,0xd6759744e],a=[1,267.8532712,59272.64853,9494680.718,0x3d5d6d39,0xd675973ab],n=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],i=[-934935152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function s(r){let s=0,u=0,l=r*r;if(r<8)s=t(e,l)/t(a,l);else{let e=r-.785398164;s=Math.sqrt(.636619772/r)*(Math.cos(e)*t(n,l=64/l)-Math.sin(e)*t(i,l)*8/r)}return s}k(s,"bessel0");let u=[-30.16036606,15704.4826,-2972611.439,242396853.1,-0x1d6950b23,0x10d925ddd8],l=[1,376.9991397,99447.43394,18583304.74,0x891f618a,0x21b24bbb9a],o=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function h(e){let r=0,a=0,n=e*e,i=Math.abs(e)-2.356194491;return 8>Math.abs(e)?r=e*t(u,n)/t(l,n):(r=Math.sqrt(.636619772/Math.abs(e))*(Math.cos(i)*t(o,n=64/n)-Math.sin(i)*t(c,n)*8/Math.abs(e)),e<0&&(r=-r)),r}return k(h,"bessel1"),/* @__PURE__ */k(function e(t,a){let n=Math.round(a);if(!Number.isFinite(t))return Number.isNaN(t)?t:0;if(n<0)return(n%2?-1:1)*e(t,-n);if(t<0)return(n%2?-1:1)*e(-t,n);if(0===n)return s(t);if(1===n)return h(t);if(0===t)return 0;let i=0;if(t>n)i=r(t,n,s(t),h(t),-1);else{let e=2*Math.floor((n+Math.floor(Math.sqrt(40*n)))/2),r=!1,a=0,s=0,u=1,l=0,o=2/t;for(let t=e;t>0;t--)if(l=t*o*u-a,a=u,Math.abs(u=l)>1e10&&(u*=1e-10,a*=1e-10,i*=1e-10,s*=1e-10),r&&(s+=u),r=!r,t===n&&(i=a),e-t>100&&0===i)return Number.NaN;i/=s=2*s-u}return i},"besselj2")})(),e.bessely=(()=>{let r=[228.4622733,-86327.92757,10879881.29,-512359803.6,0x1a4fa4b91,-0xb04cc5cd],n=[1,226.1030244,47447.2647,7189466.438,745249964.8,0x954bf890d],i=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],s=[-934945152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function u(a){let u=0,l=a*a,o=a-.785398164;return a<8?t(r,l)/t(n,l)+.636619772*(0,e.besselj)(a,0)*Math.log(a):Math.sqrt(.636619772/a)*(Math.sin(o)*t(i,l=64/l)+Math.cos(o)*t(s,l)*8/a)}k(u,"bessel0");let l=[8511.937935,-4237922.726,734926455.1,-0xbffb0414e,127527439e4,-4900604943e3],o=[1,354.9632885,102042.605,22459040.02,0xde8afbbf,0x62d2b66f40,249958057e5],c=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],h=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function m(r){let a=0,n=r*r,i=r-2.356194491;return r<8?r*t(l,n)/t(o,n)+.636619772*((0,e.besselj)(r,1)*Math.log(r)-1/r):Math.sqrt(.636619772/r)*(Math.sin(i)*t(c,n=64/n)+Math.cos(i)*t(h,n)*8/r)}return k(m,"bessel1"),a(u,m,1,-1)})(),e.besseli=/* @__PURE__ */(()=>{let e=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],r=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228];function a(a){return a<=3.75?t(e,a*a/14.0625):Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(r,3.75/Math.abs(a))}k(a,"bessel0");let n=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],i=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];function s(e){return e<3.75?e*t(n,e*e/14.0625):(e<0?-1:1)*Math.exp(Math.abs(e))/Math.sqrt(Math.abs(e))*t(i,3.75/Math.abs(e))}return k(s,"bessel1"),/* @__PURE__ */k(function e(t,r){let n=Math.round(r);if(0===n)return a(t);if(1===n)return s(t);if(n<0)return Number.NaN;if(0===Math.abs(t))return 0;if(t===1/0)return 1/0;let i=0,u,l=2/Math.abs(t),o=0,c=1,h=0,m=2*Math.round((n+Math.round(Math.sqrt(40*n)))/2);for(u=m;u>0;u--)if(h=u*l*c+o,o=c,Math.abs(c=h)>1e10&&(c*=1e-10,o*=1e-10,i*=1e-10),u===n&&(i=o),m-u>100&&0===i)return Number.NaN;return i*=e(t,0)/c,t<0&&n%2?-i:i},"besseli2")})(),e.besselk=(()=>{let r=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],n=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414];function i(a){return a<=2?-Math.log(a/2)*(0,e.besseli)(a,0)+t(r,a*a/4):Math.exp(-a)/Math.sqrt(a)*t(n,2/a)}k(i,"bessel0");let s=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],u=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];function l(r){return r<=2?Math.log(r/2)*(0,e.besseli)(r,1)+1/r*t(s,r*r/4):Math.exp(-r)/Math.sqrt(r)*t(u,2/r)}return k(l,"bessel1"),a(i,l,2,1)})()})(ir||(ir={})),k(ii,"isValidBinaryNumber"),k(is,"isValidOctalNumber"),k(iu,"isValidHexadecimalNumber"),k(il,"erf");let io=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(l<0)return td.create(Y.NUM);let o=ir.besseli(u,l);return Number.isNaN(o)||!Number.isFinite(o)?td.create(Y.NUM):ah.create(o)}};k(io,"Besseli");let ic=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(l<0)return td.create(Y.NUM);let o=ir.besselj(u,l);return Number.isNaN(o)||!Number.isFinite(o)?td.create(Y.NUM):ah.create(o)}};k(ic,"Besselj");let ih=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(l<0)return td.create(Y.NUM);let o=ir.besselk(u,l);return Number.isNaN(o)||!Number.isFinite(o)?td.create(Y.NUM):ah.create(o)}};k(ih,"Besselk");let im=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(l<0)return td.create(Y.NUM);let o=ir.bessely(u,l);return Number.isNaN(o)||!Number.isFinite(o)?td.create(Y.NUM):ah.create(o)}};k(im,"Bessely");let ig=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t;let{isError:r,errorObject:a,variants:n}=n7(e);if(r)return a;let[i]=n,s=`${i.getValue()}`;return ii(s)?(t=10===s.length&&"1"===s.substring(0,1)?Number.parseInt(s.substring(1),2)-512:Number.parseInt(s,2),ah.create(t)):td.create(Y.NUM)}};k(ig,"Bin2dec");let id=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=`${u.getValue()}`;if(!ii(l))return td.create(Y.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0xfffffffe00+Number.parseInt(l.substring(1),2)).toString(16);else if(r=Number.parseInt(l,2).toString(16),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r.toLocaleUpperCase())}};k(id,"Bin2hex");let iN=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=`${u.getValue()}`;if(!ii(l))return td.create(Y.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0x3ffffe00+Number.parseInt(l.substring(1),2)).toString(8);else if(r=Number.parseInt(l,2).toString(8),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r)}};k(iN,"Bin2oct");let i_=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),u=+n.getValue();return s<0||u<0||Math.floor(s)!==s||Math.floor(u)!==u||s>0xffffffffffff||u>0xffffffffffff?td.create(Y.NUM):ah.create(s&u)});return 1===r&&1===a?s.get(0,0):s}};k(i_,"Bitand");let iE=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),u=+n.getValue();if(s<0||Math.floor(s)!==s||s>0xffffffffffff||Math.abs(u)>53)return td.create(Y.NUM);let l=Number((u=Math.trunc(u))>=0?BigInt(s)<<BigInt(u):BigInt(s)>>BigInt(-u));return l>0xffffffffffff?td.create(Y.NUM):ah.create(l)});return 1===r&&1===a?s.get(0,0):s}};k(iE,"Bitlshift");let iC=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),u=+n.getValue();if(s<0||u<0||Math.floor(s)!==s||Math.floor(u)!==u||s>0xffffffffffff||u>0xffffffffffff)return td.create(Y.NUM);let l=Number(BigInt(s)|BigInt(u));return ah.create(l)});return 1===r&&1===a?s.get(0,0):s}};k(iC,"Bitor");let ip=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),u=+n.getValue();if(s<0||Math.floor(s)!==s||s>0xffffffffffff||Math.abs(u)>53)return td.create(Y.NUM);let l=Number((u=Math.trunc(u))>=0?BigInt(s)>>BigInt(u):BigInt(s)<<BigInt(-u));return l>0xffffffffffff?td.create(Y.NUM):ah.create(l)});return 1===r&&1===a?s.get(0,0):s}};k(ip,"Bitrshift");let iA=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),u=+n.getValue();return s<0||u<0||Math.floor(s)!==s||Math.floor(u)!==u||s>0xffffffffffff||u>0xffffffffffff?td.create(Y.NUM):ah.create(s^u)});return 1===r&&1===a?s.get(0,0):s}};k(iA,"Bitxor"),r$.prototype.cos=function(){return new r$(Math.cos(this.toNumber()))};let ib=(k(cY=class{constructor(e){if($(this,"_inumber",""),$(this,"_realNum",0),$(this,"_iNum",0),$(this,"_suffix",""),$(this,"_isError",!1),""===`${e}`.trim()){this._isError=!0;return}this._inumber=e,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(e,t,r){let a;let n=new r$(e).toSignificantDigits(15).toNumber(),i=new r$(t).toSignificantDigits(15).toNumber(),s=""===r?"i":r;if(0===n&&0===i)a=0;else if(0===n)a=1===i?s:`${i}${s}`;else if(0===i)a=n;else{let e=1===i?s:`${i}${s}`;a=`${n}${i>0?"+":""}${e}`}return a}static createByComplexStr(e,t,r){let a=cY.getComplex(e,t,r);return new cY(a)}_getImReal(){if(0===this._inumber||"0"===this._inumber){this._realNum=0;return}let e=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0){this._realNum=0;return}let t=e.indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let a=e.substring(e.length-1,e.length),n="i"===a||"j"===a;if(t>=0||r>=0){if(!n){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,t):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,r)}else n?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+e)?this._isError=!0:this._realNum=+e}_getImAginary(){if(this._isError)return;if(0===this._inumber||"0"===this._inumber){this._iNum=0;return}let e=`${this._inumber}`;if(["i","j"].indexOf(e)>=0){this._iNum=1;return}let t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let a=e.substring(e.length-1,e.length),n="i"===a||"j"===a;if(t>=0||r>=0){if(!n){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._iNum=+e.substring(t+1,e.length-1):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._iNum=-+e.substring(r+1,e.length-1)}else n?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._iNum=+e.substring(0,e.length-1):Number.isNaN(+e)?this._isError=!0:this._iNum=0}_getImSuffix(){let e=`${this._inumber}`,t=e.substring(e.length-1);this._suffix="i"===t||"j"===t?t:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return cY.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(e){let t=e.getSuffix();return""!==this._suffix&&""!==t&&this._suffix!==t}Abs(){return r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){let e=r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))),t=r$.acos(new r$(this._realNum).div(e)).toSignificantDigits(16).toNumber();return this._iNum<0&&(t=-t),t}Conjugate(){return cY.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){let e=r$.cos(this._realNum).mul(r$.cosh(this._iNum)).toNumber(),t=r$.sin(this._realNum).mul(r$.sinh(this._iNum)).negated().toNumber();return cY.getComplex(e,t,this._suffix)}{let e=r$.cos(this._realNum).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let e=r$.cosh(this._realNum).mul(r$.cos(this._iNum)).toNumber(),t=r$.sinh(this._realNum).mul(r$.sin(this._iNum)).toNumber();return cY.getComplex(e,t,this._suffix)}{let e=r$.cosh(this._realNum).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Cot(){if(this._iNum){let e=r$.cosh(2*this._iNum).sub(r$.cos(2*this._realNum)),t=r$.sin(2*this._realNum).div(e).toNumber(),r=r$.sinh(2*this._iNum).div(e).negated().toNumber();return cY.getComplex(t,r,this._suffix)}{let e=new r$(1).div(r$.tan(this._realNum)).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Csc(){if(this._iNum){let e=r$.cosh(2*this._iNum).sub(r$.cos(2*this._realNum)),t=r$.sin(this._realNum).mul(r$.cosh(this._iNum)).mul(2).div(e).toNumber(),r=r$.cos(this._realNum).mul(r$.sinh(this._iNum)).mul(-2).div(e).toNumber();return cY.getComplex(t,r,this._suffix)}{let e=new r$(1).div(r$.sin(this._realNum)).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return cY.getComplex(0,0,this._suffix);if(this._iNum){let e=r$.cosh(2*this._realNum).sub(r$.cos(2*this._iNum)),t=r$.sinh(this._realNum).mul(r$.cos(this._iNum)).mul(2).div(e).toNumber(),r=r$.cosh(this._realNum).mul(r$.sin(this._iNum)).mul(-2).div(e).toNumber();return cY.getComplex(t,r,this._suffix)}{let e=new r$(1).div(r$.sinh(this._realNum)).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Div(e){let t=new r$(this._realNum),r=new r$(this._iNum),a=new r$(e.getRealNum()),n=new r$(e.getINum()),i=a.mul(a).add(n.mul(n)),s=t.mul(a).add(r.mul(n)).div(i).toNumber(),u=r.mul(a).sub(t.mul(n)).div(i).toNumber(),l=""===this._suffix?e.getSuffix():this._suffix;return cY.getComplex(s,u,l)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";let e=r$.exp(this._realNum).mul(r$.cos(this._iNum)).toNumber(),t=r$.exp(this._realNum).mul(r$.sin(this._iNum)).toNumber();return cY.getComplex(e,t,this._suffix)}Ln(){let e=r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))),t=r$.ln(e).toNumber(),r=r$.acos(new r$(this._realNum).div(e)).toNumber();return cY.getComplex(t,r,this._suffix)}Log10(){let e=r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))),t=r$.ln(e),r=r$.acos(new r$(this._realNum).div(e));this._iNum<0&&(r=r.negated());let a=r$.ln(10),n=new r$(0),i=a.mul(a).add(n.mul(n)),s=t.mul(a).add(r.mul(n)).div(i).toNumber(),u=r.mul(a).sub(t.mul(n)).div(i).toNumber();return cY.getComplex(s,u,this._suffix)}Log2(){let e=r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))),t=r$.ln(e),r=r$.acos(new r$(this._realNum).div(e));this._iNum<0&&(r=r.negated());let a=r$.ln(2),n=new r$(0),i=a.mul(a).add(n.mul(n)),s=t.mul(a).add(r.mul(n)).div(i).toNumber(),u=r.mul(a).sub(t.mul(n)).div(i).toNumber();return cY.getComplex(s,u,this._suffix)}Power(e){if(0===this._realNum&&0===this._iNum)return e>0?cY.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let t=r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))),r=r$.acos(new r$(this._realNum).div(t));this._iNum<0&&(r=r.negated()),t=r$.pow(t,e),r=r.mul(e);let a=r$.cos(r).mul(t).toNumber(),n=r$.sin(r).mul(t).toNumber();return Number.isFinite(a)&&Number.isFinite(n)?cY.getComplex(a,n,this._suffix):(this._isError=!0,"")}Product(e){let t=new r$(this._realNum),r=new r$(this._iNum),a=new r$(e.getRealNum()),n=new r$(e.getINum()),i=t.mul(a).sub(r.mul(n)).toNumber(),s=t.mul(n).add(r.mul(a)).toNumber(),u=""===this._suffix?e.getSuffix():this._suffix;return cY.getComplex(i,s,u)}Sec(){if(this._iNum){let e=r$.cosh(2*this._iNum).add(r$.cos(2*this._realNum)),t=r$.cos(this._realNum).mul(r$.cosh(this._iNum)).mul(2).div(e).toNumber(),r=r$.sin(this._realNum).mul(r$.sinh(this._iNum)).mul(2).div(e).toNumber();return cY.getComplex(t,r,this._suffix)}{let e=new r$(1).div(r$.cos(this._realNum)).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(2*this._realNum))||!Number.isFinite(Math.cosh(2*this._realNum)))return cY.getComplex(0,0,this._suffix);if(this._iNum){let e=r$.cosh(2*this._realNum).add(r$.cos(2*this._iNum)),t=r$.cosh(this._realNum).mul(r$.cos(this._iNum)).mul(2).div(e).toNumber(),r=r$.sinh(this._realNum).mul(r$.sin(this._iNum)).mul(-2).div(e).toNumber();return cY.getComplex(t,r,this._suffix)}{let e=new r$(1).div(r$.cosh(this._realNum)).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Sin(){if(this._iNum){let e=r$.sin(this._realNum).mul(r$.cosh(this._iNum)).toNumber(),t=r$.cos(this._realNum).mul(r$.sinh(this._iNum)).toNumber();return cY.getComplex(e,t,this._suffix)}{let e=r$.sin(this._realNum).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let e=r$.sinh(this._realNum).mul(r$.cos(this._iNum)).toNumber(),t=r$.cosh(this._realNum).mul(r$.sin(this._iNum)).toNumber();return cY.getComplex(e,t,this._suffix)}{let e=r$.sinh(this._realNum).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}Sqrt(){let e=r$.sqrt(r$.pow(this._realNum,2).add(r$.pow(this._iNum,2))),t=r$.sqrt(e),r=r$.acos(new r$(this._realNum).div(e));this._iNum<0&&(r=r.negated());let a=t.mul(r$.cos(r.div(2).toNumber())).toNumber(),n=t.mul(r$.sin(r.div(2))).toNumber();return cY.getComplex(a,n,this._suffix)}Sub(e){let t=new r$(this._realNum),r=new r$(this._iNum),a=new r$(e.getRealNum()),n=new r$(e.getINum()),i=t.sub(a).toNumber(),s=r.sub(n).toNumber(),u=""===this._suffix?e.getSuffix():this._suffix;return cY.getComplex(i,s,u)}Sum(e){let t=new r$(this._realNum),r=new r$(this._iNum),a=new r$(e.getRealNum()),n=new r$(e.getINum()),i=t.add(a).toNumber(),s=r.add(n).toNumber(),u=""===this._suffix?e.getSuffix():this._suffix;return cY.getComplex(i,s,u)}Tan(){if(this._iNum){let e=r$.cos(2*this._realNum).add(r$.cosh(2*this._iNum)),t=r$.sin(2*this._realNum).div(e).toNumber(),r=r$.sinh(2*this._iNum).div(e).toNumber();return cY.getComplex(t,r,this._suffix)}{let e=r$.tan(this._realNum).toNumber();return cY.getComplex(e,this._iNum,this._suffix)}}},"Complex"),cY),iy=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=n7(e,t,null!=r?r:ag.create("i"));if(a)return n;let[s,u,l]=i,o=+s.getValue(),c=+u.getValue(),h=`${l.getValue()}`;if(Number.isNaN(o)||Number.isNaN(c)||"i"!==h&&"j"!==h)return td.create(Y.VALUE);let m=ib.getComplex(o,c,h);return"number"==typeof m?ah.create(m):ag.create(m)}};k(iy,"Complex");let iR=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3),$(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ngstrm","",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ngstrm","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,0x17a9e9bc0],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,2365882365e-13],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,0x219c7bf72246c0],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,27777777777778e-17],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,290888208665722e-18],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,0x11de784a],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestrke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,35277777777778e-17],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,946352946e-12],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ngstrm","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,56826125e-11],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,473176473e-12],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,0x1e187e0]]),$(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,0x10000000000,"Ti","tera"],Gi:["gibi",30,0x40000000,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]}),$(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){let a;let{isError:n,errorObject:i,variants:s}=n7(e,t,r);if(n)return i;let[u,l,o]=s,c=+u.getValue(),h=`${l.getValue()}`,m=`${o.getValue()}`;if(Number.isNaN(c))return td.create(Y.VALUE);let f,g=1,d,N=1,{_from:_,_to:E}=this._lookupFromAndToUnits(h,m);if(f=_,d=E,null===f){let{_from:e,_fromMultiplier:t}=this._lookupFromPrefix(h);f=e,g=t}if(null===d){let{_to:e,_toMultiplier:t}=this._lookupToPrefix(m);d=e,N=t}return null===f||null===d||f[3]!==d[3]?td.create(Y.NA):(a="temperature"===f[3]?+(a=this._getTemperatureConversion(c,f[1],d[1])).toFixed(2):c*f[6]*g/(d[6]*N),ah.create(a))}_lookupFromAndToUnits(e,t){let r=null,a=null,n;for(let i=0;i<this._units.length;i++)n=null===this._units[i][2]?[]:this._units[i][2],(this._units[i][1]===e||n.indexOf(e)>=0)&&(r=this._units[i]),(this._units[i][1]===t||n.indexOf(t)>=0)&&(a=this._units[i]);return{_from:r,_to:a}}_lookupFromPrefix(e){let t=null,r=1,a=e,n,i=this._binaryPrefixes[e.substring(0,2)],s=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(s=["dekao",10,"da"]),i?(r=i[2],a=e.substring(2)):s&&(r=s[1],a=e.substring(s[2].length));for(let e=0;e<this._units.length;e++)n=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===a||n.indexOf(a)>=0)&&(t=this._units[e]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,a=e,n,i=this._binaryPrefixes[e.substring(0,2)],s=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(s=["dekao",10,"da"]),i?(r=i[2],a=e.substring(2)):s&&(r=s[1],a=e.substring(s[2].length));for(let e=0;e<this._units.length;e++)n=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===a||n.indexOf(a)>=0)&&(t=this._units[e]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return 9*e/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return 4*e/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return 9*e/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return 5*e/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return 5*e/4;case"F":return 9*e/4+32;case"K":return 5*e/4+273.15;case"Rank":return 9*e/4+491.67;default:return e}}};k(iR,"Convert");let iS=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=Math.trunc(+u.getValue());if(Number.isNaN(l))return td.create(Y.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${l}`)||l<-512||l>511)return td.create(Y.NUM);if(l<0){let e=(512+l).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=Number.parseInt(`${l}`,10).toString(2),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r)}};k(iS,"Dec2bin");let iO=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=Math.trunc(+u.getValue());if(Number.isNaN(l))return td.create(Y.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${l}`)||l<-0x8000000000||l>0x7fffffffff)return td.create(Y.NUM);if(l<0)r=(0x10000000000+l).toString(16);else if(r=Number.parseInt(`${l}`,10).toString(16),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r.toLocaleUpperCase())}};k(iO,"Dec2hex");let iT=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=Math.trunc(+u.getValue());if(Number.isNaN(l))return td.create(Y.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${l}`)||l<-0x20000000||l>0x1fffffff)return td.create(Y.NUM);if(l<0)r=(0x40000000+l).toString(8);else if(r=Number.parseInt(`${l}`,10).toString(8),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r)}};k(iT,"Dec2oct");let iV=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e,null!=t?t:ah.create(0));if(r)return a;let[i,s]=n,u=+i.getValue(),l=+s.getValue();return Number.isNaN(u)||Number.isNaN(l)?td.create(Y.VALUE):ah.create(u===l?1:0)}};k(iV,"Delta");let iI=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(t){let{isError:a,errorObject:n,variants:i}=n7(e,t);if(a)return n;let[s,u]=i,l=+s.getValue(),o=+u.getValue();if(Number.isNaN(l)||Number.isNaN(o))return td.create(Y.VALUE);r=il(o)-il(l)}else{let{isError:t,errorObject:a,variants:n}=n7(e);if(t)return a;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return td.create(Y.VALUE);r=il(s)}return ah.create(r)}};k(iI,"Erf");let iM=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=+n.getValue();if(Number.isNaN(i))return td.create(Y.VALUE);let s=il(i);return ah.create(s)}};k(iM,"ErfPrecise");let ix=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=+n.getValue();if(Number.isNaN(i))return td.create(Y.VALUE);let s=1-il(i);return ah.create(s)}};k(ix,"Erfc");let iv=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=+n.getValue();if(Number.isNaN(i))return td.create(Y.VALUE);let s=1-il(i);return ah.create(s)}};k(iv,"ErfcPrecise");let iU=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){if(e.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,null!=t?t:ah.create(0));if(r)return a;let[i,s]=n,u=+i.getValue(),l=+s.getValue();return Number.isNaN(u)||Number.isNaN(l)?td.create(Y.VALUE):ah.create(u>=l?1:0)}};k(iU,"Gestep");let iD=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=`${u.getValue()}`;if(!iu(l))return td.create(Y.NUM);let o=10===l.length&&"F"===l.substring(0,1).toLocaleUpperCase(),c=o?Number.parseInt(l,16)-0x10000000000:Number.parseInt(l,16);if(c<-512||c>511)return td.create(Y.NUM);if(o){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r)}};k(iD,"Hex2bin");let iL=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=`${n.getValue()}`;if(!iu(i))return td.create(Y.NUM);let s=Number.parseInt(i,16);return s>=0x8000000000&&(s-=0x10000000000),ah.create(s)}};k(iL,"Hex2dec");let iP=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=`${u.getValue()}`;if(!iu(l))return td.create(Y.NUM);let o=Number.parseInt(l,16);if(o>0x1fffffff&&o<0xffe0000000)return td.create(Y.NUM);if(o>=0xffe0000000)r=(o-0xffc0000000).toString(8);else if(r=o.toString(8),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r)}};k(iP,"Hex2oct");let iw=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Abs();return ah.create(s)}};k(iw,"Imabs");let iF=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.getINum();return ah.create(s)}};k(iF,"Imaginary");let ij=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);if(0===i.getRealNum()&&0===i.getINum())return td.create(Y.DIV_BY_ZERO);let s=i.Argument();return ah.create(s)}};k(ij,"Imargument");let iB=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Conjugate();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iB,"Imconjugate");let ik=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Cos();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(ik,"Imcos");let i$=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Cosh();return i.isError()?td.create(Y.NUM):"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i$,"Imcosh");let iH=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return td.create(Y.NUM);let s=i.Cot();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iH,"Imcot");let iY=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return td.create(Y.NUM);let s=i.Csc();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iY,"Imcsc");let iG=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return td.create(Y.NUM);let s=i.Csch();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iG,"Imcsch");let iq=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=`${i.getValue()}`,l=`${s.getValue()}`,o=new ib(u),c=new ib(l);if(o.isError()||c.isError()||o.isDifferentSuffixes(c)||0===c.getRealNum()&&0===c.getINum())return td.create(Y.NUM);let h=o.Div(c);return"number"==typeof h||(0,P.isRealNum)(h)?ah.create(+h):ag.create(h)}};k(iq,"Imdiv");let iW=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Exp();return i.isError()?td.create(Y.NUM):"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iW,"Imexp");let iQ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return td.create(Y.NUM);let s=i.Ln();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iQ,"Imln");let iX=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return td.create(Y.NUM);let s=i.Log10();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iX,"Imlog10");let iK=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return td.create(Y.NUM);let s=i.Log2();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(iK,"Imlog2");let iz=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=new ib(`${i.getValue()}`);if(u.isError())return td.create(Y.NUM);let l=+s.getValue();if(Number.isNaN(l))return td.create(Y.VALUE);let o=u.Power(l);return u.isError()?td.create(Y.NUM):"number"==typeof o||(0,P.isRealNum)(o)?ah.create(+o):ag.create(o)}};k(iz,"Impower");let iZ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof td)return t;let a=e[r];if(a.isArray()){let e=!1,r;if(a.iterator(a=>{if((t=this._handleSingleObject(a,t))instanceof td)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(a,t)}return t instanceof td?t:"number"==typeof t||(0,P.isRealNum)(t)?ah.create(+t):ag.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return td.create(Y.VALUE);let a=`${e.getValue()}`;if("number"==typeof t||t){let e=new ib(t),n=new ib(a);if(e.isError()||n.isError())return td.create(Y.NUM);if(e.isDifferentSuffixes(n))return td.create(Y.VALUE);r=e.Product(n)}else{let e=new ib(a);if(e.isError())return td.create(Y.NUM);r=e.toString()}return r}};k(iZ,"Improduct");let iJ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.getRealNum();return ah.create(s)}};k(iJ,"Imreal");let i0=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Sec();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i0,"Imsec");let i1=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Sech();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i1,"Imsech");let i2=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Sin();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i2,"Imsin");let i3=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Sinh();return i.isError()?td.create(Y.NUM):"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i3,"Imsinh");let i5=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);if(0===i.getRealNum()&&0===i.getINum())return ah.create(0);let s=i.Sqrt();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i5,"Imsqrt");let i4=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=`${i.getValue()}`,l=`${s.getValue()}`,o=new ib(u),c=new ib(l);if(o.isError()||c.isError()||o.isDifferentSuffixes(c))return td.create(Y.NUM);let h=o.Sub(c);return"number"==typeof h||(0,P.isRealNum)(h)?ah.create(+h):ag.create(h)}};k(i4,"Imsub");let i6=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof td)return t;let a=e[r];if(a.isArray()){let e=!1,r;if(a.iterator(a=>{if((t=this._handleSingleObject(a,t))instanceof td)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(a,t)}return t instanceof td?t:"number"==typeof t||(0,P.isRealNum)(t)?ah.create(+t):ag.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return td.create(Y.VALUE);let a=`${e.getValue()}`;if("number"==typeof t||t){let e=new ib(t),n=new ib(a);if(e.isError()||n.isError())return td.create(Y.NUM);if(e.isDifferentSuffixes(n))return td.create(Y.VALUE);r=e.Sum(n)}else{let e=new ib(a);if(e.isError())return td.create(Y.NUM);r=e.toString()}return r}};k(i6,"Imsum");let i7=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=new ib(`${n.getValue()}`);if(i.isError())return td.create(Y.NUM);let s=i.Tan();return"number"==typeof s||(0,P.isRealNum)(s)?ah.create(+s):ag.create(s)}};k(i7,"Imtan");let i9=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=`${u.getValue()}`;if(!is(l))return td.create(Y.NUM);let o=10===l.length&&"7"===l.substring(0,1),c=o?Number.parseInt(l,8)-0x40000000:Number.parseInt(l,8);if(c<-512||c>511)return td.create(Y.NUM);if(o){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r)}};k(i9,"Oct2bin");let i8=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=n7(e);if(t)return r;let[n]=a,i=`${n.getValue()}`;if(!is(i))return td.create(Y.NUM);let s=Number.parseInt(i,8);return s>=0x20000000&&(s-=0x40000000),ah.create(s)}};k(i8,"Oct2dec");let se=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return td.create(Y.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=n7(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return td.create(Y.VALUE);if(a<0||a>10)return td.create(Y.NUM)}let{isError:n,errorObject:i,variants:s}=n7(e);if(n)return i;let[u]=s,l=`${u.getValue()}`;if(!is(l))return td.create(Y.NUM);let o=Number.parseInt(l,8);if(o>=0x20000000)r=`ff${(o+0xc0000000).toString(16)}`;else if(r=o.toString(16),t){if(a<r.length)return td.create(Y.NUM);r="0".repeat(a-r.length)+r}return ag.create(r.toLocaleUpperCase())}};k(se,"Oct2hex");let st=[[io,ia.BESSELI],[ic,ia.BESSELJ],[ih,ia.BESSELK],[im,ia.BESSELY],[ig,ia.BIN2DEC],[id,ia.BIN2HEX],[iN,ia.BIN2OCT],[i_,ia.BITAND],[iE,ia.BITLSHIFT],[iC,ia.BITOR],[ip,ia.BITRSHIFT],[iA,ia.BITXOR],[iy,ia.COMPLEX],[iR,ia.CONVERT],[iS,ia.DEC2BIN],[iO,ia.DEC2HEX],[iT,ia.DEC2OCT],[iV,ia.DELTA],[iI,ia.ERF],[iM,ia.ERF_PRECISE],[ix,ia.ERFC],[iv,ia.ERFC_PRECISE],[iU,ia.GESTEP],[iD,ia.HEX2BIN],[iL,ia.HEX2DEC],[iP,ia.HEX2OCT],[iw,ia.IMABS],[iF,ia.IMAGINARY],[ij,ia.IMARGUMENT],[iB,ia.IMCONJUGATE],[ik,ia.IMCOS],[i$,ia.IMCOSH],[iH,ia.IMCOT],[iY,ia.IMCSC],[iG,ia.IMCSCH],[iq,ia.IMDIV],[iW,ia.IMEXP],[iQ,ia.IMLN],[iX,ia.IMLOG10],[iK,ia.IMLOG2],[iz,ia.IMPOWER],[iZ,ia.IMPRODUCT],[iJ,ia.IMREAL],[i0,ia.IMSEC],[i1,ia.IMSECH],[i2,ia.IMSIN],[i3,ia.IMSINH],[i5,ia.IMSQRT],[i4,ia.IMSUB],[i6,ia.IMSUM],[i7,ia.IMTAN],[i9,ia.OCT2BIN],[i8,ia.OCT2DEC],[se,ia.OCT2HEX]];var sr=((y=sr||{}).ACCRINT="ACCRINT",y.ACCRINTM="ACCRINTM",y.AMORDEGRC="AMORDEGRC",y.AMORLINC="AMORLINC",y.COUPDAYBS="COUPDAYBS",y.COUPDAYS="COUPDAYS",y.COUPDAYSNC="COUPDAYSNC",y.COUPNCD="COUPNCD",y.COUPNUM="COUPNUM",y.COUPPCD="COUPPCD",y.CUMIPMT="CUMIPMT",y.CUMPRINC="CUMPRINC",y.DB="DB",y.DDB="DDB",y.DISC="DISC",y.DOLLARDE="DOLLARDE",y.DOLLARFR="DOLLARFR",y.DURATION="DURATION",y.EFFECT="EFFECT",y.FV="FV",y.FVSCHEDULE="FVSCHEDULE",y.INTRATE="INTRATE",y.IPMT="IPMT",y.IRR="IRR",y.ISPMT="ISPMT",y.MDURATION="MDURATION",y.MIRR="MIRR",y.NOMINAL="NOMINAL",y.NPER="NPER",y.NPV="NPV",y.ODDFPRICE="ODDFPRICE",y.ODDFYIELD="ODDFYIELD",y.ODDLPRICE="ODDLPRICE",y.ODDLYIELD="ODDLYIELD",y.PDURATION="PDURATION",y.PMT="PMT",y.PPMT="PPMT",y.PRICE="PRICE",y.PRICEDISC="PRICEDISC",y.PRICEMAT="PRICEMAT",y.PV="PV",y.RATE="RATE",y.RECEIVED="RECEIVED",y.RRI="RRI",y.SLN="SLN",y.SYD="SYD",y.TBILLEQ="TBILLEQ",y.TBILLPRICE="TBILLPRICE",y.TBILLYIELD="TBILLYIELD",y.VDB="VDB",y.XIRR="XIRR",y.XNPV="XNPV",y.YIELD="YIELD",y.YIELDDISC="YIELDDISC",y.YIELDMAT="YIELDMAT",y);function sa(e,t,r,a){let{days:n}=ny(su(e,t,r),e,a);return n}function sn(e,t,r,a){let n;if(1===a){let a=su(e,t,r),i=no(a),s=nu(i=nL(i,12/r));n=a<0&&1===r?365:s-a}else n=3===a?365/r:360/r;return n}function si(e,t,r){let a=no(e),n=no(t);for(n.setUTCFullYear(a.getUTCFullYear()),n<a&&n.setUTCFullYear(n.getUTCFullYear()+1);n>a;)n=nL(n,-12/r);return nu(n=nL(n,12/r))}function ss(e,t,r){let a=0,n=no(e),i=no(t);for(;i>n;)i=nL(i,-12/r),a++;return a}function su(e,t,r){let a=no(e),n=no(t);for(n.setUTCFullYear(a.getUTCFullYear()),n<a&&n.setUTCFullYear(n.getUTCFullYear()+1);n>a;)n=nL(n,-12/r);return nu(n)}function sl(e,t,r,a,n,i){let s=sa(e,t,n,i),u=sn(e,t,n,i),l=ss(e,t,n),o=(u-s)/u-1,c=a/n+1,h=100*r/n,m=0,f=0;for(let e=1;e<=l;e++){let t=e+o,r=h/c**t;m+=t*r,f+=r}let g=l+o,d=100/c**g;return(m+=g*d)/(f+=d)/n}function so(e,t,r,a,n){let i;if(0===e)i=(r+a)/t;else{let s=(1+e)**t;i=1===n?(a*e/(s-1)+r*e/(1-1/s))/(1+e):a*e/(s-1)+r*e/(1-1/s)}return-i}function sc(e,t,r,a,n){let i;if(0===e)i=a+r*t;else{if(-1===e&&0===t)return Number.NaN;let s=(1+e)**t;i=1===n?a*s+r*(1+e)*(s-1)/e:a*s+r*(s-1)/e}return-i}function sh(e,t,r,a,n,i){let s=so(e,r,a,n,i);return(1===t?1===i?0:-a:1===i?sc(e,t-2,s,a,1)-s:sc(e,t-1,s,a,0))*e}function sm(e,t){let r=0;for(let a=1;a<=t.length;a++)r+=t[a-1]/(1+e)**a;return r}function sf(e,t,r,a,n,i,s,u,l){let o=sN(r,a,l),c=sn(e,a,u,l);return o<c?sg(e,t,r,a,n,i,s,u,l,o,c):sd(e,t,r,a,n,i,s,u,l,c)}function sg(e,t,r,a,n,i,s,u,l,o,c){let h=0,m=ss(e,t,u),f=sN(e,a,l);h+=s/(1+i/u)**(m-1+f/c)+100*n/u*o/c/(1+i/u)**(f/c);for(let e=2;e<=m;e++)h+=100*n/u/(1+i/u)**(e-1+f/c);return h-100*n/u*sN(r,e,l)/c}function sd(e,t,r,a,n,i,s,u,l,o){let c,h=0,m=ss(a,t,u),f=sp(a,e,12/u,!0);if(2===l||3===l){let t=si(e,a,u);c=sN(e,t,l)}else{let{days:t}=ny(su(e,a,u),e,l);c=o-t}h+=s/(1+i/u)**(m+f+c/o);let g=ss(r,a,u),d=a,N=0,_=0;for(let t=g;t>=1;t--){let a=sC(d,-12/u,!1),n=1===l?sN(a,d,l):o;N+=(t>1?n:sN(r,d,l))/n,_+=sN(r>a?r:a,e<d?e:d,l)/n,d=a}h+=100*n/u*N/(1+i/u)**(f+c/o);for(let e=1;e<=m;e++)h+=100*n/u/(1+i/u)**(e+f+c/o);return h-100*n/u*_}function sN(e,t,r){let{days:a}=ny(e,t,r);return e<t?a:0}function s_(e,t,r){let a=no(e),n=a.getUTCFullYear(),i=a.getUTCMonth(),s=a.getUTCDate(),u=nD(n,i,s),l=no(t),o=l.getUTCFullYear(),c=l.getUTCMonth(),h=l.getUTCDate(),m=nD(o,c,h);return!(s!==h&&!(u&&m)||Math.abs((o-n)*12+(c-i))%(12/r)!=0)}function sE(e,t,r){return su(e,t,r)>=0}function sC(e,t,r){let a=no(e);if(a=nL(a,t),r){let e=nx(a.getUTCFullYear(),a.getUTCMonth());a.setUTCDate(e)}return nu(a)}function sp(e,t,r,a){let n=no(e),i=no(t),s=n.getUTCFullYear(),u=n.getUTCMonth(),l=n.getUTCDate(),o=i.getUTCFullYear(),c=i.getUTCMonth(),h=i.getUTCDate(),m=nD(s,u,l),f=!m&&1!==u&&l>28&&l<nx(s,u)?nD(o,c,h):m,g=sC(t,0,f),d=+a-0+ +(t<g),N=sC(g,r,f);for(;!(r>0?N>=t:N<=t);)N=sC(N,r,f),d++;return d}function sA(e,t){let r=1,a=0,n=e,i;for(;r>1e-7&&a<500;){let e=(t(n+1e-7)-t(n-1e-7))/2e-7;i=n-t(n)/e,a++,r=Math.abs(i-n),n=i}return Number.isNaN(n)||Math.abs(n)===1/0||500===a?sb(e,t):n}function sb(e,t){let r,a;let n=Number.MAX_VALUE,i=e-.01<=-1?-1+1e-7:e-.01,s=e+.01>=n?n-1e-7:e+.01,u,l,o=0;if(e<=-1||e>=n)return td.create(Y.NUM);for(let e=0;e<60;e++){u=i<=-1?-1+1e-7:i,l=s>=n?n-1e-7:s;let r=t(u),a=t(l);if(r*a<=0)break;if(!(r*a>0)||(i=u+1.6*(u-l),s=l+1.6*(l-u),59===e))return td.create(Y.NUM)}let c=t(u),h=t(l);if(1e-7>Math.abs(c)||1e-7>Math.abs(h))return td.create(Y.NUM);do c*(r=t(a=u+(l-u)/2))<0?l=a:u=a,c=t(u),o++;while(Math.abs(r)>1e-7&&o<60)return a}function sy(e,t,r,a,n,i,s){let u=ss(e,t,i),l=sn(e,t,i,s),o=sa(e,t,i,s);if(1===u)return(100*r/i+n)/(a/i*(l-o)/l+1)-100*r/i*o/l;let c=l-o,h=n/(1+a/i)**(u-1+c/l);for(let e=1;e<=u;e++)h+=100*r/i/(1+a/i)**(e-1+c/l);return h-100*r/i*o/l}function sR(e,t,r,a,n){let i=0,s=n/r;s>=1?(s=1,i=1===a?e:0):i=e*(1-s)**(a-1);let u=e*(1-s)**a,l=0;return(l=u<t?i-t:i-u)<0&&(l=0),l}k(sa,"calculateCoupdaybs"),k(sn,"calculateCoupdays"),k(si,"calculateCoupncd"),k(ss,"calculateCoupnum"),k(su,"calculateCouppcd"),k(sl,"calculateDuration"),k(so,"calculatePMT"),k(sc,"calculateFV"),k(sh,"calculateIPMT"),k(sm,"calculateNpv"),k(sf,"calculateOddFPrice"),k(sg,"calculateOddShortFirstCoupon"),k(sd,"calculateOddLongFirstCoupon"),k(sN,"getPositiveDaysBetween"),k(s_,"validDaysBetweenIsWholeFrequencyByTwoDate"),k(sE,"validCouppcdIsGte0ByTwoDate"),k(sC,"getDateSerialNumberByMonths"),k(sp,"getCouponsNumber"),k(sA,"getResultByGuessIterF"),k(sb,"guessIsNaNorInfinity"),k(sy,"calculatePrice"),k(sR,"calculateDDB");let sS=class extends a1{constructor(){super(...arguments),$(this,"minParams",6),$(this,"maxParams",8)}calculate(e,t,r,a,n,i,s,u){let l=null!=s?s:ah.create(0),o=null!=u?u:al.create(!0),{isError:c,errorObject:h,variants:m}=n7(e,t,r,a,n,i,l);if(c)return h;let[f,g,d,N,_,E,C]=m,p=nA(f);if("number"!=typeof p)return p;let A=nA(g);if("number"!=typeof A)return A;let b=nA(d);if("number"!=typeof b)return b;let y=+N.getValue(),R=+_.getValue(),S=Math.floor(+E.getValue()),O=Math.floor(+C.getValue()),T=+o.getValue();return Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(S)||Number.isNaN(O)||Number.isNaN(T)?td.create(Y.VALUE):y<=0||R<=0||![1,2,4].includes(S)||O<0||O>4||Math.floor(p)>=Math.floor(b)?td.create(Y.NUM):this._getResult(p,A,b,y,R,S,O,T)}_getResult(e,t,r,a,n,i,s,u){let l=su(e,t,i);if(l<=0)return ah.create(0);l=su(r,t,i);let o=12/i,c=no(t),h=nD(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),m=sC(t,-o,h);if(r>t&&u)for(m=t;m<r;)m=sC(m,o,h);let f=e>m?e:m,{days:g}=ny(f,r,s);if(l>=e){let{days:e}=ny(f,r,s?4:0);g=e}r<f&&(g=-g);let d=sn(m,t,i,s),N=g/d,_=m,E=e;for(;_>e;){E=_;let{days:t}=ny(f=e>(_=sC(_,-o,h))?e:_,E,s);if(0===s)g=E>=f||e<=_?t:-t,d=sn(_,E,i,s);else if(g=E<f?-t:t,3===s)d=365/i;else{let{days:e}=ny(_,E,s);d=E<_?-e:e}N+=e<=_?u?1:0:g/d}let C=n*a/i*N;return ah.create(C)}};k(sS,"Accrint");let sO=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let{isError:i,errorObject:s,variants:u}=n7(e,t,r,a,null!=n?n:ah.create(0));if(i)return s;let[l,o,c,h,m]=u,f=nA(l);if("number"!=typeof f)return f;let g=nA(o);if("number"!=typeof g)return g;let d=+c.getValue(),N=+h.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_))return td.create(Y.VALUE);if(d<=0||N<=0||_<0||_>4||Math.floor(f)>Math.floor(g))return td.create(Y.NUM);if(Math.floor(f)===Math.floor(g))return ah.create(0);let{days:E,yearDays:C}=ny(f,g,_);return ah.create(N*d*E/C)}};k(sO,"Accrintm");let sT=class extends a1{constructor(){super(...arguments),$(this,"minParams",6),$(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let{isError:u,errorObject:l,variants:o}=n7(e,t,r,a,n,i,null!=s?s:ah.create(0));if(u)return l;let[c,h,m,f,g,d,N]=o,_=nA(h);if("number"!=typeof _)return _;let E=nA(m);if("number"!=typeof E)return E;let C=+c.getValue(),p=+f.getValue(),A=+g.getValue(),b=+d.getValue(),y=Math.floor(+N.getValue());return Number.isNaN(C)||Number.isNaN(p)||Number.isNaN(A)||Number.isNaN(b)||Number.isNaN(y)?td.create(Y.VALUE):C<=0||p<0||C<p||Math.floor(_)>Math.floor(E)||A<0||b<=0||![0,1,3,4].includes(y)?td.create(Y.NUM):(A=A>1?Math.floor(A):Math.ceil(A),this._getResult(C,_,E,p,A,b,y))}_getResult(e,t,r,a,n,i,s){let u=e-a,l=e*i,{days:o,yearDays:c}=ny(t,r,s),h=o/c,m=Math.ceil(u/l-h);if(m<0)return ah.create(0);let f=l;return 0===n?f=l*h:n===m?f=u-l*(h+n-1):n>m&&(f=0),ah.create(f)}};k(sT,"Amorlinc");let sV=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=n7(e,t,r,null!=a?a:ah.create(0));if(n)return i;let[u,l,o,c]=s,h=nA(u);if("number"!=typeof h)return h;let m=nA(l);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return td.create(Y.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return td.create(Y.NUM);let d=sa(h,m,f,g);return ah.create(d)}};k(sV,"Coupdaybs");let sI=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=n7(e,t,r,null!=a?a:ah.create(0));if(n)return i;let[u,l,o,c]=s,h=nA(u);if("number"!=typeof h)return h;let m=nA(l);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return td.create(Y.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return td.create(Y.NUM);let d=sn(h,m,f,g);return ah.create(d)}};k(sI,"Coupdays");let sM=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=n7(e,t,r,null!=a?a:ah.create(0));if(n)return i;let[u,l,o,c]=s,h=nA(u);if("number"!=typeof h)return h;let m=nA(l);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return td.create(Y.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return td.create(Y.NUM);let d=no(h),N=no(m);for(N.setUTCFullYear(d.getUTCFullYear()),N<d&&N.setUTCFullYear(N.getUTCFullYear()+1);N>d;)N.setUTCMonth(N.getUTCMonth()-12/f);N.setUTCMonth(N.getUTCMonth()+12/f);let{days:_}=ny(h,nu(N),g);return ah.create(_)}};k(sM,"Coupdaysnc");let sx=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=n7(e,t,r,null!=a?a:ah.create(0));if(n)return i;let[u,l,o,c]=s,h=nA(u);if("number"!=typeof h)return h;let m=nA(l);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return td.create(Y.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return td.create(Y.NUM);let d=si(h,m,f);return ah.create(d)}};k(sx,"Coupncd");let sv=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=n7(e,t,r,null!=a?a:ah.create(0));if(n)return i;let[u,l,o,c]=s,h=nA(u);if("number"!=typeof h)return h;let m=nA(l);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return td.create(Y.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m)||0>su(h,m,f))return td.create(Y.NUM);let d=ss(h,m,f);return ah.create(d)}};k(sv,"Coupnum");let sU=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=n7(e,t,r,null!=a?a:ah.create(0));if(n)return i;let[u,l,o,c]=s,h=nA(u);if("number"!=typeof h)return h;let m=nA(l);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return td.create(Y.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return td.create(Y.NUM);let d=su(h,m,f);return d<0&&(d=0),ah.create(d)}};k(sU,"Couppcd");let sD=class extends a1{constructor(){super(...arguments),$(this,"minParams",6),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let{isError:s,errorObject:u,variants:l}=n7(e,t,r,a,n,i);if(s)return u;let[o,c,h,m,f,g]=l,d=+o.getValue(),N=+c.getValue(),_=+h.getValue(),E=+m.getValue(),C=+f.getValue(),p=+g.getValue();return Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(E)||Number.isNaN(C)||Number.isNaN(p)?td.create(Y.VALUE):d<=0||N<=0||_<=0||E<1||C<1||E>C||E>N||C>N||![0,1].includes(p)?td.create(Y.NUM):Math.trunc(E)!==E&&Math.trunc(C)!==C&&Math.trunc(E)===Math.trunc(C)?ah.create(0):this._getResult(d,N,_,E,C,p)}_getResult(e,t,r,a,n,i){let s=so(e,t,r,0,i),u=0,l=Math.ceil(a);1===l&&(0===i&&(u=-r),l++);let o=!1;for(let t=l;t<=n;t++){let a=1===i?sc(e,t-2,s,r,1):sc(e,t-1,s,r,0);if(0===a){o=!0;break}u+=1===i?a-s:a}return((u*=e)<s*(n-a+1)||o)&&(u=s*(n-a+1)),ah.create(u)}};k(sD,"Cumipmt");let sL=class extends a1{constructor(){super(...arguments),$(this,"minParams",6),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let{isError:s,errorObject:u,variants:l}=n7(e,t,r,a,n,i);if(s)return u;let[o,c,h,m,f,g]=l,d=+o.getValue(),N=+c.getValue(),_=+h.getValue(),E=+m.getValue(),C=+f.getValue(),p=+g.getValue();return Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(E)||Number.isNaN(C)||Number.isNaN(p)?td.create(Y.VALUE):d<=0||N<=0||_<=0||E<1||C<1||E>C||![0,1].includes(p)?td.create(Y.NUM):Math.trunc(E)!==E&&Math.trunc(C)!==C&&Math.trunc(E)===Math.trunc(C)?ah.create(0):this._getResult(d,N,_,E,C,p)}_getResult(e,t,r,a,n,i){let s=so(e,t,r,0,i),u=0,l=Math.ceil(a);1===l&&(u=0===i?s+r*e:s,l++);for(let t=l;t<=n;t++)u+=1===i?s-(sc(e,t-2,s,r,1)-s)*e:s-sc(e,t-1,s,r,0)*e;return ah.create(u)}};k(sL,"Cumprinc");let sP=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:ah.create(12);i.isNull()&&(i=ah.create(12));let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,i.isArray()?i.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,i.isArray()?i.getColumnCount():1),l=ak(s,u,e,td.create(Y.NA)),o=ak(s,u,t,td.create(Y.NA)),c=ak(s,u,r,td.create(Y.NA)),h=ak(s,u,a,td.create(Y.NA)),m=ak(s,u,i,td.create(Y.NA)),f=l.map((e,t,r)=>{let a=o.get(t,r),{isError:n,errorObject:i,variants:s}=n8(e,a,c.get(t,r),h.get(t,r),m.get(t,r));if(n)return i;let[u,l,f,g,d]=s,N=+u.getValue(),_=+l.getValue(),E=+f.getValue(),C=+g.getValue(),p=Math.floor(+d.getValue());return N<0||_<0||E<=0||C<=0||Math.floor(C)>Math.floor(E)||p<1||p>12?td.create(Y.NUM):(C<1&&(C=1),C=Math.floor(C),this._getResult(N,_,E,C,p,t,r))});return 1===s&&1===u?f.get(0,0):f}_getResult(e,t,r,a,n,i,s){let u;let l=+(1-(t/e)**(1/r)).toFixed(3),o=e*l*n/12,c=o,h=0,m=a===r?r-1:a;for(let t=2;t<=m;t++)h=(e-c)*l,c+=h;return Number.isNaN(u=1===a?o:a===r?(e-c)*l:h)||!Number.isFinite(u)?td.create(Y.NUM):0===i&&0===s?ah.create(u,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(u)}};k(sP,"Db");let sw=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:ah.create(2);i.isNull()&&(i=ah.create(2));let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,i.isArray()?i.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,i.isArray()?i.getColumnCount():1),l=ak(s,u,e,td.create(Y.NA)),o=ak(s,u,t,td.create(Y.NA)),c=ak(s,u,r,td.create(Y.NA)),h=ak(s,u,a,td.create(Y.NA)),m=ak(s,u,i,td.create(Y.NA)),f=l.map((e,t,r)=>{let a=o.get(t,r),{isError:n,errorObject:i,variants:s}=n8(e,a,c.get(t,r),h.get(t,r),m.get(t,r));if(n)return i;let[u,l,f,g,d]=s,N=+u.getValue(),_=+l.getValue(),E=+f.getValue(),C=+g.getValue(),p=+d.getValue();if(N<0||_<0||E<=0||C<=0||C>E||p<=0)return td.create(Y.NUM);let A=sR(N,_,E,C,p);return Number.isNaN(A)||!Number.isFinite(A)?td.create(Y.NUM):0===t&&0===r?ah.create(A,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(A)});return 1===s&&1===u?f.get(0,0):f}};k(sw,"Ddb");let sF=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let{isError:i,errorObject:s,variants:u}=n7(e,t,r,a,null!=n?n:ah.create(0));if(i)return s;let[l,o,c,h,m]=u,f=nA(l);if("number"!=typeof f)return f;let g=nA(o);if("number"!=typeof g)return g;let d=+c.getValue(),N=+h.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_))return td.create(Y.VALUE);if(d<=0||N<=0||_<0||_>4||Math.floor(f)>=Math.floor(g))return td.create(Y.NUM);let{days:E,yearDays:C}=ny(f,g,_);return ah.create((N-d)/N*(C/E))}};k(sF,"Disc");let sj=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(l<0)return td.create(Y.NUM);if(l>=0&&l<1)return td.create(Y.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let o=Number.parseInt(`${u}`,10);o+=u%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;let c=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return o=Math.round(o*c)/c,ah.create(o)}};k(sj,"Dollarde");let sB=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(l<0)return td.create(Y.NUM);if(l>=0&&l<1)return td.create(Y.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let o=Number.parseInt(`${u}`,10);return o+=u%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,ah.create(o)}};k(sB,"Dollarfr");let sk=class extends a1{constructor(){super(...arguments),$(this,"minParams",5),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:ah.create(0);s.isNull()&&(s=ah.create(0));let{isError:u,errorObject:l,variants:o}=n9(e,t,r,a,n,s);if(u)return l;let[c,h,m,f,g,d]=o,N=nA(c);if("number"!=typeof N)return N;let _=nA(h);if("number"!=typeof _)return _;let E=+m.getValue(),C=+f.getValue(),p=Math.floor(+g.getValue()),A=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(C)||Number.isNaN(p)||Number.isNaN(A))return td.create(Y.VALUE);if(E<0||C<0||![1,2,4].includes(p)||A<0||A>4||Math.floor(N)>=Math.floor(_)||N<=0||_<=366)return td.create(Y.NUM);let b=sl(N,_,E,C,p,A);return ah.create(b)}};k(sk,"Duration");let s$=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(u<=0||l<1)return td.create(Y.NUM);l=Number.parseInt(`${l}`,10);let o=(1+u/l)**l-1;return ah.create(o)}};k(s$,"Effect");let sH=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:ah.create(0),s=null!=n?n:ah.create(0),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=ak(u,l,e,td.create(Y.NA)),c=ak(u,l,t,td.create(Y.NA)),h=ak(u,l,r,td.create(Y.NA)),m=ak(u,l,i,td.create(Y.NA)),f=ak(u,l,s,td.create(Y.NA)),g=o.map((e,t,r)=>{let a=c.get(t,r),{isError:n,errorObject:i,variants:s}=n8(e,a,h.get(t,r),m.get(t,r),f.get(t,r));if(n)return i;let[u,l,o,g,d]=s,N=+u.getValue(),_=+l.getValue(),E=sc(N,_,+o.getValue(),+g.getValue(),+d.getValue()?1:0);return Number.isNaN(E)||!Number.isFinite(E)?td.create(Y.NUM):0===t&&0===r?ah.create(E,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(E)});return 1===u&&1===l?g.get(0,0):g}};k(sH,"Fv");let sY=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e);if(r)return a;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return td.create(Y.VALUE);let u=s;if(t.isArray()){let e=t.getArrayValue().flat();for(let t=0;t<e.length;t++){let r=e[t];if(r.isBoolean())return td.create(Y.VALUE);let a=+r.getValue();if(Number.isNaN(a))return td.create(Y.VALUE);u*=1+a}}else{if(t.isBoolean())return td.create(Y.VALUE);let e=+t.getValue();if(Number.isNaN(e))return td.create(Y.VALUE);u*=1+e}return ah.create(u)}};k(sY,"Fvschedule");let sG=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let{isError:i,errorObject:s,variants:u}=n7(e,t,r,a,null!=n?n:ah.create(0));if(i)return s;let[l,o,c,h,m]=u,f=nA(l);if("number"!=typeof f)return f;let g=nA(o);if("number"!=typeof g)return g;let d=+c.getValue(),N=+h.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_))return td.create(Y.VALUE);if(d<=0||N<=0||_<0||_>4||Math.floor(f)>=Math.floor(g))return td.create(Y.NUM);let{days:E,yearDays:C}=ny(f,g,_);return ah.create((N-d)/d*(C/E))}};k(sG,"Intrate");let sq=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=n?n:ah.create(0),u=null!=i?i:ah.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,e,td.create(Y.NA)),h=ak(l,o,t,td.create(Y.NA)),m=ak(l,o,r,td.create(Y.NA)),f=ak(l,o,a,td.create(Y.NA)),g=ak(l,o,s,td.create(Y.NA)),d=ak(l,o,u,td.create(Y.NA)),N=c.map((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),{isError:i,errorObject:s,variants:u}=n8(e,a,n,f.get(t,r),g.get(t,r),d.get(t,r));if(i)return s;let[l,o,c,N,_,E]=u,C=+l.getValue(),p=+o.getValue(),A=+c.getValue(),b=+N.getValue(),y=+_.getValue(),R=+E.getValue();if(p<1||Math.floor(p)>Math.ceil(A))return td.create(Y.NUM);let S=sh(C,p,A,b,y,R?1:0);return Number.isNaN(S)||!Number.isFinite(S)?td.create(Y.NUM):0===t&&0===r?ah.create(S,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(S)});return 1===l&&1===o?N.get(0,0):N}};k(sq,"Ipmt");let sW=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:ah.create(.1);return r.isNull()&&(r=ah.create(.1)),r.isArray()?r.map((t,r,a)=>this._handleSingleObject(e,t,r,a)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,a=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return td.create(Y.VALUE);if(!e.isArray())return td.create(Y.NUM);let{_values:n,valuesHasError:i}=this._getValues(e);if(i)return td.create(Y.VALUE);let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()).isError())return s;let u=+s.getValue(),{positive:l,negative:o}=this._checkValues(n);if(!l||!o)return td.create(Y.NUM);let c=sA(u,e=>sm(e,n));return"number"!=typeof c?c:0===r&&0===a?ah.create(c,"0%"):ah.create(c)}_getValues(e){let t=[],r=!1;return e.iterator(e=>{if(e.isError())return r=!0,!1;if(e.isNull()||e.isBoolean())return!0;let a=+e.getValue();if(Number.isNaN(a))return!0;t.push(a)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let a=0;a<e.length;a++)e[a]>0&&(t=!0),e[a]<0&&(r=!0);return{positive:t,negative:r}}};k(sW,"Irr");let sQ=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=ak(n,i,e,td.create(Y.NA)),u=ak(n,i,t,td.create(Y.NA)),l=ak(n,i,r,td.create(Y.NA)),o=ak(n,i,a,td.create(Y.NA)),c=s.map((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=n8(e,u.get(t,r),l.get(t,r),o.get(t,r));if(a)return n;let[s,c,h,m]=i,f=+s.getValue(),g=+c.getValue(),d=+h.getValue(),N=+m.getValue();return 0===d?td.create(Y.DIV_BY_ZERO):ah.create(N*f*(g/d-1))});return 1===n&&1===i?c.get(0,0):c}};k(sQ,"Ispmt");let sX=class extends a1{constructor(){super(...arguments),$(this,"minParams",5),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:ah.create(0);s.isNull()&&(s=ah.create(0));let{isError:u,errorObject:l,variants:o}=n9(e,t,r,a,n,s);if(u)return l;let[c,h,m,f,g,d]=o,N=nA(c);if("number"!=typeof N)return N;let _=nA(h);if("number"!=typeof _)return _;let E=+m.getValue(),C=+f.getValue(),p=Math.floor(+g.getValue()),A=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(C)||Number.isNaN(p)||Number.isNaN(A))return td.create(Y.VALUE);if(E<0||C<0||![1,2,4].includes(p)||A<0||A>4||Math.floor(N)>=Math.floor(_))return td.create(Y.NUM);let b=sl(N,_,E,C,p,A);return b/=1+C/p,ah.create(b)}};k(sX,"Mduration");let sK=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let{_values:a,numberValues:n,positive:i,negative:s}=this._getValues(e),u=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),o=ak(u,l,t,td.create(Y.NA)),c=ak(u,l,r,td.create(Y.NA)),h=o.map((t,r,u)=>{let l=c.get(r,u);if(e.isError())return e;if(l.isError())return l;if(a.isError())return a;if(!i||!s)return td.create(Y.DIV_BY_ZERO);let o=+t.getValue(),h=+l.getValue();if(Number.isNaN(o)||Number.isNaN(h))return td.create(Y.VALUE);if(-1===h)return td.create(Y.DIV_BY_ZERO);let m=this._getResult(n,o,h);return 0===r&&0===u?ah.create(m,"0%"):ah.create(m)});return 1===u&&1===l?h.get(0,0):h}_getValues(e){let t=e,r=[],a=!1,n=!1;if(!e.isError()){if(e.isNull())t=td.create(Y.VALUE);else if(e.isArray()){let{numberValues:i,valuesHasError:s,errorObject:u,positive:l,negative:o}=this._checkValues(e);s&&(t=u),r=i,a=l,n=o}else t=td.create(Y.DIV_BY_ZERO)}return{_values:t,numberValues:r,positive:a,negative:n}}_checkValues(e){let t=[],r=!1,a=td.create(Y.VALUE),n=!1,i=!1;return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isNull()||e.isBoolean())return!0;let s=+e.getValue();if(Number.isNaN(s))return!0;s>0&&(n=!0),s<0&&(i=!0),t.push(s)}),{numberValues:t,valuesHasError:r,errorObject:a,positive:n,negative:i}}_getResult(e,t,r){let a=e.length,n=[],i=[];for(let t=0;t<a;t++)e[t]>0?i.push(e[t]):e[t]<0&&n.push(e[t]);let s=this._npv(r,e,"positive"),u=this._npv(t,e,"negative"),l=-s*(1+r)**a,o=u*(1+t);return(l/o)**(1/(a-1))-1}_npv(e,t,r){let a=0;for(let n=1;n<=t.length;n++){let i=t[n-1];("positive"===r&&i>0||"negative"===r&&i<0)&&(a+=i/(1+e)**n)}return a}};k(sK,"Mirr");let sz=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=Math.floor(+s.getValue());if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(u<=0||l<1)return td.create(Y.NUM);l=Number.parseInt(`${l}`,10);let o=((u+1)**(1/l)-1)*l;return ah.create(o)}};k(sz,"Nominal");let sZ=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:ah.create(0),s=null!=n?n:ah.create(0),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=ak(u,l,e,td.create(Y.NA)),c=ak(u,l,t,td.create(Y.NA)),h=ak(u,l,r,td.create(Y.NA)),m=ak(u,l,i,td.create(Y.NA)),f=ak(u,l,s,td.create(Y.NA)),g=o.map((e,t,r)=>{let a;let n=c.get(t,r),{isError:i,errorObject:s,variants:u}=n8(e,n,h.get(t,r),m.get(t,r),f.get(t,r));if(i)return s;let[l,o,g,d,N]=u,_=+l.getValue(),E=+o.getValue(),C=+g.getValue(),p=+d.getValue(),A=+N.getValue();return(A=A?1:0,0===_&&0===E)?td.create(Y.DIV_BY_ZERO):Number.isNaN(a=0===_?-(C+p)/E:Math.log((E*(1+_*A)-p*_)/(C*_+E*(1+_*A)))/Math.log(1+_))||!Number.isFinite(a)?td.create(Y.NUM):ah.create(a)});return 1===u&&1===l?g.get(0,0):g}};k(sZ,"Nper");let sJ=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let{isError:r,errorObject:a,values:n}=this._getValues(t);return e.isArray()?e.map((e,t,i)=>this._handleSingleObject(e,r,a,n,t,i)):this._handleSingleObject(e,r,a,n)}_handleSingleObject(e,t,r,a,n=0,i=0){let s=e;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(t)return r;let u=sm(+e.getValue(),a);return Number.isNaN(u)||Math.abs(u)===1/0?td.create(Y.DIV_BY_ZERO):0===n&&0===i?ah.create(u,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(u)}_getValues(e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isError())return{isError:!0,errorObject:a};if(a.isArray()){let e=!1,r=td.create(Y.VALUE);if(a.iterator(a=>{if(a.isError())return e=!0,r=a,!1;if(a.isNull()||a.isBoolean())return!0;let n=+a.getValue();if(Number.isNaN(n))return!0;t.push(n)}),e)return{isError:e,errorObject:r}}else{let e=+a.getValue();if(Number.isNaN(e))return{isError:!0,errorObject:td.create(Y.VALUE)};t.push(e)}}return{isError:!1,values:t}}};k(sJ,"Npv");let s0=class extends a1{constructor(){super(...arguments),$(this,"minParams",8),$(this,"maxParams",9)}calculate(e,t,r,a,n,i,s,u,l){let o=null!=l?l:ah.create(0);o.isNull()&&(o=ah.create(0));let{isError:c,errorObject:h,variants:m}=n9(e,t,r,a,n,i,s,u,o);if(c)return h;let[f,g,d,N,_,E,C,p,A]=m,b=nA(f);if("number"!=typeof b)return b;let y=nA(g);if("number"!=typeof y)return y;let R=nA(d);if("number"!=typeof R)return R;let S=nA(N);if("number"!=typeof S)return S;let O=+_.getValue(),T=+E.getValue(),V=+C.getValue(),I=Math.floor(+p.getValue()),M=Math.floor(+A.getValue());if(Number.isNaN(O)||Number.isNaN(T)||Number.isNaN(V)||Number.isNaN(I)||Number.isNaN(M))return td.create(Y.VALUE);if(O<0||T<0||V<=0||![1,2,4].includes(I)||M<0||M>4||!this._validDate(y,S,b,R,I))return td.create(Y.NUM);let x=sf(b,y,R,S,O,T,V,I,M);return ah.create(x)}_validDate(e,t,r,a,n){return this._getDateCorrectOrder(e,t,r,a)&&s_(e,t,n)&&sE(a,e,n)}_getDateCorrectOrder(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(a)}};k(s0,"Oddfprice");let s1=class extends a1{constructor(){super(...arguments),$(this,"minParams",8),$(this,"maxParams",9)}calculate(e,t,r,a,n,i,s,u,l){let o=null!=l?l:ah.create(0);o.isNull()&&(o=ah.create(0));let{isError:c,errorObject:h,variants:m}=n9(e,t,r,a,n,i,s,u,o);if(c)return h;let[f,g,d,N,_,E,C,p,A]=m,b=nA(f);if("number"!=typeof b)return b;let y=nA(g);if("number"!=typeof y)return y;let R=nA(d);if("number"!=typeof R)return R;let S=nA(N);if("number"!=typeof S)return S;let O=+_.getValue(),T=+E.getValue(),V=+C.getValue(),I=Math.floor(+p.getValue()),M=Math.floor(+A.getValue());return Number.isNaN(O)||Number.isNaN(T)||Number.isNaN(V)||Number.isNaN(I)||Number.isNaN(M)?td.create(Y.VALUE):O<0||T<=0||V<=0||![1,2,4].includes(I)||M<0||M>4||!this._validDate(y,S,b,R,I)?td.create(Y.NUM):this._getResult(b,y,R,S,O,T,V,I,M)}_validDate(e,t,r,a,n){return this._getDateCorrectOrder(e,t,r,a)&&s_(e,t,n)&&sE(a,e,n)}_getDateCorrectOrder(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(a)}_getResult(e,t,r,a,n,i,s,u,l){let{days:o}=ny(e,t,l);function c(o){return i-sf(e,t,r,a,n,o,s,u,l)}k(c,"_iterF");let h=sA((n*o*100-(i-100))/((i-100)*.25*(1+2*o)+100*o),e=>c(e));return"number"!=typeof h?h:ah.create(h)}};k(s1,"Oddfyield");let s2=class extends a1{constructor(){super(...arguments),$(this,"minParams",7),$(this,"maxParams",8)}calculate(e,t,r,a,n,i,s,u){let l=null!=u?u:ah.create(0);l.isNull()&&(l=ah.create(0));let{isError:o,errorObject:c,variants:h}=n9(e,t,r,a,n,i,s,l);if(o)return c;let[m,f,g,d,N,_,E,C]=h,p=nA(m);if("number"!=typeof p)return p;let A=nA(f);if("number"!=typeof A)return A;let b=nA(g);if("number"!=typeof b)return b;let y=+d.getValue(),R=+N.getValue(),S=+_.getValue(),O=Math.floor(+E.getValue()),T=Math.floor(+C.getValue());if(Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(S)||Number.isNaN(O)||Number.isNaN(T))return td.create(Y.VALUE);if(y<0||R<0||S<=0||![1,2,4].includes(O)||T<0||T>4||!this._validDate(A,p,b,O))return td.create(Y.NUM);let V=this._getResult(p,A,b,y,R,S,O,T);return ah.create(V)}_validDate(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&sE(r,e,a)}_getResult(e,t,r,a,n,i,s,u){let l=this._getCoupDate(t,r,s),o=this._getFrac(r,e,l,s,u),c=this._getFrac(r,t,l,s,u),h=this._getFrac(e,t,l,s,u);return(i*s+100*a*(c-o*(1+n*h/s)))/(n*h+s)}_getCoupDate(e,t,r){let a=no(e),n=no(t);for(n.setUTCFullYear(a.getUTCFullYear()),n>a&&n.setUTCFullYear(n.getUTCFullYear()-1);n<a;)n.setUTCMonth(n.getUTCMonth()+12/r);return nu(n)}_getFrac(e,t,r,a,n){let i=no(e),s=no(t),u=no(r);for(u.setUTCFullYear(i.getUTCFullYear()),u<i&&u.setUTCFullYear(u.getUTCFullYear()+1);u>i;)u.setUTCMonth(u.getUTCMonth()-12/a);let l=nu(u);u.setUTCMonth(u.getUTCMonth()+12/a);let o=nu(u);if(o>=t){let{days:r}=ny(e,t,n);return r/sn(l,o,a,n)}let{days:c}=ny(e,o,n),h=c/sn(l,o,a,n),m=no(o),f=no(o);for(f.setUTCMonth(f.getUTCMonth()+12/a);f<s;)m.setUTCMonth(m.getUTCMonth()+12/a),f.setUTCMonth(f.getUTCMonth()+12/a),h+=1;l=nu(m),o=nu(f);let{days:g}=ny(l,t,n);return h+g/sn(l,o,a,n)}};k(s2,"Oddlprice");let s3=class extends a1{constructor(){super(...arguments),$(this,"minParams",8),$(this,"maxParams",9)}calculate(e,t,r,a,n,i,s,u){let l=null!=u?u:ah.create(0);l.isNull()&&(l=ah.create(0));let{isError:o,errorObject:c,variants:h}=n9(e,t,r,a,n,i,s,l);if(o)return c;let[m,f,g,d,N,_,E,C]=h,p=nA(m);if("number"!=typeof p)return p;let A=nA(f);if("number"!=typeof A)return A;let b=nA(g);if("number"!=typeof b)return b;let y=+d.getValue(),R=+N.getValue(),S=+_.getValue(),O=Math.floor(+E.getValue()),T=Math.floor(+C.getValue());if(Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(S)||Number.isNaN(O)||Number.isNaN(T))return td.create(Y.VALUE);if(y<0||R<=0||S<=0||![1,2,4].includes(O)||T<0||T>4||!this._validDate(A,p,b,O))return td.create(Y.NUM);let V=this._getResult(p,A,b,y,R,S,O,T);return ah.create(V)}_validDate(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&sE(r,e,a)}_getResult(e,t,r,a,n,i,s,u){let l=this._getCoupDate(t,r,s),o=this._getFrac(r,e,l,s,u),c=this._getFrac(r,t,l,s,u),h=this._getFrac(e,t,l,s,u);return(s*(i-n)+100*a*(c-o))/(h*n+100*a*o*h/s)}_getCoupDate(e,t,r){let a=no(e),n=no(t);for(n.setUTCFullYear(a.getUTCFullYear()),n>a&&n.setUTCFullYear(n.getUTCFullYear()-1);n<a;)n.setUTCMonth(n.getUTCMonth()+12/r);return nu(n)}_getFrac(e,t,r,a,n){let i=no(e),s=no(t),u=no(r);for(u.setUTCFullYear(i.getUTCFullYear()),u<i&&u.setUTCFullYear(u.getUTCFullYear()+1);u>i;)u.setUTCMonth(u.getUTCMonth()-12/a);let l=nu(u);u.setUTCMonth(u.getUTCMonth()+12/a);let o=nu(u);if(o>=t){let{days:r}=ny(e,t,n);return r/sn(l,o,a,n)}let{days:c}=ny(e,o,n),h=c/sn(l,o,a,n),m=no(o),f=no(o);for(f.setUTCMonth(f.getUTCMonth()+12/a);f<s;)m.setUTCMonth(m.getUTCMonth()+12/a),f.setUTCMonth(f.getUTCMonth()+12/a),h+=1;l=nu(m),o=nu(f);let{days:g}=ny(l,t,n);return h+g/sn(l,o,a,n)}};k(s3,"Oddlyield");let s5=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,t,td.create(Y.NA)),u=ak(a,n,r,td.create(Y.NA)),l=i.map((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=n8(e,s.get(t,r),u.get(t,r));if(a)return n;let[l,o,c]=i,h=+l.getValue(),m=+o.getValue(),f=+c.getValue();if(h<=-1)return td.create(Y.NUM);let g=(Math.log(f)-Math.log(m))/Math.log(1+h);return Number.isNaN(g)||!Number.isFinite(g)?td.create(Y.NUM):ah.create(g)});return 1===a&&1===n?l.get(0,0):l}};k(s5,"Pduration");let s4=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:ah.create(0),s=null!=n?n:ah.create(0),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=ak(u,l,e,td.create(Y.NA)),c=ak(u,l,t,td.create(Y.NA)),h=ak(u,l,r,td.create(Y.NA)),m=ak(u,l,i,td.create(Y.NA)),f=ak(u,l,s,td.create(Y.NA)),g=o.map((e,t,r)=>{let a=c.get(t,r),{isError:n,errorObject:i,variants:s}=n8(e,a,h.get(t,r),m.get(t,r),f.get(t,r));if(n)return i;let[u,l,o,g,d]=s,N=+u.getValue(),_=+l.getValue(),E=+o.getValue(),C=+g.getValue(),p=+d.getValue();if(N<=-1)return td.create(Y.NUM);let A=so(N,_,E,C,p?1:0);return Number.isNaN(A)||!Number.isFinite(A)?td.create(Y.NUM):0===t&&0===r?ah.create(A,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(A)});return 1===u&&1===l?g.get(0,0):g}};k(s4,"Pmt");let s6=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=n?n:ah.create(0),u=null!=i?i:ah.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,e,td.create(Y.NA)),h=ak(l,o,t,td.create(Y.NA)),m=ak(l,o,r,td.create(Y.NA)),f=ak(l,o,a,td.create(Y.NA)),g=ak(l,o,s,td.create(Y.NA)),d=ak(l,o,u,td.create(Y.NA)),N=c.map((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),{isError:i,errorObject:s,variants:u}=n8(e,a,n,f.get(t,r),g.get(t,r),d.get(t,r));if(i)return s;let[l,o,c,N,_,E]=u,C=+l.getValue(),p=+o.getValue(),A=+c.getValue(),b=+N.getValue(),y=+_.getValue(),R=+E.getValue();if(p<1||Math.floor(p)>Math.ceil(A)||p-A>=1)return td.create(Y.NUM);let S=so(C,A,b,y,R?1:0)-sh(C,p,A,b,y,R?1:0);return Number.isNaN(S)||!Number.isFinite(S)?td.create(Y.NUM):0===t&&0===r?ah.create(S,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(S)});return 1===l&&1===o?N.get(0,0):N}};k(s6,"Ppmt");let s7=class extends a1{constructor(){super(...arguments),$(this,"minParams",6),$(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let u=null!=s?s:ah.create(0);u.isNull()&&(u=ah.create(0));let{isError:l,errorObject:o,variants:c}=n9(e,t,r,a,n,i,u);if(l)return o;let[h,m,f,g,d,N,_]=c,E=nA(h);if("number"!=typeof E)return E;let C=nA(m);if("number"!=typeof C)return C;let p=+f.getValue(),A=+g.getValue(),b=+d.getValue(),y=Math.floor(+N.getValue()),R=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(A)||Number.isNaN(b)||Number.isNaN(y)||Number.isNaN(R))return td.create(Y.VALUE);if(p<0||A<0||b<=0||![1,2,4].includes(y)||R<0||R>4||E>=C||!sE(E,C,y))return td.create(Y.NUM);let S=sy(E,C,p,A,b,y,R);return ah.create(S)}};k(s7,"Price");let s9=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:ah.create(0);i.isNull()&&(i=ah.create(0));let{isError:s,errorObject:u,variants:l}=n9(e,t,r,a,i);if(s)return u;let[o,c,h,m,f]=l,g=nA(o);if("number"!=typeof g)return g;let d=nA(c);if("number"!=typeof d)return d;let N=+h.getValue(),_=+m.getValue(),E=Math.floor(+f.getValue());if(Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(E))return td.create(Y.VALUE);if(N<=0||_<=0||E<0||E>4||g>=d)return td.create(Y.NUM);let{days:C,yearDays:p}=ny(g,d,E);return ah.create(_-N*_*C/p)}};k(s9,"Pricedisc");let s8=class extends a1{constructor(){super(...arguments),$(this,"minParams",5),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:ah.create(0);s.isNull()&&(s=ah.create(0));let{isError:u,errorObject:l,variants:o}=n9(e,t,r,a,n,s);if(u)return l;let[c,h,m,f,g,d]=o,N=nA(c);if("number"!=typeof N)return N;let _=nA(h);if("number"!=typeof _)return _;let E=nA(m);if("number"!=typeof E)return E;let C=+f.getValue(),p=+g.getValue(),A=Math.floor(+d.getValue());if(Number.isNaN(C)||Number.isNaN(p)||Number.isNaN(A))return td.create(Y.VALUE);let b=this._getDateCorrectOrder(_,N,E);if(C<0||p<0||A<0||A>4||!b)return td.create(Y.NUM);let y=nU(N,A),{days:R}=ny(N,_,A),{days:S}=ny(E,_,A),{days:O}=ny(E,N,A);return ah.create((100+S/y*C*100)/(1+R/y*p)-O/y*C*100)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}};k(s8,"Pricemat");let ue=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:ah.create(0),s=null!=n?n:ah.create(0),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=ak(u,l,e,td.create(Y.NA)),c=ak(u,l,t,td.create(Y.NA)),h=ak(u,l,r,td.create(Y.NA)),m=ak(u,l,i,td.create(Y.NA)),f=ak(u,l,s,td.create(Y.NA)),g=o.map((e,t,r)=>{let a=c.get(t,r),{isError:n,errorObject:i,variants:s}=n8(e,a,h.get(t,r),m.get(t,r),f.get(t,r));if(n)return i;let[u,l,o,g,d]=s,N=+u.getValue(),_=+l.getValue(),E=+o.getValue(),C=+g.getValue(),p=+d.getValue();p=p?1:0;let A=0===N?-E*_-C:((1-(1+N)**_)/N*E*(1+N*p)-C)/(1+N)**_;return Number.isNaN(A)||!Number.isFinite(A)?td.create(Y.NUM):0===t&&0===r?ah.create(A,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(A)});return 1===u&&1===l?g.get(0,0):g}};k(ue,"Pv");let ut=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=a?a:ah.create(0),u=null!=n?n:ah.create(0),l=null!=i?i:ah.create(.1),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ak(o,c,e,td.create(Y.NA)),m=ak(o,c,t,td.create(Y.NA)),f=ak(o,c,r,td.create(Y.NA)),g=ak(o,c,s,td.create(Y.NA)),d=ak(o,c,u,td.create(Y.NA)),N=ak(o,c,l,td.create(Y.NA)),_=h.map((e,t,r)=>{let a=m.get(t,r),n=f.get(t,r),{isError:i,errorObject:s,variants:u}=n8(e,a,n,g.get(t,r),d.get(t,r),N.get(t,r));if(i)return s;let[l,o,c,h,_,E]=u,C=+l.getValue(),p=+o.getValue(),A=+c.getValue(),b=+h.getValue(),y=+_.getValue(),R=+E.getValue();return y=y?1:0,C<=0||p>=0?td.create(Y.NUM):this._getResult(C,p,A,b,y,R,t,r)});return 1===o&&1===c?_.get(0,0):_}_getResult(e,t,r,a,n,i,s,u){let l=i;for(let i=0;i<20;i++){let i,s,u;if(l<=-1)return td.create(Y.NUM);if(1e-10>Math.abs(i=1e-10>Math.abs(l)?r*(1+e*l)+t*(1+l*n)*e+a:r*(s=(1+l)**e)+t*(1/l+n)*(s-1)+a))break;if(1e-10>Math.abs(l))u=r*e+t*n*e;else{s=(1+l)**e;let a=e*(1+l)**(e-1);u=r*a+t*(1/l+n)*a+-1/(l*l)*t*(s-1)}l-=i/u}return 0===s&&0===u?ah.create(l,"0%"):ah.create(l)}};k(ut,"Rate");let ur=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:ah.create(0);i.isNull()&&(i=ah.create(0));let{isError:s,errorObject:u,variants:l}=n9(e,t,r,a,i);if(s)return u;let[o,c,h,m,f]=l,g=nA(o);if("number"!=typeof g)return g;let d=nA(c);if("number"!=typeof d)return d;let N=+h.getValue(),_=+m.getValue(),E=Math.floor(+f.getValue());if(Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(E))return td.create(Y.VALUE);if(N<=0||_<=0||E<0||E>4||g>=d)return td.create(Y.NUM);let{days:C,yearDays:p}=ny(g,d,E),A=N/(1-_*C/p);return A<0?td.create(Y.NUM):ah.create(A)}};k(ur,"Received");let ua=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",6)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,t,td.create(Y.NA)),u=ak(a,n,r,td.create(Y.NA)),l=i.map((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=n8(e,s.get(t,r),u.get(t,r));if(a)return n;let[l,o,c]=i,h=+l.getValue(),m=+o.getValue(),f=+c.getValue();if(h<=0)return td.create(Y.NUM);if(0===m&&0===f)return ah.create(0);let g=(f/m)**(1/h)-1;return Number.isNaN(g)||!Number.isFinite(g)||f/m<0?td.create(Y.NUM):ah.create(g)});return 1===a&&1===n?l.get(0,0):l}};k(ua,"Rri");let un=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,t,td.create(Y.NA)),u=ak(a,n,r,td.create(Y.NA)),l=i.map((e,t,r)=>{let a=s.get(t,r),n=u.get(t,r);if(a.isError())return a;if(n.isError())return n;let i=+e.getValue(),l=+a.getValue(),o=+n.getValue();if(Number.isNaN(i)||Number.isNaN(l)||Number.isNaN(o))return td.create(Y.VALUE);if(0===o)return td.create(Y.DIV_BY_ZERO);let c=(i-l)/o;return 0===t&&0===r?ah.create(c,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(c)});return 1===a&&1===n?l.get(0,0):l}};k(un,"Sln");let ui=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=ak(n,i,e,td.create(Y.NA)),u=ak(n,i,t,td.create(Y.NA)),l=ak(n,i,r,td.create(Y.NA)),o=ak(n,i,a,td.create(Y.NA)),c=s.map((e,t,r)=>{let a=u.get(t,r),n=l.get(t,r),i=o.get(t,r);if(a.isError())return a;if(n.isError())return n;if(i.isError())return i;let s=+e.getValue(),c=+a.getValue(),h=+n.getValue(),m=+i.getValue();if(Number.isNaN(s)||Number.isNaN(c)||Number.isNaN(h)||Number.isNaN(m))return td.create(Y.VALUE);if(c<0||h<=0||m>h)return td.create(Y.NUM);let f=(s-c)*(h-m+1)*2/(h*(h+1));return 0===t&&0===r?ah.create(f,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(f)});return 1===n&&1===i?c.get(0,0):c}};k(ui,"Syd");let us=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=n9(e,t,r);if(a)return n;let[s,u,l]=i,o=nA(s);if("number"!=typeof o)return o;let c=nA(u);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return td.create(Y.VALUE);if(h<=0||o>=c)return td.create(Y.NUM);let m=Math.floor(c)-Math.floor(o);if(m>nv(no(o).getUTCFullYear()))return td.create(Y.NUM);let f=365*h/(360-h*m);if(m>182){let e=m/365;if(Number.isNaN(f=(-e+Math.sqrt(e*e-(2*e-1)*(1-100/(100*(1-h*m/360)))))/(e-.5)))return td.create(Y.NUM)}return f<0?td.create(Y.NUM):ah.create(f)}};k(us,"Tbilleq");let uu=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=n9(e,t,r);if(a)return n;let[s,u,l]=i,o=nA(s);if("number"!=typeof o)return o;let c=nA(u);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return td.create(Y.VALUE);if(h<=0||o>=c)return td.create(Y.NUM);let m=Math.floor(c)-Math.floor(o);if(m>nv(no(o).getUTCFullYear()))return td.create(Y.NUM);let f=100*(1-h*m/360);return f<0?td.create(Y.NUM):ah.create(f,'""#,##0.00_);[Red](""#,##0.00)')}};k(uu,"Tbillprice");let ul=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=n9(e,t,r);if(a)return n;let[s,u,l]=i,o=nA(s);if("number"!=typeof o)return o;let c=nA(u);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return td.create(Y.VALUE);if(h<=0||o>=c)return td.create(Y.NUM);let m=Math.floor(c)-Math.floor(o);return m>nv(no(o).getUTCFullYear())?td.create(Y.NUM):ah.create((100-h)/h*360/m)}};k(ul,"Tbillyield");let uo=class extends a1{constructor(){super(...arguments),$(this,"minParams",5),$(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let u=null!=i?i:ah.create(2);u.isNull()&&(u=ah.create(2));let l=null!=s?s:al.create(!1);l.isNull()&&(l=al.create(!1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ak(o,c,e,td.create(Y.NA)),m=ak(o,c,t,td.create(Y.NA)),f=ak(o,c,r,td.create(Y.NA)),g=ak(o,c,a,td.create(Y.NA)),d=ak(o,c,n,td.create(Y.NA)),N=ak(o,c,u,td.create(Y.NA)),_=ak(o,c,l,td.create(Y.NA));return this._getResultArray(h,m,f,g,d,N,_,o,c)}_getResultArray(e,t,r,a,n,i,s,u,l){let o=e.map((e,u,l)=>{let o=t.get(u,l),c=r.get(u,l),h=a.get(u,l),{isError:m,errorObject:f,variants:g}=n8(e,o,c,h,n.get(u,l),i.get(u,l),s.get(u,l));if(m)return f;let[d,N,_,E,C,p,A]=g,b=+d.getValue(),y=+N.getValue(),R=+_.getValue(),S=+E.getValue(),O=+C.getValue(),T=+p.getValue(),V=+A.getValue();if(b<0||y<0||R<0||S<0||O<0||O>R||S>O||T<0)return td.create(Y.NUM);if(0===R&&0===S&&0===O)return td.create(Y.DIV_BY_ZERO);let I=this._getResult(b,y,R,S,O,T,V);return 0===u&&0===l?ah.create(I,'""#,##0.00_);[Red](""#,##0.00)'):ah.create(I)});return 1===u&&1===l?o.get(0,0):o}_getResult(e,t,r,a,n,i,s){let u=Math.floor(a),l=Math.ceil(n),o=0;if(e<t){if(a>=1||s)return o;let r=Math.abs(e-t);return-(o=r*(n-a)>r?r:r*(n-a))}if(s)for(let s=u+1;s<=l;s++){let c=sR(e,t,r,s,i);s===u+1?c*=Math.min(n,u+1)-a:s===l&&(c*=n+1-l),o+=c}else{let s=e-this._getVdb(e,t,r,r,a,i);o=this._getVdb(s,t,r,r-a,n-a,i)}return o}_getVdb(e,t,r,a,n,i){let s=Math.ceil(n),u=0,l=e-t,o=0,c=0,h=!1;for(let m=1;m<=s;m++){if(h)c=o;else{let n=sR(e,t,r,m,i);(o=l/(a-(m-1)))>n?(c=o,h=!0):(c=n,l-=n)}m===s&&(c*=n+1-s),u+=c}return u}};k(uo,"Vdb");let uc=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return td.create(Y.NA);let{isError:a,errorObejct:n,_values:i,_dates:s}=this._checkErrors(e,t);if(a)return n;let u=null!=r?r:ah.create(.1);u.isNull()&&(u=ah.create(.1));let{isError:l,errorObject:o,variants:c}=n7(u);if(l)return o;let[h]=c,m=+h.getValue();if(Number.isNaN(m))return td.create(Y.VALUE);let{positive:f,negative:g}=this._checkValues(i);if(!f||!g||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||m<0)return td.create(Y.NUM);let d=sA(m,e=>this._iterF(i,s,e));return"number"!=typeof d?d:ah.create(d)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:a,_values:n}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:a};let{isError:i,errorObejct:s,_dates:u}=this._checkErrorDates(t);return i?{isError:i,errorObejct:s}:{isError:!1,_values:n,_dates:u}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,a=td.create(Y.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isBoolean())return r=!0,a=td.create(Y.VALUE),!1;let n=+e.getValue();if(Number.isNaN(n))return r=!0,a=td.create(Y.VALUE),!1;t.push(n)}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:td.create(Y.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:td.create(Y.VALUE)}:{isError:!0,errorObejct:td.create(Y.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,a=td.create(Y.VALUE);return e.iterator(e=>{if(null!=e&&e.isError())return r=!0,a=e,!1;if(null!=e&&e.isBoolean())return r=!0,a=td.create(Y.VALUE),!1;let n=+e.getValue();return Number.isNaN(n)?(r=!0,a=td.create(Y.VALUE),!1):n<0?(r=!0,a=td.create(Y.NUM),!1):void t.push(Math.floor(n))}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:td.create(Y.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:td.create(Y.VALUE)}:0>+t?{isError:!0,errorObejct:td.create(Y.NUM)}:{isError:!0,errorObejct:td.create(Y.NA)}}}_checkValues(e){let t=!1,r=!1;for(let a=0;a<e.length;a++)e[a]>0&&(t=!0),e[a]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((e,a,n)=>e+a/(1+r)**((t[n]-t[0])/365),0)}};k(uc,"Xirr");let uh=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return td.create(Y.NA);let{isError:a,errorObject:n,variants:i}=n7(e);if(a)return n;let[s]=i,u=+s.getValue();if(Number.isNaN(u))return td.create(Y.VALUE);let{isError:l,errorObejct:o,_values:c,_dates:h}=this._checkErrors(t,r);if(l)return o;if(u<0||c.length!==h.length)return td.create(Y.NUM);let m=0,f=h[0];for(let e=0;e<h.length;e++){let t=h[e];m+=c[e]/(1+u)**((t-f)/365)}return ah.create(m)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:a,_values:n}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:a};let{isError:i,errorObejct:s,_dates:u}=this._checkErrorDates(t);return i?{isError:i,errorObejct:s}:{isError:!1,_values:n,_dates:u}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,a=td.create(Y.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isNull()||e.isBoolean())return r=!0,a=td.create(Y.VALUE),!1;let n=+e.getValue();if(Number.isNaN(n))return r=!0,a=td.create(Y.VALUE),!1;t.push(n)}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:td.create(Y.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:td.create(Y.VALUE)}:{isError:!0,errorObejct:td.create(Y.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,a=td.create(Y.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isNull()||e.isBoolean())return r=!0,a=td.create(Y.VALUE),!1;let n=+e.getValue();return Number.isNaN(n)?(r=!0,a=td.create(Y.VALUE),!1):n<0?(r=!0,a=td.create(Y.NUM),!1):void t.push(Math.floor(n))}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:td.create(Y.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:td.create(Y.VALUE)}:0>+t?{isError:!0,errorObejct:td.create(Y.NUM)}:{isError:!0,errorObejct:td.create(Y.NA)}}}};k(uh,"Xnpv");let um=class extends a1{constructor(){super(...arguments),$(this,"minParams",6),$(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let u=null!=s?s:ah.create(0);u.isNull()&&(u=ah.create(0));let{isError:l,errorObject:o,variants:c}=n9(e,t,r,a,n,i,u);if(l)return o;let[h,m,f,g,d,N,_]=c,E=nA(h);if("number"!=typeof E)return E;let C=nA(m);if("number"!=typeof C)return C;let p=+f.getValue(),A=+g.getValue(),b=+d.getValue(),y=Math.floor(+N.getValue()),R=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(A)||Number.isNaN(b)||Number.isNaN(y)||Number.isNaN(R))return td.create(Y.VALUE);if(p<0||A<=0||b<=0||![1,2,4].includes(y)||R<0||R>4||E>=C||!sE(E,C,y))return td.create(Y.NUM);let S=this._getResult(E,C,p,A,b,y,R);return ah.create(S)}_getResult(e,t,r,a,n,i,s){if(ss(e,t,i)>1){let u=r||.01,l=sy(e,t,r,u,n,i,s),o=l-a;for(let c=0;c<100&&Math.abs(o)>1e-7;c++)l=sy(e,t,r,1.01*u,n,i,s),u+=-o/(l-a-o)*u*.01,o=sy(e,t,r,u,n,i,s)-a;return u}let u=sa(e,t,i,s),l=sn(e,t,i,s),{days:o}=ny(e,t,s),c=a/100+u/l*r/i;return(n/100+r/i-c)/c*i*l/o}};k(um,"Yield");let uf=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:ah.create(0);i.isNull()&&(i=ah.create(0));let{isError:s,errorObject:u,variants:l}=n9(e,t,r,a,i);if(s)return u;let[o,c,h,m,f]=l,g=nA(o);if("number"!=typeof g)return g;let d=nA(c);if("number"!=typeof d)return d;let N=+h.getValue(),_=+m.getValue(),E=Math.floor(+f.getValue());if(Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(E))return td.create(Y.VALUE);if(N<=0||_<=0||E<0||E>4||g>=d)return td.create(Y.NUM);let{days:C,yearDays:p}=ny(g,d,E);return ah.create((_/N-1)/(C/p))}};k(uf,"Yielddisc");let ug=class extends a1{constructor(){super(...arguments),$(this,"minParams",5),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:ah.create(0);s.isNull()&&(s=ah.create(0));let{isError:u,errorObject:l,variants:o}=n9(e,t,r,a,n,s);if(u)return l;let[c,h,m,f,g,d]=o,N=nA(c);if("number"!=typeof N)return N;let _=nA(h);if("number"!=typeof _)return _;let E=nA(m);if("number"!=typeof E)return E;let C=+f.getValue(),p=+g.getValue(),A=Math.floor(+d.getValue());if(Number.isNaN(C)||Number.isNaN(p)||Number.isNaN(A))return td.create(Y.VALUE);let b=this._getDateCorrectOrder(_,N,E);if(C<0||p<=0||A<0||A>4||!b)return td.create(Y.NUM);let y=nU(N,A),{days:R}=ny(N,_,A),{days:S}=ny(E,_,A),{days:O}=ny(E,N,A);return ah.create(((1+S/y*C)/(p/100+O/y*C)-1)/(R/y))}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}};k(ug,"Yieldmat");let ud=[[sS,sr.ACCRINT],[sO,sr.ACCRINTM],[sT,sr.AMORLINC],[sV,sr.COUPDAYBS],[sI,sr.COUPDAYS],[sM,sr.COUPDAYSNC],[sx,sr.COUPNCD],[sv,sr.COUPNUM],[sU,sr.COUPPCD],[sD,sr.CUMIPMT],[sL,sr.CUMPRINC],[sP,sr.DB],[sw,sr.DDB],[sF,sr.DISC],[sj,sr.DOLLARDE],[sB,sr.DOLLARFR],[sk,sr.DURATION],[s$,sr.EFFECT],[sH,sr.FV],[sY,sr.FVSCHEDULE],[sG,sr.INTRATE],[sq,sr.IPMT],[sW,sr.IRR],[sQ,sr.ISPMT],[sX,sr.MDURATION],[sK,sr.MIRR],[sz,sr.NOMINAL],[sZ,sr.NPER],[sJ,sr.NPV],[s0,sr.ODDFPRICE],[s1,sr.ODDFYIELD],[s2,sr.ODDLPRICE],[s3,sr.ODDLYIELD],[s5,sr.PDURATION],[s4,sr.PMT],[s6,sr.PPMT],[s7,sr.PRICE],[s9,sr.PRICEDISC],[s8,sr.PRICEMAT],[ue,sr.PV],[ut,sr.RATE],[ur,sr.RECEIVED],[ua,sr.RRI],[un,sr.SLN],[ui,sr.SYD],[us,sr.TBILLEQ],[uu,sr.TBILLPRICE],[ul,sr.TBILLYIELD],[uo,sr.VDB],[uc,sr.XIRR],[uh,sr.XNPV],[um,sr.YIELD],[uf,sr.YIELDDISC],[ug,sr.YIELDMAT]];var uN=((R=uN||{}).CELL="CELL",R.ERROR_TYPE="ERROR.TYPE",R.INFO="INFO",R.ISBLANK="ISBLANK",R.ISERR="ISERR",R.ISERROR="ISERROR",R.ISEVEN="ISEVEN",R.ISFORMULA="ISFORMULA",R.ISLOGICAL="ISLOGICAL",R.ISNA="ISNA",R.ISNONTEXT="ISNONTEXT",R.ISNUMBER="ISNUMBER",R.ISODD="ISODD",R.ISOMITTED="ISOMITTED",R.ISREF="ISREF",R.ISTEXT="ISTEXT",R.N="N",R.NA="NA",R.SHEET="SHEET",R.SHEETS="SHEETS",R.TYPE="TYPE",R);let u_=class extends a1{constructor(){super(...arguments),$(this,"needsReferenceObject",!0),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),a=r.getColumnCount();if(1===e&&1===a){let e=r.get(0,0);return this._handleSingleObject(e,t)}return r.map(e=>e.isError()?e:this._handleSingleObject(e,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let a,n=t;if(n.isError())return n;if(!n.isReferenceObject())return td.create(Y.NA);let{columnData:i,defaultColumnWidth:s}=n.getCurrentActiveSheetData(),u=(n=n.toArrayValueObject()).getCurrentRow(),l=n.getCurrentColumn();switch(n=n.getFirstCell(),`${e.getValue()}`.toLocaleLowerCase()){case"address":return ag.create(`$${(0,P.Tools).chatAtABC(l)}$${u+1}`);case"col":return ah.create(l+1);case"color":case"parentheses":return ah.create(0);case"contents":return n;case"filename":default:return td.create(Y.VALUE);case"format":return ag.create("G");case"prefix":return ag.create("");case"protect":return ah.create(1);case"row":return ah.create(u+1);case"type":return a="v",n.isNull()&&(a="b"),n.isString()&&(a="l"),ag.create(a);case"width":return this._getWidthResult(i,s,l,r)}}_getWidthResult(e,t,r,a){var n;let i=null==(n=e[r])?void 0:n.w;if(i||0===i||(i=t),a)return ah.create(i);let s=[[i,i===t]];return aA.createByArray(s)}};k(u_,"Cell");let uE=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1),$(this,"_errorTypeValueMap",/* @__PURE__ */new Map([[Y.NULL,1],[Y.DIV_BY_ZERO,2],[Y.VALUE,3],[Y.REF,4],[Y.NAME,5],[Y.NUM,6],[Y.NA,7],[Y.CONNECT,8],[Y.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?ah.create(r):td.create(Y.NA)}};k(uE,"ErrorType");let uC=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isNull()?al.create(!0):e.isArray()?e.mapValue(e=>e.isNull()?al.create(!0):al.create(!1)):al.create(!1)}};k(uC,"Isblank");let up=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.getValue()===Y.NA?al.create(!1):e.isError()?al.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===Y.NA?al.create(!1):e.isError()?al.create(!0):al.create(!1)):al.create(!1)}};k(up,"Iserr");let uA=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?al.create(!0):e.isArray()?e.mapValue(e=>e.isError()?al.create(!0):al.create(!1)):al.create(!1)}};k(uA,"Iserror");let ub=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return td.create(Y.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return td.create(Y.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?td.create(Y.VALUE):al.create(r%2==0)}};k(ub,"Iseven");let uy=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1),$(this,"needsReferenceObject",!0)}calculate(e){var t;if(e.isError())return e;if(!e.isReferenceObject())return td.create(Y.NA);let r=null==(t=e.getCurrentActiveSheetData())?void 0:t.cellData.getMatrix(),{startRow:a,startColumn:n}=e.getRangePosition(),i=e.toArrayValueObject(),s=i.mapValue((e,t,i)=>{var s;let u=null==(s=null==r?void 0:r[a+t])?void 0:s[n+i];return null!=u&&u.f||null!=u&&u.si?al.create(!0):al.create(!1)});return 1===i.getRowCount()&&1===i.getColumnCount()?s.get(0,0):s}};k(uy,"Isformula");let uR=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isBoolean()?al.create(!0):e.isArray()?e.mapValue(e=>e.isBoolean()?al.create(!0):al.create(!1)):al.create(!1)}};k(uR,"Islogical");let uS=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.getValue()===Y.NA?al.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===Y.NA?al.create(!0):al.create(!1)):al.create(!1)}};k(uS,"Isna");let uO=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()||e.isString()?e.isArray()?e.mapValue(e=>e.isString()?al.create(!1):al.create(!0)):al.create(!1):al.create(!0)}};k(uO,"Isnontext");let uT=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isNumber()?al.create(!0):e.isArray()?e.mapValue(e=>e.isNumber()?al.create(!0):al.create(!1)):al.create(!1)}};k(uT,"Isnumber");let uV=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return td.create(Y.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return td.create(Y.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?td.create(Y.VALUE):al.create(r%2!=0)}};k(uV,"Isodd");let uI=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1),$(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?al.create(!0):al.create(!1)}};k(uI,"Isref");let uM=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isString()?al.create(!0):e.isArray()?e.mapValue(e=>e.isString()?al.create(!0):al.create(!1)):al.create(!1)}};k(uM,"Istext");let ux=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return ah.create(0);let r=+t.getValue();return ah.create(r)}};k(ux,"N");let uv=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){return td.create(Y.NA)}};k(uv,"Na");let uU=class extends a1{constructor(){super(...arguments),$(this,"needsReferenceObject",!0),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){let t=e.getRowCount(),r=e.getColumnCount();if(1!==t||1!==r)return ah.create(64);{let t=e.getFirstCell();if(t.isError())return ah.create(16);if(t.isBoolean())return ah.create(4);if(t.isString())return ah.create(2);if(t.isNumber()||t.isNull())return ah.create(1)}}else{if(e.isArray())return ah.create(64);if(e.isError())return ah.create(16);if(e.isBoolean())return ah.create(4);if(e.isString())return ah.create(2);if(e.isNumber()||e.isNull())return ah.create(1)}return ah.create(128)}};k(uU,"Type");let uD=[[u_,uN.CELL],[uE,uN.ERROR_TYPE],[uC,uN.ISBLANK],[up,uN.ISERR],[uA,uN.ISERROR],[ub,uN.ISEVEN],[uy,uN.ISFORMULA],[uR,uN.ISLOGICAL],[uS,uN.ISNA],[uO,uN.ISNONTEXT],[uT,uN.ISNUMBER],[uV,uN.ISODD],[uI,uN.ISREF],[uM,uN.ISTEXT],[ux,uN.N],[uv,uN.NA],[uU,uN.TYPE]],uL=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,a=null;for(let n of e){if(n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null!=e&&e.isError())return a=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t&&!!e.getValue(),r=!1)}),a)return a}else(n.isBoolean()||n.isNumber())&&(t=t&&!!n.getValue(),r=!1)}return r?td.create(Y.VALUE):al.create(t)}};k(uL,"And");let uP=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return td.create(Y.VALUE);let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=ak(r,a,e),i=[[]];for(let e=0;e<a;e++){let a=[];for(let t=0;t<r;t++){let r=n.get(t,e);a.push([r])}let s=aA.create({calculateValueList:a,rowCount:r,columnCount:1,unitId:"",sheetId:"",row:0,column:0}),u=t.execute(s);if(u.isArray()){let e=u.getRowCount(),t=u.getColumnCount();if(e>1||t>1)return td.create(Y.CALC);u=u.get(0,0)}u.isNull()&&(u=ah.create(0)),i[0].push(u)}return 1===a?i[0][0]:aA.create({calculateValueList:i,rowCount:1,columnCount:a,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(uP,"Bycol");let uw=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return td.create(Y.VALUE);let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=ak(r,a,e),i=[];for(let e=0;e<r;e++){let r=[[]];for(let t=0;t<a;t++){let a=n.get(e,t);r[0].push(a)}let s=aA.create({calculateValueList:r,rowCount:1,columnCount:a,unitId:"",sheetId:"",row:0,column:0}),u=t.execute(s);if(u.isArray()){let e=u.getRowCount(),t=u.getColumnCount();if(e>1||t>1)return td.create(Y.CALC);u=u.get(0,0)}u.isNull()&&(u=ah.create(0)),i.push([u])}return 1===r?i[0][0]:aA.create({calculateValueList:i,rowCount:r,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(uw,"Byrow");let uF=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){return al.create(!1)}};k(uF,"False");var uj=((S=uj||{}).AND="AND",S.BYCOL="BYCOL",S.BYROW="BYROW",S.FALSE="FALSE",S.IF="IF",S.IFERROR="IFERROR",S.IFNA="IFNA",S.IFS="IFS",S.LAMBDA="LAMBDA",S.LET="LET",S.MAKEARRAY="MAKEARRAY",S.MAP="MAP",S.NOT="NOT",S.OR="OR",S.REDUCE="REDUCE",S.SCAN="SCAN",S.SWITCH="SWITCH",S.TRUE="TRUE",S.XOR="XOR",S);let uB=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r=al.create(!1)){if(e.isError())return e;if(t.isError())return t;let a=this._getSingleValueObject(e);if(!a.isArray())return a.getValue()?t:r;let n=Math.max(a.isArray()?a.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(a.isArray()?a.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ak(n,i,a),u=ak(n,i,t,td.create(Y.NA)),l=ak(n,i,r,td.create(Y.NA));return s.map((e,t,r)=>{if(e.isNull())return td.create(Y.NA);{let a=u.get(t,r)||as.create(),n=l.get(t,r)||as.create();return this._calculateSingleCell(e,a,n)}})}_getSingleValueObject(e){return e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()?e.getFirstCell():e}_calculateSingleCell(e,t,r){return e.isNull()?td.create(Y.NA):e.getValue()?t.isNull()?td.create(Y.NA):t:r.isNull()?td.create(Y.NA):r}};k(uB,"If");let uk=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;if(!e.isArray())return e.isError()?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e),i=ak(r,a,t);return n.iterator((e,t,r)=>{null!=e&&e.isError()&&n.set(t,r,i.get(t,r))}),n}};k(uk,"Iferror");let u$=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==Y.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===Y.NA?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e),i=ak(r,a,t);return n.iterator((e,t,r)=>{null!=e&&e.isError()&&e.getErrorType()===Y.NA&&n.set(t,r,i.get(t,r))}),n}};k(u$,"Ifna");let uH=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(...e){if(e.length%2!=0)return td.create(Y.NA);for(let t=0;t<e.length;t++)if(e[t].isError())return e[t];let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),a=e.map(e=>ak(t,r,e,td.create(Y.NA))),n=a[0].map((e,t,r)=>{for(let e=0;e<a.length;e+=2){let n=a[e].get(t,r)||as.create(),i=a[e+1].get(t,r)||as.create();if(n.isNull())continue;if(n.isError())return n;let s=n.getValue();if(n.isString()){if("TRUE"===`${s}`.toLocaleUpperCase())return i;if("FALSE"===`${s}`.toLocaleUpperCase())continue;return td.create(Y.VALUE)}if(+s)return i.isNull()?td.create(Y.NA):i}return td.create(Y.NA)});return 1===t&&1===r?n.get(0,0):n}};k(uH,"Ifs");let uY=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){return td.create(Y.VALUE)}};k(uY,"Lambda");let uG=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",255)}calculate(...e){return td.create(Y.VALUE)}};k(uG,"Let");let uq=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(...e){let t=this.getIndexNumValue(e[0]);if("number"!=typeof t)return t;let r=this.getIndexNumValue(e[1]);if("number"!=typeof r)return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return td.create(Y.VALUE);let a=e[2],n=[];for(let e=0;e<t;e++){null==n[e]&&(n[e]=[]);for(let t=0;t<r;t++){let r=a.execute(ah.create(e+1),ah.create(t+1));r.isArray()&&(r=r.get(0,0)),n[e][t]=r}}return new aV(n)}isAsync(){return!0}};k(uq,"Makearray");let uW=(k(cG=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(...e){let t=[],r=null,a=0,n=0;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(i===e.length-1){if(!(s.isValueObject()&&s.isLambda()))return td.create(Y.VALUE);r=s}else t.push(s),a=Math.max(a,s.isArray()?s.getRowCount():1),n=Math.max(n,s.isArray()?s.getColumnCount():1)}let i=this._getResultArray(t,r,a,n);return 1===a&&1===n?i[0][0]:aA.create({calculateValueList:i,rowCount:a,columnCount:n,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,a){let n=[];for(let i=0;i<r;i++){let r=[];for(let n=0;n<a;n++){let a=[],s=!1;for(let t=0;t<e.length;t++){let u=e[t];if(!u.isArray()){if(0===i&&0===n){a.push(u);continue}r.push(td.create(Y.NA)),s=!0;break}let l=u.get(i,n);if(!l){r.push(td.create(Y.NA)),s=!0;break}a.push(l)}if(s||0===a.length)continue;let u=t.execute(...a);u.isArray()&&(u=u.get(0,0)),u.isNull()&&(u=ah.create(0)),r.push(u)}n.push(r)}return n}},"Map"),cG),uQ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=+e.getValue();return Number.isNaN(t)?td.create(Y.VALUE):al.create(!t)}};k(uQ,"Not");let uX=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,a=null;for(let n of e){if(n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null!=e&&e.isError())return a=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t||!!e.getValue(),r=!1)}),a)return a}else(n.isBoolean()||n.isNumber())&&(t=t||!!n.getValue(),r=!1)}return r?new td(Y.VALUE):new al(t)}};k(uX,"Or");let uK=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){return e.isArray()?e.mapValue(e=>this._handleSingleValueObject(e,t,r)):this._handleSingleValueObject(e,t,r)}_handleSingleValueObject(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return td.create(Y.VALUE);let a=t.isArray()?t.getRowCount():1,n=t.isArray()?t.getColumnCount():1,i=e;for(let e=0;e<a;e++)for(let a=0;a<n;a++){let n=t.isArray()?t.get(e,a):t;if(n.isError())return n;let s=r.execute(i,n);if(s.isArray()&&(s=s.get(0,0)),s.isError())return s;s.isNull()&&(s=ah.create(0)),i=s}let s=+i.getValue();return Number.isNaN(s)||!Number.isFinite(s)?td.create(Y.VALUE):ah.create(s)}};k(uK,"Reduce");let uz=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return td.create(Y.VALUE);let a=e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();if(t>1||r>1)return td.create(Y.CALC);a=e.get(0,0)}return this._getResult(a,t,r)}_getResult(e,t,r){let a=t.isArray()?t.getRowCount():1,n=t.isArray()?t.getColumnCount():1,i=e,s=[];for(let e=0;e<a;e++){let a=[];for(let s=0;s<n;s++){if(i.isError()){a.push(i);continue}let n=t.isArray()?t.get(e,s):t;if(n.isError()){i=n,a.push(n);continue}let u=r.execute(i,n);u.isArray()&&(u=u.get(0,0)),u.isNull()&&(u=ah.create(0)),i=u,a.push(u)}s.push(a)}return 1===a&&1===n?s[0][0]:aA.create({calculateValueList:s,rowCount:a,columnCount:n,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(uz,"Scan");let uZ=class extends a1{constructor(){super(...arguments),$(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;let r=t.length%2!=0,a=r?t[t.length-1]:as.create();return e.isArray()||t.some(e=>e.isArray())?this._handleArrayInputs(e,t,a,r):this._handleNonArrayInputs(e,t,a,r)}_handleNonArrayInputs(e,t,r,a){for(let r=0;r<t.length-(a?1:0);r+=2){let a=t[r],n=t[r+1];if(!a.isNull()){if(a.isError())return a;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return n.isNull()?td.create(Y.NA):n}}return r.isNull()?td.create(Y.NA):r}_handleArrayInputs(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,...t.map(e=>e.isArray()?e.getRowCount():1),r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,...t.map(e=>e.isArray()?e.getColumnCount():1),r.isArray()?r.getColumnCount():1),s=ak(n,i,e),u=t.map(e=>ak(n,i,e,td.create(Y.NA))),l=ak(n,i,r,td.create(Y.NA));return s.map((e,t,r)=>{for(let n=0;n<u.length-(a?1:0);n+=2){let a=u[n].get(t,r)||as.create(),i=u[n+1].get(t,r)||as.create();if(!a.isNull()){if(a.isError()||e.isError())return a.isError()?a:e;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return i.isNull()?td.create(Y.NA):i}}let n=l.get(t,r)||as.create();return n.isNull()?td.create(Y.NA):n})}};k(uZ,"Switch");let uJ=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){return al.create(!0)}};k(uJ,"True");let u0=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=0,r=!0,a=null;for(let n of e){if(n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null!=e&&e.isError())return a=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(e.getValue()&&t++,r=!1)}),a)return a}else(n.isBoolean()||n.isNumber())&&(n.getValue()&&t++,r=!1)}return r?td.create(Y.VALUE):al.create(t%2==1)}};k(u0,"Xor");let u1=[[uL,uj.AND],[uP,uj.BYCOL],[uw,uj.BYROW],[uF,uj.FALSE],[uB,uj.IF],[uk,uj.IFERROR],[u$,uj.IFNA],[uH,uj.IFS],[uY,uj.LAMBDA],[uG,uj.LET],[uq,uj.MAKEARRAY],[uW,uj.MAP],[uQ,uj.NOT],[uX,uj.OR],[uK,uj.REDUCE],[uz,uj.SCAN],[uZ,uj.SWITCH],[uJ,uj.TRUE],[u0,uj.XOR]],u2=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",5)}calculate(e,t,r,a,n){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(null!=a&&a.isError())return a;if(null!=n&&n.isError())return n;let i=null!=r?r:ah.create(1),s=null!=a?a:al.create(!0),u=null!=n?n:ag.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,e,td.create(Y.NA)),h=ak(l,o,t,td.create(Y.NA)),m=ak(l,o,i,td.create(Y.NA)),f=ak(l,o,s,td.create(Y.NA)),g=ak(l,o,u,td.create(Y.NA));return c.map((e,t,r)=>{let a=h.get(t,r)||td.create(Y.NA),n=m.get(t,r)||td.create(Y.NA),i=f.get(t,r)||td.create(Y.NA),s=g.get(t,r)||td.create(Y.NA);return e.isError()?e:a.isError()?a:n.isError()?n:i.isError()?i:s.isError()?s:this._calculateSingleCell(e,a,n,i,s)})}_calculateSingleCell(e,t,r,a,n){let i=Number.parseInt(`${Number(e.getValue())-1}`),s=Number.parseInt(`${Number(t.getValue())-1}`),u=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(i)||Number.isNaN(s)||Number.isNaN(u)||u<1||u>4)return td.create(Y.VALUE);let l=u3(u),o=this.getZeroOrOneByOneDefault(a),c=`${n.getValue()}`,h=eW(c)?`'${c}'`:c,m={startRow:i,startColumn:s,endRow:i,endColumn:s,startAbsoluteRefType:l,endAbsoluteRefType:l},f=a&&!o?aL(m):eP(m);return ag.create(""!==h?`${h}!${f}`:f)}};function u3(e){switch(e){case 1:default:return P.AbsoluteRefType.ALL;case 2:return P.AbsoluteRefType.ROW;case 3:return P.AbsoluteRefType.COLUMN;case 4:return P.AbsoluteRefType.NONE}}k(u2,"Address"),k(u3,"transformAbsoluteRefType");let u5=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1),$(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?ah.create(1):td.create(Y.VALUE)}};k(u5,"Areas");let u4=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255),$(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){let e=r.convertToNumberObjectValue();return e.isError()?e:t[Math.trunc(+e.getValue())-1]||td.create(Y.VALUE)}let a=r.isArray()?r.getRowCount():1,n=r.isArray()?r.getColumnCount():1;t.forEach((e,t)=>{e.isArray()?(a=Math.max(a,e.getRowCount()),n=Math.max(n,e.getColumnCount())):(a=Math.max(a,1),n=Math.max(n,1))});let i=ak(a,n,r,td.create(Y.NA)),s=t.map(e=>{let t=e;return t.isReferenceObject()&&(t=t.toArrayValueObject()),ak(a,n,t,td.create(Y.NA))});return i.map((e,t,r)=>{if(e.isError())return e;let a=e.convertToNumberObjectValue();if(a.isError())return a;let n=s[Math.trunc(+a.getValue())-1],i=(null==n?void 0:n.get(t,r))||td.create(Y.VALUE);return null!=i&&i.isNull()&&(i=ah.create(0)),i})}};k(u4,"Choose");let u6=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t.length;i++){let s=t[i];if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);s=s.get(0,0)}if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let u=Math.trunc(+s.getValue());if(0===u||Math.abs(u)>a)return td.create(Y.VALUE);let l=e;a>1&&(l=u<0?e.slice(void 0,[u+a,u+1+a]):e.slice(void 0,[u-1,u]));for(let t=0;t<r;t++)n[t]||(n[t]=[]),e.isArray()?n[t].push(l.get(t,0)):n[t].push(e)}return aA.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(u6,"Choosecols");let u7=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,a=[];for(let n=0;n<t.length;n++){let i=t[n];if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);i=i.get(0,0)}if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=Math.trunc(+i.getValue());if(0===s||Math.abs(s)>r)return td.create(Y.VALUE);let u=e;r>1&&(u=s<0?e.slice([s+r,s+1+r]):e.slice([s-1,s])),e.isArray()?a.push(u.getArrayValue()[0]):a.push([e])}return aA.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(u7,"Chooserows");let u9=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",1)}calculate(e){if(null==e)return ah.create(this.column+1);if(e.isError())return e;if(!e.isArray())return td.create(Y.NA);let t=e.getCurrentColumn(),r=e.getColumnCount(),a=[];for(let e=0;e<r;e++)a.push(ah.create(t+e+1));let n={calculateValueList:[a],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(n)}};k(u9,"Column");let u8=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return ah.create(1);if(!e.isArray())return td.create(Y.NA);let t=e.getColumnCount();return ah.create(t)}};k(u8,"Columns");let le=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:ah.create(0),n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=Math.max(t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=ak(s,u,t,td.create(Y.NA)),o=ak(s,u,a,td.create(Y.NA));if(s>1||u>1)return l.mapValue((t,r,a)=>{let s=o.get(r,a);if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);let{isError:u,errorObject:l}=this._checkRowsColumns(t,s,n,i);return u?l:e.isArray()?td.create(Y.VALUE):e});if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);let c=t.isArray()?t.get(0,0):t,h=a.isArray()?a.get(0,0):a,{isError:m,errorObject:f,rowsValue:g,columnsValue:d}=this._checkRowsColumns(c,h,n,i);return m?f:this._getResultArray(e,g,d,n,i)}_checkRowsColumns(e,t,r,a){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let n=Math.trunc(+e.getValue()),i=Math.trunc(+t.getValue());return Number.isNaN(n)||Number.isNaN(i)?{isError:!0,errorObject:td.create(Y.VALUE)}:Math.abs(n)>=r||Math.abs(i)>=a?{isError:!0,errorObject:td.create(Y.CALC)}:{isError:!1,rowsValue:n,columnsValue:i}}_getResultArray(e,t,r,a,n){let i;let s=t>=0?[t,a]:[0,a+t],u=r>=0?[r,n]:[0,n+r];return i=(i=0===t&&0===r?e:0===t?e.slice(void 0,u):0===r?e.slice(s,void 0):e.slice(s,u)).map(e=>e.isNull()?ah.create(0):e),a-t==1&&n-r==1?i.get(0,0):i}};k(le,"Drop");let lt=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",4)}calculate(e,t,r,a){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t,u=null!=r?r:ah.create(i),l=null!=a?a:td.create(Y.NA);t.isNull()&&(s=ah.create(n)),u.isNull()&&(u=ah.create(i));let o=Math.max(s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1),c=Math.max(s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1),h=ak(o,c,s,td.create(Y.NA)),m=ak(o,c,u,td.create(Y.NA));if(o>1||c>1)return h.mapValue((t,r,a)=>{let s=m.get(r,a);if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);let{isError:u,errorObject:o}=this._checkRowsColumnsPadWith(t,s,l,n,i);return u?o:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);let f=s.isArray()?s.get(0,0):s,g=u.isArray()?u.get(0,0):u,{isError:d,errorObject:N,rowsValue:_,columnsValue:E,padWithObject:C}=this._checkRowsColumnsPadWith(f,g,l,n,i);return d?N:this._getResultArray(e,_,E,C,n,i)}_checkRowsColumnsPadWith(e,t,r,a,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());if(Number.isNaN(i)||Number.isNaN(s)||Math.abs(i)<a||Math.abs(s)<n)return{isError:!0,errorObject:td.create(Y.VALUE)};let u=r;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:td.create(Y.VALUE)};u=r.get(0,0)}return{isError:!1,rowsValue:i,columnsValue:s,padWithObject:u}}_getResultArray(e,t,r,a,n,i){let s=[];s=e.isArray()?e.map(e=>e.isNull()?ah.create(0):e).getArrayValue():[[e]];let u=Math.max(0,t-n),l=Math.max(0,r-i);for(let e=0;e<u;e++)s.push(Array(i).fill(a));for(let e=0;e<l;e++)s.forEach(e=>{e.push(a)});return 1===t&&1===r?s[0][0]:aA.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(lt,"Expand");let lr=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:td.create(Y.CALC);if(e.isError())return e;if(t.isError())return t;let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;return s>1&&u>1||1===s&&u!==i||1===u&&s!==n?td.create(Y.VALUE):1===n&&1===i?this._getResultArrayByR1C1(e,t,a):1===s?u!==i?td.create(Y.VALUE):this._getResultArrayByR1(n,i,e,t,a):1===u?s!==n?td.create(Y.VALUE):this._getResultArrayByC1(n,i,e,t,a):a}_getResultArrayByR1C1(e,t,r){let a=e,n=t;return a.isArray()&&(a=a.get(0,0)),n.isArray()&&(n=n.get(0,0)),n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:+n.getValue()?a:r}_getResultArrayByR1(e,t,r,a,n){let i=[];for(let n=0;n<t;n++){let t=a.get(0,n);if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;if(+t.getValue())for(let t=0;t<e;t++){i[t]||(i[t]=[]);let e=r.get(t,n);i[t].push(e)}}return 0===i.length?n:aA.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,a,n){let i=[];for(let n=0;n<e;n++){let e=a.get(n,0);if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return e;if(!+e.getValue())continue;let s=[];for(let e=0;e<t;e++){let t=r.get(n,e);s.push(t)}i.push(s)}return 0===i.length?n:aA.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(lr,"Filter");var la=((O=la||{}).ADDRESS="ADDRESS",O.AREAS="AREAS",O.CHOOSE="CHOOSE",O.CHOOSECOLS="CHOOSECOLS",O.CHOOSEROWS="CHOOSEROWS",O.COLUMN="COLUMN",O.COLUMNS="COLUMNS",O.DROP="DROP",O.EXPAND="EXPAND",O.FILTER="FILTER",O.FORMULATEXT="FORMULATEXT",O.GETPIVOTDATA="GETPIVOTDATA",O.HLOOKUP="HLOOKUP",O.HSTACK="HSTACK",O.HYPERLINK="HYPERLINK",O.IMAGE="IMAGE",O.INDEX="INDEX",O.INDIRECT="INDIRECT",O.LOOKUP="LOOKUP",O.MATCH="MATCH",O.OFFSET="OFFSET",O.ROW="ROW",O.ROWS="ROWS",O.RTD="RTD",O.SORT="SORT",O.SORTBY="SORTBY",O.TAKE="TAKE",O.TOCOL="TOCOL",O.TOROW="TOROW",O.TRANSPOSE="TRANSPOSE",O.UNIQUE="UNIQUE",O.VLOOKUP="VLOOKUP",O.VSTACK="VSTACK",O.WRAPCOLS="WRAPCOLS",O.WRAPROWS="WRAPROWS",O.XLOOKUP="XLOOKUP",O.XMATCH="XMATCH",O);let ln=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){if(e.isError())return e;if(t.isError())return td.create(Y.REF);if(!t.isArray()||r.isError()||null!=a&&a.isError())return td.create(Y.NA);let n=this.getZeroOrOneByOneDefault(a);if(null==n)return td.create(Y.VALUE);let i=this.getIndexNumValue(r);if(i instanceof td)return i;let s=t.slice([0,1]),u=t.slice([i-1,i]);return null==s||null==u?td.create(Y.REF):e.isArray()?e.map(e=>this._handleSingleObject(e,s,u,n)):this._handleSingleObject(e,s,u,n)}_handleSingleObject(e,t,r,a){return 0===a?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}};k(ln,"Hlookup");let li=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=[];for(let a=0;a<e.length;a++){let n=e[a];if(n.isError())return n;let i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<t;e++){r[e]||(r[e]=[]);for(let t=0;t<s;t++){let a=n;n.isArray()&&(a=n.get(e,t)),e>i-1||!a?r[e].push(td.create(Y.NA)):r[e].push(a)}}}return aA.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(li,"Hstack");let ls=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",4),$(this,"needsReferenceObject",!0)}calculate(e,t,r,a){let n,i;if(e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=a&&a.isError())return a;let s=0,u=0;if(e.isValueObject())s=1,u=1;else{if(!e.isReferenceObject())return td.create(Y.VALUE);let{startRow:t,endRow:r,startColumn:a,endColumn:n}=e.getRangePosition();s=r-t+1,u=n-a+1}1===s&&u>1&&null==r?(i=null!=t?t:ah.create(0),n=ah.create(0)):(n=null!=t?t:ah.create(0),i=null!=r?r:ah.create(0));let l=null!=a?a:ah.create(1);n.isReferenceObject()&&(n=n.toArrayValueObject()),i.isReferenceObject()&&(i=i.toArrayValueObject()),l.isReferenceObject()&&(l=l.toArrayValueObject());let o=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,l.isArray()?l.getColumnCount():1);if(1===o&&1===c)return this._calculateSingleCell(e,n,i,l);{let t=ak(o,c,n,td.create(Y.NA)),r=ak(o,c,i,td.create(Y.NA)),a=ak(o,c,l,td.create(Y.NA));return t.map((t,n,i)=>{let s=r.get(n,i)||as.create(),u=a.get(n,i)||as.create(),l=this._calculateSingleCell(e,t,s,u);return l.isReferenceObject()?l.toArrayValueObject().getFirstCell():l})}}_calculateSingleCell(e,t,r,a){if(t.isError())return t;let n=this._getNumberValue(t);if(void 0===n||n<0)return td.create(Y.VALUE);if(r.isError())return r;let i=this._getNumberValue(r);if(void 0===i||i<0)return td.create(Y.VALUE);if(a.isError())return a;let s=this._getAreaNumberValue(a);return void 0===s||s<1?td.create(Y.VALUE):e.isReferenceObject()?this._getReferenceObject(e,n,i,s):e.isValueObject()&&1===n&&1===i?e:td.create(Y.REF)}_getNumberValue(e){if(null==e)return 0;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getAreaNumberValue(e){if(null==e)return 1;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getReferenceObject(e,t,r,a){let{startRow:n,endRow:i,startColumn:s,endColumn:u}=e.getRangePosition(),l=0,o=0,c=0,h=0;if(0===t?(l=n,o=i):l=o=n+t-1,0===r?(c=s,h=u):c=h=s+r-1,l>i||c>u)return td.create(Y.REF);let m={startRow:l,startColumn:c,endRow:o,endColumn:h};return this.createReferenceObject(e,m)}};k(ls,"Index");let lu=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(null!=t&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);null==r&&(r=1);let a=e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();if(t>1||r>1)return e.map(()=>td.create(Y.VALUE));a=e.getFirstCell()}return this._handleSingleObject(a,r)}_handleSingleObject(e,t){let r=`${e.getValue()}`;if(""===r.trim())return td.create(Y.REF);let a=this._convertToDefinedName(r);if(0===t){let{range:e,sheetName:t,unitId:r}=aD(a),n=new aM(e);return n.setForcedUnitIdDirect(r),n.setForcedSheetName(t),this._setDefault(n)}if(new RegExp(eb).test(a))return this._setDefault(new aF(a));if(new RegExp(ey).test(a))return this._setDefault(new aB(a));if(new RegExp(eR).test(a))return this._setDefault(new aj(a));let{range:n,sheetName:i,unitId:s}=e$(a);if(Number.isNaN(n.startRow)||n.endRow+1>1048576||Number.isNaN(n.startColumn)||n.endColumn+1>16384)return td.create(Y.REF);let u=new aM(n);return u.setForcedUnitIdDirect(s),u.setForcedSheetName(i),this._setDefault(u)}_setDefault(e){return null==this.unitId||null==this.subUnitId?td.create(Y.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){let t=this.getDefinedName(e);if(null==t)return e;let r=t.formulaOrRefString;return null==r?e:r.startsWith(Q.EQUALS)?r.slice(1):r}};k(lu,"Indirect");let ll=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3),$(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?td.create(Y.REF):t.isArray()?null!=r&&r.isError()?r:1===t.getColumnCount()||1===t.getRowCount()?null==r||r.isArray()?this._handleVector(e,t,r):td.create(Y.REF):this._handleArray(e,t):td.create(Y.VALUE)}_handleVector(e,t,r){let a=r;if(null==a)a=t;else if(a.getRowCount()!==t.getRowCount()||a.getColumnCount()!==t.getColumnCount())return td.create(Y.REF);return e.isArray()?e.map(e=>this.binarySearch(e,t,a)):this.binarySearch(e,t,a)}_handleArray(e,t){let r,a;let n=t.getRowCount(),i=t.getColumnCount();return i>n?(r=t.slice([0,1]),a=t.slice([n-1,n])):(r=t.slice(void 0,[0,1]),a=t.slice(void 0,[i-1,i])),null==r||null==a?td.create(Y.VALUE):e.isArray()?e.map(e=>this.binarySearch(e,r,a)):this.binarySearch(e,r,a)}};k(ll,"Lookup");let lo=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return td.create(Y.REF);if(!t.isArray())return td.create(Y.VALUE);let a=t.getRowCount(),n=t.getColumnCount();if(1!==a&&1!==n||null!=r&&r.isError())return td.create(Y.NA);let i=this.getMatchTypeValue(r);return null==i?td.create(Y.VALUE):e.isArray()?e.map(e=>this._handleSingleObject(e,t,i)):this._handleSingleObject(e,t,i)}_handleSingleObject(e,t,r){let a=this._getSearchModeValue(r),n=t.orderSearch(e,a);if(null==n)return td.create(Y.NA);if(n instanceof td)return n;let i=1===t.getRowCount()?n.column+1:n.row+1;return ah.create(i)}_getSearchModeValue(e){switch(e){case 1:return tr.MIN;case 0:return tr.NORMAL;case -1:return tr.MAX}}};k(lo,"Match");let lc=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",5),$(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,a,n){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(null!=a&&a.isError())return a;if(null!=n&&n.isError())return n;if(!e.isReferenceObject())return td.create(Y.VALUE);let i=e.getRowCount(),s=e.getColumnCount(),u=t;u.isReferenceObject()&&(u=u.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let o=a;o?o.isReferenceObject()&&(o=o.toArrayValueObject()):o=ah.create(i);let c=n;c?c.isReferenceObject()&&(c=c.toArrayValueObject()):c=ah.create(s);let h=Math.max(u.isArray()?u.getRowCount():1,l.isArray()?l.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(u.isArray()?u.getColumnCount():1,l.isArray()?l.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(1===h&&1===m)return this._handleSingleObject(e,u,l,o,c);let f=ak(h,m,u,td.create(Y.NA)),g=ak(h,m,l,td.create(Y.NA)),d=ak(h,m,o,td.create(Y.NA)),N=ak(h,m,c,td.create(Y.NA));return f.mapValue((t,r,a)=>{let n=g.get(r,a),i=d.get(r,a),s=N.get(r,a);return t.isError()?t:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,t,n,i,s,!0)})}_handleSingleObject(e,t,r,a,n,i=!1){let{startRow:s,startColumn:u}=e.getRangePosition(),l=this.getIndexNumValue(t),o=this.getIndexNumValue(r);if("number"!=typeof l||"number"!=typeof o)return td.create(Y.VALUE);let c=s+l,h=u+o;if(c<0||h<0)return td.create(Y.REF);let m=this.getIndexNumValue(a),f=this.getIndexNumValue(n);if("number"!=typeof m||"number"!=typeof f)return td.create(Y.VALUE);if(0===m||0===f)return td.create(Y.REF);let g=m>0?c+m-1:c+m+1,d=f>0?h+f-1:h+f+1;return g<0||d<0?td.create(Y.REF):i?td.create(Y.VALUE):this.createReferenceObject(e,{startRow:c<g?c:g,startColumn:h<d?h:d,endRow:c>g?c:g,endColumn:h>d?h:d})}};k(lc,"Offset");let lh=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",1)}calculate(e){if(null==e)return ah.create(this.row+1);if(e.isError())return e;if(!e.isArray())return td.create(Y.NA);let t=e.getCurrentRow(),r=e.getRowCount(),a=[];for(let e=0;e<r;e++)a.push([ah.create(t+e+1)]);let n={calculateValueList:a,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(n)}};k(lh,"Row");let lm=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return ah.create(1);if(!e.isArray())return td.create(Y.NA);let t=e.getRowCount();return ah.create(t)}};k(lm,"Rows");let lf=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",4)}calculate(e,t,r,a){let n=null!=t?t:ah.create(1),i=null!=r?r:ah.create(1),s=null!=a?a:al.create(!1);if(s.isArray()){let t=s.getRowCount(),r=s.getColumnCount();if(1===t&&1===r){let t=s.get(0,0);return this._handleSingleObject(e,n,i,t)}return s.map(t=>{let r=this._handleSingleObject(e,n,i,t);return r.isArray()?r.get(0,0):r})}return this._handleSingleObject(e,n,i,s)}_handleSingleObject(e,t,r,a){if(e.isError())return e;let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=this._checkArrayError(t);if(s.isError())return s;let u=Math.floor(+s.getValue());if(u<1)return td.create(Y.VALUE);let l=this._checkArrayError(r);if(l.isError())return l;let o=Math.floor(+l.getValue());if(-1!==o&&1!==o)return td.create(Y.VALUE);let c=a;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!e.isArray()||1===n&&1===i)return e;let h=+c.getValue();return this._getResult(e,u,o,h,n,i)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return td.create(Y.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,a,n,i){if(a){if(t>n)return td.create(Y.VALUE);let a=e.transpose().getArrayValue();return a.sort(this._sort(t-1,r)),aA.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}{if(t>i)return td.create(Y.VALUE);let a=e.getArrayValue();return a.sort(this._sort(t-1,r)),aA.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){let r=ta();return 1===t?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,a)=>{let n=r[e],i=a[e];if(null==n||n.isNull())return 1;if(null==i||i.isNull())return -1;if(n.isError()&&i.isError())return 0;if(n.isError())return 1;if(i.isError())return -1;let s=n.getValue(),u=i.getValue();return n.isBoolean()&&!0===s?1:i.isBoolean()&&!0===u?-1:n.isBoolean()&&!1===s?1:i.isBoolean()&&!1===u?-1:n.isNumber()&&i.isNumber()?+s-+u:t(s,u)}}_sortDesc(e,t){return(r,a)=>{let n=r[e],i=a[e];if(null==n||n.isNull())return 1;if(null==i||i.isNull())return -1;if(n.isError()&&i.isError())return 0;if(n.isError())return -1;if(i.isError())return 1;let s=n.getValue(),u=i.getValue();return n.isBoolean()&&!0===s?-1:i.isBoolean()&&!0===u?1:n.isBoolean()&&!1===s?-1:i.isBoolean()&&!1===u?1:n.isNumber()&&i.isNumber()?+u-+s:t(u,s)}}};k(lf,"Sort");let lg=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(e,...t){1===t.length&&t.push(ah.create(1));let r=this._getVariantsError(e,...t),{maxRowLength:a,maxColumnLength:n}=aX(t);if(r.isError()){let e=ak(a,n,r);return 1===a&&1===n?e.get(0,0):e}let i=t.map((e,t)=>t%2==0?e:ak(a,n,e,td.create(Y.NA))),s=this._getResultArray(e,i,a,n);return 1===a&&1===n?s[0][0]:aA.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let e=0;e<t.length;e++){let r=t[e];if(r.isError())return r}if(t.length<2||t.length%2!=0)return td.create(Y.VALUE);let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t[0].isArray()?t[0].getRowCount():1,i=t[0].isArray()?t[0].getColumnCount():1;if((n>1||i>1)&&(n>1&&i>1||1===n&&i!==a||1===i&&n!==r))return td.create(Y.VALUE);for(let e=2;e<t.length;e++){if(e%2==1)continue;let r=t[e].isArray()?t[e].getRowCount():1,a=t[e].isArray()?t[e].getColumnCount():1;if(r!==n||a!==i)return td.create(Y.VALUE)}return al.create(!0)}_getResultArray(e,t,r,a){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t[0].isArray()?t[0].getRowCount():1,u=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let o=0;o<r;o++){l[o]=[];for(let c=0;c<a;c++){let{isError:h,errorObject:m,byArrays:f,sortOrders:g}=this._getByArraysAndSortOrders(t,o,c,u);if(h){l[o].push(m);continue}if(!e.isArray()||1===n&&1===i){l[o].push(e);continue}let d=e.getArrayValue();1===s&&1===u||(1===s?(d=d.concat(f),(d=this._transposeArray(d)).sort(this._sort(n,g)),d=this._transposeArray(d).slice(0,n)):1===u&&(d=(d=this._transposeArray(d)).concat(f),(d=this._transposeArray(d)).sort(this._sort(i,g)),d=d.map(e=>e.slice(0,i))));let N=aA.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||a>1){l[o].push(N.get(0,0));continue}l[o].push(N)}}return l}_getByArraysAndSortOrders(e,t,r,a){let n=[],i=[],s=!1,u=null;for(let l=0;l<e.length;l++){if(l%2==1)continue;let o=e[l],c=e[l+1].get(t,r);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError()){s=!0,u=c;break}let h=Math.floor(+c.getValue());if(-1!==h&&1!==h){s=!0,u=td.create(Y.VALUE);break}if(i.push(h),o.isArray()){let e=o.getArrayValue();1===a&&(e=this._transposeArray(e)),n.push(e[0])}else n.push([o])}return{isError:s,errorObject:u,byArrays:n,sortOrders:i}}_transposeArray(e){let t=e.length,r=e[0].length,a=[];for(let n=0;n<r;n++){a[n]=[];for(let r=0;r<t;r++)a[n][r]=e[r][n]}return a}_sort(e,t){let r=ta();return(a,n)=>{let i=a[e],s=n[e],u=this._compare(i,s,t[0],r);if(0===u&&t.length>1)for(let l=1;l<t.length&&(i=a[e+l],s=n[e+l],0===(u=this._compare(i,s,t[l],r)));l++);return u}}_compare(e,t,r,a){return 1===r?this._asc(e,t,a):this._desc(e,t,a)}_asc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return -1;let a=e.getValue(),n=t.getValue();return e.isBoolean()&&!0===a?1:t.isBoolean()&&!0===n?-1:e.isBoolean()&&!1===a?1:t.isBoolean()&&!1===n?-1:e.isNumber()&&t.isNumber()?+a-+n:r(a,n)}_desc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return -1;if(t.isError())return 1;let a=e.getValue(),n=t.getValue();return e.isBoolean()&&!0===a?-1:t.isBoolean()&&!0===n?1:e.isBoolean()&&!1===a?-1:t.isBoolean()&&!1===n?1:e.isNumber()&&t.isNumber()?+n-+a:r(n,a)}};k(lg,"Sortby");let ld=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t,s=null!=r?r:ah.create(n);t.isNull()&&(i=ah.create(a)),s.isNull()&&(s=ah.create(n));let u=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=ak(u,l,i,td.create(Y.NA)),c=ak(u,l,s,td.create(Y.NA));if(u>1||l>1)return o.mapValue((t,r,i)=>{let s=c.get(r,i);if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);let{isError:u,errorObject:l}=this._checkRowsColumns(t,s,a,n);return u?l:e.isArray()?td.create(Y.VALUE):e});if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);let h=i.isArray()?i.get(0,0):i,m=s.isArray()?s.get(0,0):s,{isError:f,errorObject:g,rowsValue:d,columnsValue:N}=this._checkRowsColumns(h,m,a,n);return f?g:this._getResultArray(e,d,N,a,n)}_checkRowsColumns(e,t,r,a){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let n=Math.trunc(+e.getValue()),i=Math.trunc(+t.getValue());return Number.isNaN(n)||Number.isNaN(i)?{isError:!0,errorObject:td.create(Y.VALUE)}:0===Math.abs(n)||0===Math.abs(i)?{isError:!0,errorObject:td.create(Y.CALC)}:(n>r&&(n=r),i>a&&(i=a),{isError:!1,rowsValue:n,columnsValue:i})}_getResultArray(e,t,r,a,n){let i;if(!e.isArray())return e;let s=t>=0?[0,t]:[a+t,a],u=r>=0?[0,r]:[n+r,n];return i=(i=t===a&&r===n?e:t===a?e.slice(void 0,u):r===n?e.slice(s,void 0):e.slice(s,u)).map(e=>e.isNull()?ah.create(0):e),1===t&&1===r?i.get(0,0):i}};k(ld,"Take");let lN=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:ah.create(0),n=null!=r?r:al.create(!1),i=Math.max(a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=ak(i,s,a,td.create(Y.NA)),l=ak(i,s,n,td.create(Y.NA)),o=u.mapValue((t,r,a)=>{let n=l.get(r,a);if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);if(t.isError())return t;if(n.isError())return n;let u=Math.trunc(+t.getValue()),o=+n.getValue();if(Number.isNaN(u)||u<0||u>3||Number.isNaN(o))return td.create(Y.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=o?this._getArrayValueByColumn(e,u):this._getArrayValueByRow(e,u)).length?td.create(Y.CALC):i>1||s>1||1===c.length?c[0]:aA.create({calculateValueList:c.map(e=>[e]),rowCount:c.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===i&&1===s?o.get(0,0):o}_getArrayValueByColumn(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<a;i++)for(let a=0;a<r;a++){let r=e.get(a,i);this._isIgnore(r,t)||n.push(r.isNull()?ah.create(0):r)}return n}_getArrayValueByRow(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<r;i++)for(let r=0;r<a;r++){let a=e.get(i,r);this._isIgnore(a,t)||n.push(a.isNull()?ah.create(0):a)}return n}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}};k(lN,"Tocol");let l_=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:ah.create(0),n=null!=r?r:al.create(!1),i=Math.max(a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=ak(i,s,a,td.create(Y.NA)),l=ak(i,s,n,td.create(Y.NA)),o=u.mapValue((t,r,a)=>{let n=l.get(r,a);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let u=Math.trunc(+t.getValue()),o=+n.getValue();if(Number.isNaN(u)||u<0||u>3||Number.isNaN(o)||e.isNull())return td.create(Y.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=o?this._getArrayValueByColumn(e,u):this._getArrayValueByRow(e,u)).length?td.create(Y.CALC):i>1||s>1||1===c.length?c[0]:aA.create({calculateValueList:[c],rowCount:1,columnCount:c.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===i&&1===s?o.get(0,0):o}_getArrayValueByColumn(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<a;i++)for(let a=0;a<r;a++){let r=e.get(a,i);this._isIgnore(r,t)||n.push(r.isNull()?ah.create(0):r)}return n}_getArrayValueByRow(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<r;i++)for(let r=0;r<a;r++){let a=e.get(i,r);this._isIgnore(a,t)||n.push(a.isNull()?ah.create(0):a)}return n}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}};k(l_,"Torow");let lE=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return 1===t&&1===r?e.get(0,0):e.transpose()}return e}};k(lE,"Transpose");let lC=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:al.create(!1),n=null!=r?r:al.create(!1),i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,u=Math.max(a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),l=Math.max(a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=ak(u,l,a,td.create(Y.NA)),c=ak(u,l,n,td.create(Y.NA)),h=o.map((t,r,a)=>{let n,o=t,h=c.get(r,a);if(e.isError())return e;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=+o.getValue(),f=+h.getValue();return n=!m&&1===i||m&&1===s?e:this._getResult(e,m,f),(u>1||l>1)&&null!=n&&n.isArray()?n.get(0,0):n});return 1===u&&1===l?h.get(0,0):h}_getResult(e,t,r){let a=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=e.getArrayValue(),s=a,u=n;t&&(i=this._transposeArray(i),s=n,u=a);let l=this._getRepeatRows(i,s,u);if(l.length>0){let e=[];l.forEach(t=>{t.forEach((t,a)=>{(0!==a||r)&&e.push(t)})}),i=i.filter((t,r)=>!e.includes(r))}return 0===i.length?td.create(Y.CALC):(t&&(i=this._transposeArray(i)),aA.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let a=[];for(let n=0;n<r;n++)if(0===n){let r=Array(t).fill(null).map((t,r)=>({r:r,valueObject:e[r][n]}));a=this._getRepeatRowsByObjects(r)}else{if(0===a.length)break;let t=[];a.forEach(r=>{let a=r.map(t=>({r:t,valueObject:e[t][n]})),i=this._getRepeatRowsByObjects(a);t=t.concat(i)}),a=t}return a}_getRepeatRowsByObjects(e){let t=/* @__PURE__ */new Map;return e.forEach(e=>{let r=e.r,a=e.valueObject,n=a.getValue();if(a.isNull()?n=null:a.isString()&&(0,P.isRealNum)(n)&&(n=+n),t.has(n)){let e=t.get(n);e.push(r),t.set(n,e)}else t.set(n,[r])}),Array.from(t.values()).filter(e=>e.length>1)}_transposeArray(e){let t=e.length,r=e[0].length,a=[];for(let n=0;n<r;n++){a[n]=[];for(let r=0;r<t;r++)a[n][r]=e[r][n]}return a}};k(lC,"Unique");let lp=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",4)}calculate(e,t,r,a){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return td.create(Y.VALUE);if(r.isError())return r;if(null!=a&&a.isError())return a;let n=null!=a?a:al.create(!0);return aW(e)&&aW(n)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,n):this._handleNonArrayColIndexNum(e,t,r,n)}_handleArrayColIndexNum(e,t,r,a){let n;let i=e.isArray()?e.getFirstCell():e,s=this.getZeroOrOneByOneDefault(a);if(null==s)return td.create(Y.VALUE);let u=[];return r.iterator((e,r,a)=>{if(null==e)return n=td.create(Y.VALUE),!1;let l=this._handleTableArray(i,t,e,s);if(l.isError())return n=l,!1;void 0===u[r]&&(u[r]=[]),u[r][a]=l}),n||a$(u,u.length,u[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=ak(n,i,e),u=ak(n,i,a);return s.map((e,a,n)=>{if(e.isError())return e;let i=u.get(a,n);if(null==i)return td.create(Y.VALUE);if(i.isError())return i;let s=this.getZeroOrOneByOneDefault(i);return null==s?td.create(Y.VALUE):this._handleTableArray(e,t,r,s)})}_handleTableArray(e,t,r,a){let n=this.getIndexNumValue(r);if(n instanceof td)return n;let i=t.slice(void 0,[0,1]);if(null==i)return td.create(Y.VALUE);let s=t.slice(void 0,[n-1,n]);return null==s?td.create(Y.REF):this._handleSingleObject(e,i,s,a)}_handleSingleObject(e,t,r,a){return 0===a?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}};k(lp,"Vlookup");let lA=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),r=[];for(let a=0;a<e.length;a++){let n=e[a];if(n.isError())return n;let i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<i;e++){let a=[];for(let r=0;r<t;r++){let t=n;n.isArray()&&(t=n.get(e,r)),r>s-1||!t?a.push(td.create(Y.NA)):a.push(t)}r.push(a)}}return aA.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};k(lA,"Vstack");let lb=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:td.create(Y.NA);a.isNull()&&(a=td.create(Y.NA));let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=Math.max(t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=ak(s,u,t,td.create(Y.NA)),o=ak(s,u,a,td.create(Y.NA)),c=l.mapValue((t,r,a)=>{let l=o.get(r,a);if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(n>1&&i>1||Number.isNaN(c))return td.create(Y.VALUE);if(c<1)return td.create(Y.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],m=this._getWrapArray(h,c,l);return s>1||u>1||1===m.length&&1===m[0].length?m[0][0]:aA.create({calculateValueList:m,rowCount:m.length,columnCount:m[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===u?c.get(0,0):c}_getWrapArray(e,t,r){let a=Math.ceil(e.length/t),n=a>1?t:e.length,i=[];for(let t=0;t<a;t++)for(let a=0;a<n;a++){i[a]||(i[a]=[]);let s=t*n+a;s<e.length?i[a].push(e[s].isNull()?ah.create(0):e[s]):i[a].push(r)}return i}};k(lb,"Wrapcols");let ly=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:td.create(Y.NA);a.isNull()&&(a=td.create(Y.NA));let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=Math.max(t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=ak(s,u,t,td.create(Y.NA)),o=ak(s,u,a,td.create(Y.NA)),c=l.mapValue((t,r,a)=>{let l=o.get(r,a);if(e.isError())return e;if(e.isNull())return td.create(Y.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(n>1&&i>1||Number.isNaN(c))return td.create(Y.VALUE);if(c<1)return td.create(Y.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],m=this._getWrapArray(h,c,l);return s>1||u>1||1===m.length&&1===m[0].length?m[0][0]:aA.create({calculateValueList:m,rowCount:m.length,columnCount:m[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===u?c.get(0,0):c}_getWrapArray(e,t,r){let a=Math.ceil(e.length/t),n=a>1?t:e.length,i=[];for(let t=0;t<a;t++){let a=[];for(let i=0;i<n;i++){let s=t*n+i;s<e.length?a.push(e[s].isNull()?ah.create(0):e[s]):a.push(r)}i.push(a)}return i}};k(ly,"Wraprows");let lR=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){if(e.isError())return e;if(t.isError()||r.isError())return td.create(Y.REF);if(!t.isArray()||!r.isArray())return td.create(Y.VALUE);let s=t.getRowCount(),u=t.getColumnCount(),l=r.getRowCount(),o=r.getColumnCount();if(1!==s&&1!==u||s!==l&&u!==o)return td.create(Y.VALUE);if(null!=a&&a.isError()||null!=n&&n.isError()||null!=i&&i.isError())return td.create(Y.NA);let c=null!=a?a:td.create(Y.NA),h=this.getIndexNumValue(n||ah.create(0));if(h instanceof td)return h;let m=this.getIndexNumValue(i||ah.create(1));return m instanceof td?m:this._getResult(e,t,r,c,h,m,s,u,l,o)}_getResult(e,t,r,a,n,i,s,u,l,o){if(e.isArray()){let u;return null==(u=1===s?r.slice([0,1]):r.slice(void 0,[0,1]))?td.create(Y.NA):e.map(e=>{let r=this._checkErrorCombination(n,i);if(r)return r;let s=this._handleSingleObject(e,t,u,n,i);return s.isError()?a:s})}if(u===o&&s===l){let s=this._checkErrorCombination(n,i);if(s)return s;let u=this._handleSingleObject(e,t,r,n,i);return u.isError()?a:u}let c=0;u===o&&(c=1);let h=this._handleExpandObject(e,t,r,n,i,c);return null==h?td.create(Y.NA):h}_handleExpandObject(e,t,r,a,n,i=0){if((2===n||-2===n)&&2!==a){let s=tc(n),u=to(a);return this.binarySearchExpand(e,t,r,i,s,u)}return 2===a?this.fuzzySearchExpand(e,t,r,-1!==n,i):-1===a||1===a?this.orderSearchExpand(e,t,r,1===a?tr.MAX:tr.MIN,-1===n,i):this.equalSearchExpand(e,t,r,-1!==n,i)}_handleSingleObject(e,t,r,a,n){if((2===n||-2===n)&&2!==a){let i=tc(n),s=to(a);return this.binarySearch(e,t,r,i,s)}return 2===a?this.fuzzySearch(e,t,r,-1!==n):-1===a||1===a?this.orderSearch(e,t,r,1===a?tr.MAX:tr.MIN,-1===n):this.equalSearch(e,t,r,-1!==n)}_checkErrorCombination(e,t){return 2===e&&(-2===t||2===t)?td.create(Y.VALUE):null}};k(lR,"Xlookup");let lS=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",4)}calculate(e,t,r,a){if(e.isError())return e;if(t.isError())return td.create(Y.REF);if(!t.isArray())return td.create(Y.VALUE);let n=t.getRowCount(),i=t.getColumnCount();if(1!==n&&1!==i)return td.create(Y.VALUE);if(null!=r&&r.isError()||null!=a&&a.isError())return td.create(Y.NA);let s=this.getIndexNumValue(r||ah.create(0));if(s instanceof td)return s;let u=this.getIndexNumValue(a||ah.create(1));return u instanceof td?u:e.isArray()?e.map(e=>this._handleSingleObject(e,t,s,u)):this._handleSingleObject(e,t,s,u)}_handleSingleObject(e,t,r,a){let n;if((2===a||-2===a)&&2!==r){let i=tc(a),s=to(r);n=t.binarySearch(e,i,s)}else if(2===r){let r;let i=t.compare(e,X.EQUALS);if(null==(r=-1!==a?i.getFirstTruePosition():i.getLastTruePosition()))return td.create(Y.NA);n=1===t.getRowCount()?r.column:r.row}else if(-1===r||1===r){let i=t.orderSearch(e,1===r?tr.MAX:tr.MIN,-1===a);if(null==i)return td.create(Y.NA);if(i instanceof td)return i;n=1===t.getRowCount()?i.column:i.row}else{let r;let i=t.isEqual(e);if(null==(r=-1!==a?i.getFirstTruePosition():i.getLastTruePosition()))return td.create(Y.NA);n=1===t.getRowCount()?r.column:r.row}return null==n?td.create(Y.NA):ah.create(n+1)}};k(lS,"Xmatch");let lO=[[u2,la.ADDRESS],[u5,la.AREAS],[u4,la.CHOOSE],[u6,la.CHOOSECOLS],[u7,la.CHOOSEROWS],[u9,la.COLUMN],[u8,la.COLUMNS],[le,la.DROP],[lt,la.EXPAND],[lr,la.FILTER],[ln,la.HLOOKUP],[li,la.HSTACK],[ls,la.INDEX],[lu,la.INDIRECT],[ll,la.LOOKUP],[lo,la.MATCH],[lc,la.OFFSET],[lh,la.ROW],[lm,la.ROWS],[lf,la.SORT],[lg,la.SORTBY],[ld,la.TAKE],[lN,la.TOCOL],[l_,la.TOROW],[lE,la.TRANSPOSE],[lC,la.UNIQUE],[lp,la.VLOOKUP],[lA,la.VSTACK],[lb,la.WRAPCOLS],[ly,la.WRAPROWS],[lR,la.XLOOKUP],[lS,la.XMATCH]],lT=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}};k(lT,"Abs");let lV=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}};k(lV,"Acos");let lI=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}};k(lI,"Acosh");let lM=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:lx(e)):lx(t)}};function lx(e){let t=e.getValue();if(e.isBoolean()&&(t=t?1:0),!Number.isFinite(t))return td.create(Y.VALUE);let r=Math.atan(1/(t=Number(t)));return t<0&&(r+=Math.PI),Number.isNaN(r)?td.create(Y.VALUE):ah.create(r)}k(lM,"Acot"),k(lx,"acot");let lv=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:lU(e)):lU(t)}};function lU(e){let t=e.getValue();if(e.isBoolean()&&(t=t?1:0),!Number.isFinite(t))return td.create(Y.VALUE);if(1>=Math.abs(t=Number(t)))return td.create(Y.NUM);let r=.5*Math.log((t+1)/(t-1));return Number.isNaN(r)?td.create(Y.VALUE):ah.create(r)}k(lv,"Acoth"),k(lU,"acoth");let lD=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}};k(lD,"Asin");let lL=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}};k(lL,"Asinh");let lP=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}};k(lP,"Atan");let lw=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e,a=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:a.atan2(r))}};k(lw,"Atan2");let lF=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}};k(lF,"Atanh");let lj=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:ah.create(0);if(e.isError())return e;if(t.isError())return t;if(a.isError())return a;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=ak(n,i,e,td.create(Y.NA)),u=ak(n,i,t,td.create(Y.NA)),l=ak(n,i,a,td.create(Y.NA)),o=s.map((e,t,r)=>{let a=u.get(t,r),n=l.get(t,r);return this._handleSingleObject(e,a,n)});return 1===o.getRowCount()&&1===o.getColumnCount()?o.getArrayValue()[0][0]:o}_handleSingleObject(e,t,r){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=t;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=r;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=Math.floor(+a.getValue()),u=Math.floor(+n.getValue()),l=Math.floor(+i.getValue());if(s<0||s>=0x20000000000000||u<2||u>36||l<0)return td.create(Y.NUM);let o=s.toString(u);return o.length<l&&(o=Array(l-o.length+1).join("0")+o),ag.create(o.toLocaleUpperCase())}};k(lj,"Base");let lB=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=e,n=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),u=+n.getValue();if(s>0&&u<0)return td.create(Y.NUM);if(0===s||0===u)return ah.create(0);let l=rX(s/u,0)*u;return ah.create(l)});return 1===s.getRowCount()&&1===s.getColumnCount()?s.getArrayValue()[0][0]:s}};k(lB,"Ceiling");let lk=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:ah.create(1),n=null!=r?r:ah.create(0);if(e.isError())return e;if(a.isError())return a;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=ak(i,s,e,td.create(Y.NA)),l=ak(i,s,a,td.create(Y.NA)),o=ak(i,s,n,td.create(Y.NA)),c=u.map((e,t,r)=>{let a=e,n=l.get(t,r),i=o.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=+a.getValue(),u=+n.getValue(),c=+i.getValue();return 0===s||0===u?ah.create(0):this._getResult(s,u,c)});return 1===i&&1===s?c.get(0,0):c}_getResult(e,t,r){let a;return a=e<0&&0!==r?(t<0?rX(Math.abs(e)/Math.abs(t),0):-rX(Math.abs(e)/t,0))*t:(t<0?-rX(e/Math.abs(t),0):rX(e/t,0))*t,ah.create(a)}};k(lk,"CeilingMath");let l$=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:ah.create(1);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,r,td.create(Y.NA)),u=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),u=+a.getValue();if(0===i||0===u)return ah.create(0);let l=(u<0?-rX(i/Math.abs(u),0):rX(i/u,0))*u;return ah.create(l)});return 1===a&&1===n?u.get(0,0):u}};function lH(e,t=1){let r=Math.floor(e);if(e<0)return Number.NaN;let a=1;for(;r>1&&Number.isFinite(a);)a*=r,r-=t;return a}function lY(e,t){let r=Math.min(e-t,t),a=1;for(let t=1;t<=r&&Number.isFinite(a);t++)a*=e-t+1,a/=t;return a}function lG(e,t){let r=Math.floor(e),a=Math.floor(t);for(;0!==a;){let e=a;a=r%a,r=e}return r}function lq(e,t){let r=lG(e,t);return 0===r?0:Math.abs(e*t)/r}function lW(e){let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let r=0;for(let a=0;a<t;a++)r+=(a%2==0?1:-1)*e[0][a]*lW(lX(e,0,a));return r}function lQ(e){let t=lW(e);return 0===t?null:1===e.length?[[1/t]]:lK(e).map(e=>e.map(e=>e/t))}function lX(e,t,r){return e.filter((e,r)=>r!==t).map(e=>e.filter((e,t)=>t!==r))}function lK(e){let t=e.length,r=Array.from({length:t},()=>Array(t).fill(0));for(let a=0;a<t;a++)for(let n=0;n<t;n++){let t=(a+n)%2==0?1:-1;r[n][a]=t*lW(lX(e,a,n))}return r}k(l$,"CeilingPrecise"),k(lH,"calculateFactorial"),k(lY,"calculateCombin"),k(lG,"calculateGcd"),k(lq,"calculateLcm"),k(lW,"calculateMdeterm"),k(lQ,"calculateMinverse"),k(lX,"minor"),k(lK,"adjoint");let lz=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.mapValue((e,t,r)=>{let a=e,n=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),n.isString()&&(n=n.convertToNumberObjectValue()),a.isError())return a;if(n.isError())return n;let s=Math.floor(+a.getValue()),u=Math.floor(+n.getValue());if(s<0||u<0||s<u)return td.create(Y.NUM);let l=lY(s,u);return Number.isNaN(l)||!Number.isFinite(l)?td.create(Y.NUM):ah.create(l)});return 1===r&&1===a?s.get(0,0):s}};k(lz,"Combin");let lZ=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.mapValue((e,t,r)=>{let a=e,n=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),n.isString()&&(n=n.convertToNumberObjectValue()),a.isError())return a;if(n.isError())return n;let s=Math.floor(+a.getValue()),u=Math.floor(+n.getValue());if(s<0||u<0||0===s&&s<u)return td.create(Y.NUM);let l=lY(s+u-1,s-1);return Number.isNaN(l)||!Number.isFinite(l)?td.create(Y.NUM):ah.create(l)});return 1===r&&1===a?s.get(0,0):s}};k(lZ,"Combina");let lJ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}};k(lJ,"Cos");let l0=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}};k(l0,"Cosh");let l1=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?td.create(Y.NUM):0===r?td.create(Y.DIV_BY_ZERO):t.tan().getReciprocal()}};k(l1,"Cot");let l2=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:0==+t.getValue()?td.create(Y.DIV_BY_ZERO):t.tanh().getReciprocal()}};k(l2,"Coth");let l3=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?td.create(Y.NUM):0===r?td.create(Y.DIV_BY_ZERO):t.sin().getReciprocal()}};k(l3,"Csc");let l5=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return 0===r?td.create(Y.DIV_BY_ZERO):Number.isNaN(r)||Number.isFinite(Math.sinh(r))?t.sinh().getReciprocal():ah.create(0)}};k(l5,"Csch");let l4=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{if(e.isError())return e;let a=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=`${e.getValue()}`,s=Math.floor(+a.getValue());if((0,P.isRealNum)(n)&&(0>+n||+n>=0x20000000000000||!Number.isInteger(+n))||"true"===n.toLocaleLowerCase()||"false"===n.toLocaleLowerCase()||s<2||s>36)return td.create(Y.NUM);if(""===n.replace(/\s/g,""))return ah.create(0);if(!this._isValidCharForRadix(n,s))return td.create(Y.NUM);let u=Number.parseInt(n,s);return Number.isNaN(u)?td.create(Y.NUM):ah.create(u)});return 1===r&&1===a?s.get(0,0):s}_isValidCharForRadix(e,t){for(let r of e){let e=r.toUpperCase().charCodeAt(0);if(t<=10&&!(e>=48&&e<48+t)||t>10&&!(e>=48&&e<58||e>=65&&e<65+t-10))return!1}return!0}};k(l4,"Decimal");let l6=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return td.create(Y.VALUE);let a=180/Math.PI*r;return Number.isNaN(a)?td.create(Y.VALUE):ah.create(a)}};k(l6,"Degrees");let l7=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return td.create(Y.VALUE);let a=(r<0?-rX(Math.abs(r)/2,0):rX(r/2,0))*2;return Number.isNaN(a)?td.create(Y.VALUE):0===a?ah.create(0):ah.create(a)}};k(l7,"Even");let l9=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}};k(l9,"Exp");let l8=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=lH(Math.floor(+t.getValue()));return Number.isNaN(r)||!Number.isFinite(r)?td.create(Y.NUM):ah.create(r)}};k(l8,"Fact");let oe=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){let r=e.getRowCount(),a=e.getColumnCount();if(r>1||a>1)return td.create(Y.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=lH(Math.floor(+t.getValue()),2);return Number.isNaN(r)||!Number.isFinite(r)?td.create(Y.NUM):ah.create(r)}};k(oe,"Factdouble");let ot=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=i.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let s=+n.getValue(),u=+a.getValue();if(s>0&&u<0)return td.create(Y.NUM);if(0===s)return ah.create(0);if(0===u)return td.create(Y.DIV_BY_ZERO);let l=rQ(s/u,0)*u;return ah.create(l)});return 1===r&&1===a?s.get(0,0):s}};k(ot,"Floor");let or=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:ah.create(1),n=null!=r?r:ah.create(0),i=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=ak(i,s,e,td.create(Y.NA)),l=ak(i,s,a,td.create(Y.NA)),o=ak(i,s,n,td.create(Y.NA)),c=u.map((e,t,r)=>{let a,n=e,i=l.get(t,r),s=o.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let u=+n.getValue(),c=+i.getValue(),h=+s.getValue();return 0===u||0===c?ah.create(0):(a=u<0&&0!==h?(c<0?rQ(Math.abs(u)/Math.abs(c),0):-rQ(Math.abs(u)/c,0))*c:(c<0?-rQ(u/Math.abs(c),0):rQ(u/c,0))*c,ah.create(a))});return 1===i&&1===s?c.get(0,0):c}};k(or,"FloorMath");let oa=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:ah.create(1);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,r,td.create(Y.NA)),u=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),u=+a.getValue();if(0===i||0===u)return ah.create(0);let l=(u<0?-rQ(i/Math.abs(u),0):rQ(i/u,0))*u;return ah.create(l)});return 1===a&&1===n?u.get(0,0):u}};k(oa,"FloorPrecise");var on=((T=on||{}).ABS="ABS",T.ACOS="ACOS",T.ACOSH="ACOSH",T.ACOT="ACOT",T.ACOTH="ACOTH",T.AGGREGATE="AGGREGATE",T.ARABIC="ARABIC",T.ASIN="ASIN",T.ASINH="ASINH",T.ATAN="ATAN",T.ATAN2="ATAN2",T.ATANH="ATANH",T.BASE="BASE",T.CEILING="CEILING",T.CEILING_MATH="CEILING.MATH",T.CEILING_PRECISE="CEILING.PRECISE",T.COMBIN="COMBIN",T.COMBINA="COMBINA",T.COS="COS",T.COSH="COSH",T.COT="COT",T.COTH="COTH",T.CSC="CSC",T.CSCH="CSCH",T.DECIMAL="DECIMAL",T.DEGREES="DEGREES",T.EVEN="EVEN",T.EXP="EXP",T.FACT="FACT",T.FACTDOUBLE="FACTDOUBLE",T.FLOOR="FLOOR",T.FLOOR_MATH="FLOOR.MATH",T.FLOOR_PRECISE="FLOOR.PRECISE",T.GCD="GCD",T.INT="INT",T.ISO_CEILING="ISO.CEILING",T.LCM="LCM",T.LET="LET",T.LN="LN",T.LOG="LOG",T.LOG10="LOG10",T.MDETERM="MDETERM",T.MINVERSE="MINVERSE",T.MMULT="MMULT",T.MOD="MOD",T.MROUND="MROUND",T.MULTINOMIAL="MULTINOMIAL",T.MUNIT="MUNIT",T.ODD="ODD",T.PI="PI",T.POWER="POWER",T.PRODUCT="PRODUCT",T.QUOTIENT="QUOTIENT",T.RADIANS="RADIANS",T.RAND="RAND",T.RANDARRAY="RANDARRAY",T.RANDBETWEEN="RANDBETWEEN",T.ROMAN="ROMAN",T.ROUND="ROUND",T.ROUNDDOWN="ROUNDDOWN",T.ROUNDUP="ROUNDUP",T.SEC="SEC",T.SECH="SECH",T.SERIESSUM="SERIESSUM",T.SEQUENCE="SEQUENCE",T.SIGN="SIGN",T.SIN="SIN",T.SINH="SINH",T.SQRT="SQRT",T.SQRTPI="SQRTPI",T.SUBTOTAL="SUBTOTAL",T.SUM="SUM",T.SUMIF="SUMIF",T.SUMIFS="SUMIFS",T.SUMPRODUCT="SUMPRODUCT",T.SUMSQ="SUMSQ",T.SUMX2MY2="SUMX2MY2",T.SUMX2PY2="SUMX2PY2",T.SUMXMY2="SUMXMY2",T.TAN="TAN",T.TANH="TANH",T.TRUNC="TRUNC",T);let oi=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if(a.isArray()){let e=!1,r=td.create(Y.VALUE);if(a.iterator(a=>{if(null!=a&&a.isNull())return!0;let{isError:n,errorObject:i,number:s}=this._handleSingleObject(a);if(n)return e=!0,r=i,!1;t=lG(t,s)}),e)return r}else{let{isError:e,errorObject:r,number:n}=this._handleSingleObject(a);if(e)return r;t=lG(t,n)}}}return ah.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:td.create(Y.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0||r>=0x20000000000000?{isError:!0,errorObject:td.create(Y.NUM),number:null}:{isError:!1,errorObject:null,number:r}}};k(oi,"Gcd");let os=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());return ah.create(r)}};k(os,"Int");let ou=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let a=0;a<e.length;a++){let n=e[a];if(!n.isNull()){if(n.isArray()){let e=!1,a=td.create(Y.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:u}=this._handleSingleObject(n);if(i)return e=!0,a=s,!1;t=lq(t,u),r=!1}),e)return a}else{let{isError:e,errorObject:a,number:i}=this._handleSingleObject(n);if(e)return a;t=lq(t,i),r=!1}}}return r?ah.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=0x20000000000000?td.create(Y.VALUE):ah.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:td.create(Y.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:td.create(Y.NUM),number:null}:{isError:!1,errorObject:null,number:r}}};k(ou,"Lcm");let ol=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}};k(ol,"Ln");let oo=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:ah.create(10);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,r,td.create(Y.NA)),u=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),u=+a.getValue();if(i<=0||u<=0)return td.create(Y.NUM);let l=Math.log(u);if(0===l)return td.create(Y.DIV_BY_ZERO);let o=Math.log(i)/l;return ah.create(o)});return 1===a&&1===n?u.get(0,0):u}};k(oo,"Log");let oc=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}};k(oc,"Log10");let oh=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,a=[];for(let n=0;n<t;n++){let t=[];for(let a=0;a<r;a++){let r=e.isArray()?e.get(n,a):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return td.create(Y.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let i=+r.getValue();t.push(i)}a.push(t)}if(t!==r)return td.create(Y.VALUE);let n=lW(a);return ah.create(n)}};k(oh,"Mdeterm");let om=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,a=[];for(let n=0;n<t;n++){let t=[];for(let a=0;a<r;a++){let r=e.isArray()?e.get(n,a):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return td.create(Y.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let i=+r.getValue();t.push(i)}a.push(t)}if(t!==r)return td.create(Y.VALUE);let n=lQ(a);return null===n?td.create(Y.NUM):aA.createByArray(n)}};k(om,"Minverse");let of=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;if(a!==n)return td.create(Y.VALUE);let s=this._getMatrix(e,r,a),u=this._getMatrix(t,n,i);if(s instanceof td)return s;if(u instanceof td)return u;let l=this._getResult(s,u,r,a,i);return aA.createByArray(l)}_getMatrix(e,t,r){let a=[];for(let n=0;n<t;n++){let t=[];for(let a=0;a<r;a++){let r=e.isArray()?e.get(n,a):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return td.create(Y.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let i=+r.getValue();t.push(i)}a.push(t)}return a}_getResult(e,t,r,a,n){let i=Array.from({length:r},()=>Array(n).fill(0));for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=0;for(let i=0;i<a;i++)n+=e[s][i]*t[i][r];i[s][r]=n}return i}};k(of,"Mmult");let og=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.mod(a)}};k(og,"Mod");let od=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);r=r.get(0,0)}if(r.isError())return r;let a=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);a=a.get(0,0)}if(a.isError())return a;if(r.isBoolean()||a.isBoolean())return td.create(Y.VALUE);let n=+r.getValue(),i=+a.getValue();if(Number.isNaN(n)||Number.isNaN(i))return td.create(Y.VALUE);if(0===i)return ah.create(0);if(n>0&&i<0||n<0&&i>0)return td.create(Y.NUM);let s=rW(n/i,0)*i;return ah.create(s)}};k(od,"Mround");let oN=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let a=0;a<e.length;a++){let n=e[a];if(!n.isNull()){if(n.isArray()){let e=!1,a=td.create(Y.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:u}=this._handleSingleObject(n);return i?(e=!0,a=s,!1):(t+=u)>170?(e=!0,a=td.create(Y.NUM),!1):void(r*=lH(u))}),e)return a}else{let{isError:e,errorObject:a,number:i}=this._handleSingleObject(n);if(e)return a;if((t+=i)>170)return td.create(Y.NUM);r*=lH(i)}}}let a=lH(t)/r;return ah.create(a)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:td.create(Y.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:td.create(Y.NUM),number:null}:{isError:!1,errorObject:null,number:r}}};k(oN,"Multinomial");let o_=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount(),a=e.mapValue(e=>{let a=this._handleSingleObject(e);return a.isError()?a:t>1||r>1?a.get(0,0):a});return 1===t&&1===r?a.get(0,0):a}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());if(r<=0)return td.create(Y.VALUE);let a=[];for(let e=0;e<r;e++){a[e]=[];for(let t=0;t<r;t++)a[e][t]=e===t?1:0}return aA.createByArray(a)}};k(o_,"Munit");let oE=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return td.create(Y.VALUE);let a=r<0?-rX(Math.abs(r),0):rX(r,0);return Number.isNaN(a)?td.create(Y.VALUE):(Math.abs(a)%2==0&&(r<0?a--:a++),ah.create(a))}};k(oE,"Odd");let oC=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){return ah.create(Math.PI)}};k(oC,"Pi");let op=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.pow(a)}};k(op,"Power");let oA=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(1);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isArray()&&(a=this._multiplyArray(a)),a.isError())return a;if((t=t.multiply(a)).isError())break}}return t}_multiplyArray(e){let t=ah.create(1);return e.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.multiply(e)))),t}};k(oA,"Product");let ob=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=n7(e,t);if(r)return a;let[i,s]=n,u=+i.getValue(),l=+s.getValue();if(Number.isNaN(u)||Number.isNaN(l))return td.create(Y.VALUE);if(0===l)return td.create(Y.DIV_BY_ZERO);let o=Math.trunc(u/l);return ah.create(o)}};k(ob,"Quotient");let oy=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return td.create(Y.VALUE);let a=Math.PI/180*r;return Number.isNaN(a)?td.create(Y.VALUE):ah.create(a)}};k(oy,"Radians");let oR=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",0)}calculate(){return ah.create(Math.random())}};k(oR,"Rand");let oS=class extends a1{constructor(){super(...arguments),$(this,"minParams",0),$(this,"maxParams",5)}calculate(e,t,r,a,n){if(null!=e&&e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=a&&a.isError())return a;if(null!=n&&n.isError())return n;let i=null!=e?e:ah.create(1),s=null!=t?t:ah.create(1),u=null!=r?r:ah.create(0),l=null!=a?a:ah.create(1),o=null!=n?n:ah.create(0);return this._calculateResult(i,s,u,l,o)}_calculateResult(e,t,r,a,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1);if(1===i&&1===s)return this._calculateSingleCell(e,t,r,a,n);let u=ak(i,s,e,td.create(Y.NA)),l=ak(i,s,t,td.create(Y.NA)),o=ak(i,s,r,td.create(Y.NA)),c=ak(i,s,a,td.create(Y.NA)),h=ak(i,s,n,td.create(Y.NA));return u.map((e,t,r)=>{let a=l.get(t,r),n=o.get(t,r),i=c.get(t,r),s=h.get(t,r),u=this._handleError(e,a,n,i,s);if(u.errorObject)return u.errorObject;let{minValue:m,maxValue:f,wholeNumberValue:g}=u,d;return g?(m=Math.ceil(m),d=Math.floor(Math.random()*((f=Math.floor(f))-m+1))+m):d=Math.random()*(f-m)+m,d<m||d>f?td.create(Y.VALUE):ah.create(d)})}_calculateSingleCell(e,t,r,a,n){let i=e;i.isArray()&&(i=i.get(0,0));let s=t;s.isArray()&&(s=s.get(0,0));let u=r;u.isArray()&&(u=u.get(0,0));let l=a;l.isArray()&&(l=l.get(0,0));let o=n;o.isArray()&&(o=o.get(0,0));let c=this._handleError(i,s,u,l,o);if(c.errorObject)return c.errorObject;let{rowsValue:h,columnsValue:m,minValue:f,maxValue:g,wholeNumberValue:d}=c;if(d&&(f=Math.ceil(f))>(g=Math.floor(g)))return td.create(Y.VALUE);let N=[];for(let e=0;e<h;e++){let e=[];for(let t=0;t<m;t++)d?e.push(Math.floor(Math.random()*(g-f+1))+f):e.push(Math.random()*(g-f)+f);N.push(e)}return 1===h&&1===m?ah.create(N[0][0]):aA.createByArray(N)}_handleError(e,t,r,a,n){let i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return{errorObject:i};let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return{errorObject:s};let u=r;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return{errorObject:u};let l=a;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let o=n;return o.isString()&&(o=o.convertToNumberObjectValue()),o.isError()?{errorObject:o}:this._getValue(i,s,u,l,o)}_getValue(e,t,r,a,n){let i=Math.floor(+e.getValue()),s=Math.floor(+t.getValue());if(0===i||0===s)return{errorObject:td.create(Y.CALC)};if(i<0||s<0)return{errorObject:td.create(Y.VALUE)};let u=+r.getValue(),l=+a.getValue(),o=+n.getValue();return u>l?{errorObject:td.create(Y.VALUE)}:!o||Number.isInteger(u)&&Number.isInteger(l)?{rowsValue:i,columnsValue:s,minValue:u,maxValue:l,wholeNumberValue:o}:{errorObject:td.create(Y.VALUE)}}};k(oS,"Randarray");let oO=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);r=r.get(0,0)}if(r.isError())return r;let a=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);a=a.get(0,0)}if(a.isError())return a;if(r.isBoolean()||a.isBoolean())return td.create(Y.VALUE);let n=+r.getValue(),i=+a.getValue();if(Number.isNaN(n)||Number.isNaN(i))return td.create(Y.VALUE);if(n>i)return td.create(Y.NUM);n=Math.ceil(n);let s=Math.floor(Math.random()*((i=Math.floor(i))-n+1))+n;return ah.create(s)}};k(oO,"Randbetween");let oT=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.round(a)}};k(oT,"Round");let oV=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.floor(a)}};k(oV,"Rounddown");let oI=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.ceil(a)}};k(oI,"Roundup");let oM=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())?t:Math.abs(+t.getValue())>=0x8000000?td.create(Y.NUM):t.cos().getReciprocal()}};k(oM,"Sec");let ox=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=0x8000000?td.create(Y.NUM):t.cosh().getReciprocal():ah.create(0)}};k(ox,"Sech");let ov=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",4)}calculate(e,t,r,a){let n=e,i=null!=t?t:ah.create(1),s=null!=r?r:ah.create(1),u=null!=a?a:ah.create(1);n.isNull()&&(n=ah.create(1)),i.isNull()&&(i=ah.create(1)),s.isNull()&&(s=ah.create(1)),u.isNull()&&(u=ah.create(1));let l=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,n,td.create(Y.NA)),h=ak(l,o,i,td.create(Y.NA)),m=ak(l,o,s,td.create(Y.NA)),f=ak(l,o,u,td.create(Y.NA)),g=c.mapValue((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),i=f.get(t,r);return e.isError()?e:a.isError()?a:n.isError()?n:i.isError()?i:this._getResult(e,a,n,i,l,o)});return 1===l&&1===o?g.get(0,0):g}_getResult(e,t,r,a,n,i){let{isError:s,errorObject:u,variants:l}=n8(e,t,r,a);if(s)return u;let[o,c,h,m]=l,f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue()),d=+h.getValue(),N=+m.getValue();if(f<0||g<0)return td.create(Y.VALUE);if(0===f||0===g)return td.create(Y.CALC);let _=[];for(let e=0;e<f;e++){_[e]=[];for(let t=0;t<g;t++)_[e][t]=d+(e*g+t)*N}return n>1||i>1?ah.create(_[0][0]):aA.createByArray(_)}};k(ov,"Sequence");let oU=class extends a1{constructor(){super(...arguments),$(this,"minParams",4),$(this,"maxParams",4)}calculate(e,t,r,a){if(e.isNull()||t.isNull()||r.isNull()||a.isNull())return td.create(Y.NA);let{isError:n,errorObject:i,variants:s}=n7(e,t,r);if(n)return i;let{isError:u,errorObject:l,variants:o}=n8(...s);if(u)return l;let[c,h,m]=o,f=+c.getValue(),g=+h.getValue(),d=+m.getValue(),N=[];if(a.isArray()){let e=!1,t=td.create(Y.VALUE);if(a.iterator(r=>{let{isError:a,errorObject:n,coefficientsObject:i}=this._handleSingleObject(r);if(a)return e=!0,t=n,!1;let s=+i.getValue();N.push(s)}),e)return t}else{let{isError:e,errorObject:t,coefficientsObject:r}=this._handleSingleObject(a);if(e)return t;let n=+r.getValue();N.push(n)}let _=0;for(let e=0;e<N.length;e++)_+=N[e]*f**(g+e*d);return Number.isNaN(_)||!Number.isFinite(_)?td.create(Y.NUM):ah.create(_)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(null!=e&&e.isBoolean())return{isError:!0,errorObject:td.create(Y.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}};k(oU,"Seriessum");let oD=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let{isError:t,errorObject:r,variants:a}=n8(e);if(t)return r;let[n]=a,i=+n.getValue();return i>0?ah.create(1):i<0?ah.create(-1):ah.create(0)}};k(oD,"Sign");let oL=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}};k(oL,"Sin");let oP=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}};k(oP,"Sinh");let ow=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}};k(ow,"Sqrt");let oF=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return td.create(Y.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(r<0)return td.create(Y.NUM);let a=Math.sqrt(r*Math.PI);return ah.create(a)}};k(oF,"Sqrtpi");let oj=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255),$(this,"needsReferenceObject",!0)}calculate(e,...t){if(e.isError())return e;if(e.isReferenceObject()){let r=[];return e.iterator((e,a,n)=>{null==r[a]&&(r[a]=[]),r[a][n]=this._handleSingleObject(e,...t)}),a$(r,r.length,r[0].length)}return this._handleSingleObject(e,...t)}_handleSingleObject(e,...t){let r;let a=this._getIndexNumValue(e);if(a instanceof td)return a;switch(a){case 1:r=this._average(!1,...t);break;case 2:r=this._count(!1,...t);break;case 3:r=this._counta(!1,...t);break;case 4:r=this._max(!1,...t);break;case 5:r=this._min(!1,...t);break;case 6:r=this._product(!1,...t);break;case 7:r=this._stdev(!1,...t);break;case 8:r=this._stdevp(!1,...t);break;case 9:r=this._sum(!1,...t);break;case 10:r=this._var(!1,...t);break;case 11:r=this._varp(!1,...t);break;case 101:r=this._average(!0,...t);break;case 102:r=this._count(!0,...t);break;case 103:r=this._counta(!0,...t);break;case 104:r=this._max(!0,...t);break;case 105:r=this._min(!0,...t);break;case 106:r=this._product(!0,...t);break;case 107:r=this._stdev(!0,...t);break;case 108:r=this._stdevp(!0,...t);break;case 109:r=this._sum(!0,...t);break;case 110:r=this._var(!0,...t);break;case 111:r=this._varp(!0,...t);break;default:r=td.create(Y.VALUE)}return r}_getIndexNumValue(e){let t=e?Number(e.getValue()):0;if(Number.isNaN(t))return td.create(Y.VALUE);let r=Math.floor(t);return r>=1&&r<=11||r>=101&&r<=111?r:td.create(Y.VALUE)}_average(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.mean()}_count(e,...t){let r=ah.create(0);for(let a=0;a<t.length;a++){let n=t[a];if(!n.isReferenceObject())return td.create(Y.VALUE);let i=n.getRowData();n.iterator((t,a)=>{if(e&&this._isRowHidden(i,a))return!0;null!=t&&t.isNumber()&&(r=r.plusBy(1))})}return r}_counta(e,...t){let r=ah.create(0);for(let a=0;a<t.length;a++){let n=t[a];if(!n.isReferenceObject())return td.create(Y.VALUE);let i=n.getRowData();n.iterator((t,a)=>{if(e&&this._isRowHidden(i,a)||null==t||t.isNull())return!0;r=r.plusBy(1)})}return r}_max(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ah.create(0):r.max()}_min(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ah.create(0):r.min()}_product(e,...t){let r=this._flattenRefArray(e,...t);if(r.isError())return r;if(this._isBlankArrayObject(r))return ah.create(0);let a=ah.create(1);return r.iterator(e=>{a=a.multiply(e)}),a}_stdev(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?td.create(Y.DIV_BY_ZERO):r.std(1)}_stdevp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?td.create(Y.DIV_BY_ZERO):r.std()}_sum(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.sum()}_var(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?td.create(Y.DIV_BY_ZERO):r.var(1)}_varp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?td.create(Y.DIV_BY_ZERO):r.var()}_flattenRefArray(e,...t){let r=[];r[0]=[];for(let a=0;a<t.length;a++){let n;let i=t[a];if(i.isError())return i;if(!i.isReferenceObject())return td.create(Y.VALUE);let s=i.getRowData();if(i.iterator((t,a)=>!!(e&&this._isRowHidden(s,a)||null==t||t.isNull()||t.isString()||t.isBoolean())||(t.isError()?(n=t,!1):void r[0].push(t))),null!=n&&n.isError())return n}return a$(r,1,r[0].length)}_isRowHidden(e,t){let r=e[t];return!!r&&r.hd===P.BooleanNumber.TRUE}_isBlankArrayObject(e){return 0===e.getArrayValue()[0].length}};k(oj,"Subtotal");let oB=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0);for(let r=0;r<e.length;r++){let a=e[r];if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()||(a.isArray()&&(a=a.sum()),a.isError()))return a;if((t=t.plus(a)).isError())break}return t}};k(oB,"Sum");let ok=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3)}calculate(e,t,r){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:e.isArray()&&(!r||r.isArray())?t.isArray()?t.map(t=>this._handleSingleObject(e,t,r)):this._handleSingleObject(e,t,r):td.create(Y.VALUE)}_handleSingleObject(e,t,r){let a=aY(e,t),[,n]=aH(`${t.getValue()}`);a=aZ(a,e,n);let i=r?r.slice([0,e.getRowCount()],[0,e.getColumnCount()]):e;return i?i.pick(a).sum():td.create(Y.VALUE)}};k(ok,"Sumif");let o$=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;if(!e.isArray()||t.length<2||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return td.create(Y.VALUE);let{maxRowLength:r,maxColumnLength:a}=aX(t),n=aK(t,e,r,a);if(n)return n;let i=az(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>e.pick(t).sum())),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(a)}};k(o$,"Sumifs");let oH=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=this._initArray1(e);if(!(t.length>0))return r.sum();{let e=r.getRowCount(),a=r.getColumnCount(),n=this._getResultArrayByArray1(e,a,r);if(n instanceof td)return n;for(let r=0;r<t.length;r++){if(t[r].isError())return t[r];let i=1,s=1;if(t[r].isArray()&&(i=t[r].getRowCount(),s=t[r].getColumnCount()),i!==e||s!==a)return td.create(Y.VALUE);for(let i=0;i<e;i++){let e=[];for(let s=0;s<a;s++){let a=t[r];if(t[r].isArray()&&(a=t[r].get(i,s)),a.isError())return a;let u=a.getValue();u&&(0,P.isRealNum)(u)?e.push(+u*n[i][s]):e.push(0)}n[i]=e}}let i=n.reduce((e,t)=>e.concat(t)).reduce((e,t)=>e+t,0);return ah.create(i)}}_initArray1(e){let t=e;return t.isArray()||(t=aA.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){let a=[];for(let n=0;n<e;n++){let e=[];for(let a=0;a<t;a++){let t=r.get(n,a);if(t.isError())return t;let i=t.getValue();i&&(0,P.isRealNum)(i)?e.push(+i):e.push(0)}a.push(e)}return a}};k(oH,"Sumproduct");let oY=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0),r=ah.create(2);for(let a=0;a<e.length;a++){let n=e[a];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()?n.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.plus(e.pow(r))))):t=t.plus(n.pow(r)),t.isError())break}return t}};k(oY,"Sumsq");let oG=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return td.create(Y.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),a=t.flatten(),n=as.create(),i=[],s=[],u=0;return r.iterator((e,t,r)=>{let l=a.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return n=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return n=l,!1;let o=+e.getValue(),c=+l.getValue();i.push(o),s.push(c),u+=o**2-c**2}),n.isError()?n:0===i.length||0===s.length?td.create(Y.DIV_BY_ZERO):ah.create(u)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let a=t;if(a.isArray()&&(a=a.get(0,0)),a.isError())return a;if(r.isNull()||a.isNull())return td.create(Y.VALUE);let n=+r.getValue(),i=+a.getValue();if(r.isString()&&!(0,P.isRealNum)(n)||r.isBoolean()||a.isString()&&!(0,P.isRealNum)(i)||a.isBoolean())return td.create(Y.DIV_BY_ZERO);let s=n**2-i**2;return ah.create(s)}};k(oG,"Sumx2my2");let oq=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return td.create(Y.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),a=t.flatten(),n=as.create(),i=[],s=[],u=0;return r.iterator((e,t,r)=>{let l=a.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return n=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return n=l,!1;let o=+e.getValue(),c=+l.getValue();i.push(o),s.push(c),u+=o**2+c**2}),n.isError()?n:0===i.length||0===s.length?td.create(Y.DIV_BY_ZERO):ah.create(u)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let a=t;if(a.isArray()&&(a=a.get(0,0)),a.isError())return a;if(r.isNull()||a.isNull())return td.create(Y.VALUE);let n=+r.getValue(),i=+a.getValue();if(r.isString()&&!(0,P.isRealNum)(n)||r.isBoolean()||a.isString()&&!(0,P.isRealNum)(i)||a.isBoolean())return td.create(Y.DIV_BY_ZERO);let s=n**2+i**2;return ah.create(s)}};k(oq,"Sumx2py2");let oW=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return td.create(Y.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),a=t.flatten(),n=as.create(),i=[],s=[],u=0;return r.iterator((e,t,r)=>{let l=a.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return n=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return n=l,!1;let o=+e.getValue(),c=+l.getValue();i.push(o),s.push(c),u+=(o-c)**2}),n.isError()?n:0===i.length||0===s.length?td.create(Y.DIV_BY_ZERO):ah.create(u)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let a=t;if(a.isArray()&&(a=a.get(0,0)),a.isError())return a;if(r.isNull()||a.isNull())return td.create(Y.VALUE);let n=+r.getValue(),i=+a.getValue();return r.isString()&&!(0,P.isRealNum)(n)||r.isBoolean()||a.isString()&&!(0,P.isRealNum)(i)||a.isBoolean()?td.create(Y.DIV_BY_ZERO):ah.create((n-i)**2)}};k(oW,"Sumxmy2");let oQ=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}};k(oQ,"Tan");let oX=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}};k(oX,"Tanh");let oK=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:ah.create(0),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e,td.create(Y.NA)),s=ak(a,n,r,td.create(Y.NA)),u=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),u=+a.getValue(),l=10**Math.trunc(u),o=rK(i,l),c=Math.trunc(rG(i,l)+o)/l;return ah.create(c)});return 1===a&&1===n?u.get(0,0):u}};k(oK,"Trunc");let oz=[[lT,on.ABS],[lV,on.ACOS],[lI,on.ACOSH],[lM,on.ACOT],[lv,on.ACOTH],[lD,on.ASIN],[lL,on.ASINH],[lP,on.ATAN],[lw,on.ATAN2],[lF,on.ATANH],[lj,on.BASE],[lB,on.CEILING],[lk,on.CEILING_MATH],[l$,on.CEILING_PRECISE],[lz,on.COMBIN],[lZ,on.COMBINA],[lJ,on.COS],[l0,on.COSH],[l1,on.COT],[l2,on.COTH],[l3,on.CSC],[l5,on.CSCH],[l4,on.DECIMAL],[l6,on.DEGREES],[l7,on.EVEN],[l9,on.EXP],[l8,on.FACT],[oe,on.FACTDOUBLE],[ot,on.FLOOR],[or,on.FLOOR_MATH],[oa,on.FLOOR_PRECISE],[oi,on.GCD],[os,on.INT],[ou,on.LCM],[ol,on.LN],[oo,on.LOG],[oc,on.LOG10],[oh,on.MDETERM],[om,on.MINVERSE],[of,on.MMULT],[og,on.MOD],[od,on.MROUND],[oN,on.MULTINOMIAL],[o_,on.MUNIT],[oE,on.ODD],[oC,on.PI],[op,on.POWER],[oA,on.PRODUCT],[ob,on.QUOTIENT],[oy,on.RADIANS],[oR,on.RAND],[oS,on.RANDARRAY],[oO,on.RANDBETWEEN],[oT,on.ROUND],[oV,on.ROUNDDOWN],[oI,on.ROUNDUP],[oM,on.SEC],[ox,on.SECH],[oU,on.SERIESSUM],[ov,on.SEQUENCE],[oD,on.SIGN],[oL,on.SIN],[oP,on.SINH],[ow,on.SQRT],[oF,on.SQRTPI],[oj,on.SUBTOTAL],[oB,on.SUM],[ok,on.SUMIF],[o$,on.SUMIFS],[oH,on.SUMPRODUCT],[oY,on.SUMSQ],[oG,on.SUMX2MY2],[oq,on.SUMX2PY2],[oW,on.SUMXMY2],[oQ,on.TAN],[oX,on.TANH],[oK,on.TRUNC]],oZ=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2),$(this,"_compareType",X.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}};k(oZ,"Compare");let oJ=class e extends tm{constructor(e){super(""),$(this,"_values",[]),this._values=e}static create(t){return new e(t)}isCube(){return!0}sum(){let e=ah.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=ah.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=ah.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){let e=ah.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){let e=ah.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){let e=ah.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}};k(oJ,"CubeValueObject");let o0=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isError())return a;if(!a.isArray())return td.create(Y.VALUE);t.push(a)}return oJ.create(t)}};k(o0,"Cube");let o1=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:t.isArray()||0!==t.getValue()?e.divided(t):td.create(Y.DIV_BY_ZERO)}};k(o1,"Divided");var o2=((V=o2||{}).COMPARE="COMPARE",V.DIVIDED="DIVIDED",V.MINUS="MINUS",V.MULTIPLY="MULTIPLY",V.PLUS="PLUS",V.UNION="UNION",V.CUBE="CUBE",V);let o3=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}};k(o3,"Minus");let o5=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}};k(o5,"Multiply");let o4=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}};k(o4,"Plus");let o6=[[oZ,o2.COMPARE],[o1,o2.DIVIDED],[o3,o2.MINUS],[o5,o2.MULTIPLY],[o4,o2.PLUS],[o0,o2.CUBE]];var o7=((I=o7||{}).AVEDEV="AVEDEV",I.AVERAGE="AVERAGE",I.AVERAGEA="AVERAGEA",I.AVERAGEIF="AVERAGEIF",I.AVERAGEIFS="AVERAGEIFS",I.BETA_DIST="BETA.DIST",I.BETA_INV="BETA.INV",I.BINOM_DIST="BINOM.DIST",I.BINOM_DIST_RANGE="BINOM.DIST.RANGE",I.BINOM_INV="BINOM.INV",I.CHISQ_DIST="CHISQ.DIST",I.CHISQ_DIST_RT="CHISQ.DIST.RT",I.CHISQ_INV="CHISQ.INV",I.CHISQ_INV_RT="CHISQ.INV.RT",I.CHISQ_TEST="CHISQ.TEST",I.CONFIDENCE_NORM="CONFIDENCE.NORM",I.CONFIDENCE_T="CONFIDENCE.T",I.CORREL="CORREL",I.COUNT="COUNT",I.COUNTA="COUNTA",I.COUNTBLANK="COUNTBLANK",I.COUNTIF="COUNTIF",I.COUNTIFS="COUNTIFS",I.COVARIANCE_P="COVARIANCE.P",I.COVARIANCE_S="COVARIANCE.S",I.DEVSQ="DEVSQ",I.EXPON_DIST="EXPON.DIST",I.F_DIST="F.DIST",I.F_DIST_RT="F.DIST.RT",I.F_INV="F.INV",I.F_INV_RT="F.INV.RT",I.F_TEST="F.TEST",I.FISHER="FISHER",I.FISHERINV="FISHERINV",I.FORECAST="FORECAST",I.FORECAST_ETS="FORECAST.ETS",I.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",I.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",I.FORECAST_ETS_STAT="FORECAST.ETS.STAT",I.FORECAST_LINEAR="FORECAST.LINEAR",I.FREQUENCY="FREQUENCY",I.GAMMA="GAMMA",I.GAMMA_DIST="GAMMA.DIST",I.GAMMA_INV="GAMMA.INV",I.GAMMALN="GAMMALN",I.GAMMALN_PRECISE="GAMMALN.PRECISE",I.GAUSS="GAUSS",I.GEOMEAN="GEOMEAN",I.GROWTH="GROWTH",I.HARMEAN="HARMEAN",I.HYPGEOM_DIST="HYPGEOM.DIST",I.INTERCEPT="INTERCEPT",I.KURT="KURT",I.LARGE="LARGE",I.LINEST="LINEST",I.LOGEST="LOGEST",I.LOGNORM_DIST="LOGNORM.DIST",I.LOGNORM_INV="LOGNORM.INV",I.MAX="MAX",I.MAXA="MAXA",I.MAXIFS="MAXIFS",I.MEDIAN="MEDIAN",I.MIN="MIN",I.MINA="MINA",I.MINIFS="MINIFS",I.MODE_MULT="MODE.MULT",I.MODE_SNGL="MODE.SNGL",I.NEGBINOM_DIST="NEGBINOM.DIST",I.NORM_DIST="NORM.DIST",I.NORM_INV="NORM.INV",I.NORM_S_DIST="NORM.S.DIST",I.NORM_S_INV="NORM.S.INV",I.PEARSON="PEARSON",I.PERCENTILE_EXC="PERCENTILE.EXC",I.PERCENTILE_INC="PERCENTILE.INC",I.PERCENTRANK_EXC="PERCENTRANK.EXC",I.PERCENTRANK_INC="PERCENTRANK.INC",I.PERMUT="PERMUT",I.PERMUTATIONA="PERMUTATIONA",I.PHI="PHI",I.POISSON_DIST="POISSON.DIST",I.PROB="PROB",I.QUARTILE_EXC="QUARTILE.EXC",I.QUARTILE_INC="QUARTILE.INC",I.RANK_AVG="RANK.AVG",I.RANK_EQ="RANK.EQ",I.RSQ="RSQ",I.SKEW="SKEW",I.SKEW_P="SKEW.P",I.SLOPE="SLOPE",I.SMALL="SMALL",I.STANDARDIZE="STANDARDIZE",I.STDEV_P="STDEV.P",I.STDEV_S="STDEV.S",I.STDEVA="STDEVA",I.STDEVPA="STDEVPA",I.STEYX="STEYX",I.T_DIST="T.DIST",I.T_DIST_2T="T.DIST.2T",I.T_DIST_RT="T.DIST.RT",I.T_INV="T.INV",I.T_INV_2T="T.INV.2T",I.T_TEST="T.TEST",I.TREND="TREND",I.TRIMMEAN="TRIMMEAN",I.VAR_P="VAR.P",I.VAR_S="VAR.S",I.VARA="VARA",I.VARPA="VARPA",I.WEIBULL_DIST="WEIBULL.DIST",I.Z_TEST="Z.TEST",I);let o9=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0),r=ah.create(0);for(let a=0;a<e.length;a++){let n=e[a];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){if((n=o8(n)).isError())return n;if(e[a]=n,(t=t.plus(n.sum())).isError())return t;r=r.plus(n.count())}else n.isNull()||(t=t.plus(n),r=r.plus(ah.create(1)))}if(0===r.getValue())return td.create(Y.NUM);let a=t.divided(r);if(a.isError())return a;let n=ah.create(0);for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;if(r.isArray()){if((n=n.plus(r.minus(a).abs().sum())).isError())return n}else r.isNull()||(n=n.plus(r.minus(a).abs()))}return n.divided(r)}};function o8(e){let t=[];t[0]=[];let r=null;return e.iterator((e,a,n)=>{if(null!=e&&e.isError())return r=e,!1;null!=e&&e.isNumber()&&t[0].push(e)}),r||a$(t,1,t[0].length)}k(o9,"Avedev"),k(o8,"filterNumberValueObject");let ce=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0),r=ah.create(0);for(let a=0;a<e.length;a++){let n=e[a];if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){if((t=t.plus(n.sum())).isError())return t;r=r.plus(n.count())}else n.isNull()||(t=t.plus(n),r=r.plus(ah.create(1)))}return t.divided(r)}};k(ce,"Average");let ct=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0),r=ah.create(0);for(let a=0;a<e.length;a++){let n=e[a];if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null==e||e.isNull())return!0;let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()).isError()&&(a=ah.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=t.plus(a),r=r.plus(ah.create(1))}),t.isError())return t}else n.isNull()||(t=t.plus(n),r=r.plus(ah.create(1)))}return t.divided(r)}};k(ct,"Averagea");let cr=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3),$(this,"needsReferenceObject",!0)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject()),a.isArray()||(a=a$([[a]],1,1));let n=t;return n.isReferenceObject()&&(n=n.toArrayValueObject()),r&&!(null!=r&&r.isReferenceObject())?td.create(Y.NA):n.isArray()?n.map(e=>this._handleSingleObject(a,e,r)):this._handleSingleObject(a,n,r)}_handleSingleObject(e,t,r){let a=aY(e,t),[,n]=aH(`${t.getValue()}`);a=aZ(a,e,n);let i=r?this._createRangeReferenceObject(r,e):e;if(!i)return td.create(Y.VALUE);if(i.isError())return i;i.isReferenceObject()&&(i=i.toArrayValueObject());let s=i.pick(a),u=s.sum(),l=s.count();return u.divided(l)}_createRangeReferenceObject(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;if(r===n&&a===i)return e;let{startRow:s,startColumn:u}=e.getRangePosition();return this.createReferenceObject(e,{startRow:s,startColumn:u,endRow:s+n-1,endColumn:u+i-1})}};k(cr,"Averageif");let ca=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return td.create(Y.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return td.create(Y.VALUE);let{maxRowLength:r,maxColumnLength:a}=aX(t),n=aK(t,e,r,a);if(n)return n;let i=az(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t),a=r.sum(),n=r.count();return a.divided(n)})),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(a)}};k(ca,"Averageifs");let cn=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0);for(let r=0;r<e.length;r++){let a=e[r];a.isError()||(a.isArray()?t=t.plus(a.count()):a.isString()?a.convertToNumberObjectValue().isError()||(t=t.plus(ah.create(1))):a.isNull()||(t=t.plus(ah.create(1))))}return t}};k(cn,"Count");let ci=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(0);for(let r=0;r<e.length;r++){let a=e[r];if(a.isError()){t=t.plus(ah.create(1));continue}a.isArray()?(a=a.countA(),t=t.plus(a)):a.isNull()||(t=t.plus(ah.create(1)))}return t}};k(ci,"Counta");let cs=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:""===e.getValue()||e.isNull()?ah.create(1):e.isArray()?e.countBlank():ah.create(0)}};k(cs,"Countblank");let cu=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){return e.isError()||t.isError()?td.create(Y.NA):e.isArray()?t.isArray()?t.mapValue(t=>this._handleSingleObject(e,t)):this._handleSingleObject(e,t):td.create(Y.VALUE)}_handleSingleObject(e,t){let r=aY(e,t),[,a]=aH(`${t.getValue()}`);r=aZ(r,e,a);let n=e.pick(r);return this._countA(n)}_countA(e){let t=ah.create(0);return e.iterator(e=>{if(null==e)return!0;t=t.plusBy(1)}),t}};k(cu,"Countif");let cl=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",255)}calculate(...e){if(e.length%2!=0||e.some((e,t)=>t%2==0&&!e.isArray()))return td.create(Y.VALUE);let{maxRowLength:t,maxColumnLength:r}=aX(e),a=aK(e,e[0],t,r);if(a)return a;let n=az(e,t,r,!0);return this._aggregateResults(n)}_aggregateResults(e){let t=e.map(e=>e.map(e=>co(e))),r={calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(r)}};function co(e){let t=0;return e.iterator(e=>{null!=e&&e.isBoolean()&&!0===e.getValue()&&t++}),ah.create(t)}k(cl,"Countifs"),k(co,"countTrueValue");let cc=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isArray()&&(a=a.max()),a.isError())return a;t=this._validator(t,a)}}return t.getValue()===Number.NEGATIVE_INFINITY?ah.create(0):t}_validator(e,t){let r=e.isLessThan(t),a=e;return r.getValue()&&(a=t),a}};k(cc,"Max");let ch=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(a.isArray()&&a.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=ah.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,a)}}return t.getValue()===Number.NEGATIVE_INFINITY?ah.create(0):t}_validator(e,t){let r=e.isLessThan(t),a=e;return r.getValue()&&(a=t),a}};k(ch,"Maxa");let cm=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return td.create(Y.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return td.create(Y.VALUE);let{maxRowLength:r,maxColumnLength:a}=aX(t),n=aK(t,e,r,a);if(n)return n;let i=az(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?aA.create("0"):r.max()})),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(a)}};k(cm,"Maxifs");let cf=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isArray()&&(a=a.min()),a.isError())return a;t=this._validator(t,a)}}return t.getValue()===Number.POSITIVE_INFINITY?ah.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),a=e;return r.getValue()&&(a=t),a}};k(cf,"Min");let cg=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=ah.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(a.isArray()&&a.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=ah.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,a)}}return t.getValue()===Number.POSITIVE_INFINITY?ah.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),a=e;return r.getValue()&&(a=t),a}};k(cg,"Mina");let cd=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",255)}calculate(e,...t){if(e.isError())return td.create(Y.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return td.create(Y.VALUE);let{maxRowLength:r,maxColumnLength:a}=aX(t),n=aK(t,e,r,a);if(n)return n;let i=az(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?aA.create("0"):r.min()})),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return aA.create(a)}};k(cd,"Minifs");let cN=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3),$(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject());let{refHasError:n,refErrorObject:i,refNumbers:s}=this._checkRefReferenceObject(t),u=null!=r?r:ah.create(0);u.isReferenceObject()&&(u=u.toArrayValueObject());let l=Math.max(a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,a,td.create(Y.NA)),h=ak(l,o,u,td.create(Y.NA)),m=c.map((t,r,a)=>{let u=h.get(r,a);if(!e.isReferenceObject()&&e.isNull())return td.create(Y.NA);if(n)return i;if(u.isError())return u;let l=+t.getValue(),o=+u.getValue();return Number.isNaN(l)||Number.isNaN(o)?td.create(Y.VALUE):this._getResult(l,o,s)});return 1===l&&1===o?m.get(0,0):m}_getResult(e,t,r){let a=r.sort((e,r)=>t?e-r:r-e),n=a.indexOf(e),i=[];for(;n>=0;){let t=n+1;i.push(t),n=a.indexOf(e,t)}if(0===i.length)return td.create(Y.NA);let s=i.reduce((e,t)=>e+t,0)/i.length;return ah.create(s)}_checkRefReferenceObject(e){let t=!1,r=td.create(Y.NA),a=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;a.push(n)}),{refHasError:t,refErrorObject:r,refNumbers:a}):{refHasError:!0,refErrorObject:r,refNumbers:a}}};k(cN,"RankAvg");let c_=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",3),$(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject());let{refHasError:n,refErrorObject:i,refNumbers:s}=this._checkRefReferenceObject(t),u=null!=r?r:ah.create(0);u.isReferenceObject()&&(u=u.toArrayValueObject());let l=Math.max(a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),o=Math.max(a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),c=ak(l,o,a,td.create(Y.NA)),h=ak(l,o,u,td.create(Y.NA)),m=c.map((t,r,a)=>{let u=h.get(r,a);if(!e.isReferenceObject()&&e.isNull())return td.create(Y.NA);if(n)return i;if(u.isError())return u;let l=+t.getValue(),o=+u.getValue();if(Number.isNaN(l)||Number.isNaN(o))return td.create(Y.VALUE);let c=s.sort((e,t)=>o?e-t:t-e).indexOf(l);return -1===c?td.create(Y.NA):ah.create(c+1)});return 1===l&&1===o?m.get(0,0):m}_checkRefReferenceObject(e){let t=!1,r=td.create(Y.NA),a=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;a.push(n)}),{refHasError:t,refErrorObject:r,refNumbers:a}):{refHasError:!0,refErrorObject:r,refNumbers:a}}};k(c_,"RankEq");let cE=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}};k(cE,"Stdeva");let cC=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std()}};k(cC,"Stdevpa");let cp=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}};k(cp,"Vara");let cA=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var()}};k(cA,"Varpa");let cb=[[o9,o7.AVEDEV],[ce,o7.AVERAGE],[ct,o7.AVERAGEA],[cr,o7.AVERAGEIF],[ca,o7.AVERAGEIFS],[cn,o7.COUNT],[ci,o7.COUNTA],[cs,o7.COUNTBLANK],[cu,o7.COUNTIF],[cl,o7.COUNTIFS],[cc,o7.MAX],[ch,o7.MAXA],[cm,o7.MAXIFS],[cf,o7.MIN],[cg,o7.MINA],[cd,o7.MINIFS],[cN,o7.RANK_AVG],[c_,o7.RANK_EQ],[a5,o7.STDEV_P],[a4,o7.STDEV_S],[cE,o7.STDEVA],[cC,o7.STDEVPA],[a6,o7.VAR_P],[a7,o7.VAR_S],[cp,o7.VARA],[cA,o7.VARPA]],cy=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t="",r=null;for(let a of e)if(a.isArray()){if(a.iterator(e=>!!(null==e||e.isNull())||(e.isError()?(r=e,!1):void(e.isBoolean()?t+=`${e.getValue()}`.toLocaleUpperCase():(e.isString()||e.isNumber())&&(t+=e.getValue())))),r)return r}else a.isError()||a.isNull()||(t+=a.getValue());return ag.create(t)}};k(cy,"Concat");let cR=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(e=>{e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1))});let a=null;for(let n of e)a=ak(t,r,n,td.create(Y.NA)).mapValue((e,t,r)=>{let n=a&&a.get(t,r);if(null!=n&&n.isError())return n;if(e.isError())return e;let i=null==n?void 0:n.getValue(),s=null==e?void 0:e.getValue();null!=n&&n.isBoolean()&&(i=`${i}`.toLocaleUpperCase()),null!=e&&e.isBoolean()&&(s=`${s}`.toLocaleUpperCase());let u=null!=n&&n.isNull()?"":null!=i?i:"",l=null!=e&&e.isNull()?"":null!=s?s:"";return ag.create(`${u}${l}`)});return a||td.create(Y.VALUE)}};k(cR,"Concatenate");var cS=((M=cS||{}).ASC="ASC",M.ARRAYTOTEXT="ARRAYTOTEXT",M.BAHTTEXT="BAHTTEXT",M.CHAR="CHAR",M.CLEAN="CLEAN",M.CODE="CODE",M.CONCAT="CONCAT",M.CONCATENATE="CONCATENATE",M.DBCS="DBCS",M.DOLLAR="DOLLAR",M.EXACT="EXACT",M.FIND="FIND",M.FINDB="FINDB",M.FIXED="FIXED",M.LEFT="LEFT",M.LEFTB="LEFTB",M.LEN="LEN",M.LENB="LENB",M.LOWER="LOWER",M.MID="MID",M.MIDB="MIDB",M.NUMBERVALUE="NUMBERVALUE",M.PHONETIC="PHONETIC",M.PROPER="PROPER",M.REPLACE="REPLACE",M.REPLACEB="REPLACEB",M.REPT="REPT",M.RIGHT="RIGHT",M.RIGHTB="RIGHTB",M.SEARCH="SEARCH",M.SEARCHB="SEARCHB",M.SUBSTITUTE="SUBSTITUTE",M.T="T",M.TEXT="TEXT",M.TEXTAFTER="TEXTAFTER",M.TEXTBEFORE="TEXTBEFORE",M.TEXTJOIN="TEXTJOIN",M.TEXTSPLIT="TEXTSPLIT",M.TRIM="TRIM",M.UNICHAR="UNICHAR",M.UNICODE="UNICODE",M.UPPER="UPPER",M.VALUE="VALUE",M.VALUETOTEXT="VALUETOTEXT",M.CALL="CALL",M.EUROCONVERT="EUROCONVERT",M.REGISTER_ID="REGISTER.ID",M);function cO(e){let t=0;for(let r=0;r<e.length;r++){let a=e.charCodeAt(r);a>=12352&&a<=12543||a>=19968&&a<=40959||a>=44032&&a<=55215?t+=2:t+=1}return t}k(cO,"charLenByte");let cT=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(null!=t&&t.isError())return t;let r=t||ah.create(1),a=Math.max(e.isArray()?e.getRowCount():1,r&&r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r&&r.isArray()?r.getColumnCount():1),i=ak(a,n,e),s=ak(a,n,r);return i.map((e,t,r)=>this._handleSingleText(e,t,r,s))}_handleSingleText(e,t,r,a){let n=a.get(t,r)||ah.create(1);if(n.isError())return n;let i=e.getValue();if(e.isNull()&&(i=""),e.isBoolean()&&(i=i?"TRUE":"FALSE"),i=`${i}`,(n.isString()||n.isBoolean()||n.isNull())&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=Math.floor(+n.getValue());return s<0?td.create(Y.VALUE):ag.create(this._sliceByBytes(i,s))}_sliceByBytes(e,t){let r=0,a=0;for(let n=0;n<e.length;n++){let i=cO(e[n]);if(r+i>t)break;r+=i,a++}return[...e].slice(0,a).join("")}};k(cT,"Leftb");let cV=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.mapValue(e=>this._handleSingleText(e)):this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;if(e.isNull())return ah.create(0);if(e.isNumber()){let t=r7(e.getValue(),12,Number.EPSILON).toString();return ah.create(t.length)}if(e.isString()||e.isBoolean()||e.isNumber()){let t=e.getValue().toString();return ah.create(t.length)}return td.create(Y.VALUE)}};k(cV,"Len");let cI=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.mapValue(e=>this._handleSingleText(e)):this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;if(e.isNull())return ah.create(0);if(e.isString()||e.isBoolean()||e.isNumber()){let t=cO(e.getValue().toString());return ah.create(t)}return td.create(Y.VALUE)}};k(cI,"Lenb");let cM=class extends a1{constructor(){super(...arguments),$(this,"minParams",1),$(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.mapValue(e=>this._handleSingleText(e)):this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;if(e.isNull())return ag.create("");if(e.isString()||e.isBoolean()||e.isNumber()){let t=e.getValue().toString().toLowerCase();return ag.create(t)}return td.create(Y.VALUE)}};k(cM,"Lower");let cx=class extends a1{constructor(){super(...arguments),$(this,"minParams",3),$(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=ak(a,n,e),s=ak(a,n,t),u=ak(a,n,r);return i.map((e,t,r)=>this._handleSingleText(e,t,r,s,u))}_handleSingleText(e,t,r,a,n){let i=a.get(t,r)||as.create(),s=n.get(t,r)||as.create();if(i.isError())return i;if(s.isError())return s;let u=e.getValue();if(e.isNull()&&(u=""),e.isBoolean()&&(u=u?"TRUE":"FALSE"),u=`${u}`,(i.isString()||i.isBoolean()||i.isNull())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if((s.isString()||s.isBoolean()||s.isNull())&&(s=s.convertToNumberObjectValue()),s.isError())return s;let l=Math.floor(+i.getValue())-1,o=s.getValue();return l<0||o<0?td.create(Y.VALUE):ag.create(u.substring(l,l+o))}};k(cx,"Mid");let cv=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e,td.create(Y.NA)),i=ak(r,a,t,td.create(Y.NA)),s=n.map((e,t,r)=>{let a=i.get(t,r);if(e.isError())return e;let n=e.getValue();if(e.isNull()&&(n=""),e.isBoolean()&&(n=n?"TRUE":"FALSE"),n+="",a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let s=Math.floor(+a.getValue());if(s<0||s>32767/n.length)return td.create(Y.VALUE);let u=n.repeat(s);return ag.create(u)});return 1===r&&1===a?s.get(0,0):s}};k(cv,"Rept");let cU=/* @__PURE__ */k((e,t)=>(0,P.numfmt).format(e,t,{throws:!1}),"getFormatPreview"),cD=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=ak(r,a,e),i=ak(r,a,t);return n.map((e,t,r)=>{if(e.isError())return e;let a=i.get(t,r)||ag.create(" ");if(a.isError())return a;if(a.isBoolean())return td.create(Y.VALUE);if(e.isBoolean())return e;let n=e.getValue();if(e.isNull()&&(n=0),e.isString()){if(!(0,P.isRealNum)(n))return e;n=Number(n)}a.isNull()&&(a=ag.create(" "));let s=`${a.getValue()}`,u=cU(s,n);return ag.create(" "===s?u.trimEnd():u)})}};k(cD,"Text");let cL=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=!1,u=null!=r?r:ah.create(1);u.isNull()&&(s=!0,u=ah.create(1));let l=null!=a?a:ah.create(0),o=null!=n?n:ah.create(0),c=null!=i?i:td.create(Y.NA),h=Math.max(e.isArray()?e.getRowCount():1,u.isArray()?u.getRowCount():1,l.isArray()?l.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,u.isArray()?u.getColumnCount():1,l.isArray()?l.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),f=ak(h,m,e,td.create(Y.NA)),g=ak(h,m,u,td.create(Y.NA)),d=ak(h,m,l,td.create(Y.NA)),N=ak(h,m,o,td.create(Y.NA)),_=ak(h,m,c,td.create(Y.NA)),E=this._getResultArray(f,t,g,d,N,_,s,!a);return 1===h&&1===m?E.get(0,0):E}_getResultArray(e,t,r,a,n,i,s,u){return e.map((e,l,o)=>{let c=r.get(l,o),h=a.get(l,o),m=n.get(l,o),f=i.get(l,o),g=this._checkVariantsError(e,c,h,m);if(g.isError())return g;let d=this._getStringValue(e),N=this._getDelimiterValue(t);if(N instanceof td)return N;let _=this._getVariantsNumberFloorValue(c,h,m);if(_ instanceof td)return _;let[E,C,p]=_;return 0===E||C<0||C>1||p<0||p>1?td.create(Y.VALUE):N.includes("")?E>0?ag.create(d):ag.create(""):!s&&Math.abs(E)>d.length?td.create(Y.VALUE):N.every(e=>e.length>d.length)?td.create(Y.NA):this._getResult(d,N,E,C,p,f,u)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return al.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,a=td.create(Y.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;t.push(this._getStringValue(e))}),r)return a}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=Math.floor(+a.getValue());t.push(n)}return t}_getResult(e,t,r,a,n,i,s){let u=a?e.toLocaleLowerCase():e,l=a?t.map(e=>e.toLocaleLowerCase()):t,o=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:u.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;o=e.index,u=u.substr(0,e.index),h=e.length,c++}else{let e=l.map(e=>({index:u.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;o+=e.index+h,u=u.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&s)return td.create(Y.NA);if(!c||c<Math.abs(r))return n?r>0?ag.create(""):ag.create(e):i;let m=e.substr(o+h);return ag.create(m)}};k(cL,"Textafter");let cP=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=!1,u=null!=r?r:ah.create(1);u.isNull()&&(s=!0,u=ah.create(1));let l=null!=a?a:ah.create(0),o=null!=n?n:ah.create(0),c=null!=i?i:td.create(Y.NA),h=Math.max(e.isArray()?e.getRowCount():1,u.isArray()?u.getRowCount():1,l.isArray()?l.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,u.isArray()?u.getColumnCount():1,l.isArray()?l.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),f=ak(h,m,e,td.create(Y.NA)),g=ak(h,m,u,td.create(Y.NA)),d=ak(h,m,l,td.create(Y.NA)),N=ak(h,m,o,td.create(Y.NA)),_=ak(h,m,c,td.create(Y.NA)),E=this._getResultArray(f,t,g,d,N,_,s,!a);return 1===h&&1===m?E.get(0,0):E}_getResultArray(e,t,r,a,n,i,s,u){return e.map((e,l,o)=>{let c=r.get(l,o),h=a.get(l,o),m=n.get(l,o),f=i.get(l,o),g=this._checkVariantsError(e,c,h,m);if(g.isError())return g;let d=this._getStringValue(e),N=this._getDelimiterValue(t);if(N instanceof td)return N;let _=this._getVariantsNumberFloorValue(c,h,m);if(_ instanceof td)return _;let[E,C,p]=_;return 0===E||C<0||C>1||p<0||p>1?td.create(Y.VALUE):N.includes("")?E>0?ag.create(""):ag.create(d):!s&&Math.abs(E)>d.length?td.create(Y.VALUE):N.every(e=>e.length>d.length)?td.create(Y.NA):this._getResult(d,N,E,C,p,f,u)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return al.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,a=td.create(Y.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;t.push(this._getStringValue(e))}),r)return a}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=Math.floor(+a.getValue());t.push(n)}return t}_getResult(e,t,r,a,n,i,s){let u=a?e.toLocaleLowerCase():e,l=a?t.map(e=>e.toLocaleLowerCase()):t,o=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:u.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;o=e.index,u=u.substr(0,e.index),c++}else{let e=l.map(e=>({index:u.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;o+=e.index+h,u=u.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&s)return td.create(Y.NA);if(!c||c<Math.abs(r))return n?r>0?ag.create(e):ag.create(""):i;let m=e.substr(0,o);return ag.create(m)}};k(cP,"Textbefore");let cw=class extends a1{constructor(){super(...arguments),$(this,"minParams",2),$(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=r?r:ag.create("\\s"),u=null!=a?a:ah.create(0),l=null!=n?n:ah.create(0),o=null!=i?i:ag.create(Y.NA),{_variant:c,values:h}=this._getStringValues(t),{_variant:m,values:f}=this._getStringValues(s,!1);s=m;let g=Math.max(e.isArray()?e.getRowCount():1,u.isArray()?u.getRowCount():1,l.isArray()?l.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,u.isArray()?u.getColumnCount():1,l.isArray()?l.getColumnCount():1),N=ak(g,d,e,td.create(Y.NA)),_=ak(g,d,u,td.create(Y.NA)),E=ak(g,d,l,td.create(Y.NA)),C=this._getResultArray(N,c,s,_,E,o,h,f);return 1===g&&1===d?C.get(0,0):C.map(e=>e.get(0,0))}_getStringValues(e,t=!0){let r=e,a=[];if(r.isArray())r.iterator(e=>{if(null!=e&&e.isError())return r=e,!1;if(null!=e&&e.isNull()&&t)return r=td.create(Y.VALUE),!1;let n=this._getRegExpStringValue(e);if(""===n)return r=td.create(Y.VALUE),!1;a.push(n)});else{r.isNull()&&t&&(r=td.create(Y.VALUE));let e=this._getRegExpStringValue(r);""===e&&(r=td.create(Y.VALUE)),a.push(e)}return{_variant:r,values:a}}_getResultArray(e,t,r,a,n,i,s,u){return e.map((e,l,o)=>{let c=a.get(l,o),h=n.get(l,o),m=this._checkVariantsError(e,t,r,c,h);if(m.isError())return m;if(e.isNull())return td.create(Y.VALUE);let f=i;if(f.isArray()){let e=f.getRowCount(),t=f.getColumnCount();if(e>1||t>1)return td.create(Y.VALUE);f=f.get(0,0)}let g=`${e.getValue()}`;if(e.isBoolean()&&(g=g.toLocaleUpperCase()),c.isString()&&(c=c.convertToNumberObjectValue()).isError())return c;let d=Math.floor(+c.getValue());if(h.isString()&&(h=h.convertToNumberObjectValue()).isError())return h;let N=Math.floor(+h.getValue());if(N<0||N>1)return td.create(Y.VALUE);let _=`${f.getValue()}`;return f.isBoolean()&&(_=_.toLocaleUpperCase()),this._getResult(g,s,u,d,N,_)})}_getResult(e,t,r,a,n,i){let s=RegExp(r.join("|"),`g${n?"i":""}`),u=RegExp(t.join("|"),`g${n?"i":""}`),l=e.split(s),o=1,c=l.map(e=>{let t=e.split(u);return a&&(t=t.filter(e=>""!==e)),o=Math.max(o,t.length),t});return c=c.map(e=>{let t=e;return t.length<o&&(t=t.concat(Array(o-t.length).fill(i))),t}),aA.createByArray(c)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return al.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};k(cw,"Textsplit");let cF=[[cy,cS.CONCAT],[cR,cS.CONCATENATE],[cV,cS.LEN],[cI,cS.LENB],[cM,cS.LOWER],[cx,cS.MID],[cv,cS.REPT],[cD,cS.TEXT],[cL,cS.TEXTAFTER],[cP,cS.TEXTBEFORE],[cw,cS.TEXTSPLIT],[cT,cS.LEFTB]],cj=[],cB=[];var ck=((x=ck||{}).ENCODEURL="ENCODEURL",x.FILTERXML="FILTERXML",x.WEBSERVICE="WEBSERVICE",x);function c$(e,t,r,a,n,i,s){let u=(null==s?void 0:s.f)||"",l=(null==s?void 0:s.si)||"",o=(0,P.isFormulaString)(u),c=(0,P.isFormulaId)(l),h=e.getValue(n,i),m=(null==h?void 0:h.f)||"",f=(null==h?void 0:h.si)||"";function g(){var e;if((0,P.isFormulaString)(m)&&(0,P.isFormulaId)(f)){let t=null==(e=r.get(f))?void 0:e.f;t?a.set(f,t):a.set(f,m)}}k(g,"clearFormulaData"),o&&c?(f!==l&&g(),e.setValue(n,i,{f:u,si:l}),r.set(l,{f:u,r:n,c:i}),t.setValue(n,i,{f:u,si:l})):o&&!c?(m!==u&&g(),e.setValue(n,i,{f:u}),t.setValue(n,i,{f:u})):!o&&c?(f!==l&&g(),e.setValue(n,i,{f:"",si:l})):!o&&!c&&e.getValue(n,i)&&(g(),e.realDeleteValue(n,i),t.setValue(n,i,null))}function cH(e,t,r,a){let n=null==e?void 0:e.getValue(r,a);if(null==n)return!0;let{startRow:i,startColumn:s,endRow:u,endColumn:l}=n;for(let e=i;e<=u;e++)for(let r=s;r<=l;r++)t.realDeleteValue(e,r)}k(c$,"updateFormulaDataByCellValue"),k(cH,"clearArrayFormulaCellDataByCell");var cY,cG,cq,cW=Object.defineProperty,cQ=Object.getOwnPropertyDescriptor,cX=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?cQ(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&cW(t,r,i),i},"__decorateClass$m"),cK=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$m");let cz=(k(cq=class extends P.Disposable{constructor(e,t){super(),$(this,"_formulaData",{}),$(this,"_arrayFormulaRange",{}),$(this,"_arrayFormulaCellData",{}),this._univerInstanceService=e,this._lexerTreeBuilder=t,this.initFormulaData()}dispose(){super.dispose(),this._formulaData={},this._arrayFormulaRange={},this._arrayFormulaCellData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{var a,n,i,s;let u=r[e],l=null==(n=null==(a=this._arrayFormulaRange)?void 0:a[t])?void 0:n[e];if(null==l)return!0;let o=new P.ObjectMatrix;(null==(i=this._arrayFormulaCellData[t])?void 0:i[e])!=null&&(o=new P.ObjectMatrix(null==(s=this._arrayFormulaCellData[t])?void 0:s[e])),u.forValue((e,t)=>{var r;let a=null==(r=null==l?void 0:l[e])?void 0:r[t];if(null==a)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:u}=a;for(let e=n;e<=s;e++)for(let t=i;t<=u;t++)o.setValue(e,t,null)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=o.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;null==this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t]={}),null==this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(e=>{var a,n;let i=r[e],s=new P.ObjectMatrix(null==(a=this._arrayFormulaRange[t])?void 0:a[e]),u=new P.ObjectMatrix(null==(n=this._arrayFormulaCellData[t])?void 0:n[e]);i.forValue((e,t)=>{let r=null==s?void 0:s.getValue(e,t);if(null==r)return!0;let{startRow:a,startColumn:n,endRow:i,endColumn:l}=r;for(let e=a;e<=i;e++)for(let t=n;t<=l;t++)u.setValue(e,t,null)}),i.forValue((e,t,r)=>{u.setValue(e,t,r)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=u.getData())})})}getFormulaData(){return this._formulaData}setFormulaData(e){this._formulaData=e}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(e=>{var a;let n=new P.ObjectMatrix(r[e]),i=new P.ObjectMatrix(null==(a=this._arrayFormulaRange[t])?void 0:a[e]);n.forValue((e,t,r)=>{i.setValue(e,t,r)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][e]=i.getData())})})}mergeFormulaData(e){Object.keys(e).forEach(t=>{let r=e[t];if(void 0!==r){if(null===r){delete this._formulaData[t];return}this._formulaData[t]||(this._formulaData[t]={}),Object.keys(r).forEach(e=>{var a,n;let i=r[e];if(void 0===i)return;if(null===i){null==(a=this._formulaData[t])||delete a[e];return}let s=new P.ObjectMatrix(i),u=new P.ObjectMatrix((null==(n=this._formulaData[t])?void 0:n[e])||{});s.forValue((e,t,r)=>{null==r?u.realDeleteValue(e,t):u.setValue(e,t,r)}),this._formulaData[t][e]=u.clone()})}})}deleteArrayFormulaRange(e,t,r,a){var n;let i=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(null==i)return;let s=new P.ObjectMatrix(i);s.getValue(r,a)&&(s.realDeleteValue(r,a),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=s.getData()))}initFormulaData(){if(0===this._univerInstanceService.getAllUnitsForType(P.UniverInstanceType.UNIVER_SHEET).length)return;let e=this._univerInstanceService.getCurrentUnitForType(P.UniverInstanceType.UNIVER_SHEET),t=e.getUnitId();this._formulaData[t]={},e.getSheets().forEach(e=>{let r=e.getCellMatrix(),a=e.getSheetId();cZ(this._formulaData,t,a,r)})}getCalculateData(){let e=this._univerInstanceService.getAllUnitsForType(P.UniverInstanceType.UNIVER_SHEET),t={},r={};for(let a of e){let e=a.getUnitId(),n=a.getSheets(),i={},s={};for(let e of n){let t=e.getSheetId(),r=e.getConfig();i[t]={cellData:new P.ObjectMatrix(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},s[e.getName()]=e.getSheetId()}t[e]=i,r[e]=s}return{allUnitData:t,unitSheetNameMap:r}}updateFormulaData(e,t,r){let a=new P.ObjectMatrix(r),n=this.getFormulaIdMap(e,t),i=/* @__PURE__ */new Map,s=this._formulaData;null==s[e]&&(s[e]={});let u=s[e];null==u[t]&&(u[t]={});let l=new P.ObjectMatrix(u[t]||{}),o=new P.ObjectMatrix;return a.forValue((e,t,r)=>{c$(l,o,n,i,e,t,r)}),l.forValue((e,t,r)=>{let a=(null==r?void 0:r.f)||"",s=(null==r?void 0:r.si)||"";if((0,P.isFormulaId)(s)){let u=n.get(s),c=i.get(s);if(u&&!(0,P.isFormulaString)(a)){let r=u.f,a=t-u.c,n=e-u.r;l.setValue(e,t,{f:r,si:s,x:a,y:n}),o.setValue(e,t,{f:r,si:s,x:a,y:n})}else if("string"==typeof c){let a=(null==r?void 0:r.x)||0,n=(null==r?void 0:r.y)||0,u=this._lexerTreeBuilder.moveFormulaRefOffset(c,a,n);i.set(s,{r:e,c:t,f:u}),l.setValue(e,t,{f:u,si:s}),o.setValue(e,t,{f:u,si:s})}else if("object"==typeof c){let r=t-c.c,a=e-c.r;l.setValue(e,t,{f:c.f,si:s,x:r,y:a}),o.setValue(e,t,{f:c.f,si:s,x:r,y:a})}}}),o.clone()}updateArrayFormulaRange(e,t,r){var a;let n=null==(a=this._arrayFormulaRange[e])?void 0:a[t];if(!n)return;let i=new P.ObjectMatrix(n);new(0,P.ObjectMatrix)(r).forValue((e,t,r)=>{i.realDeleteValue(e,t)})}updateArrayFormulaCellData(e,t,r){var a,n;let i=null==(a=this._arrayFormulaRange[e])?void 0:a[t];if(!i)return;let s=new P.ObjectMatrix(i),u=null==(n=this._arrayFormulaCellData[e])?void 0:n[t];if(!u)return;let l=new P.ObjectMatrix(u);new(0,P.ObjectMatrix)(r).forValue((e,t,r)=>{cH(s,l,e,t)})}getFormulaItemBySId(e,t,r){let a=this._formulaData;if(null==a[r])return null;let n=a[r];if((null==n?void 0:n[t])==null)return null;let i=new P.ObjectMatrix(n[t]||{}),s=null;return i.forValue((t,r,a)=>{if(null==a)return!0;let{f:n,si:i,x:u=0,y:l=0}=a;if(i===e&&n.length>0&&0===u&&0===l)return s=a,!1}),s}getFormulaDataItem(e,t,r,a){var n,i,s,u;return null==(u=null==(s=null==(i=null==(n=this._formulaData)?void 0:n[a])?void 0:i[r])?void 0:s[e])?void 0:u[t]}getFormulaIdMap(e,t){let r=/* @__PURE__ */new Map,a=this._formulaData;if(null==a[e])return r;let n=a[e];return(null==n?void 0:n[t])==null||new(0,P.ObjectMatrix)(n[t]||{}).forValue((e,t,a)=>{let n=(null==a?void 0:a.f)||"",i=(null==a?void 0:a.si)||"",s=(null==a?void 0:a.x)||0,u=(null==a?void 0:a.y)||0;(0,P.isFormulaString)(n)&&(0,P.isFormulaId)(i)&&0===s&&0===u&&r.set(i,{f:n,r:e,c:t})}),r}getFormulaStringByCell(e,t,r,a){let n=this.getFormulaDataItem(e,t,r,a);if(null==n)return null;let{f:i,si:s,x:u=0,y:l=0}=n;if(null!=s&&(0!==u||0!==l)){let e="";if(i.length>0)e=i;else{let t=this.getFormulaItemBySId(s,r,a);if(null==t||0===t.f.length)return null;e=t.f}return this._lexerTreeBuilder.moveFormulaRefOffset(e,u,l)}return(0,P.isFormulaString)(i)?i:null}},"FormulaDataModel"),cq);function cZ(e,t,r,a){let n=/* @__PURE__ */new Map,i=new P.ObjectMatrix;a.forValue((e,t,r)=>{let a=(null==r?void 0:r.f)||"",s=(null==r?void 0:r.si)||"",u=(0,P.isFormulaString)(a),l=(0,P.isFormulaId)(s);u&&l?(i.setValue(e,t,{f:a,si:s}),n.set(s,{f:a,r:e,c:t})):u&&!l?i.setValue(e,t,{f:a}):!u&&l&&i.setValue(e,t,{f:"",si:s})}),i.forValue((e,t,r)=>{let a=(null==r?void 0:r.f)||"",s=(null==r?void 0:r.si)||"";if((0,P.isFormulaId)(s)&&!(0,P.isFormulaString)(a)){let r=n.get(s);if(r){let a=r.f,n=t-r.c,u=e-r.r;i.setValue(e,t,{f:a,si:s,x:n,y:u})}else i.realDeleteValue(e,t)}}),e[t]||(e[t]={});let s=i.clone();return e[t][r]=s,{[t]:{[r]:s}}}cz=cX([cK(0,P.IUniverInstanceService),cK(1,(0,P.Inject)(e0))],cz),k(cZ,"initSheetFormulaData");let cJ={id:"formula.mutation.set-array-formula-data",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k((e,t)=>!0,"handler")},c0={id:"formula.mutation.set-formula-calculation-start",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},c1={id:"formula.mutation.set-formula-calculation-stop",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},c2={id:"formula.mutation.set-formula-calculation-notification",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},c3={id:"formula.mutation.set-formula-calculation-result",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},c5={id:"formula.mutation.set-formula-data",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k((e,t)=>!0,"handler")},c4=class extends P.Disposable{constructor(){super(),$(this,"_definedNameMap",{}),$(this,"_update$",new w.Subject),$(this,"update$",this._update$.asObservable()),$(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}}),$(this,"_currentRange$",new w.Subject),$(this,"currentRange$",this._currentRange$.asObservable()),$(this,"_focusRange$",new w.Subject),$(this,"focusRange$",this._focusRange$.asObservable())}dispose(){this._definedNameMap={}}focusRange(e,t){let r=this.getValueById(e,t);null!=r&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return eP(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._update()}registerDefinedName(e,t){null==this._definedNameMap[e]&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._update()}removeDefinedName(e,t){var r;null==(r=this._definedNameMap[e])||delete r[t],this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){var r;let a=this._definedNameMap[e];return null==a?null:null==(r=Array.from(Object.values(a)).filter(e=>e.name===t))?void 0:r[0]}getValueById(e,t){var r;return null==(r=this._definedNameMap[e])?void 0:r[t]}hasDefinedName(e){return null!=this._definedNameMap[e]&&0!==(Array.from(Object.values(this._definedNameMap[e])).length||0)}_update(){this._update$.next(null)}};k(c4,"DefinedNamesService");let c6=(0,P.createIdentifier)("univer.formula.defined-names.service");var c7,c9=Object.defineProperty,c8=Object.getOwnPropertyDescriptor,he=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?c8(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&c9(t,r,i),i},"__decorateClass$l"),ht=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$l");let hr=(k(c7=class extends P.Disposable{constructor(e){super(),$(this,"_unitData",{}),$(this,"_unitStylesData",{}),$(this,"_arrayFormulaCellData",{}),$(this,"_formulaData",{}),$(this,"_sheetNameMap",{}),$(this,"_forceCalculate",!1),$(this,"_dirtyRanges",[]),$(this,"_dirtyNameMap",{}),$(this,"_dirtyDefinedNameMap",{}),$(this,"_dirtyUnitFeatureMap",{}),$(this,"_dirtyUnitOtherFormulaMap",{}),$(this,"_excludedCell"),$(this,"_sheetIdToNameMap",{}),$(this,"_executeUnitId",""),$(this,"_executeSubUnitId",""),this._univerInstanceService=e}dispose(){this._unitData={},this._unitStylesData={},this._formulaData={},this._arrayFormulaCellData={},this._sheetNameMap={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._excludedCell={},this._sheetIdToNameMap={},this._dirtyUnitOtherFormulaMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return null==this._sheetIdToNameMap[e]?"":this._sheetIdToNameMap[e][t]||""}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{let{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t}this._formulaData=e.formulaData,this._arrayFormulaCellData=el(e.arrayFormulaCellData),this._forceCalculate=e.forceCalculate,this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(a=>{null==e[r]&&(e[r]={}),e[r][t[r][a]]=a})}),this._sheetIdToNameMap={},Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(r=>{null==this._sheetIdToNameMap[t]&&(this._sheetIdToNameMap[t]={}),this._sheetIdToNameMap[t][e[t][r]]=r})})}_loadSheetData(){let e=this._univerInstanceService.getAllUnitsForType(P.UniverInstanceType.UNIVER_SHEET),t=this._univerInstanceService.getCurrentUnitForType(P.UniverInstanceType.UNIVER_SHEET),r=null==t?void 0:t.getActiveSheet();this._executeUnitId=null==t?void 0:t.getUnitId(),this._executeSubUnitId=null==r?void 0:r.getSheetId();let a={},n={},i={};for(let t of e){let e=t.getUnitId(),r=t.getSheets(),s={},u={};for(let e of r){let t=e.getSheetId(),r=e.getConfig();s[t]={cellData:new P.ObjectMatrix(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},u[e.getName()]=e.getSheetId()}a[e]=s,n[e]=t.getStyles(),i[e]=u}return{allUnitData:a,unitStylesData:n,unitSheetNameMap:i}}},"FormulaCurrentConfigService"),c7);hr=he([ht(0,P.IUniverInstanceService)],hr);let ha=(0,P.createIdentifier)("univer.formula.current-data.service");var hn,hi=Object.defineProperty,hs=Object.getOwnPropertyDescriptor,hu=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?hs(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&hi(t,r,i),i},"__decorateClass$k"),hl=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$k");let ho=(k(hn=class extends P.Disposable{constructor(e,t,r){super(),this._definedNamesService=e,this._lexerTreeBuilder=t,this._formulaCurrentConfigService=r}treeBuilder(e,t=!0){return this._lexerTreeBuilder.treeBuilder(e,t,this._injectDefinedName.bind(this),this._simpleCheckDefinedName.bind(this))}_simpleCheckDefinedName(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let a=Object.keys(t[r]);for(let t=0,r=a.length;t<r;t++){let r=a[t];if(e.indexOf(r)>-1)return!0}}return!1}_checkDefinedNameDirty(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let a=Object.keys(t[r]);for(let t=0,r=a.length;t<r;t++)if(a[t]===e)return!0}return!1}_injectDefinedName(e){let t=this._formulaCurrentConfigService.getExecuteUnitId();if(null==t)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};let r=this._lexerTreeBuilder.getSequenceNode(e),a="",n=!1,i=[];for(let e=0,s=r.length;e<s;e++){let s=r[e];if("string"==typeof s){a+=s;continue}let{nodeType:u,token:l}=s;if(u===eI.REFERENCE||u===eI.FUNCTION){let e=this._definedNamesService.getValueByName(t,l);if(e){let t=e.formulaOrRefString;t.substring(0,1)===Q.EQUALS&&(t=t.substring(1)),a+=t,i.push(e.name),n=!0}else this._checkDefinedNameDirty(l)?(a+=Y.NAME,n=!0,i.push(l)):a+=l}else a+=l}return{sequenceString:a,hasDefinedName:n,definedNames:i}}},"Lexer"),hn);ho=hu([hl(0,c6),hl(1,(0,P.Inject)(e0)),hl(2,ha)],ho);var hc,hh=Object.defineProperty,hm=Object.getOwnPropertyDescriptor,hf=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?hm(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&hh(t,r,i),i},"__decorateClass$j"),hg=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$j"),hd=((v=hd||{})[v.IDLE=0]="IDLE",v[v.START_DEPENDENCY=1]="START_DEPENDENCY",v[v.START_CALCULATION=2]="START_CALCULATION",v[v.CURRENTLY_CALCULATING=3]="CURRENTLY_CALCULATING",v[v.START_DEPENDENCY_ARRAY_FORMULA=4]="START_DEPENDENCY_ARRAY_FORMULA",v[v.START_CALCULATION_ARRAY_FORMULA=5]="START_CALCULATION_ARRAY_FORMULA",v[v.CURRENTLY_CALCULATING_ARRAY_FORMULA=6]="CURRENTLY_CALCULATING_ARRAY_FORMULA",v[v.CALCULATION_COMPLETED=7]="CALCULATION_COMPLETED",v),hN=((U=hN||{})[U.INITIAL=0]="INITIAL",U[U.STOP_EXECUTION=1]="STOP_EXECUTION",U[U.NOT_EXECUTED=2]="NOT_EXECUTED",U[U.SUCCESS=3]="SUCCESS",U);let h_=(k(hc=class extends P.Disposable{constructor(e){super(),$(this,"_formulaExecuteStage",0),$(this,"_stopState",!1),$(this,"_currentRow",-1),$(this,"_currentColumn",-1),$(this,"_currentRowCount",Number.NEGATIVE_INFINITY),$(this,"_currentColumnCount",Number.NEGATIVE_INFINITY),$(this,"_currentSubUnitId",""),$(this,"_currentUnitId",""),$(this,"_runtimeData",{}),$(this,"_runtimeOtherData",{}),$(this,"_unitArrayFormulaRange",{}),$(this,"_runtimeArrayFormulaCellData",{}),$(this,"_runtimeClearArrayFormulaCellData",{}),$(this,"_runtimeFeatureRange",{}),$(this,"_runtimeFeatureCellData",{}),$(this,"_functionsExecutedState",0),$(this,"_functionDefinitionPrivacyVar",/* @__PURE__ */new Map),$(this,"_totalFormulasToCalculate",0),$(this,"_completedFormulasCount",0),$(this,"_totalArrayFormulasToCalculate",0),$(this,"_completedArrayFormulasCount",0),$(this,"_formulaCycleIndex",0),$(this,"_isCycleDependency",!1),this._currentConfigService=e}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={}}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0}setCurrent(e,t,r,a,n,i){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=a,this._currentSubUnitId=n,this._currentUnitId=i}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t){let r=this._currentSubUnitId,a=this._currentUnitId;void 0===this._runtimeOtherData[a]&&(this._runtimeOtherData[a]={});let n=this._runtimeOtherData[a];void 0===n[r]&&(n[r]={});let i=n[r],s=[];if(t.isReferenceObject()||t.isValueObject()&&t.isArray()){let{startRow:e,startColumn:r}=t.getRangePosition();t.iterator((t,a,n)=>{let i=aQ(t),u=a-e;null==s[u]&&(s[u]=[]),s[u][n-r]=i})}else s=[[aQ(t)]];i[e]=s}setRuntimeData(e){let t=this._currentRow,r=this._currentColumn,a=this._currentRowCount,n=this.currentColumnCount,i=this._currentSubUnitId,s=this._currentUnitId;null==this._runtimeData[s]&&(this._runtimeData[s]={});let u=this._runtimeData[s];null==u[i]&&(u[i]=new P.ObjectMatrix),null==this._unitArrayFormulaRange[s]&&(this._unitArrayFormulaRange[s]={});let l=this._unitArrayFormulaRange[s],o=new P.ObjectMatrix;l[i]&&(o=new P.ObjectMatrix(l[i])),void 0===this._runtimeArrayFormulaCellData[s]&&(this._runtimeArrayFormulaCellData[s]={});let c=this._runtimeArrayFormulaCellData[s];null==c[i]&&(c[i]=new P.ObjectMatrix),void 0===this._runtimeClearArrayFormulaCellData[s]&&(this._runtimeClearArrayFormulaCellData[s]={});let h=this._runtimeClearArrayFormulaCellData[s];null==h[i]&&(h[i]=new P.ObjectMatrix);let m=u[i],f=c[i],g=h[i];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){let{startRow:u,startColumn:c,endRow:h,endColumn:d}=e.getRangePosition();if(u===h&&c===d){let a=aQ(e.getFirstCell());m.setValue(t,r,a),g.setValue(t,r,a);return}let N={startRow:t,startColumn:r,endRow:h-u+t,endColumn:d-c+r};if(o.setValue(t,r,N),l[i]=o.getData(),this._checkIfArrayFormulaRangeHasData(s,i,t,r,N)||this._checkIfArrayFormulaExceeded(a,n,N)){let a=aQ(td.create(Y.SPILL));m.setValue(t,r,a),g.setValue(t,r,a);let n=this._currentConfigService.getUnitData();e.iterator((e,l,o)=>{var h,m;let g=l-u+t,d=o-c+r,N=null==(m=null==(h=n[s])?void 0:h[i])?void 0:m.cellData.getValue(g,d);l===u&&o===c?f.setValue(t,r,a):null!=N?(null==N.v&&(N.v=""),f.setValue(g,d,N)):f.setValue(g,d,{v:""})})}else{let a=td.create(Y.SPILL);e.iterator((e,n,i)=>{let s=aQ(e);if(n===u&&i===c){if(null!=e&&e.isError()&&e.isEqualType(a))return g.setValue(t,r,{}),m.setValue(t,r,{...aQ(a)}),!1;m.setValue(t,r,{...s})}let l=n-u+t,o=i-c+r;f.setValue(l,o,s)})}}else{let a=aQ(e);m.setValue(t,r,a),g.setValue(t,r,a)}}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}_checkIfArrayFormulaRangeHasData(e,t,r,a,n){var i,s,u,l,o,c,h,m,f,g,d,N;let{startRow:_,startColumn:E,endRow:C,endColumn:p}=n,A=this._currentConfigService.getUnitData(),b=null==(u=null==(s=null==(i=this._unitArrayFormulaRange[e])?void 0:i[t])?void 0:s[r])?void 0:u[a];for(let n=_;n<=C;n++)for(let i=E;i<=p;i++){if(n===r&&a===i)continue;let s=null==(c=null==(o=null==(l=this._runtimeData)?void 0:l[e])?void 0:o[t])?void 0:c.getValue(n,i),u=null==(f=null==(m=null==(h=this._runtimeArrayFormulaCellData)?void 0:h[e])?void 0:m[t])?void 0:f.getValue(n,i),_=null==(N=null==(d=null==(g=null==A?void 0:A[e])?void 0:g[t])?void 0:d.cellData)?void 0:N.getValue(n,i),E=this._getRuntimeFeatureCellValue(n,i,t,e);if(!(0,P.isNullCell)(s)||!(0,P.isNullCell)(u)&&!this._isInArrayFormulaRange(b,n,i)||!(0,P.isNullCell)(_)||!(0,P.isNullCell)(E))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,a){return e5(e,t,r,a,this._runtimeFeatureCellData)}_isInArrayFormulaRange(e,t,r){if(null==e)return!1;let{startRow:a,startColumn:n,endRow:i,endColumn:s}=e;return t>=a&&t<=i&&r>=n&&r<=s}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,a){let n=this._currentConfigService.getDirtyRanges();return 0===n.length||H(n,e,t,r,a)}},"FormulaRuntimeService"),hc);h_=hf([hg(0,ha)],h_);let hE=(0,P.createIdentifier)("univer.formula.runtime.service");var hC=((D=hC||{}).REFERENCE="ReferenceNode",D.VALUE="ValueNode",D.OPERATOR="OperatorNode",D.FUNCTION="FunctionNode",D.LAMBDA="LambdaNode",D.LAMBDA_PARAMETER="LambdaNodeParameter",D.ERROR="ErrorNode",D.BASE="Base",D.ROOT="Root",D.UNION="UnionNode",D.PREFIX="PrefixNode",D.SUFFIX="SuffixNode",D.NULL="NullNode",D);let hp=/* @__PURE__ */new Map([["ReferenceNode",7],["ValueNode",9],["OperatorNode",8],["FunctionNode",6],["LambdaNode",1],["LambdaNodeParameter",2],["Root",10],["UnionNode",3],["PrefixNode",4],["SuffixNode",5]]),hA=class extends P.Disposable{constructor(e){super(),$(this,"_children",[]),$(this,"_definedNames",[]),$(this,"_parent"),$(this,"_valueObject"),$(this,"_calculateState",!1),$(this,"_async",!1),$(this,"_address",!1),$(this,"_refOffsetX",0),$(this,"_refOffsetY",0),this._token=e}dispose(){var e;this._children.forEach(e=>{e.dispose()}),null==(e=this._valueObject)||e.dispose(),this._parent=null}get nodeType(){return hC.BASE}isAsync(){return this._async}isAddress(){return this._address}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(e){this._parent=e,e.addChildren(this)}getChildren(){return this._children}addChildren(...e){this._children.push(...e)}getToken(){return this._token}setValue(e){this._valueObject=e}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(e=!0){}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}async executeAsync(){return Promise.resolve(e6.SUCCESS)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],a=t.length;for(let e=0;e<a;e++){let a=t[e];r.push(a.serialize())}let n={token:e,nodeType:this.nodeType};return a>0&&(n.children=r),n}hasDefinedName(e){return this._definedNames.includes(e)}setDefinedNames(e){this._definedNames=e}};k(hA,"BaseAstNode");let hb=hA,hy=class e extends hb{constructor(e){super(e),$(this,"_errorValueObject"),this._errorValueObject=td.create(e)}get nodeType(){return hC.ERROR}static create(t){return new e(t)}getValue(){return this._errorValueObject}};k(hy,"ErrorNode");let hR=class extends P.Disposable{get zIndex(){return 0}create(e,t,r){return new hb(e instanceof ef?e.getToken():e)}};k(hR,"BaseAstNodeFactory");let hS=hR,hO=class extends hb{get nodeType(){return hC.ROOT}execute(){let e=this.getChildren();if(e.length>1){this.setValue(td.create(Y.VALUE));return}let t=e[0];null==t?this.setValue(td.create(Y.VALUE)):this.setValue(t.getValue())}};k(hO,"AstRootNode");let hT=class extends hS{get zIndex(){return hp.get(hC.ROOT)||100}checkAndCreateNodeType(e){if(e instanceof ef&&"R_1"===e.getToken())return new hO("R_1")}};k(hT,"AstRootNodeFactory");let hV=(0,P.createIdentifier)("univer.formula-function.service"),hI=class extends P.Disposable{constructor(){super(...arguments),$(this,"_functionExecutors",/* @__PURE__ */new Map),$(this,"_functionDescriptions",/* @__PURE__ */new Map)}dispose(){this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.set(r.functionName,r)}return(0,P.toDisposable)(()=>{for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r)}}};k(hI,"FunctionService");var hM=Object.defineProperty,hx=Object.getOwnPropertyDescriptor,hv=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?hx(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&hM(t,r,i),i},"__decorateClass$i"),hU=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$i");let hD=class extends hb{constructor(e,t,r){super(t),this._accessor=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return hC.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._operatorString===er.MINUS?this._functionExecutor.calculate(ah.create(0),e):this._operatorString===er.AT?this._handlerAT(e):td.create(Y.VALUE),this.setValue(t)}_handlerAT(e){if(!e.isReferenceObject()||e.isCell())return td.create(Y.VALUE);let t=this._accessor.get(hE),r=t.currentRow||0,a=t.currentColumn||0;return e.isRow()?e.getCellByColumn(a):e.isColumn()?e.getCellByRow(r):e.isRange()||e.isTable()?e.getCellByPosition():td.create(Y.VALUE)}};k(hD,"PrefixNode");let hL=(k(hH=class extends hS{constructor(e,t){super(),this._functionService=e,this._injector=t}get zIndex(){return hp.get(hC.PREFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof ef))return;let t=e.getToken(),r=t.trim();if('"'===r.charAt(0)&&'"'===r.charAt(r.length-1))return;let a="";if(r!==er.MINUS)return r===er.AT?new hD(this._injector,r):void 0;a=o2.MINUS;let n=this._functionService.getExecutor(a);return n?new hD(this._injector,r,n):(console.error(`No function ${t}`),hy.create(Y.NAME))}},"PrefixNodeFactory"),hH);function hP(e,t,r){let a,n;let i=e.slice(0,2),s=0;if(RegExp(er.MINUS,"g").test(i)){let e=t.getExecutor(o2.MINUS);a=new hD(r,er.MINUS,e),s++}return RegExp(er.AT,"g").test(i)&&(n=new hD(r,er.AT),a&&n.setParent(a),s++),s>0&&(e=e.slice(s)),{tokenTrim:e,minusPrefixNode:a,atPrefixNode:n}}hL=hv([hU(0,hV),hU(1,(0,P.Inject)(P.Injector))],hL),k(hP,"prefixHandler");var hw=Object.defineProperty,hF=Object.getOwnPropertyDescriptor,hj=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?hF(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&hw(t,r,i),i},"__decorateClass$h"),hB=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$h");let hk=class extends hb{constructor(e,t,r,a,n){super(e),this._functionExecutor=t,this._currentConfigService=r,this._runtimeService=a,this._definedNamesService=n,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress()}get nodeType(){return hC.FUNCTION}async executeAsync(){let e;let t=[],r=this.getChildren(),a=r.length;this._compatibility();for(let e=0;e<a;e++){let a=r[e].getValue();null!=a&&(a.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?t.push(a.toArrayValueObject()):t.push(a))}let n=this._calculate(t);return e=n.isAsyncObject()||n.isAsyncArrayObject()?await n.getValue():n,this._setRefData(e),this.setValue(e),Promise.resolve(e6.SUCCESS)}execute(){let e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let a=0;a<r;a++){let r=t[a].getValue();null!=r&&(r.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(r.toArrayValueObject()):e.push(r))}let a=this._calculate(e);this._setRefData(a),this.setValue(a)}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){let e=this.getChildren(),t=e.length;if(!this._functionExecutor.needsExpandParams||3!==t)return;let r=e[1].getValue(),a=e[2].getValue();if(!(null!=r&&r.isReferenceObject())&&!(null!=a&&a.isReferenceObject()))return;let n=r.getRangeData(),i=a.getRangeData(),{startRow:s,startColumn:u,endRow:l,endColumn:o}=n,c=l-s+1,h=o-u+1,{startRow:m,startColumn:f,endRow:g,endColumn:d}=i,N=g-m+1,_=d-f+1;c!==N&&(i.endRow+=c-N),h!==_&&(i.endColumn+=h-_)}_calculate(e){var t;let r;let{minParams:a,maxParams:n}=this._functionExecutor;if(-1!==a&&-1!==n&&(e.length<a||e.length>n))return td.create(Y.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let a=this._functionExecutor.calculateCustom(...e.map(e=>e.isArray()?e.toValue():e.getValue()));if("object"!=typeof a||null==a)r=ay.create(a);else{let e=aC(a);r=aA.create({calculateValueList:e,rowCount:e.length,columnCount:(null==(t=e[0])?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}}else this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction(),r=this._functionExecutor.calculate(...e);return r}_setDefinedNamesForFunction(){let e=this._currentConfigService.getExecuteUnitId();if(null==e)return;let t=this._definedNamesService.getDefinedNameMap(e);null!=t&&this._functionExecutor.setDefinedNames(t)}_setRefInfo(){let{currentUnitId:e,currentSubUnitId:t,currentRow:r,currentColumn:a}=this._runtimeService;this._functionExecutor.setRefInfo(e,t,r,a)}_setRefData(e){e.isReferenceObject()&&(e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData()))}};k(hk,"FunctionNode");let h$=(k(hY=class extends hS{constructor(e,t,r,a,n){super(),this._functionService=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=a,this._injector=n}get zIndex(){return hp.get(hC.FUNCTION)||100}create(e){let t=this._functionService.getExecutor(e);return t?new hk(e,t,this._currentConfigService,this._runtimeService,this._definedNamesService):(console.error(`No function ${e}`),hy.create(Y.NAME))}checkAndCreateNodeType(e){if("string"==typeof e)return;let{tokenTrim:t,minusPrefixNode:r,atPrefixNode:a}=hP(e.getToken().trim(),this._functionService,this._injector);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(e))return hy.create(Y.VALUE);let n=t.toUpperCase();if(this._functionService.hasExecutor(n)){let e=this.create(n);return a?e.setParent(a):r&&e.setParent(r),e}}_isParentUnionNode(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken())===J.COLON}},"FunctionNodeFactory"),hY);h$=hj([hB(0,hV),hB(1,ha),hB(2,hE),hB(3,c6),hB(4,(0,P.Inject)(P.Injector))],h$);var hH,hY,hG,hq=Object.defineProperty,hW=Object.getOwnPropertyDescriptor,hQ=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?hW(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&hq(t,r,i),i},"__decorateClass$g"),hX=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$g");let hK=(k(hG=class extends P.Disposable{constructor(e){super(),this._runtimeService=e}async executeAsync(e){if(!e)return td.create(Y.VALUE);await this._executeAsync(e);let t=e.getValue();if(null==t)throw Error("node value is null");return Promise.resolve(t)}execute(e){if(!e)return td.create(Y.VALUE);this._execute(e);let t=e.getValue();if(null==t)throw Error("node value is null");return t}executePreCalculateNode(e){return e.execute(),e.getValue()}checkAsyncNode(e){let t=[];this._checkAsyncNode(e,t);for(let e=0,r=t.length;e<r;e++)if(!0===t[e])return!0;return!1}_checkAsyncNode(e,t){let r=e.getChildren(),a=r.length;for(let e=0;e<a;e++){let a=r[e];t.push(a.isAsync()),this._checkAsyncNode(a,t)}}async _executeAsync(e){if(this._runtimeService.isStopExecution())return Promise.resolve(e6.ERROR);let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken().toUpperCase()===em&&r.isEmptyParamFunction()){r.execute();continue}await this._executeAsync(r)}return e.nodeType===hC.FUNCTION&&e.isAsync()?await e.executeAsync():e.execute(),Promise.resolve(e6.SUCCESS)}_execute(e){if(this._runtimeService.isStopExecution())return e6.ERROR;let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken().toUpperCase()===em&&r.isEmptyParamFunction()){r.execute();continue}this._execute(r)}return e.execute(),e6.SUCCESS}},"Interpreter"),hG);function hz(e){return e instanceof ef&&"L_1"===e.getToken()}function hZ(e){return e instanceof ef&&e.getToken()===eh}function hJ(e){if(!e)return;if(e.getToken()!==ec)return e;let t=e.getCurrentLambdaPrivacyVar(),r=e.getLambdaParameter();if(!t)return;let a=t.get(r);return null==a&&e.getValue()?e:hJ(a)}hK=hQ([hX(0,hE)],hK),k(hz,"isFirstChildParameter"),k(hZ,"isChildRunTimeParameter"),k(hJ,"getRootLexerHasValueNode");let h0=class e extends tm{constructor(e,t,r){super(0),$(this,"_lambdaPrivacyValueMap",/* @__PURE__ */new Map),this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(t,r,a){return new e(t,r,a)}isLambda(){return!0}execute(...e){let t;let r=this._lambdaPrivacyVarKeys.length;if(e.length!==r)return td.create(Y.VALUE);if(this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1),this._interpreter.checkAsyncNode(this._lambdaNode))t=new aT(this._interpreter.executeAsync(this._lambdaNode));else{let e=this._interpreter.execute(this._lambdaNode);t=e.isReferenceObject()?e.toArrayValueObject():e}return this._lambdaNode.setNotEmpty(!0),t}_setLambdaNodeValue(e){let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken()===ec){let e=r.getLambdaParameter(),t=this._lambdaPrivacyValueMap.get(e);if(t)r.setValue(t);else{let t=hJ(r.getCurrentLambdaPrivacyVar().get(e));null!=t&&r.setValue(t.getValue())}continue}this._setLambdaNodeValue(r)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){let r=e[t],a=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(a,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}};k(h0,"LambdaValueObjectObject");var h1=Object.defineProperty,h2=Object.getOwnPropertyDescriptor,h3=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?h2(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&h1(t,r,i),i},"__decorateClass$f"),h5=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$f");let h4=class extends hb{constructor(e,t,r,a){super(e),$(this,"_isNotEmpty",!0),this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=a}get nodeType(){return hC.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return null===this._lambdaId}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(h0.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{let e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}}};k(h4,"LambdaNode");let h6=(k(mx=class extends hS{constructor(e,t){super(),this._runtimeService=e,this._interpreter=t}get zIndex(){return hp.get(hC.LAMBDA)||100}create(e){let t=e.getChildren(),r=t[0],a=t.slice(1,-1),n=t[t.length-1];if(!(r instanceof ef&&n instanceof ef))return hy.create(Y.NAME);if("L_1"===r.getToken()){let e=r.getChildren();if(a.length!==e.length)return hy.create(Y.VALUE)}else a=t.slice(0,-1);let i=(0,P.Tools).generateRandomId(8),s=/* @__PURE__ */new Map;for(let e=0;e<a.length;e++){let t=a[e];if(!(t instanceof ef))return hy.create(Y.VALUE);{let e=t.getChildren()[0];t.setToken(eh),s.set(e.trim(),void 0)}}return this._runtimeService.registerFunctionDefinitionPrivacyVar(i,s),this._updateLambdaStatement(n,i,s),new h4(e.getToken(),i,this._interpreter,[...s.keys()])}checkAndCreateNodeType(e){if(!(!(e instanceof ef)||e.getToken().trim().toUpperCase()!==em))return this.create(e)}_updateLambdaStatement(e,t,r){this._updateTree(e,t,r)}_updateTree(e,t,r){let a=e.getChildren(),n=a.length,i=a[0];for(let e=0;e<n;e++){let n=a[e];if(!(hz(i)&&0!==e)){if(n instanceof ef)this._updateTree(n,t,r);else{let i=n.trim();if(r.has(i)){let n=new ef;n.setToken(ec),n.setLambdaId(t),n.setLambdaPrivacyVar(r),n.setLambdaParameter(i),a[e]=n}}}}}},"LambdaNodeFactory"),mx);function h7(e){if(!e)return;if(e.getToken()!==ec)return e;let t=e.getCurrentLambdaPrivacyVar(),r=e.getLambdaParameter();if(t)return h7(t.get(r))}h6=h3([h5(0,hE),h5(1,(0,P.Inject)(hK))],h6),k(h7,"getRootLexerNode");let h9=class extends hb{constructor(e,t,r){super(e),this._lambdaParameter=t,this._currentLambdaPrivacyVar=r}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return hC.LAMBDA_PARAMETER}execute(){let e=h7(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(e)this.setValue(e.getValue());else{let e=this.getValue();(null==e||e.isError())&&this.setValue(td.create(Y.SPILL))}}};k(h9,"LambdaParameterNode");let h8=class extends hS{get zIndex(){return hp.get(hC.LAMBDA_PARAMETER)||100}create(e){let t=e.getFunctionDefinitionPrivacyVar(),r=e.getLambdaParameter();return t?new h9(e.getToken(),r,t):new hy(Y.SPILL)}checkAndCreateNodeType(e){if(!(!(e instanceof ef)||e.getToken().trim()!==ec))return this.create(e)}};k(h8,"LambdaParameterNodeFactory");let me=class extends hb{constructor(e){super(e),this._operatorString=e}get nodeType(){return hC.NULL}execute(){this.setValue(as.create())}};k(me,"NullNode");var mt=Object.defineProperty,mr=Object.getOwnPropertyDescriptor,ma=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?mr(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&mt(t,r,i),i},"__decorateClass$e"),mn=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$e");let mi=class extends hb{constructor(e,t){super(e),this._operatorString=e,this._functionExecutor=t}get nodeType(){return hC.OPERATOR}execute(){var e,t;let r=this.getChildren();this._functionExecutor.name===o2.COMPARE&&this._functionExecutor.setCompareType(this.getToken());let a=null==(e=r[0])?void 0:e.getValue(),n=null==(t=r[1])?void 0:t.getValue(),i=this.getToken();if((null==a||null==n)&&i!==Q.MINUS&&i!==Q.PLUS){this.setValue(td.create(Y.VALUE));return}null==a&&(a=as.create()),null==n&&(n=as.create()),a.isReferenceObject()&&(a=a.toArrayValueObject()),n.isReferenceObject()&&(n=n.toArrayValueObject()),this.setValue(this._functionExecutor.calculate(a,n))}};k(mi,"OperatorNode");let ms=(k(mv=class extends hS{constructor(e){super(),this._functionService=e}get zIndex(){return hp.get(hC.OPERATOR)||100}create(e){let t="";e===Q.PLUS?t=o2.PLUS:e===Q.MINUS?t=o2.MINUS:e===Q.MULTIPLY?t=o2.MULTIPLY:e===Q.DIVIDED?t=o2.DIVIDED:e===Q.CONCATENATE?t=cS.CONCATENATE:e===Q.POWER?t=on.POWER:Z.has(e)&&(t=o2.COMPARE);let r=this._functionService.getExecutor(t);return r?new mi(e,r):(console.error(`No function ${e}`),hy.create(Y.NAME))}checkAndCreateNodeType(e){if(e instanceof ef)return;let t=e.trim();if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))&&z.has(t))return this.create(t)}},"OperatorNodeFactory"),mv);ms=ma([mn(0,hV)],ms);let mu=class extends P.Disposable{constructor(){super(...arguments),$(this,"_tableMap",/* @__PURE__ */new Map),$(this,"_tableOptionMap",/* @__PURE__ */new Map)}dispose(){this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;null==(r=this._tableMap.get(e))||r.delete(t)}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var a;null==this._tableMap.get(e)&&this._tableMap.set(e,/* @__PURE__ */new Map),null==(a=this._tableMap.get(e))||a.set(t,r)}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}};k(mu,"SuperTableService");let ml=(0,P.createIdentifier)("univer.formula.super-table.service"),mo=class extends aO{constructor(e,t,r,a){super(e),this._tableData=t,this._columnDataString=r;let n=this._tableData.sheetId,i=this._tableData.range,s=this._tableData.titleMap;this.setForcedSheetIdDirect(n);let u=this._stringToColumnData(this._columnDataString,s,a),l=u.startColumn,o=u.endColumn,c=u.type,h=-1,m=-1,f=i.startRow,g=i.startColumn;c===e7.ALL?(h=f,m=g):c===e7.DATA?(h=f+1,m=g):c===e7.HEADERS?(h=f,m=f):c===e7.TOTALS&&(h=g,m=g),this.setRangeData({startColumn:l,endColumn:o,startRow:h,endRow:m})}isTable(){return!0}_stringToColumnData(e,t,r){let a=(e=e.substring(1,-1)).indexOf(J.COMMA),n=-1,i=-1,s=e7.ALL;if(-1===a){let r=this._columnHandler(e,t);n=r.startColumn,i=r.endColumn}else{let u=e.substring(0,a).substring(1,-1),l=e.substring(a+1),o=this._columnHandler(l,t,!0);n=o.startColumn,i=o.endColumn,(s=r.get(u))||(s=e7.ALL)}return{startColumn:n,endColumn:i,type:s}}_columnHandler(e,t,r=!1){var a,n,i;let s=-1,u=-1,l=e.indexOf(J.COLON);if(RegExp(eT,"g").test(e)){let r=e.substring(0,l).substring(1,-1),i=e.substring(l+1).substring(1,-1);s=null!=(a=t.get(r))?a:-1,u=null!=(n=t.get(i))?n:-1}else r&&(e=e.substring(1,-1)),u=s=null!=(i=t.get(e))?i:-1;return{startColumn:s,endColumn:u}}};k(mo,"TableReferenceObject");var mc=Object.defineProperty,mh=Object.getOwnPropertyDescriptor,mm=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?mh(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&mc(t,r,i),i},"__decorateClass$d"),mf=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$d");let mg=class extends hb{constructor(e,t,r,a=!1){super(t),this._accessor=e,this._operatorString=t,this._referenceObject=r,this._isPrepareMerge=a}get nodeType(){return hC.REFERENCE}execute(){let e=this._accessor.get(ha),t=this._accessor.get(hE);this._referenceObject.setDefaultUnitId(t.currentUnitId),this._referenceObject.setDefaultSheetId(t.currentSubUnitId),this._referenceObject.setForcedSheetId(e.getSheetNameMap()),this._referenceObject.setUnitData(e.getUnitData()),this._referenceObject.setArrayFormulaCellData(e.getArrayFormulaCellData()),this._referenceObject.setRuntimeData(t.getUnitData()),this._referenceObject.setUnitStylesData(e.getUnitStylesData()),this._referenceObject.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),this._referenceObject.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());let{x:r,y:a}=this.getRefOffset();this._referenceObject.setRefOffset(r,a),!this._isPrepareMerge&&this._referenceObject.isExceedRange()?this.setValue(td.create(Y.NAME)):this.setValue(this._referenceObject)}};k(mg,"ReferenceNode");let md=(k(mU=class extends hS{constructor(e,t,r,a){super(),this._superTableService=e,this._formulaRuntimeService=t,this._functionService=r,this._injector=a}get zIndex(){return hp.get(hC.REFERENCE)||100}checkAndCreateNodeType(e){var t,r;let a;let n=!1,i,s=!1;e instanceof ef?(n=!0,i=e.getToken().trim(),(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===J.COLON&&(s=!0)):i=e.trim();let{tokenTrim:u,minusPrefixNode:l,atPrefixNode:o}=hP(i,this._functionService,this._injector);if(n||'"'!==u.charAt(0)||'"'!==u.charAt(u.length-1)){if(new RegExp(eb).test(u))a=new mg(this._injector,u,new aF(u),s);else if(n&&this._checkParentIsUnionOperator(e))new RegExp(eS).test(u)?a=new mg(this._injector,u,new aB(u),s):new RegExp(eO).test(u)&&(a=new mg(this._injector,u,new aj(u),s));else{let e=this._formulaRuntimeService.currentUnitId,t=this._superTableService.getTableMap(e),r=RegExp(eT,"g"),i=u.replace(r,"");if(!n&&null!=t&&t.has(i)){let e=r.exec(u),n="";e&&(n=e[0]);let s=t.get(i),l=this._superTableService.getTableOptionMap();a=new mg(this._injector,u,new mo(u,s,n,l))}}if(a)return o?a.setParent(o):l&&a.setParent(l),a}}_checkParentIsUnionOperator(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===J.COLON}},"ReferenceNodeFactory"),mU);md=mm([mf(0,ml),mf(1,hE),mf(2,hV),mf(3,(0,P.Inject)(P.Injector))],md);var mN=Object.defineProperty,m_=Object.getOwnPropertyDescriptor,mE=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?m_(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&mN(t,r,i),i},"__decorateClass$c"),mC=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$c");let mp=class extends hb{constructor(e,t,r){super(t),this._accessor=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return hC.SUFFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");if(this._operatorString===ee.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),(t=this._functionExecutor.calculate(e,ah.create(100))).isNumber()){let e=Number(t.getValue());t=ah.create(e,"0.00%")}}else t=this._operatorString===ee.POUND?this._handlerPound(e):td.create(Y.VALUE);this.setValue(t)}_handlerPound(e){var t,r,a,n;if(!e.isReferenceObject()||!e.isCell())return td.create(Y.VALUE);let i=this._accessor.get(ha),s=this._accessor.get(ho),u=e.getRangePosition(),l=e.getUnitId(),o=e.getSheetId(),c=i.getFormulaData(),h=null==(n=null==(a=null==(r=null==(t=null==c?void 0:c[l])?void 0:t[o])?void 0:r[u.startRow])?void 0:a[u.startColumn])?void 0:n.f;return h&&s.treeBuilder(h),td.create(Y.VALUE)}};k(mp,"SuffixNode");let mA=(k(mD=class extends hS{constructor(e,t){super(),this._functionService=e,this._injector=t}get zIndex(){return hp.get(hC.SUFFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof ef))return;let t=e.getToken().trim();if('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))return;let r="";if(t!==ee.PERCENTAGE)return t===ee.POUND?new mp(this._injector,t):void 0;r=o2.DIVIDED;let a=this._functionService.getExecutor(r);return a?new mp(this._injector,t,a):(console.error(`No function ${e}`),hy.create(Y.NAME))}},"SuffixNodeFactory"),mD);mA=mE([mC(0,hV),mC(1,(0,P.Inject)(P.Injector))],mA);var mb=Object.defineProperty,my=Object.getOwnPropertyDescriptor,mR=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?my(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&mb(t,r,i),i},"__decorateClass$b"),mS=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$b");let mO=class extends hb{constructor(e){super(e),this._operatorString=e}get nodeType(){return hC.UNION}execute(){let e;let t=this.getChildren(),r=t[0].getValue(),a=t[1].getValue();if(null==r||null==a)throw Error("leftNode and rightNode");e=this._operatorString===J.COLON?this._unionFunction(r,a):td.create(Y.NAME),this.setValue(e)}_unionFunction(e,t){return e.isError()||t.isError()||!e.isReferenceObject()||!t.isReferenceObject()?td.create(Y.REF):e.isCell()&&t.isCell()||e.isRow()&&t.isRow()||e.isColumn()&&t.isColumn()?e.unionBy(t):td.create(Y.NAME)}};k(mO,"UnionNode");let mT=(k(mL=class extends hS{constructor(e){super(),this._functionService=e}get zIndex(){return hp.get(hC.UNION)||100}create(e){return new mO(e)}checkAndCreateNodeType(e){if(!(e instanceof ef))return;let t=e.getToken().trim();if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))&&t===J.COLON)return this.create(t)}},"UnionNodeFactory"),mL);mT=mR([mS(0,hV)],mT);let mV=class extends hb{constructor(e){super(e),this._operatorString=e}get nodeType(){return hC.VALUE}execute(){this.setValue(ay.create(this._operatorString))}};k(mV,"ValueNode");let mI=class extends hS{get zIndex(){return hp.get(hC.VALUE)||100}_checkValueNode(e){if(!Number.isNaN(Number(e)))return this.create(e);{let t=e.trim(),r=t.charAt(0),a=t.charAt(t.length-1);if(G.has(t)||'"'===r&&'"'===a||"{"===r&&"}"===a)return this.create(t);let n=t.toUpperCase();if(n===e4.TRUE||n===e4.FALSE)return this.create(n)}}create(e){return new mV(e)}checkAndCreateNodeType(e){if(!(e instanceof ef))return this._checkValueNode(e)}};function mM(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}k(mI,"ValueNodeFactory"),k(mM,"getAstNodeTopParent");var mx,mv,mU,mD,mL,mP,mw=Object.defineProperty,mF=Object.getOwnPropertyDescriptor,mj=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?mF(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&mw(t,r,i),i},"__decorateClass$a"),mB=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$a");let mk=(k(mP=class extends P.Disposable{constructor(e,t,r,a,n,i,s,u,l,o,c){super(),$(this,"_astNodeFactoryList",[]),$(this,"_refOffsetX",0),$(this,"_refOffsetY",0),this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=a,this._lambdaParameterNodeFactory=n,this._operatorNodeFactory=i,this._prefixNodeFactory=s,this._referenceNodeFactory=u,this._suffixNodeFactory=l,this._unionNodeFactory=o,this._valueNodeFactory=c,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e,t=0,r=0){let a=new hO("R_1");this._refOffsetX=t,this._refOffsetY=r;let n=this._parse(e,a);return e.hasDefinedNames()&&(null==n||n.setDefinedNames(e.getDefinedNames())),n}_lambdaParameterHandler(e,t){if(null==t.getLambdaId)return hy.create(Y.VALUE);let r=t.getLambdaId(),a=new hO("R_1"),n=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!n)return!1;let i=[...n.keys()],s=e.getChildren(),u=s.length;for(let e=0;e<u;e++){let t=s[e];if(!(t instanceof ef))return!1;this._parse(t,a)}let l=a.getChildren(),o=l.length;for(let e=0;e<o;e++){let t=l[e];n.set(i[e],t)}return a.setParent(t),t}_changeLetToLambda(e){let t=e.getChildren(),r=t.length;if(r%2!=1||0===r)return;let a=new ef;a.setToken(em);let n=new ef;n.setToken("L_1");let i=[...t];for(let e=0;e<r;e++){let t=i[e];if(!(t instanceof ef))return;e%2==0?t.changeToParent(a):t.changeToParent(n)}a.addChildrenFirst(n),n.setParent(a);let s=e.getParent();return null==s||s.replaceChild(e,a),a}_parse(e,t){let r=e.getChildren(),a=r.length,n=[],i=null,s=e.getToken().trim().toUpperCase();if("LET"===s){let r=this._changeLetToLambda(e);return null!=r?this._parse(r,t):hy.create(Y.ERROR)}if("P_1"===s){if(i=t,0===a)return new me("R_1").setParent(t),i}else{if("L_1"===s){let r=this._lambdaParameterHandler(e,t);return!1===r&&(r=hy.create(Y.ERROR)),r}if(null==(i=this._checkAstNode(e)))return hy.create(Y.NAME)}let u=r[0];for(let e=0;e<a;e++){let t=r[e];if(hz(u)){if(0!==e&&e!==a-1)continue}else if(hZ(t)&&e!==a-1)continue;let s=null;if(t instanceof ef){if((s=this._parse(t,i))===i)continue}else s=this._checkAstNode(t);if(null==s)return hy.create(Y.NAME);if(null==(s=mM(s)))return;switch(s.nodeType){case hC.ERROR:return s;case hC.FUNCTION:case hC.LAMBDA:case hC.LAMBDA_PARAMETER:n.push(s);break;case hC.OPERATOR:{let e=n.pop(),t=n.pop();t&&t.setParent(s),e&&e.setParent(s),n.push(s);break}case hC.REFERENCE:s.setRefOffset(this._refOffsetX,this._refOffsetY),n.push(s);break;case hC.ROOT:case hC.UNION:case hC.VALUE:case hC.PREFIX:case hC.SUFFIX:n.push(s)}}let l=n.length;for(let e=0;e<l;e++)n[e].setParent(i);return i}_checkAstNode(e){let t=null,r=this._astNodeFactoryList.length;for(let a=0;a<r&&null==(t=this._astNodeFactoryList[a].checkAndCreateNodeType(e));a++);return t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(P.sortRules)}},"AstTreeBuilder"),mP);mk=mj([mB(0,hE),mB(1,(0,P.Inject)(hT)),mB(2,(0,P.Inject)(h$)),mB(3,(0,P.Inject)(h6)),mB(4,(0,P.Inject)(h8)),mB(5,(0,P.Inject)(ms)),mB(6,(0,P.Inject)(hL)),mB(7,(0,P.Inject)(md)),mB(8,(0,P.Inject)(mA)),mB(9,(0,P.Inject)(mT)),mB(10,(0,P.Inject)(mI))],mk);let m$=class extends P.Disposable{constructor(){super(...arguments),$(this,"_referenceExecutorMap",/* @__PURE__ */new Map),$(this,"_onChanged$",new w.Subject),$(this,"onChanged$",this._onChanged$.asObservable())}dispose(){this._referenceExecutorMap.clear()}remove(e,t,r){r.forEach(r=>{var a,n;null==(n=null==(a=this._referenceExecutorMap.get(e))?void 0:a.get(t))||n.delete(r)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var a,n;return null==(n=null==(a=this._referenceExecutorMap.get(e))?void 0:a.get(t))?void 0:n.get(r)}has(e,t,r){var a,n;return!!(null!=(n=null==(a=this._referenceExecutorMap.get(e))?void 0:a.get(t))&&n.has(r))}register(e,t,r,a){let n=this._referenceExecutorMap.get(e);n||(n=/* @__PURE__ */new Map,this._referenceExecutorMap.set(e,n));let i=n.get(t);i||(i=/* @__PURE__ */new Map,n.set(t,i)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),i.set(r,a)}getReferenceExecutorMap(){return this._referenceExecutorMap}};k(m$,"FeatureCalculationManagerService");let mH=(0,P.createIdentifier)("univer.formula.feature-calculation-manager.service"),mY=class extends P.Disposable{constructor(){super(...arguments),$(this,"_otherFormulaData",{})}dispose(){this._otherFormulaData={}}remove(e){var t,r,a;let{unitId:n,subUnitId:i,formulaId:s}=e;null==(a=null==(r=null==(t=this._otherFormulaData)?void 0:t[n])?void 0:r[i])||delete a[s]}get(e){var t,r;let{unitId:a,subUnitId:n,formulaId:i}=e;return null==(r=null==(t=this._otherFormulaData[a])?void 0:t[n])?void 0:r[i]}has(e){var t,r;let{unitId:a,subUnitId:n,formulaId:i}=e;return(null==(r=null==(t=this._otherFormulaData[a])?void 0:t[n])?void 0:r[i])!=null}register(e){let{unitId:t,subUnitId:r,formulaId:a,item:n}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][a]=n}batchRegister(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let a=r[e];if(null==a)return!0;Object.keys(a).forEach(r=>{let n=a[r];if(null==n)return!0;this.register({unitId:t,subUnitId:e,formulaId:r,item:n})})})})}batchRemove(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let a=r[e];if(null==a)return!0;Object.keys(a).forEach(r=>{this.remove({unitId:t,subUnitId:e,formulaId:r})})})})}getOtherFormulaData(){return this._otherFormulaData}};k(mY,"OtherFormulaManagerService");let mG=(0,P.createIdentifier)("univer.formula.other-formula-manager.service"),mq=class extends P.Disposable{constructor(){super(),$(this,"node"),$(this,"children",[]),$(this,"parents",[]),$(this,"formula",""),$(this,"row",-1),$(this,"column",-1),$(this,"rowCount",Number.NEGATIVE_INFINITY),$(this,"columnCount",Number.NEGATIVE_INFINITY),$(this,"subUnitId",""),$(this,"unitId",""),$(this,"rangeList",[]),$(this,"formulaId"),$(this,"featureId"),$(this,"isPassive",!0),$(this,"_childIds",/* @__PURE__ */new Set),$(this,"anchorToken",""),$(this,"getDirtyData"),$(this,"_state",0),$(this,"_id"),this._id=`${Math.random().toString(36).slice(3)}-${Math.random().toString(36).slice(3)}`}get id(){return this._id}dispose(){var e;super.dispose(),this.children=[],this.rangeList=[],this.parents=[],null==(e=this.node)||e.dispose()}disposeWithChildren(){this.children.forEach(e=>{e.disposeWithChildren()}),this.dispose()}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return 1===this._state}setSkip(){this._state=2}isSkip(){return 2===this._state}inRangeData(e){let t=e.startRow,r=e.startColumn,a=e.endRow,n=e.endColumn;return!(this.row<t||this.row>a||this.column<r||this.column>n)}dependencyRange(e,t,r){var a,n;if(0===this.rangeList.length)return!1;for(let i=0,s=this.rangeList.length;i<s;i++){let{unitId:s,sheetId:u,range:l}=this.rangeList[i].gridRange;if((null==(a=t[s])?void 0:a[u])!=null)return!0;if(!e.has(s))continue;let o=e.get(s);if(!o.has(u))continue;let c=o.get(u),h=null==(n=null==r?void 0:r[s])?void 0:n[u],{startRow:m,endRow:f,startColumn:g,endColumn:d}=l;for(let e of(Number.isNaN(m)&&(m=0),Number.isNaN(g)&&(g=0),Number.isNaN(f)&&(f=Number.POSITIVE_INFINITY),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),c)){let{startRow:t,startColumn:r,endRow:a,endColumn:n}=e;if(!(m>a||f<t||g>n||d<r)){let e=!0;if(null==h||h.forValue((t,r)=>{if(t>=m&&t<=f&&r>=g&&r<=d)return e=!1,!1}),e)return!0}}}return!1}pushChildren(e){this.children.push(e),e._pushParent(this),this._childIds.add(e.id)}hasChild(e){return this._childIds.has(e.id)}pushRangeList(e){this.rangeList.push(e)}dependency(e){if(0===this.rangeList.length)return!1;for(let t=0,r=this.rangeList.length;t<r;t++){let r=this.rangeList[t],a=r.gridRange.unitId,n=r.gridRange.sheetId,i=r.gridRange.range;if(e.unitId===a&&e.subUnitId===n&&e.inRangeData(i))return!0}return!1}_pushParent(e){this.parents.push(e)}};k(mq,"FormulaDependencyTree");let mW=class extends P.Disposable{constructor(){super(...arguments),$(this,"_cacheItems",/* @__PURE__ */new Map),$(this,"_map",/* @__PURE__ */new Map),$(this,"_dependencyMap",/* @__PURE__ */new Map),$(this,"_parentIdMap",/* @__PURE__ */new Map),$(this,"_rangeTokens",/* @__PURE__ */new Set)}dispose(){this.clear()}size(){return this._cacheItems.size}getDependencyMap(){return this._dependencyMap}getDependencyTree(e){return this._dependencyMap.get(e)}get length(){return this._cacheItems.size}add(e,t){let{token:r}=e;if(!this._cacheItems.has(r)){this._cacheItems.set(r,{unitRangeWithToken:e,treeList:[t],ids:/* @__PURE__ */new Set([t.id])});return}let a=this._cacheItems.get(r);a.treeList.push(t),a.ids.add(t.id);let{gridRange:n}=e,{range:i}=n;i.startRow===i.endRow&&i.startColumn===i.endColumn||this._rangeTokens.add(r)}addDependencyMap(e){this._dependencyMap.set(e.id,e)}updateParent(e){let t=/* @__PURE__ */new Set,r=e.unitId,a=e.subUnitId,n=this._cacheItems.get(e.anchorToken);if(n){this._parentIdMap.set(e.id,[...n.ids]);return}for(let n of this._rangeTokens){let i=this._cacheItems.get(n);if(i){let{unitRangeWithToken:n,treeList:s}=i,{gridRange:u}=n;if(u.unitId===r&&u.sheetId===a&&e.inRangeData(u.range))for(let e of s)t.add(e.id)}}this._parentIdMap.set(e.id,[...t])}clear(){this._cacheItems.clear(),this._map.clear(),this._dependencyMap.clear()}remove(e,t){if(!this._cacheItems.has(e))return;let r=this._cacheItems.get(e),a=r.treeList.indexOf(t);-1!==a&&r.treeList.splice(a,1)}delete(e){this._cacheItems.delete(e)}getDependencyId(e,t){let r=this._parentIdMap.get(e.id);if(r)for(let a of[...r]){t.add(a);let r=this._dependencyMap.get(a);r&&a!==e.id&&this.getDependencyId(r,t)}}dependencyUseParentId(e){let t=/* @__PURE__ */new Set;for(let r of(this.getDependencyId(e,t),t)){let t=this._dependencyMap.get(r);if(t&&t.hasChild(e)&&t.rangeList){for(let r of t.rangeList)if(r.gridRange.unitId===e.unitId&&r.gridRange.sheetId===e.subUnitId){t.pushChildren(e);break}}t&&!t.hasChild(e)&&t.pushChildren(e)}t.clear(),t=null}dependency(e){this._cacheItems.forEach(t=>{let{unitRangeWithToken:r,treeList:a}=t,{gridRange:n}=r,{unitId:i,sheetId:s,range:u}=n;e.unitId===i&&e.subUnitId===s&&e.inRangeData(u)&&a.forEach(t=>{if(t===e||t.children.includes(e))return!0;t.pushChildren(e)})})}};k(mW,"FormulaDependencyTreeCache");let mQ=class extends P.Disposable{constructor(){super(...arguments),$(this,"_otherFormulaData",{}),$(this,"_featureFormulaData",{}),$(this,"_formulaData",{})}dispose(){this._otherFormulaData={},this._featureFormulaData={},this._formulaData={}}getAllTree(){let e=[];return Object.values(this._otherFormulaData).forEach(t=>{if(null==t)return!0;Object.values(t).forEach(t=>{Object.values(t).forEach(t=>{t&&(t.resetState(),e.push(t))})})}),Object.values(this._featureFormulaData).forEach(t=>{if(null==t)return!0;Object.values(t).forEach(t=>{Object.values(t).forEach(t=>{t&&(t.resetState(),e.push(t))})})}),Object.values(this._formulaData).map(t=>null==t?[]:Object.values(t).forEach(t=>t.forValue((t,r,a)=>{a&&(a.resetState(),e.push(a))}))),e}buildDependencyTree(e,t){let r=this.getAllTree();return e instanceof mW?this._buildDependencyTreeWithCache(r,e,t||[]):this._buildDependencyTree(r,e,e),r}_buildDependencyTreeWithCache(e,t,r){let a=new mW;for(let t of e.concat(r))for(let e of t.rangeList)a.add(e,t),a.addDependencyMap(t);let n=a.getDependencyMap();for(let e of n.values())a.updateParent(e);for(let e of n.values())a.dependencyUseParentId(e);a.dispose()}_buildDependencyTree(e,t,r){let a=new mW;for(let n of e.concat(t,r))for(let e of n.rangeList)a.add(e,n),a.addDependencyMap(n);let n=a.getDependencyMap();for(let e of n.values())a.updateParent(e);for(let e of n.values())a.dependencyUseParentId(e);a.dispose()}clearDependencyForTree(e){if(null==e)return;let t=e.parents,r=e.children;t.forEach(t=>{t.children=t.children.filter(t=>t!==e)}),r.forEach(t=>{t.parents=t.parents.filter(t=>t!==e)}),this._buildDependencyTree(t,r,r),e.dispose()}reset(){this._otherFormulaData={},this._featureFormulaData={},this._formulaData={}}addOtherFormulaDependency(e,t,r,a){this._otherFormulaData[e]||(this._otherFormulaData[e]={}),this._otherFormulaData[e][t]||(this._otherFormulaData[e][t]={}),this._otherFormulaData[e][t][r]=a}removeOtherFormulaDependency(e,t,r){this._otherFormulaData[e]&&this._otherFormulaData[e][t]&&r.forEach(r=>{let a=this._otherFormulaData[e][t][r];this.clearDependencyForTree(a),delete this._otherFormulaData[e][t][r]})}getOtherFormulaDependency(e,t,r){var a,n;return null==(n=null==(a=this._otherFormulaData[e])?void 0:a[t])?void 0:n[r]}hasOtherFormulaDependency(e,t,r){var a,n;return(null==(n=null==(a=this._otherFormulaData[e])?void 0:a[t])?void 0:n[r])!=null}addFeatureFormulaDependency(e,t,r,a){this._featureFormulaData[e]||(this._featureFormulaData[e]={}),this._featureFormulaData[e][t]||(this._featureFormulaData[e][t]={}),this._featureFormulaData[e][t][r]=a}removeFeatureFormulaDependency(e,t,r){this._featureFormulaData[e]&&this._featureFormulaData[e][t]&&r.forEach(r=>{let a=this._featureFormulaData[e][t][r];this.clearDependencyForTree(a),delete this._featureFormulaData[e][t][r]})}getFeatureFormulaDependency(e,t,r){var a,n;return null==(n=null==(a=this._featureFormulaData[e])?void 0:a[t])?void 0:n[r]}hasFeatureFormulaDependency(e,t,r){var a,n;return(null==(n=null==(a=this._featureFormulaData[e])?void 0:a[t])?void 0:n[r])!=null}addFormulaDependency(e,t,r,a,n){this._formulaData[e]||(this._formulaData[e]={}),this._formulaData[e][t]||(this._formulaData[e][t]=new P.ObjectMatrix),this._formulaData[e][t].setValue(r,a,n)}removeFormulaDependency(e,t,r,a){if(this._formulaData[e]&&this._formulaData[e][t]){let n=this._formulaData[e][t].getValue(r,a);this.clearDependencyForTree(n),this._formulaData[e][t].realDeleteValue(r,a)}}clearFormulaDependency(e,t){t&&this._formulaData[e]&&this._formulaData[e][t]?this._formulaData[e][t].reset():this._formulaData[e]&&(this._formulaData[e]=null)}hasFormulaDependency(e,t,r,a){var n,i;return(null==(i=null==(n=this._formulaData[e])?void 0:n[t])?void 0:i.getValue(r,a))!=null}};k(mQ,"DependencyManagerService");let mX=(0,P.createIdentifier)("univer.formula.dependency-manager.service");var mK=Object.defineProperty,mz=Object.getOwnPropertyDescriptor,mZ=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?mz(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&mK(t,r,i),i},"__decorateClass$9"),mJ=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$9");let m0=(k(m6=class extends P.Disposable{constructor(e,t,r,a,n,i,s,u){super(),$(this,"_updateRangeFlattenCache",/* @__PURE__ */new Map),$(this,"_dirtyUnitSheetNameMap",{}),$(this,"_formulaASTCache",new eg(1e5)),this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=a,this._interpreter=n,this._astTreeBuilder=i,this._lexer=s,this._dependencyManagerService=u}dispose(){this._updateRangeFlattenCache.clear(),this._formulaASTCache.clear(),this._dirtyUnitSheetNameMap={}}async generate(){this._updateRangeFlatten();let e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getUnitData(),{treeList:a,dependencyTreeCache:n}=await this._generateTreeList(e,t,r),i=this._getUpdateTreeListAndMakeDependency(a,n),s=this._calculateRunList(i);return this._dependencyFeatureCalculation(s)&&(s.forEach(e=>{e.resetState()}),s=this._calculateRunList(s)),this._checkIsCycleDependency(s)&&this._runtimeService.enableCycleDependency(),Promise.resolve(s)}_isCyclicUtil(e,t,r){if(!t.has(e)){t.add(e),r.add(e);for(let a=0;a<e.children.length;a++)if(!t.has(e.children[a])&&this._isCyclicUtil(e.children[a],t,r)||r.has(e.children[a]))return!0}return r.delete(e),!1}_checkIsCycleDependency(e){let t=/* @__PURE__ */new Set,r=/* @__PURE__ */new Set;for(let a=0,n=e.length;a<n;a++){let n=e[a];if(!0===this._isCyclicUtil(n,t,r))return!0}return!1}async _generateTreeList(e,t,r){let a=Object.keys(e),n=Object.keys(t),i=[];this._currentConfigService.isForceCalculate()&&(this._dependencyManagerService.reset(),this._formulaASTCache.clear()),this._registerFormulas(a,e,r,i),this._registerOtherFormulas(t,n,i),this._registerFeatureFormulas(i);let s=new mW;for(let e=0,t=i.length;e<t;e++){let t=i[e];if(this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId),null==t.node)continue;let r=await this._getRangeListByNode(t.node);for(let e=0,a=r.length;e<a;e++){let a=r[e];t.pushRangeList(a),s.add(a,t)}}return{treeList:i,dependencyTreeCache:s}}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((t,r)=>{t.forEach((t,r)=>{t.forEach((t,r)=>{e.push(this._getFeatureFormulaTree(r,t))})})})}_getFeatureFormulaTree(e,t){let{unitId:r,subUnitId:a,dependencyRanges:n,getDirtyData:i}=t,s=new mq;return s.unitId=r,s.subUnitId=a,s.getDirtyData=i,s.featureId=e,s.rangeList=n.map(e=>({gridRange:e,token:ej({...e,sheetName:this._currentConfigService.getSheetName(e.unitId,e.sheetId)})})),this._dependencyManagerService.addFeatureFormulaDependency(r,a,e,s),s}_registerOtherFormulas(e,t,r){for(let a of t){let t=e[a];if(null!=t)for(let e of Object.keys(t)){let n=t[e];if(null!=n)for(let t of Object.keys(n)){if(this._dependencyManagerService.hasOtherFormulaDependency(a,e,t))continue;let{f:i}=n[t],s=this._generateAstNode(a,i),u=new mq;u.node=s,u.formula=i,u.unitId=a,u.subUnitId=e,u.formulaId=t,this._dependencyManagerService.addOtherFormulaDependency(a,e,t,u),r.push(u)}}}}_registerFormulas(e,t,r,a){for(let n of e){let e=t[n];if(null!=e)for(let t of Object.keys(e))new(0,P.ObjectMatrix)(e[t]||{}).forValue((e,i,s)=>{if(null==s)return!0;let{f:u,x:l,y:o}=s;if(this._dependencyManagerService.hasFormulaDependency(n,t,e,i))return!0;let c=this._generateAstNode(n,u,l,o),h=new mq,m=r[n][t];h.node=c,h.formula=u,h.unitId=n,h.subUnitId=t,h.row=e,h.column=i;let f={range:{startRow:e,startColumn:i,endRow:e,endColumn:i},unitId:n,sheetId:t};h.anchorToken=ej({...f,sheetName:this._currentConfigService.getSheetName(n,t)}),h.rowCount=m.rowCount,h.columnCount=m.columnCount,this._dependencyManagerService.addFormulaDependency(n,t,e,i,h),a.push(h)})}}_updateRangeFlatten(){let e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let e=0;e<t.length;e++){let r=t[e],a=r.range,n=r.sheetId,i=r.unitId;this._addFlattenCache(i,n,a)}this._dirtyUnitSheetNameMap=this._currentConfigService.getDirtyNameMap()}}_generateAstNode(e,t,r=0,a=0){let n=this._formulaASTCache.get(`${e}${t}##${r}-${a}`);if(n&&!this._isDirtyDefinedForNode(n))return n;let i=this._lexer.treeBuilder(t);if(G.has(i))return hy.create(i);if(null==(n=this._astTreeBuilder.parse(i,r,a)))throw Error("astNode is null");return this._formulaASTCache.set(`${e}${t}##${r}-${a}`,n),n}_addFlattenCache(e,t,r){let a=this._updateRangeFlattenCache.get(e);null==a&&(a=/* @__PURE__ */new Map,this._updateRangeFlattenCache.set(e,a));let n=a.get(t);null==n&&(n=[],a.set(t,n)),n.push(r)}_isPreCalculateNode(e){return e.nodeType===hC.UNION||e.nodeType===hC.PREFIX&&e.getToken()===er.AT||e.nodeType===hC.SUFFIX&&e.getToken()===ee.POUND}_nodeTraversalRef(e,t){let r=e.getChildren(),a=r.length;for(let e=0;e<a;e++){let a=r[e];if(this._isPreCalculateNode(a)){t.push(a);continue}a.nodeType===hC.REFERENCE&&t.push(a),this._nodeTraversalRef(a,t)}}_nodeTraversalReferenceFunction(e,t){let r=e.getChildren(),a=r.length;for(let e=0;e<a;e++){let a=r[e];if(a.nodeType===hC.FUNCTION&&a.isAddress()){t.push(a);continue}this._nodeTraversalReferenceFunction(a,t)}}async _executeNode(e){return this._interpreter.checkAsyncNode(e)?await this._interpreter.executeAsync(e):this._interpreter.execute(e)}async _getRangeListByNode(e){let t=[],r=[];this._nodeTraversalRef(e,t),this._nodeTraversalReferenceFunction(e,r);let a=[];for(let e=0,r=t.length;e<r;e++){let r=t[e],n=(await this._executeNode(r)).toUnitRange(),i=ej({...n,sheetName:this._currentConfigService.getSheetName(n.unitId,n.sheetId)});a.push({gridRange:n,token:i})}for(let e=0,t=r.length;e<t;e++){let t=r[e],n=(await this._executeNode(t)).toUnitRange(),i=ej({...n,sheetName:this._currentConfigService.getSheetName(n.unitId,n.sheetId)});a.push({gridRange:n,token:i})}return a}_isDirtyDefinedForNode(e){let t=this._currentConfigService.getDirtyDefinedNameMap(),r=this._currentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let a=Object.keys(t[r]);for(let t=0,r=a.length;t<r;t++){let r=a[t];if(e.hasDefinedName(r))return!0}}return!1}_getUpdateTreeListAndMakeDependency(e,t){let r=[],a=/* @__PURE__ */new Set,n=this._currentConfigService.isForceCalculate(),i=[];i=t.size()>e.length?this._dependencyManagerService.buildDependencyTree(e):this._dependencyManagerService.buildDependencyTree(t,e);for(let e=0,t=i.length;e<t;e++){let t=i[e];(n||t.dependencyRange(this._updateRangeFlattenCache,this._dirtyUnitSheetNameMap,this._currentConfigService.getExcludedRange())||this._includeTree(t))&&!a.has(t)&&(r.push(t),a.add(t))}return t.dispose(),r}_dependencyFeatureCalculation(e){this._clearFeatureCalculationNode(e);let t=!1;return this._featureCalculationManagerService.getReferenceExecutorMap().forEach((r,a)=>{r.forEach((r,a)=>{r.forEach((r,a)=>{let{unitId:n,subUnitId:i,getDirtyData:s}=r,u=s(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()).dirtyRanges,l=this._convertDirtyRangesToMap(u),o=this._intersectFeatureCalculation(l,e,{unitId:n,subUnitId:i,featureId:a});if(o.length>0){let s=this._getExistTreeList({unitId:n,subUnitId:i,featureId:a},e);null==s&&(s=this._getFeatureFormulaTree(a,r),e.push(s)),s.parents=[],o.forEach(e=>{e.children.includes(s)||e.pushChildren(s)}),t=!0}})})}),t}_clearFeatureCalculationNode(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(e=>{e.children=e.children.filter(r=>{var a,n;return!r.featureId||!(null!=(n=null==(a=t.get(e.unitId))?void 0:a.get(e.subUnitId))&&n.has(r.featureId))}),e.parents=e.parents.filter(r=>{var a,n;return!r.featureId||!(null!=(n=null==(a=t.get(e.unitId))?void 0:a.get(e.subUnitId))&&n.has(r.featureId))})})}_getExistTreeList(e,t){let{unitId:r,subUnitId:a,featureId:n}=e;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(i.unitId===r&&i.subUnitId===a&&i.featureId===n)return i}}_convertDirtyRangesToMap(e){let t=/* @__PURE__ */new Map;for(let r in e){let a=e[r],n=/* @__PURE__ */new Map;for(let e in a){let t=a[e];n.set(e,t)}t.set(r,n)}return t}_intersectFeatureCalculation(e,t,r){let a=[];for(let n=0,i=t.length;n<i;n++){let i=t[n];(i.unitId!==r.unitId||i.subUnitId!==r.subUnitId||i.featureId!==r.featureId)&&i.dependencyRange(e,{})&&a.push(i)}return a}_includeTreeFeature(e){var t,r;let a=e.unitId,n=e.subUnitId,i=e.featureId;if(null!=i){let e=this._currentConfigService.getDirtyUnitFeatureMap();if((null==(r=null==(t=null==e?void 0:e[a])?void 0:t[n])?void 0:r[i])!=null)return!0}return!1}_includeOtherFormula(e){var t,r;let a=e.unitId,n=e.subUnitId,i=e.formulaId;if(null!=i){let e=this._currentConfigService.getDirtyUnitOtherFormulaMap();if((null==(r=null==(t=null==e?void 0:e[a])?void 0:t[n])?void 0:r[i])!=null)return!0}return!1}_includeDefinedName(e){let t=e.node;return!!(null!=t&&this._isDirtyDefinedForNode(t))}_includeTree(e){var t,r,a;let n=e.unitId,i=e.subUnitId;if(!0===this._includeTreeFeature(e)||!0===this._includeOtherFormula(e)||!0===this._includeDefinedName(e))return!0;let s=null==(r=null==(t=this._currentConfigService.getExcludedRange())?void 0:t[n])?void 0:r[i],u=!1;if(null==s||s.forValue((t,r)=>{if(e.row===t&&e.column===r)return u=!0,!1}),u)return!1;if((null==(a=this._dirtyUnitSheetNameMap[n])?void 0:a[i])!=null)return!0;if(!this._updateRangeFlattenCache.has(n))return!1;let l=this._updateRangeFlattenCache.get(n);if(!l.has(i))return!1;for(let t of l.get(i))if(e.inRangeData(t))return!0;return!1}_calculateRunList(e){let t=e,r=[];for(;t.length>0;){let e=t.pop();if(void 0===e||e.isSkip())continue;if(e.isAdded()){r.push(e),e.setSkip();continue}let a=[];for(let t=0,r=e.parents.length;t<r;t++){let r=e.parents[t];r.isAdded()||e.isSkip()||a.push(r)}0===a.length?(r.push(e),e.setSkip()):(e.setAdded(),t.push(e),t=t.concat(a))}return r.reverse()}},"FormulaDependencyGenerator"),m6);m0=mZ([(0,P.OnLifecycle)(P.LifecycleStages.Rendered,m0),mJ(0,ha),mJ(1,hE),mJ(2,mG),mJ(3,mH),mJ(4,(0,P.Inject)(hK)),mJ(5,(0,P.Inject)(mk)),mJ(6,(0,P.Inject)(ho)),mJ(7,mX)],m0);var m1=Object.defineProperty,m2=Object.getOwnPropertyDescriptor,m3=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?m2(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&m1(t,r,i),i},"__decorateClass$8"),m5=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$8");let m4=(k(m7=class extends P.Disposable{constructor(e,t,r,a,n,i,s){super(),$(this,"_executionStartListener$",new w.Subject),$(this,"executionStartListener$",this._executionStartListener$.asObservable()),$(this,"_executionCompleteListener$",new w.Subject),$(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable()),$(this,"_executionInProgressListener$",new w.Subject),$(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable()),this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=a,this._formulaDependencyGenerator=n,this._interpreter=i,this._astTreeBuilder=s}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._executionStartListener$.next(!0),this._currentConfigService.load(e),this._runtimeService.reset();let t=this._configService.getConfig("CYCLE_REFERENCE_COUNT")||1;for(let e=0;e<t&&(this._runtimeService.setFormulaCycleIndex(e),await this._execute(),aR.clear(),this._runtimeService.isCycleDependency());e++);this._runtimeService.setFormulaExecuteStage(hd.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),te.clear()}async _execute(){let e=await this._apply();if(null==e)return;let{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:a,excludedCell:n}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return null==a||0===a.length||(this._currentConfigService.loadDirtyRangesAndExcludedCell(a,n),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){let r=[],a={};return Object.keys(e).forEach(t=>{let n=e[t];if(null==n)return!0;Object.keys(n).forEach(e=>{let i=new P.ObjectMatrix(n[e]);if(null==i)return!0;let s=new P.ObjectMatrix;i.forValue((a,n,i)=>{s.setValue(a,n,!0),r.push({unitId:t,sheetId:e,range:i})}),null==a[t]&&(a[t]={}),a[t][e]=s})}),Object.keys(t).forEach(e=>{let a=t[e];Object.keys(a).forEach(e=>{let t=a[e];if(null==t)return!0;Object.keys(t).forEach(a=>{let n=t[a];if(null==n)return!0;for(let t of n)r.push({unitId:e,sheetId:a,range:t})})})}),{dirtyRanges:r,excludedCell:a}}async _apply(e=!1){e?this._runtimeService.setFormulaExecuteStage(hd.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(hd.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let t=await this._formulaDependencyGenerator.generate(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(hd.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(hd.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let a=[];for(let n=0,i=t.length;n<i;n++){let i;if(await new Promise(e=>{let t=(0,P.requestImmediateMacroTask)(e);a.push(t)}),this._runtimeService.isStopExecution()){this._runtimeService.setFormulaExecuteStage(hd.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}let s=t[n],u=s.node,l=s.getDirtyData;if(null==u&&null==l)throw Error("AstNode or executor is null");if(this._runtimeService.setCurrent(s.row,s.column,s.rowCount,s.columnCount,s.subUnitId,s.unitId),null!=l&&null!=s.featureId){let{runtimeCellData:e,dirtyRanges:t}=l(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(s.featureId,e),this._runtimeService.setRuntimeFeatureRange(s.featureId,t)}else null!=u&&(i=r.checkAsyncNode(u)?await r.executeAsync(u):r.execute(u),null!=s.formulaId?this._runtimeService.setRuntimeOtherData(s.formulaId,i):this._runtimeService.setRuntimeData(i));e?(this._runtimeService.setFormulaExecuteStage(hd.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(n+1)):(this._runtimeService.setFormulaExecuteStage(hd.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(n+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState())}return a.forEach(e=>e()),a=[],t.length>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){let r=this._lexer.treeBuilder(e,t);if(Object.values(Y).includes(r))return hy.create(r);let a=this._astTreeBuilder.parse(r);null==a||a.serialize()}},"CalculateFormulaService"),m7);m4=m3([(0,P.OnLifecycle)(P.LifecycleStages.Rendered,m4),m5(0,P.IConfigService),m5(1,(0,P.Inject)(ho)),m5(2,ha),m5(3,hE),m5(4,(0,P.Inject)(m0)),m5(5,(0,P.Inject)(hK)),m5(6,(0,P.Inject)(mk))],m4);var m6,m7,m9,m8=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,ft=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?fe(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&m8(t,r,i),i},"__decorateClass$7"),fr=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$7");let fa=(k(m9=class extends P.Disposable{constructor(e,t,r,a){super(),this._commandService=e,this._calculateFormulaService=t,this._univerInstanceService=r,this._formulaDataModel=a,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener(),this._initialExecuteFormulaProcessListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{if(e.id===c1.id)this._calculateFormulaService.stopFormulaExecution();else if(e.id===c5.id){let t=e.params.formulaData;this._formulaDataModel.mergeFormulaData(t)}else if(e.id===c0.id){let t=e.params;if(!0===t.forceCalculation)this._calculate(!0);else{let{dirtyRanges:e,dirtyNameMap:r,dirtyDefinedNameMap:a,dirtyUnitFeatureMap:n,dirtyUnitOtherFormulaMap:i}=t;this._calculate(!1,e,r,a,n,i)}}else if(e.id===cJ.id){let t=e.params;if(null==t)return;let{arrayFormulaRange:r,arrayFormulaCellData:a}=t;this._formulaDataModel.setArrayFormulaRange(r),this._formulaDataModel.setArrayFormulaCellData(a)}}))}async _calculate(e=!1,t=[],r={},a={},n={},i={}){if(0===t.length&&0===Object.keys(r).length&&0===Object.keys(a).length&&0===Object.keys(n).length&&0===Object.keys(i).length&&!1===e)return;let s=this._formulaDataModel.getFormulaData(),u=this._formulaDataModel.getArrayFormulaCellData();this._calculateFormulaService.execute({formulaData:s,arrayFormulaCellData:u,forceCalculate:e,dirtyRanges:t,dirtyNameMap:r,dirtyDefinedNameMap:a,dirtyUnitFeatureMap:n,dirtyUnitOtherFormulaMap:i})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(e=>{let t=e.functionsExecutedState;switch(t){case hN.NOT_EXECUTED:case hN.STOP_EXECUTION:break;case hN.SUCCESS:this._applyFormula(e);case hN.INITIAL:}this._commandService.executeCommand(c2.id,{functionsExecutedState:t},{onlyLocal:!0})})}_initialExecuteFormulaProcessListener(){this._calculateFormulaService.executionInProgressListener$.subscribe(e=>{this._commandService.executeCommand(c2.id,{stageInfo:e},{onlyLocal:!0})})}async _applyFormula(e){let{unitData:t,unitOtherData:r,arrayFormulaRange:a,arrayFormulaCellData:n,clearArrayFormulaCellData:i}=e;if(!t){console.error("No sheetData from Formula Engine!");return}a&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(i),this._formulaDataModel.mergeArrayFormulaCellData(n),this._formulaDataModel.mergeArrayFormulaRange(a),this._commandService.executeCommand(cJ.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData()},{onlyLocal:!0})),this._commandService.executeCommand(c3.id,{unitData:eo(t),unitOtherData:r},{onlyLocal:!0})}},"CalculateController"),m9);fa=ft([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fa),fr(0,P.ICommandService),fr(1,(0,P.Inject)(m4)),fr(2,P.IUniverInstanceService),fr(3,(0,P.Inject)(cz))],fa);let fn={id:"formula.mutation.register-function",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fi={id:"formula.mutation.set-defined-name",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fs={id:"formula.mutation.remove-defined-name",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fu={id:"formula.mutation.set-feature-calculation",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fl={id:"formula.mutation.remove-feature-calculation",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fo={id:"formula.mutation.set-other-formula",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fc={id:"formula.mutation.remove-other-formula",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fh={id:"formula.mutation.set-super-table",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fm={id:"formula.mutation.remove-super-table",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},ff={id:"formula.mutation.set-super-table-option",type:P.CommandType.MUTATION,handler:/* @__PURE__ */k(()=>!0,"handler")},fg="engine-formula.config",fd={};var fN,f_=Object.defineProperty,fE=Object.getOwnPropertyDescriptor,fC=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?fE(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&f_(t,r,i),i},"__decorateClass$6"),fp=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$6");let fA=(k(fN=class extends P.Disposable{constructor(e,t,r,a){super(),this._commandService=e,this._functionService=t,this._configService=r,this._dataSyncPrimaryController=a,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[c5,cJ,c0,c1,c2,c3,fi,fs,fu,fl,fo,fc,fh,fm,ff,fn].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)})}_registerFunctions(){var e;let t=this._configService.getConfig(fg),r=[...aw,...ne,...nt,...na,...it,...st,...ud,...uD,...u1,...lO,...oz,...o6,...cb,...cF,...cj,...cB].concat(null!=(e=null==t?void 0:t.function)?e:[]).map(e=>new e[0](e[1]));this._functionService.registerExecutors(...r)}},"FormulaController"),fN);fA=fC([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fA),fp(0,P.ICommandService),fp(1,hV),fp(2,P.IConfigService),fp(3,(0,P.Optional)(F.DataSyncPrimaryController))],fA);var fb,fy=Object.defineProperty,fR=Object.getOwnPropertyDescriptor,fS=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?fR(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&fy(t,r,i),i},"__decorateClass$5"),fO=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$5");let fT=(k(fb=class extends P.Disposable{constructor(e,t){super(),this._commandService=e,this._definedNamesService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===fi.id){let t=e.params;if(null==t)return;let{id:r,unitId:a,name:n,formulaOrRefString:i,comment:s,hidden:u,localSheetId:l}=t;this._definedNamesService.registerDefinedName(a,{id:r,name:n.trim(),formulaOrRefString:i.trim(),comment:null==s?void 0:s.trim(),hidden:u,localSheetId:l})}else if(e.id===fs.id){let t=e.params;if(null==t)return;let{unitId:r,id:a}=t;this._definedNamesService.removeDefinedName(r,a)}}))}},"SetDefinedNameController"),fb);fT=fS([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fT),fO(0,P.ICommandService),fO(1,c6)],fT);var fV,fI=Object.defineProperty,fM=Object.getOwnPropertyDescriptor,fx=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?fM(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&fI(t,r,i),i},"__decorateClass$4"),fv=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$4");let fU=(k(fV=class extends P.Disposable{constructor(e,t){super(),this._commandService=e,this._featureCalculationManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===fu.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:a}=t,{unitId:n,subUnitId:i}=a;this._featureCalculationManagerService.register(n,i,r,a)}else if(e.id===fl.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:a,subUnitId:n}=t;this._featureCalculationManagerService.remove(a,n,r)}}))}},"SetFeatureCalculationController"),fV);fU=fx([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fU),fv(0,P.ICommandService),fv(1,mH)],fU);var fD,fL=Object.defineProperty,fP=Object.getOwnPropertyDescriptor,fw=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?fP(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&fL(t,r,i),i},"__decorateClass$3"),fF=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$3");let fj=(k(fD=class extends P.Disposable{constructor(e,t,r){super(),this._commandService=e,this._otherFormulaManagerService=t,this._dependencyManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===fo.id){let t=e.params;if(null==t)return;let r={[t.unitId]:{[t.subUnitId]:t.formulaMap}};this._otherFormulaManagerService.batchRegister(r)}else if(e.id===fc.id){let t=e.params;if(null==t)return;let r={};t.formulaIdList.forEach(e=>r[e]=!0);let a={[t.unitId]:{[t.subUnitId]:r}};this._otherFormulaManagerService.batchRemove(a)}}))}},"SetOtherFormulaController"),fD);fj=fw([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fj),fF(0,P.ICommandService),fF(1,mG),fF(2,mX)],fj);var fB,fk=Object.defineProperty,f$=Object.getOwnPropertyDescriptor,fH=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?f$(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&fk(t,r,i),i},"__decorateClass$2"),fY=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$2");let fG=(k(fB=class extends P.Disposable{constructor(e,t){super(),this._commandService=e,this._superTableService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===fi.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:a,reference:n}=t;this._superTableService.registerTable(r,a,n)}else if(e.id===fs.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:a}=t;this._superTableService.remove(r,a)}else if(e.id===ff.id){let t=e.params;if(null==t)return;let{tableOption:r,tableOptionType:a}=t;this._superTableService.registerTableOptionMap(r,a)}}))}},"SetSuperTableController"),fB);fG=fH([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fG),fY(0,P.ICommandService),fY(1,ml)],fG);let fq=class extends P.Disposable{constructor(){super(...arguments),$(this,"_dirtyConversionMap",/* @__PURE__ */new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}};k(fq,"ActiveDirtyManagerService");let fW=(0,P.createIdentifier)("univer.formula.active-dirty-manager.service");var fQ,fX=Object.defineProperty,fK=Object.getOwnPropertyDescriptor,fz=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?fK(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&fX(t,r,i),i},"__decorateClass$1"),fZ=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$1");let fJ=(k(fQ=class extends P.Disposable{constructor(e,t,r){super(),this._commandService=e,this._dependencyManagerService=t,this._featureCalculationManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(e=>{let{unitId:t,subUnitId:r,featureIds:a}=e;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,a)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===fl.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:a,subUnitId:n}=t;this._dependencyManagerService.removeFeatureFormulaDependency(a,n,r)}else if(e.id===fu.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:a}=t,{unitId:n,subUnitId:i}=a;this._dependencyManagerService.removeFeatureFormulaDependency(n,i,[r])}else if(e.id===fc.id){let t=e.params;if(null==t)return;this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,t.formulaIdList)}else if(e.id===fo.id){let t=e.params;if(null==t)return;let r=t.formulaMap,a=[];Object.keys(r).forEach(e=>{a.push(e)}),this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,a)}else if(e.id===c5.id){let t=e.params.formulaData;Object.keys(t).forEach(e=>{let r=t[e];if(void 0!==r){if(null===r){this._dependencyManagerService.clearFormulaDependency(e);return}Object.keys(r).forEach(t=>{let a=r[t];if(void 0!==a){if(null===a)return this._dependencyManagerService.clearFormulaDependency(e,t),!0;new(0,P.ObjectMatrix)(a).forValue((r,a)=>{this._dependencyManagerService.removeFormulaDependency(e,t,r,a)})}})}})}}))}},"SetDependencyController"),fQ);fJ=fz([(0,P.OnLifecycle)(P.LifecycleStages.Ready,fJ),fZ(0,P.ICommandService),fZ(1,mH),fZ(1,mX),fZ(2,mH)],fJ);var f0=Object.defineProperty,f1=Object.getOwnPropertyDescriptor,f2=/* @__PURE__ */k((e,t,r,a)=>{for(var n,i=a>1?void 0:a?f1(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&f0(t,r,i),i},"__decorateClass"),f3=/* @__PURE__ */k((e,t)=>(r,a)=>t(r,a,e),"__decorateParam");let f5=(k(L=class extends P.Plugin{constructor(e=fd,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...a}=this._config;this._configService.setConfig(fg,a)}onStarting(){this._initialize()}_initialize(){var e;let t=[[hV,{useClass:hI}],[c6,{useClass:c4}],[fW,{useClass:fq}],[ml,{useClass:mu}],[cz],[e0],[fA],[fT],[fG]];null!=(e=this._config)&&e.notExecuteFormula||t.push([m4],[mG,{useClass:mY}],[hE,{useClass:h_}],[ha,{useClass:hr}],[mX,{useClass:mQ}],[mH,{useClass:m$}],[fa],[fj],[fJ],[fU],[m0],[hK],[mk],[ho],[hT],[h$],[h6],[h8],[ms],[hL],[md],[mA],[mT],[mI]),t.forEach(e=>this._injector.add(e))}},"UniverFormulaEnginePlugin"),$(L,"pluginName","UNIVER_ENGINE_FORMULA_PLUGIN"),L);f5=f2([f3(1,(0,P.Inject)(P.Injector)),f3(2,P.IConfigService)],f5)}),r("k2g5B",function(r,a){e(r.exports,"fromModule",function(){return I}),e(r.exports,"toModule",function(){return M}),e(r.exports,"IRPCChannelService",function(){return D}),e(r.exports,"DataSyncPrimaryController",function(){return H});var n,i=t("7yNYd"),s=t("lMvMU"),u=t("9z4na"),l=t("2jrJe"),o=t("5LPkb"),c=t("dBx9C"),h=t("hRiv7"),m=t("1O3Nt"),f=t("3yupB"),g=t("c3hg1"),d=Object.defineProperty,N=(e,t,r)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_=(e,t)=>d(e,"name",{value:t,configurable:!0}),E=(e,t,r)=>N(e,"symbol"!=typeof t?t+"":t,r),C=Object.defineProperty,p=Object.getOwnPropertyDescriptor,A=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?p(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&C(t,r,i),i},"__decorateClass$3"),b=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$3");let y="rpc.remote-sync.service",R=(0,i.createIdentifier)(y),S=(_(P=class{constructor(e){this._commandService=e}async syncMutation(e){return this._commandService.syncExecuteCommand(e.mutationInfo.id,e.mutationInfo.params,{onlyLocal:!0,fromSync:!0})}},"RemoteSyncPrimaryService"),P);S=A([b(0,i.ICommandService)],S);let O="univer.remote-instance-service",T=(0,i.createIdentifier)(O),V=(_(w=class{constructor(e,t,r){this._univerInstanceService=e,this._commandService=t,this._logService=r}whenReady(){return Promise.resolve(!0)}async syncMutation(e){return this._applyMutation(e.mutationInfo)}async createInstance(e){let{type:t,snapshot:r}=e;try{if(t===i.UniverInstanceType.UNIVER_SHEET)return this._univerInstanceService.createUnit(i.UniverInstanceType.UNIVER_SHEET,r),!0;throw Error(`[WebWorkerRemoteInstanceService]: cannot create replica for document type: ${t}.`)}catch(e){throw e instanceof Error?e:TypeError(`${e}`)}}async disposeInstance(e){return this._univerInstanceService.disposeUnit(e.unitID)}_applyMutation(e){let{id:t,params:r}=e;return this._commandService.syncExecuteCommand(t,r,{onlyLocal:!0,fromSync:!0})}},"WebWorkerRemoteInstanceService"),w);function I(e){return new class{call(t,r){let a=e[t];if("function"==typeof a){let t=a.apply(e,[r]);return t instanceof Promise||(t=Promise.resolve(t)),t}throw Error(`[RPC]: method not found for ${t}!`)}subscribe(t,r){let a=e[t];if("function"==typeof a){let t=a.apply(e,r);return(0,h.isObservable)(t)?t:(0,f.of)(t)}throw Error(`[RPC]: observable method not found for ${t}!`)}}}function M(e){return new Proxy({},{get(t,r){if("dispose"!==r)return function(...t){return x(r)?e.subscribe(r,t[0]):e.call(r,t[0])}}})}function x(e){return e.endsWith("$")}V=A([b(0,i.IUniverInstanceService),b(1,i.ICommandService),b(2,i.ILogService)],V),_(I,"fromModule"),_(M,"toModule"),_(x,"propertyIsEventSource");let v=class extends i.RxDisposable{constructor(e){super(),E(this,"_initialized",new o.BehaviorSubject(!1)),E(this,"_lastRequestCounter",0),E(this,"_pendingRequests",/* @__PURE__ */new Map),this._protocol=e,this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onMessage(e))}dispose(){this._pendingRequests.clear()}getChannel(e){let t=this;return{call:(r,a)=>t._disposed?Promise.reject():t._remoteCall(e,r,a),subscribe(r,a){if(t._disposed)throw Error("[ChannelClient]: client is disposed!");return t._remoteSubscribe(e,r,a)}}}_whenReady(){return(0,c.firstValueFrom)(this._initialized.pipe((0,s.filter)(e=>e),(0,u.take)(1)))}async _remoteCall(e,t,r){await this._whenReady();let a=++this._lastRequestCounter,n={seq:a,type:100,channelName:e,method:t,args:r},i=this;return new Promise((e,t)=>{this._pendingRequests.set(a,{handle(r){switch(r.type){case 201:i._pendingRequests.delete(a),e(r.data);break;case 202:i._pendingRequests.delete(a),t(r.data);break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(n)})}_remoteSubscribe(e,t,r){return new m.Observable(a=>{let n=-1;return this._whenReady().then(()=>{let i={seq:n=++this._lastRequestCounter,type:101,channelName:e,method:t,args:r};this._pendingRequests.set(n,{handle(e){switch(e.type){case 300:a.next(e.data);break;case 301:a.error(e.data);break;case 302:a.complete();break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(i)}),()=>{if(-1===n)return;let r={type:102,seq:n,channelName:e,method:t};this._sendRequest(r)}})}_sendRequest(e){this._protocol.send(e)}_onMessage(e){var t;switch(e.type){case 0:this._initialized.next(!0);break;case 201:case 202:case 300:case 302:case 301:null==(t=this._pendingRequests.get(e.seq))||t.handle(e)}}};_(v,"ChannelClient");let U=class extends i.RxDisposable{constructor(e){super(),E(this,"_channels",/* @__PURE__ */new Map),E(this,"_subscriptions",/* @__PURE__ */new Map),this._protocol=e,this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onRequest(e)),this._sendResponse({seq:-1,type:0})}dispose(){super.dispose(),this._subscriptions.clear(),this._channels.clear()}registerChannel(e,t){this._channels.set(e,t)}_onRequest(e){switch(e.type){case 100:this._onMethodCall(e);break;case 101:this._onSubscribe(e);break;case 102:this._onUnsubscribe(e)}}_onMethodCall(e){let t;let{channelName:r,method:a,args:n}=e,i=this._channels.get(r);try{if(!i)throw Error(`[ChannelServer]: Channel ${r} not found!`);t=i.call(a,n)}catch(e){t=Promise.reject(e)}t.then(t=>{this._sendResponse({seq:e.seq,type:201,data:t})}).catch(t=>{t instanceof Error?this._sendResponse({seq:e.seq,type:202,data:t.message}):this._sendResponse({seq:e.seq,type:202,data:String(t)})})}_onSubscribe(e){let{channelName:t,seq:r}=e,a=this._channels.get(t);try{if(!a)throw Error(`[ChannelServer]: Channel ${t} not found!`);let n=a.subscribe(e.method,e.args).subscribe({next:/* @__PURE__ */_(e=>{this._sendResponse({seq:r,type:300,data:e})},"next"),error:/* @__PURE__ */_(e=>{this._sendResponse({seq:r,type:301,data:e.message}),this._sendResponse({seq:r,type:302})},"error"),complete:/* @__PURE__ */_(()=>{this._sendResponse({seq:r,type:302})},"complete")});this._subscriptions.set(e.seq,n)}catch(t){t instanceof Error?this._sendResponse({seq:e.seq,type:301,data:t.message}):this._sendResponse({seq:e.seq,type:301,data:String(t)})}}_onUnsubscribe(e){let t=this._subscriptions.get(e.seq);t&&(t.unsubscribe(),this._subscriptions.delete(e.seq))}_sendResponse(e){this._protocol.send(e)}};_(U,"ChannelServer");let D=(0,i.createIdentifier)("IRPCChannelService"),L=class{constructor(e){E(this,"_client"),E(this,"_server"),this._client=new v(e),this._server=new U(e)}dispose(){this._client.dispose(),this._server.dispose()}requestChannel(e){return this._client.getChannel(e)}registerChannel(e,t){this._server.registerChannel(e,t)}};_(L,"ChannelService");var P,w,F,j=Object.defineProperty,B=Object.getOwnPropertyDescriptor,k=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?B(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&j(t,r,i),i},"__decorateClass$2"),$=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$2");let H=(F=class extends i.RxDisposable{constructor(e,t,r,a,n){super(),E(this,"_remoteInstanceService"),E(this,"_syncingUnits",/* @__PURE__ */new Set),E(this,"_syncingMutations",/* @__PURE__ */new Set),this._injector=e,this._commandService=t,this._univerInstanceService=r,this._rpcChannelService=a,this._remoteSyncService=n,this._initRPCChannels(),this._init()}registerSyncingMutations(e){this._syncingMutations.add(e.id)}syncUnit(e){return this._syncingUnits.add(e),(0,i.toDisposable)(()=>this._syncingUnits.delete(e))}_initRPCChannels(){this._rpcChannelService.registerChannel(y,I(this._remoteSyncService)),this._injector.add([T,{useFactory:/* @__PURE__ */_(()=>M(this._rpcChannelService.requestChannel(O)),"useFactory")}]),this._remoteInstanceService=this._injector.get(T)}_init(){this._univerInstanceService.getTypeOfUnitAdded$(i.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.add(e.getUnitId()),this._remoteInstanceService.createInstance({unitID:e.getUnitId(),type:i.UniverInstanceType.UNIVER_SHEET,snapshot:e.getSnapshot()})}),this._univerInstanceService.getTypeOfUnitDisposed$(i.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.delete(e.getUnitId()),this._remoteInstanceService.disposeInstance({unitID:e.getUnitId()})}),this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{let{type:r,params:a,id:n}=e,s=(null==a?void 0:a.unitId)||"";r===i.CommandType.MUTATION&&(!s||this._syncingUnits.has(s))&&!(null!=t&&t.fromSync)&&this._syncingMutations.has(n)&&this._remoteInstanceService.syncMutation({mutationInfo:e})}))}},_(F,"DataSyncPrimaryController"),F);H=k([(0,i.OnLifecycle)(i.LifecycleStages.Starting,H),$(0,(0,i.Inject)(i.Injector)),$(1,i.ICommandService),$(2,i.IUniverInstanceService),$(3,D),$(4,R)],H);var Y,G=Object.defineProperty,q=Object.getOwnPropertyDescriptor,W=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?q(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&G(t,r,i),i},"__decorateClass$1"),Q=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$1");let X=(Y=class extends i.Disposable{constructor(e,t,r,a){super(),E(this,"_remoteSyncService"),this._injector=e,this._remoteInstanceService=t,this._commandService=r,this._rpcChannelService=a,this._initRPCChannels(),this._init()}_initRPCChannels(){this._rpcChannelService.registerChannel(O,I(this._remoteInstanceService)),this._injector.add([R,{useFactory:/* @__PURE__ */_(()=>M(this._rpcChannelService.requestChannel(y)),"useFactory")}]),this._remoteSyncService=this._injector.get(R)}_init(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{e.type!==i.CommandType.MUTATION||null!=t&&t.fromSync||this._remoteSyncService.syncMutation({mutationInfo:e})}))}},_(Y,"DataSyncReplicaController"),Y);function K(){return{send(e){postMessage(e)},onMessage:new(0,m.Observable)(e=>{let t=/* @__PURE__ */_(t=>{e.next(t.data)},"handler");return addEventListener("message",t),()=>removeEventListener("message",t)}).pipe((0,g.shareReplay)(1))}}function z(e){return{send(t){e.postMessage(t)},onMessage:new(0,m.Observable)(t=>{let r=/* @__PURE__ */_(e=>{t.next(e.data)},"handler");return e.addEventListener("message",r),()=>e.removeEventListener("message",r)}).pipe((0,g.shareReplay)(1))}}X=W([(0,i.OnLifecycle)(i.LifecycleStages.Starting,X),Q(0,(0,i.Inject)(i.Injector)),Q(1,T),Q(2,i.ICommandService),Q(3,D)],X),_(K,"createWebWorkerMessagePortOnWorker"),_(z,"createWebWorkerMessagePortOnMain");let Z={},J={};var ee,et=Object.defineProperty,er=Object.getOwnPropertyDescriptor,ea=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?er(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&et(t,r,i),i},"__decorateClass"),en=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam");let ei=(ee=class extends i.Plugin{constructor(e=Z,t,r){super(),E(this,"_internalWorker",null),this._config=e,this._injector=t,this._configService=r;let{...a}=this._config;this._configService.setConfig("rpc.main-thread.config",a)}dispose(){super.dispose(),this._internalWorker&&(this._internalWorker.terminate(),this._internalWorker=null)}onStarting(){let{workerURL:e}=this._config;if(!e)throw Error("[UniverRPCMainThreadPlugin]: The workerURL is required for the RPC main thread plugin.");let t=e instanceof Worker?e:new Worker(e);this._internalWorker=e instanceof Worker?null:t;let r=z(t);[[D,{useFactory:/* @__PURE__ */_(()=>new L(r),"useFactory")}],[H],[R,{useClass:S}]].forEach(e=>this._injector.add(e)),this._injector.get(H)}},_(ee,"UniverRPCMainThreadPlugin"),E(ee,"pluginName","UNIVER_RPC_MAIN_THREAD_PLUGIN"),ee);ei=ea([en(1,(0,i.Inject)(i.Injector)),en(2,i.IConfigService)],ei);let es=(n=class extends i.Plugin{constructor(e=J,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...a}=this._config;this._configService.setConfig("rpc.worker-thread.config",a)}onStarting(){[[X],[D,{useFactory:/* @__PURE__ */_(()=>new L(K()),"useFactory")}],[T,{useClass:V}]].forEach(e=>this._injector.add(e)),this._injector.get(X)}},_(n,"UniverRPCWorkerThreadPlugin"),E(n,"pluginName","UNIVER_RPC_WORKER_THREAD_PLUGIN"),n);ea([en(1,(0,i.Inject)(i.Injector)),en(2,i.IConfigService)],es)}),r("2jrJe",function(r,a){e(r.exports,"takeUntil",function(){return l});var n=t("jSzwf"),i=t("iNetn"),s=t("b7gpN"),u=t("f1euv");function l(e){return(0,n.operate)(function(t,r){(0,s.innerFrom)(e).subscribe((0,i.createOperatorSubscriber)(r,function(){return r.complete()},u.noop)),r.closed||t.subscribe(r)})}}),r("dBx9C",function(r,a){e(r.exports,"firstValueFrom",function(){return s});var n=t("aXqMV"),i=t("lftZl");function s(e,t){var r="object"==typeof t;return new Promise(function(a,s){var u=new i.SafeSubscriber({next:function(e){a(e),u.unsubscribe()},error:s,complete:function(){r?a(t.defaultValue):s(new n.EmptyError)}});e.subscribe(u)})}}),r("hRiv7",function(r,a){e(r.exports,"isObservable",function(){return s});var n=t("1O3Nt"),i=t("3IQI0");function s(e){return!!e&&(e instanceof n.Observable||(0,i.isFunction)(e.lift)&&(0,i.isFunction)(e.subscribe))}}),r("c3hg1",function(r,a){e(r.exports,"shareReplay",function(){return s});var n=t("3rvNF"),i=t("8LCGH");function s(e,t,r){var a,s,u,l,o=!1;return e&&"object"==typeof e?(l=void 0===(a=e.bufferSize)?1/0:a,t=void 0===(s=e.windowTime)?1/0:s,o=void 0!==(u=e.refCount)&&u,r=e.scheduler):l=null!=e?e:1/0,(0,i.share)({connector:function(){return new n.ReplaySubject(l,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}}),r("3rvNF",function(r,a){e(r.exports,"ReplaySubject",function(){return u});var n=t("1a7ft"),i=t("1mjSk"),s=t("O2Flc"),u=function(e){function t(t,r,a){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===a&&(a=s.dateTimestampProvider);var n=e.call(this)||this;return n._bufferSize=t,n._windowTime=r,n._timestampProvider=a,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=r===1/0,n._bufferSize=Math.max(1,t),n._windowTime=Math.max(1,r),n}return(0,n.__extends)(t,e),t.prototype.next=function(t){var r=this.isStopped,a=this._buffer,n=this._infiniteTimeWindow,i=this._timestampProvider,s=this._windowTime;!r&&(a.push(t),n||a.push(i.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,a=this._buffer.slice(),n=0;n<a.length&&!e.closed;n+=r?1:2)e.next(a[n]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,a=this._infiniteTimeWindow,n=(a?1:2)*e;if(e<1/0&&n<r.length&&r.splice(0,r.length-n),!a){for(var i=t.now(),s=0,u=1;u<r.length&&r[u]<=i;u+=2)s=u;s&&r.splice(0,s+1)}},t}(i.Subject)}),r("8LCGH",function(r,a){e(r.exports,"share",function(){return o});var n=t("1a7ft"),i=t("b7gpN"),s=t("1mjSk"),u=t("lftZl"),l=t("jSzwf");function o(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new s.Subject}:t,a=e.resetOnError,n=void 0===a||a,o=e.resetOnComplete,h=void 0===o||o,m=e.resetOnRefCountZero,f=void 0===m||m;return function(e){var t,a,s,o=0,m=!1,g=!1,d=function(){null==a||a.unsubscribe(),a=void 0},N=function(){d(),t=s=void 0,m=g=!1},_=function(){var e=t;N(),null==e||e.unsubscribe()};return(0,l.operate)(function(e,l){o++,g||m||d();var E=s=null!=s?s:r();l.add(function(){0!=--o||g||m||(a=c(_,f))}),E.subscribe(l),!t&&o>0&&(t=new u.SafeSubscriber({next:function(e){return E.next(e)},error:function(e){g=!0,d(),a=c(N,n,e),E.error(e)},complete:function(){m=!0,d(),a=c(N,h),E.complete()}}),(0,i.innerFrom)(e).subscribe(t))})(e)}}function c(e,t){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];if(!0===t){e();return}if(!1!==t){var s=new u.SafeSubscriber({next:function(){s.unsubscribe(),e()}});return(0,i.innerFrom)(t.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(r)))).subscribe(s)}}});
//# sourceMappingURL=es.4fcbf5f3.js.map
