{"mappings":"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","sources":["<anon>","node_modules/@univerjs/docs/lib/es/index.js","node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js","node_modules/rxjs/src/internal/operators/takeUntil.ts"],"sourcesContent":["(function () {\n\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n\n      var $parcel$global =\n        typeof globalThis !== 'undefined'\n          ? globalThis\n          : typeof self !== 'undefined'\n          ? self\n          : typeof window !== 'undefined'\n          ? window\n          : typeof global !== 'undefined'\n          ? global\n          : {};\n  var parcelRequire = $parcel$global[\"parcelRequire26fc\"];\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"kB4bq\", function(module, exports) {\n\n$parcel$export(module.exports, \"SetTextSelectionsOperation\", function () { return $efea821103d1be34$export$bbaf5c73dc455386; });\n$parcel$export(module.exports, \"DocSelectionManagerService\", function () { return $efea821103d1be34$export$48e4577d7a229f0a; });\n$parcel$export(module.exports, \"DocSkeletonManagerService\", function () { return $efea821103d1be34$export$aee3082e5b786336; });\n$parcel$export(module.exports, \"DocStateEmitService\", function () { return $efea821103d1be34$export$abde8bb35be70afa; });\n$parcel$export(module.exports, \"RichTextEditingMutation\", function () { return $efea821103d1be34$export$7c0b8b211b9b73ef; });\n$parcel$export(module.exports, \"UniverDocsPlugin\", function () { return $efea821103d1be34$export$8bf9704db23df28c; });\n$parcel$export(module.exports, \"DocInterceptorService\", function () { return $efea821103d1be34$export$8fb700ffdc3732e4; });\n\nvar $83KcA = parcelRequire(\"83KcA\");\n\nvar $D79YY = parcelRequire(\"D79YY\");\n\nvar $jv4BO = parcelRequire(\"jv4BO\");\nvar $cZW0b = parcelRequire(\"cZW0b\");\nvar $efea821103d1be34$var$__defProp = Object.defineProperty;\nvar $efea821103d1be34$var$__defNormalProp = (obj, key, value)=>key in obj ? $efea821103d1be34$var$__defProp(obj, key, {\n        enumerable: !0,\n        configurable: !0,\n        writable: !0,\n        value: value\n    }) : obj[key] = value;\nvar $efea821103d1be34$var$__name = (target, value)=>$efea821103d1be34$var$__defProp(target, \"name\", {\n        value: value,\n        configurable: !0\n    });\nvar $efea821103d1be34$var$__publicField = (obj, key, value)=>$efea821103d1be34$var$__defNormalProp(obj, typeof key != \"symbol\" ? key + \"\" : key, value);\nconst $efea821103d1be34$export$bbaf5c73dc455386 = {\n    id: \"doc.operation.set-selections\",\n    type: (0, $83KcA.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $efea821103d1be34$var$__name((_, __)=>!0, \"handler\")\n};\nvar $efea821103d1be34$var$__defProp$4 = Object.defineProperty, $efea821103d1be34$var$__getOwnPropDesc$4 = Object.getOwnPropertyDescriptor, $efea821103d1be34$var$__decorateClass$4 = /* @__PURE__ */ $efea821103d1be34$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $efea821103d1be34$var$__getOwnPropDesc$4(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $efea821103d1be34$var$__defProp$4(target, key, result), result;\n}, \"__decorateClass$4\"), $efea821103d1be34$var$__decorateParam$4 = /* @__PURE__ */ $efea821103d1be34$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$4\"), $efea821103d1be34$var$_a;\nlet $efea821103d1be34$export$48e4577d7a229f0a = ($efea821103d1be34$var$_a = class extends (0, $83KcA.RxDisposable) {\n    constructor(_commandService, _univerInstanceService){\n        super();\n        $efea821103d1be34$var$__publicField(this, \"_currentSelection\", null);\n        $efea821103d1be34$var$__publicField(this, \"_textSelectionInfo\", /* @__PURE__ */ new Map());\n        $efea821103d1be34$var$__publicField(this, \"_textSelection$\", new (0, $jv4BO.BehaviorSubject)(null));\n        $efea821103d1be34$var$__publicField(this, \"textSelection$\", this._textSelection$.asObservable());\n        $efea821103d1be34$var$__publicField(this, \"_refreshSelection$\", new (0, $jv4BO.BehaviorSubject)(null));\n        $efea821103d1be34$var$__publicField(this, \"refreshSelection$\", this._refreshSelection$.asObservable());\n        this._commandService = _commandService, this._univerInstanceService = _univerInstanceService, this._listenCurrentUnit();\n    }\n    _listenCurrentUnit() {\n        this._univerInstanceService.getCurrentTypeOfUnit$((0, $83KcA.UniverInstanceType).UNIVER_DOC).pipe((0, $cZW0b.takeUntil)(this.dispose$)).subscribe((documentModel)=>{\n            if (documentModel == null) return;\n            const unitId = documentModel.getUnitId();\n            this._setCurrentSelectionNotRefresh({\n                unitId: unitId,\n                subUnitId: unitId\n            });\n        });\n    }\n    getCurrentSelection() {\n        return this._currentSelection;\n    }\n    // Get textRanges, style, segmentId\n    /**\n   * @deprecated\n   */ getCurrentSelectionInfo() {\n        return this._getTextRanges(this._currentSelection);\n    }\n    refreshSelection() {\n        this._currentSelection != null && this._refresh(this._currentSelection);\n    }\n    // **Only used in test case** because this does not go through the render layer.\n    setCurrentSelection(param) {\n        this._currentSelection = param, this._refresh(param);\n    }\n    getCurrentTextRanges() {\n        var _a6;\n        return (_a6 = this._getTextRanges(this._currentSelection)) == null ? void 0 : _a6.textRanges;\n    }\n    getCurrentRectRanges() {\n        var _a6;\n        return (_a6 = this._getTextRanges(this._currentSelection)) == null ? void 0 : _a6.rectRanges;\n    }\n    getDocRanges() {\n        var _a6, _b;\n        const textRanges = (_a6 = this.getCurrentTextRanges()) != null ? _a6 : [], rectRanges = (_b = this.getCurrentRectRanges()) != null ? _b : [];\n        return [\n            ...textRanges,\n            ...rectRanges\n        ].filter((range)=>range.startOffset != null && range.endOffset != null).sort((a, b)=>a.startOffset > b.startOffset ? 1 : a.startOffset < b.startOffset ? -1 : 0);\n    }\n    getActiveTextRange() {\n        const selectionInfo = this._getTextRanges(this._currentSelection);\n        if (selectionInfo == null) return;\n        const { textRanges: textRanges } = selectionInfo;\n        return textRanges.find((textRange)=>textRange.isActive);\n    }\n    /**\n   *\n   * @deprecated\n   */ getActiveRectRange() {\n        const selectionInfo = this._getTextRanges(this._currentSelection);\n        if (selectionInfo == null) return;\n        const { rectRanges: rectRanges } = selectionInfo;\n        return rectRanges.find((rectRange)=>rectRange.isActive);\n    }\n    // **Only used in test case** because this does not go through the render layer.\n    add(textRanges, isEditing = !0) {\n        this._currentSelection != null && this._addByParam({\n            ...this._currentSelection,\n            textRanges: textRanges,\n            rectRanges: [],\n            segmentId: \"\",\n            segmentPage: -1,\n            isEditing: isEditing,\n            style: (0, $D79YY.NORMAL_TEXT_SELECTION_PLUGIN_STYLE)\n        });\n    }\n    replaceTextRanges(docRanges, isEditing = !0, options) {\n        if (this._currentSelection == null) return;\n        const { unitId: unitId, subUnitId: subUnitId } = this._currentSelection;\n        this._refreshSelection$.next({\n            unitId: unitId,\n            subUnitId: subUnitId,\n            docRanges: docRanges,\n            isEditing: isEditing,\n            options: options\n        });\n    }\n    // Only use in doc-selection-render.controller.ts\n    __replaceTextRangesWithNoRefresh(textSelectionInfo) {\n        if (this._currentSelection == null) return;\n        const params = {\n            ...this._currentSelection,\n            ...textSelectionInfo\n        };\n        this._replaceByParam(params), this._textSelection$.next(params);\n        const { unitId: unitId, subUnitId: subUnitId, segmentId: segmentId, style: style, textRanges: textRanges, rectRanges: rectRanges, isEditing: isEditing } = params, ranges = [\n            ...textRanges,\n            ...rectRanges\n        ].filter((range)=>range.startOffset != null && range.endOffset != null).sort((a, b)=>a.startOffset > b.startOffset ? 1 : a.startOffset < b.startOffset ? -1 : 0);\n        this._commandService.executeCommand($efea821103d1be34$export$bbaf5c73dc455386.id, {\n            unitId: unitId,\n            subUnitId: subUnitId,\n            segmentId: segmentId,\n            style: style,\n            isEditing: isEditing,\n            ranges: ranges\n        });\n    }\n    dispose() {\n        this._textSelection$.complete();\n    }\n    _setCurrentSelectionNotRefresh(param) {\n        var _a6;\n        const { unitId: unitId, subUnitId: subUnitId } = (_a6 = this._currentSelection) != null ? _a6 : {}, { unitId: newUnitId, subUnitId: newSubUnitId } = param;\n        (unitId !== newUnitId || subUnitId !== newSubUnitId) && (unitId && subUnitId && this._refreshSelection$.next({\n            unitId: unitId,\n            subUnitId: subUnitId,\n            docRanges: [],\n            isEditing: !1\n        }), this._currentSelection = param);\n    }\n    _getTextRanges(param) {\n        var _a6;\n        if (param == null) return;\n        const { unitId: unitId, subUnitId: subUnitId = \"\" } = param;\n        return (_a6 = this._textSelectionInfo.get(unitId)) == null ? void 0 : _a6.get(subUnitId);\n    }\n    _refresh(param) {\n        const allTextSelectionInfo = this._getTextRanges(param);\n        if (allTextSelectionInfo == null) return;\n        const { textRanges: textRanges, rectRanges: rectRanges } = allTextSelectionInfo, docRanges = [\n            ...textRanges,\n            ...rectRanges\n        ], { unitId: unitId, subUnitId: subUnitId } = param;\n        this._refreshSelection$.next({\n            unitId: unitId,\n            subUnitId: subUnitId,\n            docRanges: docRanges,\n            isEditing: !1\n        });\n    }\n    _replaceByParam(insertParam) {\n        const { unitId: unitId, subUnitId: subUnitId, ...selectionInsertParam } = insertParam;\n        this._textSelectionInfo.has(unitId) || this._textSelectionInfo.set(unitId, /* @__PURE__ */ new Map()), this._textSelectionInfo.get(unitId).set(subUnitId, {\n            ...selectionInsertParam\n        });\n    }\n    _addByParam(insertParam) {\n        const { unitId: unitId, subUnitId: subUnitId, ...selectionInsertParam } = insertParam;\n        this._textSelectionInfo.has(unitId) || this._textSelectionInfo.set(unitId, /* @__PURE__ */ new Map());\n        const unitTextRange = this._textSelectionInfo.get(unitId);\n        unitTextRange.has(subUnitId) ? unitTextRange.get(subUnitId).textRanges.push(...insertParam.textRanges) : unitTextRange.set(subUnitId, {\n            ...selectionInsertParam\n        });\n    }\n}, $efea821103d1be34$var$__name($efea821103d1be34$var$_a, \"DocSelectionManagerService\"), $efea821103d1be34$var$_a);\n$efea821103d1be34$export$48e4577d7a229f0a = $efea821103d1be34$var$__decorateClass$4([\n    $efea821103d1be34$var$__decorateParam$4(0, (0, $83KcA.ICommandService)),\n    $efea821103d1be34$var$__decorateParam$4(1, (0, $83KcA.IUniverInstanceService))\n], $efea821103d1be34$export$48e4577d7a229f0a);\nvar $efea821103d1be34$var$__defProp$3 = Object.defineProperty, $efea821103d1be34$var$__getOwnPropDesc$3 = Object.getOwnPropertyDescriptor, $efea821103d1be34$var$__decorateClass$3 = /* @__PURE__ */ $efea821103d1be34$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $efea821103d1be34$var$__getOwnPropDesc$3(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $efea821103d1be34$var$__defProp$3(target, key, result), result;\n}, \"__decorateClass$3\"), $efea821103d1be34$var$__decorateParam$3 = /* @__PURE__ */ $efea821103d1be34$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$3\"), $efea821103d1be34$var$_a2;\nlet $efea821103d1be34$export$aee3082e5b786336 = ($efea821103d1be34$var$_a2 = class extends (0, $83KcA.RxDisposable) {\n    constructor(_context, _localeService, _univerInstanceService){\n        super();\n        $efea821103d1be34$var$__publicField(this, \"_skeleton\");\n        $efea821103d1be34$var$__publicField(this, \"_docViewModel\");\n        $efea821103d1be34$var$__publicField(this, \"_currentSkeleton$\", new (0, $jv4BO.BehaviorSubject)(null));\n        $efea821103d1be34$var$__publicField(this, \"currentSkeleton$\", this._currentSkeleton$.asObservable());\n        // CurrentSkeletonBefore for pre-triggered logic during registration\n        $efea821103d1be34$var$__publicField(this, \"_currentSkeletonBefore$\", new (0, $jv4BO.BehaviorSubject)(null));\n        $efea821103d1be34$var$__publicField(this, \"currentSkeletonBefore$\", this._currentSkeletonBefore$.asObservable());\n        $efea821103d1be34$var$__publicField(this, \"_currentViewModel$\", new (0, $jv4BO.BehaviorSubject)(null));\n        $efea821103d1be34$var$__publicField(this, \"currentViewModel$\", this._currentViewModel$.asObservable());\n        this._context = _context, this._localeService = _localeService, this._univerInstanceService = _univerInstanceService, this._init(), this._univerInstanceService.getCurrentTypeOfUnit$((0, $83KcA.UniverInstanceType).UNIVER_DOC).pipe((0, $cZW0b.takeUntil)(this.dispose$)).subscribe((documentModel)=>{\n            documentModel && documentModel.getUnitId() === this._context.unitId && this._update(documentModel);\n        });\n    }\n    dispose() {\n        super.dispose(), this._currentSkeletonBefore$.complete(), this._currentSkeleton$.complete();\n    }\n    getSkeleton() {\n        return this._skeleton;\n    }\n    getViewModel() {\n        return this._docViewModel;\n    }\n    _init() {\n        const documentDataModel = this._context.unit;\n        this._update(documentDataModel);\n    }\n    _update(documentDataModel) {\n        const unitId = this._context.unitId;\n        if (documentDataModel.getBody() == null) return;\n        this._docViewModel && (0, $83KcA.isInternalEditorID)(unitId) ? (this._docViewModel.reset(documentDataModel), this._context.unit = documentDataModel) : this._docViewModel || (this._docViewModel = this._buildDocViewModel(documentDataModel)), this._skeleton || (this._skeleton = this._buildSkeleton(this._docViewModel));\n        const skeleton = this._skeleton;\n        skeleton.calculate(), this._currentSkeletonBefore$.next(skeleton), this._currentSkeleton$.next(skeleton), this._currentViewModel$.next(this._docViewModel);\n    }\n    _buildSkeleton(documentViewModel) {\n        return (0, $D79YY.DocumentSkeleton).create(documentViewModel, this._localeService);\n    }\n    _buildDocViewModel(documentDataModel) {\n        return new (0, $D79YY.DocumentViewModel)(documentDataModel);\n    }\n}, $efea821103d1be34$var$__name($efea821103d1be34$var$_a2, \"DocSkeletonManagerService\"), $efea821103d1be34$var$_a2);\n$efea821103d1be34$export$aee3082e5b786336 = $efea821103d1be34$var$__decorateClass$3([\n    $efea821103d1be34$var$__decorateParam$3(1, (0, $83KcA.Inject)((0, $83KcA.LocaleService))),\n    $efea821103d1be34$var$__decorateParam$3(2, (0, $83KcA.IUniverInstanceService))\n], $efea821103d1be34$export$aee3082e5b786336);\nconst $efea821103d1be34$var$_DocStateEmitService = class _DocStateEmitService extends (0, $83KcA.RxDisposable) {\n    constructor(){\n        super();\n        $efea821103d1be34$var$__publicField(this, \"_docStateChangeParams$\", new (0, $jv4BO.BehaviorSubject)(null));\n        $efea821103d1be34$var$__publicField(this, \"docStateChangeParams$\", this._docStateChangeParams$.asObservable());\n    }\n    emitStateChangeInfo(params) {\n        this._docStateChangeParams$.next(params);\n    }\n    dispose() {\n        super.dispose(), this._docStateChangeParams$.complete();\n    }\n};\n$efea821103d1be34$var$__name($efea821103d1be34$var$_DocStateEmitService, \"DocStateEmitService\");\nlet $efea821103d1be34$export$abde8bb35be70afa = $efea821103d1be34$var$_DocStateEmitService;\nconst $efea821103d1be34$var$RichTextEditingMutationId = \"doc.mutation.rich-text-editing\", $efea821103d1be34$export$7c0b8b211b9b73ef = {\n    id: $efea821103d1be34$var$RichTextEditingMutationId,\n    type: (0, $83KcA.CommandType).MUTATION,\n    handler: /* @__PURE__ */ $efea821103d1be34$var$__name((accessor, params)=>{\n        var _a6, _b;\n        const { unitId: unitId, segmentId: segmentId = \"\", actions: actions, textRanges: textRanges, prevTextRanges: prevTextRanges, trigger: trigger, noHistory: noHistory, isCompositionEnd: isCompositionEnd, noNeedSetTextRange: noNeedSetTextRange, debounce: debounce } = params, univerInstanceService = accessor.get((0, $83KcA.IUniverInstanceService)), renderManagerService = accessor.get((0, $D79YY.IRenderManagerService)), docStateEmitService = accessor.get($efea821103d1be34$export$abde8bb35be70afa), documentDataModel = univerInstanceService.getUniverDocInstance(unitId), documentViewModel = (_a6 = renderManagerService.getRenderById(unitId)) == null ? void 0 : _a6.with($efea821103d1be34$export$aee3082e5b786336).getViewModel();\n        if (documentDataModel == null || documentViewModel == null) throw new Error(`DocumentDataModel or documentViewModel not found for unitId: ${unitId}`);\n        const docSelectionManagerService = accessor.get($efea821103d1be34$export$48e4577d7a229f0a), docRanges = (_b = docSelectionManagerService.getDocRanges()) != null ? _b : [], disabled = !!documentDataModel.getSnapshot().disabled;\n        if ((0, $83KcA.JSONX).isNoop(actions) || actions && actions.length === 0 || disabled) return {\n            unitId: unitId,\n            actions: [],\n            textRanges: docRanges\n        };\n        const undoActions = (0, $83KcA.JSONX).invertWithDoc(actions, documentDataModel.getSnapshot());\n        documentDataModel.apply(actions), documentViewModel.reset(documentDataModel), !noNeedSetTextRange && textRanges && trigger != null && queueMicrotask(()=>{\n            docSelectionManagerService.replaceTextRanges(textRanges, !0, params.options);\n        });\n        const changeState = {\n            commandId: $efea821103d1be34$var$RichTextEditingMutationId,\n            unitId: unitId,\n            segmentId: segmentId,\n            trigger: trigger,\n            noHistory: noHistory,\n            debounce: debounce,\n            redoState: {\n                actions: actions,\n                textRanges: textRanges\n            },\n            undoState: {\n                actions: undoActions,\n                textRanges: prevTextRanges != null ? prevTextRanges : docRanges\n            },\n            isCompositionEnd: isCompositionEnd\n        };\n        return docStateEmitService.emitStateChangeInfo(changeState), {\n            unitId: unitId,\n            actions: undoActions,\n            textRanges: docRanges\n        };\n    }, \"handler\")\n}, $efea821103d1be34$var$DocsRenameMutation = {\n    id: \"doc.mutation.rename-doc\",\n    type: (0, $83KcA.CommandType).MUTATION,\n    handler: /* @__PURE__ */ $efea821103d1be34$var$__name((accessor, params)=>{\n        const doc = accessor.get((0, $83KcA.IUniverInstanceService)).getUnit(params.unitId, (0, $83KcA.UniverInstanceType).UNIVER_DOC);\n        return doc ? (doc.setName(params.name), !0) : !1;\n    }, \"handler\")\n}, $efea821103d1be34$var$PLUGIN_CONFIG_KEY = \"docs.config\", $efea821103d1be34$var$defaultPluginConfig = {};\nvar $efea821103d1be34$var$__defProp$2 = Object.defineProperty, $efea821103d1be34$var$__getOwnPropDesc$2 = Object.getOwnPropertyDescriptor, $efea821103d1be34$var$__decorateClass$2 = /* @__PURE__ */ $efea821103d1be34$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $efea821103d1be34$var$__getOwnPropDesc$2(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $efea821103d1be34$var$__defProp$2(target, key, result), result;\n}, \"__decorateClass$2\"), $efea821103d1be34$var$__decorateParam$2 = /* @__PURE__ */ $efea821103d1be34$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$2\"), $efea821103d1be34$var$_a3;\nlet $efea821103d1be34$var$DocCustomRangeController = ($efea821103d1be34$var$_a3 = class extends (0, $83KcA.Disposable) {\n    constructor(_commandService, _textSelectionManagerService, _univerInstanceService){\n        super(), this._commandService = _commandService, this._textSelectionManagerService = _textSelectionManagerService, this._univerInstanceService = _univerInstanceService, this._initSelectionChange();\n    }\n    _transformCustomRange(doc, selection) {\n        var _a6;\n        const { startOffset: startOffset, endOffset: endOffset, collapsed: collapsed } = selection, customRanges = (_a6 = doc.getCustomRanges()) == null ? void 0 : _a6.filter((range)=>!range.wholeEntity || startOffset <= range.startIndex && endOffset > range.endIndex ? !1 : collapsed ? range.startIndex < startOffset && range.endIndex >= endOffset : (0, $83KcA.BuildTextUtils).range.isIntersects(startOffset, endOffset - 1, range.startIndex, range.endIndex));\n        if (customRanges != null && customRanges.length) {\n            let start = startOffset, end = endOffset;\n            return customRanges.forEach((range)=>{\n                start = Math.min(range.startIndex, start), end = Math.max(range.endIndex + 1, end);\n            }), {\n                ...selection,\n                startOffset: start,\n                endOffset: end,\n                collapsed: start === end\n            };\n        }\n        return selection;\n    }\n    _initSelectionChange() {\n        this.disposeWithMe(this._commandService.onCommandExecuted((commandInfo)=>{\n            if (commandInfo.id === $efea821103d1be34$export$bbaf5c73dc455386.id) {\n                const params = commandInfo.params, { unitId: unitId, ranges: ranges, isEditing: isEditing } = params, doc = this._univerInstanceService.getUnit(unitId);\n                if (!doc) return;\n                const transformedRanges = ranges.map((range)=>this._transformCustomRange(doc, range));\n                transformedRanges.some((range, i)=>ranges[i] !== range) && this._textSelectionManagerService.replaceTextRanges(transformedRanges, isEditing);\n            }\n        }));\n    }\n}, $efea821103d1be34$var$__name($efea821103d1be34$var$_a3, \"DocCustomRangeController\"), $efea821103d1be34$var$_a3);\n$efea821103d1be34$var$DocCustomRangeController = $efea821103d1be34$var$__decorateClass$2([\n    (0, $83KcA.OnLifecycle)((0, $83KcA.LifecycleStages).Ready, $efea821103d1be34$var$DocCustomRangeController),\n    $efea821103d1be34$var$__decorateParam$2(0, (0, $83KcA.ICommandService)),\n    $efea821103d1be34$var$__decorateParam$2(1, (0, $83KcA.Inject)($efea821103d1be34$export$48e4577d7a229f0a)),\n    $efea821103d1be34$var$__decorateParam$2(2, (0, $83KcA.IUniverInstanceService))\n], $efea821103d1be34$var$DocCustomRangeController);\nvar $efea821103d1be34$var$__defProp$1 = Object.defineProperty, $efea821103d1be34$var$__getOwnPropDesc$1 = Object.getOwnPropertyDescriptor, $efea821103d1be34$var$__decorateClass$1 = /* @__PURE__ */ $efea821103d1be34$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $efea821103d1be34$var$__getOwnPropDesc$1(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $efea821103d1be34$var$__defProp$1(target, key, result), result;\n}, \"__decorateClass$1\"), $efea821103d1be34$var$__decorateParam$1 = /* @__PURE__ */ $efea821103d1be34$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$1\");\nconst $efea821103d1be34$var$PLUGIN_NAME = \"DOCS_PLUGIN\";\nvar $efea821103d1be34$var$_a4;\nlet $efea821103d1be34$export$8bf9704db23df28c = ($efea821103d1be34$var$_a4 = class extends (0, $83KcA.Plugin) {\n    constructor(_config = $efea821103d1be34$var$defaultPluginConfig, _injector, _configService){\n        super(), this._config = _config, this._injector = _injector, this._configService = _configService;\n        const { ...rest } = this._config;\n        this._configService.setConfig($efea821103d1be34$var$PLUGIN_CONFIG_KEY, rest), this._initializeDependencies(_injector), this._initializeCommands();\n    }\n    _initializeCommands() {\n        [\n            $efea821103d1be34$export$7c0b8b211b9b73ef,\n            $efea821103d1be34$var$DocsRenameMutation,\n            $efea821103d1be34$export$bbaf5c73dc455386\n        ].forEach((command)=>{\n            this._injector.get((0, $83KcA.ICommandService)).registerCommand(command);\n        });\n    }\n    _initializeDependencies(docInjector) {\n        [\n            // services\n            [\n                $efea821103d1be34$export$48e4577d7a229f0a\n            ],\n            [\n                $efea821103d1be34$export$abde8bb35be70afa\n            ],\n            // controllers\n            [\n                $efea821103d1be34$var$DocCustomRangeController\n            ]\n        ].forEach((d)=>docInjector.add(d));\n    }\n}, $efea821103d1be34$var$__name($efea821103d1be34$var$_a4, \"UniverDocsPlugin\"), $efea821103d1be34$var$__publicField($efea821103d1be34$var$_a4, \"pluginName\", $efea821103d1be34$var$PLUGIN_NAME), $efea821103d1be34$var$__publicField($efea821103d1be34$var$_a4, \"type\", (0, $83KcA.UniverInstanceType).UNIVER_DOC), $efea821103d1be34$var$_a4);\n$efea821103d1be34$export$8bf9704db23df28c = $efea821103d1be34$var$__decorateClass$1([\n    $efea821103d1be34$var$__decorateParam$1(1, (0, $83KcA.Inject)((0, $83KcA.Injector))),\n    $efea821103d1be34$var$__decorateParam$1(2, (0, $83KcA.IConfigService))\n], $efea821103d1be34$export$8bf9704db23df28c);\nconst $efea821103d1be34$var$CUSTOM_RANGE = (0, $83KcA.createInterceptorKey)(\"CUSTOM_RANGE\"), $efea821103d1be34$var$CUSTOM_DECORATION = (0, $83KcA.createInterceptorKey)(\"CUSTOM_DECORATION\"), $efea821103d1be34$export$175d499bafe9375c = {\n    CUSTOM_RANGE: $efea821103d1be34$var$CUSTOM_RANGE,\n    CUSTOM_DECORATION: $efea821103d1be34$var$CUSTOM_DECORATION\n};\nvar $efea821103d1be34$var$__defProp2 = Object.defineProperty, $efea821103d1be34$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor, $efea821103d1be34$var$__decorateClass = /* @__PURE__ */ $efea821103d1be34$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $efea821103d1be34$var$__getOwnPropDesc(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $efea821103d1be34$var$__defProp2(target, key, result), result;\n}, \"__decorateClass\"), $efea821103d1be34$var$__decorateParam = /* @__PURE__ */ $efea821103d1be34$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam\"), $efea821103d1be34$var$_a5;\nlet $efea821103d1be34$export$8fb700ffdc3732e4 = ($efea821103d1be34$var$_a5 = class extends (0, $83KcA.Disposable) {\n    constructor(_context, _docSkeletonManagerService){\n        super();\n        $efea821103d1be34$var$__publicField(this, \"_interceptorsByName\", /* @__PURE__ */ new Map());\n        this._context = _context, this._docSkeletonManagerService = _docSkeletonManagerService;\n        const viewModel = this._docSkeletonManagerService.getViewModel(), unitId = viewModel.getDataModel().getUnitId();\n        if (unitId === (0, $83KcA.DOCS_NORMAL_EDITOR_UNIT_ID_KEY) || unitId === (0, $83KcA.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)) return;\n        this.disposeWithMe(this.interceptDocumentViewModel(viewModel)), this.disposeWithMe(this.intercept($efea821103d1be34$export$175d499bafe9375c.CUSTOM_RANGE, {\n            priority: -1,\n            handler: /* @__PURE__ */ $efea821103d1be34$var$__name((data, pos, next)=>next(data), \"handler\")\n        }));\n        let disposableCollection = new (0, $83KcA.DisposableCollection)();\n        viewModel.segmentViewModels$.subscribe((segmentViewModels)=>{\n            disposableCollection.dispose(), disposableCollection = new (0, $83KcA.DisposableCollection)(), segmentViewModels.forEach((segmentViewModel)=>{\n                disposableCollection.add(this.interceptDocumentViewModel(segmentViewModel));\n            });\n        }), this.disposeWithMe(disposableCollection);\n    }\n    intercept(name, interceptor) {\n        const key = name;\n        this._interceptorsByName.has(key) || this._interceptorsByName.set(key, []);\n        const interceptors = this._interceptorsByName.get(key);\n        return interceptors.push(interceptor), this._interceptorsByName.set(key, interceptors.sort((a, b)=>{\n            var _a6, _b;\n            return ((_a6 = b.priority) != null ? _a6 : 0) - ((_b = a.priority) != null ? _b : 0);\n        })), this.disposeWithMe((0, $83KcA.toDisposable)(()=>(0, $83KcA.remove)(this._interceptorsByName.get(key), interceptor)));\n    }\n    fetchThroughInterceptors(name) {\n        const key = name, interceptors = this._interceptorsByName.get(key);\n        return (0, $83KcA.composeInterceptors)(interceptors || []);\n    }\n    interceptDocumentViewModel(viewModel) {\n        const disposableCollection = new (0, $83KcA.DisposableCollection)();\n        return disposableCollection.add(viewModel.registerCustomRangeInterceptor({\n            getCustomRange: /* @__PURE__ */ $efea821103d1be34$var$__name((index)=>{\n                var _a6;\n                return this.fetchThroughInterceptors($efea821103d1be34$export$175d499bafe9375c.CUSTOM_RANGE)(viewModel.getCustomRangeRaw(index), {\n                    index: index,\n                    unitId: viewModel.getDataModel().getUnitId(),\n                    customRanges: (_a6 = viewModel.getDataModel().getCustomRanges()) != null ? _a6 : []\n                });\n            }, \"getCustomRange\"),\n            getCustomDecoration: /* @__PURE__ */ $efea821103d1be34$var$__name((index)=>{\n                var _a6;\n                return this.fetchThroughInterceptors($efea821103d1be34$export$175d499bafe9375c.CUSTOM_DECORATION)(viewModel.getCustomDecorationRaw(index), {\n                    index: index,\n                    unitId: viewModel.getDataModel().getUnitId(),\n                    customDecorations: (_a6 = viewModel.getDataModel().getCustomDecorations()) != null ? _a6 : []\n                });\n            }, \"getCustomDecoration\")\n        })), disposableCollection;\n    }\n}, $efea821103d1be34$var$__name($efea821103d1be34$var$_a5, \"DocInterceptorService\"), $efea821103d1be34$var$_a5);\n$efea821103d1be34$export$8fb700ffdc3732e4 = $efea821103d1be34$var$__decorateClass([\n    (0, $83KcA.OnLifecycle)((0, $83KcA.LifecycleStages).Starting, $efea821103d1be34$export$8fb700ffdc3732e4),\n    $efea821103d1be34$var$__decorateParam(1, (0, $83KcA.Inject)($efea821103d1be34$export$aee3082e5b786336))\n], $efea821103d1be34$export$8fb700ffdc3732e4);\n\n});\nparcelRegister(\"cZW0b\", function(module, exports) {\n\n$parcel$export(module.exports, \"takeUntil\", function () { return $97682c83450dcff1$export$ac8dfd3a7ad06e80; });\n\nvar $jaOYC = parcelRequire(\"jaOYC\");\n\nvar $hMcgT = parcelRequire(\"hMcgT\");\n\nvar $jzqEI = parcelRequire(\"jzqEI\");\n\nvar $gyLB6 = parcelRequire(\"gyLB6\");\nfunction $97682c83450dcff1$export$ac8dfd3a7ad06e80(notifier) {\n    return (0, $jaOYC.operate)(function(source, subscriber) {\n        (0, $jzqEI.innerFrom)(notifier).subscribe((0, $hMcgT.createOperatorSubscriber)(subscriber, function() {\n            return subscriber.complete();\n        }, (0, $gyLB6.noop)));\n        !subscriber.closed && source.subscribe(subscriber);\n    });\n}\n\n});\n\n\n})();\n//# sourceMappingURL=es.5a078b65.js.map\n","var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: !0, configurable: !0, writable: !0, value }) : obj[key] = value;\nvar __name = (target, value) => __defProp(target, \"name\", { value, configurable: !0 });\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key != \"symbol\" ? key + \"\" : key, value);\nimport { CommandType, RxDisposable, UniverInstanceType, ICommandService, IUniverInstanceService, Inject, LocaleService, isInternalEditorID, JSONX, OnLifecycle, LifecycleStages, Disposable, BuildTextUtils, Plugin, Injector, IConfigService, createInterceptorKey, DOCS_NORMAL_EDITOR_UNIT_ID_KEY, DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY, DisposableCollection, toDisposable, remove, composeInterceptors } from \"@univerjs/core\";\nimport { NORMAL_TEXT_SELECTION_PLUGIN_STYLE, DocumentSkeleton, DocumentViewModel, IRenderManagerService } from \"@univerjs/engine-render\";\nimport { BehaviorSubject, takeUntil } from \"rxjs\";\nconst SetTextSelectionsOperation = {\n  id: \"doc.operation.set-selections\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name((_, __) => !0, \"handler\")\n};\nvar __defProp$4 = Object.defineProperty, __getOwnPropDesc$4 = Object.getOwnPropertyDescriptor, __decorateClass$4 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$4(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$4(target, key, result), result;\n}, \"__decorateClass$4\"), __decorateParam$4 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$4\"), _a;\nlet DocSelectionManagerService = (_a = class extends RxDisposable {\n  constructor(_commandService, _univerInstanceService) {\n    super();\n    __publicField(this, \"_currentSelection\", null);\n    __publicField(this, \"_textSelectionInfo\", /* @__PURE__ */ new Map());\n    __publicField(this, \"_textSelection$\", new BehaviorSubject(null));\n    __publicField(this, \"textSelection$\", this._textSelection$.asObservable());\n    __publicField(this, \"_refreshSelection$\", new BehaviorSubject(null));\n    __publicField(this, \"refreshSelection$\", this._refreshSelection$.asObservable());\n    this._commandService = _commandService, this._univerInstanceService = _univerInstanceService, this._listenCurrentUnit();\n  }\n  _listenCurrentUnit() {\n    this._univerInstanceService.getCurrentTypeOfUnit$(UniverInstanceType.UNIVER_DOC).pipe(takeUntil(this.dispose$)).subscribe((documentModel) => {\n      if (documentModel == null)\n        return;\n      const unitId = documentModel.getUnitId();\n      this._setCurrentSelectionNotRefresh({\n        unitId,\n        subUnitId: unitId\n      });\n    });\n  }\n  getCurrentSelection() {\n    return this._currentSelection;\n  }\n  // Get textRanges, style, segmentId\n  /**\n   * @deprecated\n   */\n  getCurrentSelectionInfo() {\n    return this._getTextRanges(this._currentSelection);\n  }\n  refreshSelection() {\n    this._currentSelection != null && this._refresh(this._currentSelection);\n  }\n  // **Only used in test case** because this does not go through the render layer.\n  setCurrentSelection(param) {\n    this._currentSelection = param, this._refresh(param);\n  }\n  getCurrentTextRanges() {\n    var _a6;\n    return (_a6 = this._getTextRanges(this._currentSelection)) == null ? void 0 : _a6.textRanges;\n  }\n  getCurrentRectRanges() {\n    var _a6;\n    return (_a6 = this._getTextRanges(this._currentSelection)) == null ? void 0 : _a6.rectRanges;\n  }\n  getDocRanges() {\n    var _a6, _b;\n    const textRanges = (_a6 = this.getCurrentTextRanges()) != null ? _a6 : [], rectRanges = (_b = this.getCurrentRectRanges()) != null ? _b : [];\n    return [...textRanges, ...rectRanges].filter((range) => range.startOffset != null && range.endOffset != null).sort((a, b) => a.startOffset > b.startOffset ? 1 : a.startOffset < b.startOffset ? -1 : 0);\n  }\n  getActiveTextRange() {\n    const selectionInfo = this._getTextRanges(this._currentSelection);\n    if (selectionInfo == null)\n      return;\n    const { textRanges } = selectionInfo;\n    return textRanges.find((textRange) => textRange.isActive);\n  }\n  /**\n   *\n   * @deprecated\n   */\n  getActiveRectRange() {\n    const selectionInfo = this._getTextRanges(this._currentSelection);\n    if (selectionInfo == null)\n      return;\n    const { rectRanges } = selectionInfo;\n    return rectRanges.find((rectRange) => rectRange.isActive);\n  }\n  // **Only used in test case** because this does not go through the render layer.\n  add(textRanges, isEditing = !0) {\n    this._currentSelection != null && this._addByParam({\n      ...this._currentSelection,\n      textRanges,\n      rectRanges: [],\n      segmentId: \"\",\n      segmentPage: -1,\n      isEditing,\n      style: NORMAL_TEXT_SELECTION_PLUGIN_STYLE\n      // mock style.\n    });\n  }\n  replaceTextRanges(docRanges, isEditing = !0, options) {\n    if (this._currentSelection == null)\n      return;\n    const { unitId, subUnitId } = this._currentSelection;\n    this._refreshSelection$.next({\n      unitId,\n      subUnitId,\n      docRanges,\n      isEditing,\n      options\n    });\n  }\n  // Only use in doc-selection-render.controller.ts\n  __replaceTextRangesWithNoRefresh(textSelectionInfo) {\n    if (this._currentSelection == null)\n      return;\n    const params = {\n      ...this._currentSelection,\n      ...textSelectionInfo\n    };\n    this._replaceByParam(params), this._textSelection$.next(params);\n    const { unitId, subUnitId, segmentId, style, textRanges, rectRanges, isEditing } = params, ranges = [...textRanges, ...rectRanges].filter((range) => range.startOffset != null && range.endOffset != null).sort((a, b) => a.startOffset > b.startOffset ? 1 : a.startOffset < b.startOffset ? -1 : 0);\n    this._commandService.executeCommand(SetTextSelectionsOperation.id, {\n      unitId,\n      subUnitId,\n      segmentId,\n      style,\n      isEditing,\n      ranges\n    });\n  }\n  dispose() {\n    this._textSelection$.complete();\n  }\n  _setCurrentSelectionNotRefresh(param) {\n    var _a6;\n    const { unitId, subUnitId } = (_a6 = this._currentSelection) != null ? _a6 : {}, { unitId: newUnitId, subUnitId: newSubUnitId } = param;\n    (unitId !== newUnitId || subUnitId !== newSubUnitId) && (unitId && subUnitId && this._refreshSelection$.next({\n      unitId,\n      subUnitId,\n      docRanges: [],\n      isEditing: !1\n    }), this._currentSelection = param);\n  }\n  _getTextRanges(param) {\n    var _a6;\n    if (param == null)\n      return;\n    const { unitId, subUnitId = \"\" } = param;\n    return (_a6 = this._textSelectionInfo.get(unitId)) == null ? void 0 : _a6.get(subUnitId);\n  }\n  _refresh(param) {\n    const allTextSelectionInfo = this._getTextRanges(param);\n    if (allTextSelectionInfo == null)\n      return;\n    const { textRanges, rectRanges } = allTextSelectionInfo, docRanges = [...textRanges, ...rectRanges], { unitId, subUnitId } = param;\n    this._refreshSelection$.next({\n      unitId,\n      subUnitId,\n      docRanges,\n      isEditing: !1\n    });\n  }\n  _replaceByParam(insertParam) {\n    const { unitId, subUnitId, ...selectionInsertParam } = insertParam;\n    this._textSelectionInfo.has(unitId) || this._textSelectionInfo.set(unitId, /* @__PURE__ */ new Map()), this._textSelectionInfo.get(unitId).set(subUnitId, { ...selectionInsertParam });\n  }\n  _addByParam(insertParam) {\n    const { unitId, subUnitId, ...selectionInsertParam } = insertParam;\n    this._textSelectionInfo.has(unitId) || this._textSelectionInfo.set(unitId, /* @__PURE__ */ new Map());\n    const unitTextRange = this._textSelectionInfo.get(unitId);\n    unitTextRange.has(subUnitId) ? unitTextRange.get(subUnitId).textRanges.push(...insertParam.textRanges) : unitTextRange.set(subUnitId, { ...selectionInsertParam });\n  }\n}, __name(_a, \"DocSelectionManagerService\"), _a);\nDocSelectionManagerService = __decorateClass$4([\n  __decorateParam$4(0, ICommandService),\n  __decorateParam$4(1, IUniverInstanceService)\n], DocSelectionManagerService);\nvar __defProp$3 = Object.defineProperty, __getOwnPropDesc$3 = Object.getOwnPropertyDescriptor, __decorateClass$3 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$3(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$3(target, key, result), result;\n}, \"__decorateClass$3\"), __decorateParam$3 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$3\"), _a2;\nlet DocSkeletonManagerService = (_a2 = class extends RxDisposable {\n  constructor(_context, _localeService, _univerInstanceService) {\n    super();\n    __publicField(this, \"_skeleton\");\n    __publicField(this, \"_docViewModel\");\n    __publicField(this, \"_currentSkeleton$\", new BehaviorSubject(null));\n    __publicField(this, \"currentSkeleton$\", this._currentSkeleton$.asObservable());\n    // CurrentSkeletonBefore for pre-triggered logic during registration\n    __publicField(this, \"_currentSkeletonBefore$\", new BehaviorSubject(null));\n    __publicField(this, \"currentSkeletonBefore$\", this._currentSkeletonBefore$.asObservable());\n    __publicField(this, \"_currentViewModel$\", new BehaviorSubject(null));\n    __publicField(this, \"currentViewModel$\", this._currentViewModel$.asObservable());\n    this._context = _context, this._localeService = _localeService, this._univerInstanceService = _univerInstanceService, this._init(), this._univerInstanceService.getCurrentTypeOfUnit$(UniverInstanceType.UNIVER_DOC).pipe(takeUntil(this.dispose$)).subscribe((documentModel) => {\n      documentModel && documentModel.getUnitId() === this._context.unitId && this._update(documentModel);\n    });\n  }\n  dispose() {\n    super.dispose(), this._currentSkeletonBefore$.complete(), this._currentSkeleton$.complete();\n  }\n  getSkeleton() {\n    return this._skeleton;\n  }\n  getViewModel() {\n    return this._docViewModel;\n  }\n  _init() {\n    const documentDataModel = this._context.unit;\n    this._update(documentDataModel);\n  }\n  _update(documentDataModel) {\n    const unitId = this._context.unitId;\n    if (documentDataModel.getBody() == null)\n      return;\n    this._docViewModel && isInternalEditorID(unitId) ? (this._docViewModel.reset(documentDataModel), this._context.unit = documentDataModel) : this._docViewModel || (this._docViewModel = this._buildDocViewModel(documentDataModel)), this._skeleton || (this._skeleton = this._buildSkeleton(this._docViewModel));\n    const skeleton = this._skeleton;\n    skeleton.calculate(), this._currentSkeletonBefore$.next(skeleton), this._currentSkeleton$.next(skeleton), this._currentViewModel$.next(this._docViewModel);\n  }\n  _buildSkeleton(documentViewModel) {\n    return DocumentSkeleton.create(documentViewModel, this._localeService);\n  }\n  _buildDocViewModel(documentDataModel) {\n    return new DocumentViewModel(documentDataModel);\n  }\n}, __name(_a2, \"DocSkeletonManagerService\"), _a2);\nDocSkeletonManagerService = __decorateClass$3([\n  __decorateParam$3(1, Inject(LocaleService)),\n  __decorateParam$3(2, IUniverInstanceService)\n], DocSkeletonManagerService);\nconst _DocStateEmitService = class _DocStateEmitService extends RxDisposable {\n  constructor() {\n    super();\n    __publicField(this, \"_docStateChangeParams$\", new BehaviorSubject(null));\n    __publicField(this, \"docStateChangeParams$\", this._docStateChangeParams$.asObservable());\n  }\n  emitStateChangeInfo(params) {\n    this._docStateChangeParams$.next(params);\n  }\n  dispose() {\n    super.dispose(), this._docStateChangeParams$.complete();\n  }\n};\n__name(_DocStateEmitService, \"DocStateEmitService\");\nlet DocStateEmitService = _DocStateEmitService;\nconst RichTextEditingMutationId = \"doc.mutation.rich-text-editing\", RichTextEditingMutation = {\n  id: RichTextEditingMutationId,\n  type: CommandType.MUTATION,\n  handler: /* @__PURE__ */ __name((accessor, params) => {\n    var _a6, _b;\n    const {\n      unitId,\n      segmentId = \"\",\n      actions,\n      textRanges,\n      prevTextRanges,\n      trigger,\n      noHistory,\n      isCompositionEnd,\n      noNeedSetTextRange,\n      debounce\n    } = params, univerInstanceService = accessor.get(IUniverInstanceService), renderManagerService = accessor.get(IRenderManagerService), docStateEmitService = accessor.get(DocStateEmitService), documentDataModel = univerInstanceService.getUniverDocInstance(unitId), documentViewModel = (_a6 = renderManagerService.getRenderById(unitId)) == null ? void 0 : _a6.with(DocSkeletonManagerService).getViewModel();\n    if (documentDataModel == null || documentViewModel == null)\n      throw new Error(`DocumentDataModel or documentViewModel not found for unitId: ${unitId}`);\n    const docSelectionManagerService = accessor.get(DocSelectionManagerService), docRanges = (_b = docSelectionManagerService.getDocRanges()) != null ? _b : [], disabled = !!documentDataModel.getSnapshot().disabled;\n    if (JSONX.isNoop(actions) || actions && actions.length === 0 || disabled)\n      return {\n        unitId,\n        actions: [],\n        textRanges: docRanges\n      };\n    const undoActions = JSONX.invertWithDoc(actions, documentDataModel.getSnapshot());\n    documentDataModel.apply(actions), documentViewModel.reset(documentDataModel), !noNeedSetTextRange && textRanges && trigger != null && queueMicrotask(() => {\n      docSelectionManagerService.replaceTextRanges(textRanges, !0, params.options);\n    });\n    const changeState = {\n      commandId: RichTextEditingMutationId,\n      unitId,\n      segmentId,\n      trigger,\n      noHistory,\n      debounce,\n      redoState: {\n        actions,\n        textRanges\n      },\n      undoState: {\n        actions: undoActions,\n        textRanges: prevTextRanges != null ? prevTextRanges : docRanges\n      },\n      isCompositionEnd\n    };\n    return docStateEmitService.emitStateChangeInfo(changeState), {\n      unitId,\n      actions: undoActions,\n      textRanges: docRanges\n    };\n  }, \"handler\")\n}, DocsRenameMutation = {\n  id: \"doc.mutation.rename-doc\",\n  type: CommandType.MUTATION,\n  handler: /* @__PURE__ */ __name((accessor, params) => {\n    const doc = accessor.get(IUniverInstanceService).getUnit(params.unitId, UniverInstanceType.UNIVER_DOC);\n    return doc ? (doc.setName(params.name), !0) : !1;\n  }, \"handler\")\n}, PLUGIN_CONFIG_KEY = \"docs.config\", defaultPluginConfig = {};\nvar __defProp$2 = Object.defineProperty, __getOwnPropDesc$2 = Object.getOwnPropertyDescriptor, __decorateClass$2 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$2(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$2(target, key, result), result;\n}, \"__decorateClass$2\"), __decorateParam$2 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$2\"), _a3;\nlet DocCustomRangeController = (_a3 = class extends Disposable {\n  constructor(_commandService, _textSelectionManagerService, _univerInstanceService) {\n    super(), this._commandService = _commandService, this._textSelectionManagerService = _textSelectionManagerService, this._univerInstanceService = _univerInstanceService, this._initSelectionChange();\n  }\n  _transformCustomRange(doc, selection) {\n    var _a6;\n    const { startOffset, endOffset, collapsed } = selection, customRanges = (_a6 = doc.getCustomRanges()) == null ? void 0 : _a6.filter((range) => !range.wholeEntity || startOffset <= range.startIndex && endOffset > range.endIndex ? !1 : collapsed ? range.startIndex < startOffset && range.endIndex >= endOffset : BuildTextUtils.range.isIntersects(startOffset, endOffset - 1, range.startIndex, range.endIndex));\n    if (customRanges != null && customRanges.length) {\n      let start = startOffset, end = endOffset;\n      return customRanges.forEach((range) => {\n        start = Math.min(range.startIndex, start), end = Math.max(range.endIndex + 1, end);\n      }), {\n        ...selection,\n        startOffset: start,\n        endOffset: end,\n        collapsed: start === end\n      };\n    }\n    return selection;\n  }\n  _initSelectionChange() {\n    this.disposeWithMe(this._commandService.onCommandExecuted((commandInfo) => {\n      if (commandInfo.id === SetTextSelectionsOperation.id) {\n        const params = commandInfo.params, { unitId, ranges, isEditing } = params, doc = this._univerInstanceService.getUnit(unitId);\n        if (!doc)\n          return;\n        const transformedRanges = ranges.map((range) => this._transformCustomRange(doc, range));\n        transformedRanges.some((range, i) => ranges[i] !== range) && this._textSelectionManagerService.replaceTextRanges(transformedRanges, isEditing);\n      }\n    }));\n  }\n}, __name(_a3, \"DocCustomRangeController\"), _a3);\nDocCustomRangeController = __decorateClass$2([\n  OnLifecycle(LifecycleStages.Ready, DocCustomRangeController),\n  __decorateParam$2(0, ICommandService),\n  __decorateParam$2(1, Inject(DocSelectionManagerService)),\n  __decorateParam$2(2, IUniverInstanceService)\n], DocCustomRangeController);\nvar __defProp$1 = Object.defineProperty, __getOwnPropDesc$1 = Object.getOwnPropertyDescriptor, __decorateClass$1 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$1(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$1(target, key, result), result;\n}, \"__decorateClass$1\"), __decorateParam$1 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$1\");\nconst PLUGIN_NAME = \"DOCS_PLUGIN\";\nvar _a4;\nlet UniverDocsPlugin = (_a4 = class extends Plugin {\n  constructor(_config = defaultPluginConfig, _injector, _configService) {\n    super(), this._config = _config, this._injector = _injector, this._configService = _configService;\n    const { ...rest } = this._config;\n    this._configService.setConfig(PLUGIN_CONFIG_KEY, rest), this._initializeDependencies(_injector), this._initializeCommands();\n  }\n  _initializeCommands() {\n    [\n      RichTextEditingMutation,\n      DocsRenameMutation,\n      SetTextSelectionsOperation\n    ].forEach((command) => {\n      this._injector.get(ICommandService).registerCommand(command);\n    });\n  }\n  _initializeDependencies(docInjector) {\n    [\n      // services\n      [DocSelectionManagerService],\n      [DocStateEmitService],\n      // controllers\n      [DocCustomRangeController]\n    ].forEach((d) => docInjector.add(d));\n  }\n}, __name(_a4, \"UniverDocsPlugin\"), __publicField(_a4, \"pluginName\", PLUGIN_NAME), __publicField(_a4, \"type\", UniverInstanceType.UNIVER_DOC), _a4);\nUniverDocsPlugin = __decorateClass$1([\n  __decorateParam$1(1, Inject(Injector)),\n  __decorateParam$1(2, IConfigService)\n], UniverDocsPlugin);\nconst CUSTOM_RANGE = createInterceptorKey(\"CUSTOM_RANGE\"), CUSTOM_DECORATION = createInterceptorKey(\"CUSTOM_DECORATION\"), DOC_INTERCEPTOR_POINT = {\n  CUSTOM_RANGE,\n  CUSTOM_DECORATION\n};\nvar __defProp2 = Object.defineProperty, __getOwnPropDesc = Object.getOwnPropertyDescriptor, __decorateClass = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp2(target, key, result), result;\n}, \"__decorateClass\"), __decorateParam = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam\"), _a5;\nlet DocInterceptorService = (_a5 = class extends Disposable {\n  constructor(_context, _docSkeletonManagerService) {\n    super();\n    __publicField(this, \"_interceptorsByName\", /* @__PURE__ */ new Map());\n    this._context = _context, this._docSkeletonManagerService = _docSkeletonManagerService;\n    const viewModel = this._docSkeletonManagerService.getViewModel(), unitId = viewModel.getDataModel().getUnitId();\n    if (unitId === DOCS_NORMAL_EDITOR_UNIT_ID_KEY || unitId === DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)\n      return;\n    this.disposeWithMe(this.interceptDocumentViewModel(viewModel)), this.disposeWithMe(this.intercept(DOC_INTERCEPTOR_POINT.CUSTOM_RANGE, {\n      priority: -1,\n      handler: /* @__PURE__ */ __name((data, pos, next) => next(data), \"handler\")\n    }));\n    let disposableCollection = new DisposableCollection();\n    viewModel.segmentViewModels$.subscribe((segmentViewModels) => {\n      disposableCollection.dispose(), disposableCollection = new DisposableCollection(), segmentViewModels.forEach((segmentViewModel) => {\n        disposableCollection.add(this.interceptDocumentViewModel(segmentViewModel));\n      });\n    }), this.disposeWithMe(disposableCollection);\n  }\n  intercept(name, interceptor) {\n    const key = name;\n    this._interceptorsByName.has(key) || this._interceptorsByName.set(key, []);\n    const interceptors = this._interceptorsByName.get(key);\n    return interceptors.push(interceptor), this._interceptorsByName.set(\n      key,\n      interceptors.sort((a, b) => {\n        var _a6, _b;\n        return ((_a6 = b.priority) != null ? _a6 : 0) - ((_b = a.priority) != null ? _b : 0);\n      })\n    ), this.disposeWithMe(toDisposable(() => remove(this._interceptorsByName.get(key), interceptor)));\n  }\n  fetchThroughInterceptors(name) {\n    const key = name, interceptors = this._interceptorsByName.get(key);\n    return composeInterceptors(interceptors || []);\n  }\n  interceptDocumentViewModel(viewModel) {\n    const disposableCollection = new DisposableCollection();\n    return disposableCollection.add(viewModel.registerCustomRangeInterceptor({\n      getCustomRange: /* @__PURE__ */ __name((index) => {\n        var _a6;\n        return this.fetchThroughInterceptors(DOC_INTERCEPTOR_POINT.CUSTOM_RANGE)(\n          viewModel.getCustomRangeRaw(index),\n          {\n            index,\n            unitId: viewModel.getDataModel().getUnitId(),\n            customRanges: (_a6 = viewModel.getDataModel().getCustomRanges()) != null ? _a6 : []\n          }\n        );\n      }, \"getCustomRange\"),\n      getCustomDecoration: /* @__PURE__ */ __name((index) => {\n        var _a6;\n        return this.fetchThroughInterceptors(DOC_INTERCEPTOR_POINT.CUSTOM_DECORATION)(\n          viewModel.getCustomDecorationRaw(index),\n          {\n            index,\n            unitId: viewModel.getDataModel().getUnitId(),\n            customDecorations: (_a6 = viewModel.getDataModel().getCustomDecorations()) != null ? _a6 : []\n          }\n        );\n      }, \"getCustomDecoration\")\n    })), disposableCollection;\n  }\n}, __name(_a5, \"DocInterceptorService\"), _a5);\nDocInterceptorService = __decorateClass([\n  OnLifecycle(LifecycleStages.Starting, DocInterceptorService),\n  __decorateParam(1, Inject(DocSkeletonManagerService))\n], DocInterceptorService);\nexport {\n  DOC_INTERCEPTOR_POINT,\n  DocInterceptorService,\n  DocSelectionManagerService,\n  DocSkeletonManagerService,\n  DocStateEmitService,\n  RichTextEditingMutation,\n  SetTextSelectionsOperation,\n  UniverDocsPlugin\n};\n","import { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nimport { innerFrom } from '../observable/innerFrom';\nimport { noop } from '../util/noop';\nexport function takeUntil(notifier) {\n    return operate(function (source, subscriber) {\n        innerFrom(notifier).subscribe(createOperatorSubscriber(subscriber, function () { return subscriber.complete(); }, noop));\n        !subscriber.closed && source.subscribe(subscriber);\n    });\n}\n//# sourceMappingURL=takeUntil.js.map","import { MonoTypeOperatorFunction, ObservableInput } from '../types';\nimport { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nimport { innerFrom } from '../observable/innerFrom';\nimport { noop } from '../util/noop';\n\n/**\n * Emits the values emitted by the source Observable until a `notifier`\n * Observable emits a value.\n *\n * <span class=\"informal\">Lets values pass until a second Observable,\n * `notifier`, emits a value. Then, it completes.</span>\n *\n * ![](takeUntil.png)\n *\n * `takeUntil` subscribes and begins mirroring the source Observable. It also\n * monitors a second Observable, `notifier` that you provide. If the `notifier`\n * emits a value, the output Observable stops mirroring the source Observable\n * and completes. If the `notifier` doesn't emit any value and completes\n * then `takeUntil` will pass all values.\n *\n * ## Example\n *\n * Tick every second until the first click happens\n *\n * ```ts\n * import { interval, fromEvent, takeUntil } from 'rxjs';\n *\n * const source = interval(1000);\n * const clicks = fromEvent(document, 'click');\n * const result = source.pipe(takeUntil(clicks));\n * result.subscribe(x => console.log(x));\n * ```\n *\n * @see {@link take}\n * @see {@link takeLast}\n * @see {@link takeWhile}\n * @see {@link skip}\n *\n * @param {Observable} notifier The Observable whose first emitted value will\n * cause the output Observable of `takeUntil` to stop emitting values from the\n * source Observable.\n * @return A function that returns an Observable that emits the values from the\n * source Observable until `notifier` emits its first value.\n */\nexport function takeUntil<T>(notifier: ObservableInput<any>): MonoTypeOperatorFunction<T> {\n  return operate((source, subscriber) => {\n    innerFrom(notifier).subscribe(createOperatorSubscriber(subscriber, () => subscriber.complete(), noop));\n    !subscriber.closed && source.subscribe(subscriber);\n  });\n}\n"],"names":["$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","parcelRequire","$parcel$global","globalThis","self","window","global","parcelRegister","register","module","exports","$efea821103d1be34$export$bbaf5c73dc455386","$efea821103d1be34$export$48e4577d7a229f0a","$efea821103d1be34$export$aee3082e5b786336","$efea821103d1be34$export$abde8bb35be70afa","$efea821103d1be34$export$7c0b8b211b9b73ef","$efea821103d1be34$export$8bf9704db23df28c","$efea821103d1be34$export$8fb700ffdc3732e4","$83KcA","$D79YY","$jv4BO","$cZW0b","$efea821103d1be34$var$__defProp","$efea821103d1be34$var$__defNormalProp","obj","key","value","writable","$efea821103d1be34$var$__name","target","$efea821103d1be34$var$__publicField","id","type","CommandType","OPERATION","handler","_","__","$efea821103d1be34$var$_a","$efea821103d1be34$var$__defProp$4","$efea821103d1be34$var$__getOwnPropDesc$4","getOwnPropertyDescriptor","$efea821103d1be34$var$__decorateClass$4","decorators","kind","decorator","result","i","length","$efea821103d1be34$var$__decorateParam$4","index","RxDisposable","constructor","_commandService","_univerInstanceService","Map","BehaviorSubject","_textSelection$","asObservable","_refreshSelection$","_listenCurrentUnit","getCurrentTypeOfUnit$","UniverInstanceType","UNIVER_DOC","pipe","takeUntil","dispose$","subscribe","documentModel","unitId","getUnitId","_setCurrentSelectionNotRefresh","subUnitId","getCurrentSelection","_currentSelection","getCurrentSelectionInfo","_getTextRanges","refreshSelection","_refresh","setCurrentSelection","param","getCurrentTextRanges","_a6","textRanges","getCurrentRectRanges","rectRanges","getDocRanges","_b","filter","range","startOffset","endOffset","sort","a","b","getActiveTextRange","selectionInfo","find","textRange","isActive","getActiveRectRange","rectRange","add","isEditing","_addByParam","segmentId","segmentPage","style","NORMAL_TEXT_SELECTION_PLUGIN_STYLE","replaceTextRanges","docRanges","options","next","__replaceTextRangesWithNoRefresh","textSelectionInfo","params","_replaceByParam","ranges","executeCommand","dispose","complete","newUnitId","newSubUnitId","_textSelectionInfo","allTextSelectionInfo","insertParam","selectionInsertParam","has","unitTextRange","push","ICommandService","IUniverInstanceService","$efea821103d1be34$var$_a2","$efea821103d1be34$var$__defProp$3","$efea821103d1be34$var$__getOwnPropDesc$3","$efea821103d1be34$var$__decorateClass$3","$efea821103d1be34$var$__decorateParam$3","_context","_localeService","_currentSkeleton$","_currentSkeletonBefore$","_currentViewModel$","_init","_update","getSkeleton","_skeleton","getViewModel","_docViewModel","documentDataModel","unit","getBody","isInternalEditorID","reset","_buildDocViewModel","_buildSkeleton","skeleton","calculate","documentViewModel","DocumentSkeleton","create","DocumentViewModel","Inject","LocaleService","$efea821103d1be34$var$_DocStateEmitService","_docStateChangeParams$","emitStateChangeInfo","$efea821103d1be34$var$RichTextEditingMutationId","MUTATION","accessor","actions","prevTextRanges","trigger","noHistory","isCompositionEnd","noNeedSetTextRange","debounce","univerInstanceService","renderManagerService","IRenderManagerService","docStateEmitService","getUniverDocInstance","getRenderById","with","Error","docSelectionManagerService","disabled","getSnapshot","JSONX","isNoop","undoActions","invertWithDoc","apply","queueMicrotask","commandId","redoState","undoState","$efea821103d1be34$var$DocsRenameMutation","doc","getUnit","setName","name","$efea821103d1be34$var$defaultPluginConfig","$efea821103d1be34$var$_a3","$efea821103d1be34$var$__defProp$2","$efea821103d1be34$var$__getOwnPropDesc$2","$efea821103d1be34$var$__decorateClass$2","$efea821103d1be34$var$__decorateParam$2","$efea821103d1be34$var$DocCustomRangeController","Disposable","_textSelectionManagerService","_initSelectionChange","_transformCustomRange","selection","collapsed","customRanges","getCustomRanges","wholeEntity","startIndex","endIndex","BuildTextUtils","isIntersects","start","end","forEach","Math","min","max","disposeWithMe","onCommandExecuted","commandInfo","transformedRanges","map","some","OnLifecycle","LifecycleStages","Ready","$efea821103d1be34$var$__defProp$1","$efea821103d1be34$var$__getOwnPropDesc$1","$efea821103d1be34$var$__decorateClass$1","$efea821103d1be34$var$__decorateParam$1","$efea821103d1be34$var$_a4","Plugin","_config","_injector","_configService","rest","setConfig","_initializeDependencies","_initializeCommands","command","registerCommand","docInjector","d","Injector","IConfigService","$efea821103d1be34$export$175d499bafe9375c","CUSTOM_RANGE","createInterceptorKey","CUSTOM_DECORATION","$efea821103d1be34$var$_a5","$efea821103d1be34$var$__defProp2","$efea821103d1be34$var$__getOwnPropDesc","$efea821103d1be34$var$__decorateClass","$efea821103d1be34$var$__decorateParam","_docSkeletonManagerService","viewModel","getDataModel","DOCS_NORMAL_EDITOR_UNIT_ID_KEY","DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY","interceptDocumentViewModel","intercept","priority","data","pos","disposableCollection","DisposableCollection","segmentViewModels$","segmentViewModels","segmentViewModel","interceptor","_interceptorsByName","interceptors","toDisposable","remove","fetchThroughInterceptors","composeInterceptors","registerCustomRangeInterceptor","getCustomRange","getCustomRangeRaw","getCustomDecoration","getCustomDecorationRaw","customDecorations","getCustomDecorations","Starting","$97682c83450dcff1$export$ac8dfd3a7ad06e80","$jaOYC","$hMcgT","$jzqEI","$gyLB6","notifier","operate","source","subscriber","innerFrom","createOperatorSubscriber","noop","closed"],"version":3,"file":"es.5a078b65.js.map"}