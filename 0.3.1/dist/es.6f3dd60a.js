!function(){function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire26fc,n=t.register;n("61xGp",function(n,r){e(n.exports,"SetNumfmtCommand",function(){return O}),e(n.exports,"getPatternType",function(){return K}),e(n.exports,"UniverSheetsNumfmtPlugin",function(){return tU});var i=t("83KcA"),a=t("ls2nu"),l=t("jv4BO"),s=t("5WWyv"),o=t("d0sRG"),c=t("3KKCW"),u=t("bA4Xh"),m=t("9kWt8"),d=t("bTGUS"),h=t("11kpD"),f=t("D79YY"),p=t("cahIb"),v=t("bVip2"),g=t("fElJC"),d=t("bTGUS"),y=t("6cCiq"),b=t("gQuIR"),S=t("bLx5G"),_=t("5KEro"),C=Object.defineProperty,I=(e,t,n)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t)=>C(e,"name",{value:t,configurable:!0}),N=(e,t,n)=>I(e,"symbol"!=typeof t?t+"":t,n);let E=["$","£","¥","¤","֏","؋","৳","฿","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿"],j={US:"$",CA:"C$",GB:"£",JP:"¥",IN:"₹",AU:"A$",CN:"¥",KR:"₩",RU:"₽",AT:"€",BE:"€",CY:"€",EE:"€",FI:"€",FR:"€",DE:"€",GR:"€",IE:"€",IT:"€",LV:"€",LT:"€",LU:"€",MT:"€",NL:"€",PT:"€",SK:"€",SI:"€",ES:"€"},T=/* @__PURE__ */x((e,t=0)=>{var n;return e&&null!=(n=(0,i.numfmt).getInfo(e).maxDecimals)?n:t},"getDecimalFromPattern"),P=/* @__PURE__ */x((e,t)=>{if(e&&!t||!e&&t)return!1;let n=/* @__PURE__ */x(e=>e.reduce((e,t)=>{if(e.isEnd)return e;let n=t.value||t.num;return"point"===t.type?(e.isEnd=!0,e):{...e,result:e.result+n}},{isEnd:!1,result:""}).result,"getString"),r=(0,i.numfmt).getInfo(e)._partitions,a=(0,i.numfmt).getInfo(t)._partitions,l=n(r[0].tokens),s=n(a[0].tokens),o=n(r[1].tokens),c=n(a[1].tokens);return l===s&&o===c&&r[1].color===a[1].color},"isPatternEqualWithoutDecimal"),M=/* @__PURE__ */x(e=>Array(Math.min(Math.max(0,Number(e)),30)).fill(0).join(""),"getDecimalString"),R=/* @__PURE__ */x((e,t)=>e.split(";").map(e=>/\.0?/.test(e)?e.replace(/\.0*/g,`${t>0?".":""}${M(Number(t||0))}`):/0([^0]?)|0$/.test(e)?e.replace(/0([^0]+)|0$/,`0${t>0?".":""}${M(Number(t||0))}$1`):e).join(";"),"setPatternDecimal"),w=/* @__PURE__ */x(e=>/\.0?/.test(e)||/0([^0]?)|0$/.test(e),"isPatternHasDecimal"),O={id:"sheet.command.numfmt.set.numfmt",type:i.CommandType.COMMAND,handler:/* @__PURE__ */x((e,t)=>{if(!t)return!1;let n=e.get(i.ICommandService),r=e.get(i.IUniverInstanceService),l=e.get(i.IUndoRedoService),s=(0,a.getSheetCommandTarget)(r,t);if(!s)return!1;let{unitId:o,subUnitId:c}=s,u=t.values.filter(e=>!!e.pattern),m=t.values.filter(e=>!e.pattern),d=(0,a.transformCellsToRange)(o,c,u),h={unitId:o,subUnitId:c,ranges:m.map(e=>({startColumn:e.col,startRow:e.row,endColumn:e.col,endRow:e.row}))},f=[],p=[];if(u.length){Object.keys(d.values).forEach(e=>{let t=d.values[e];t.ranges=(0,a.rangeMerge)(t.ranges)}),f.push({id:a.SetNumfmtMutation.id,params:d});let t=(0,a.factorySetNumfmtUndoMutation)(e,d);p.push(...t)}if(m.length){h.ranges=(0,a.rangeMerge)(h.ranges),f.push({id:a.RemoveNumfmtMutation.id,params:h});let t=(0,a.factoryRemoveNumfmtUndoMutation)(e,h);p.push(...t)}let v=(0,i.sequenceExecute)(f,n).result;return v&&l.pushUndoRedo({unitID:o,undoMutations:p,redoMutations:f}),v},"handler")},$={id:"sheet.command.numfmt.add.decimal.command",type:i.CommandType.COMMAND,handler:/* @__PURE__ */x(async e=>{let t=e.get(i.ICommandService),n=e.get(a.SheetsSelectionsService),r=e.get(a.INumfmtService),l=e.get(i.IUniverInstanceService),s=n.getCurrentSelections();if(!s||!s.length)return!1;let o=(0,a.getSheetCommandTarget)(l);if(!o)return!1;let{unitId:c,subUnitId:u}=o,m=0;s.forEach(e=>{(0,i.Range).foreach(e.range,(e,t)=>{let n=r.getValue(c,u,e,t);if(!n){let n=o.worksheet.getCellRaw(e,t);if(!m&&n&&n.t===i.CellValueType.NUMBER&&n.v){let e=/\.(\d*)$/.exec(String(n.v));if(e){let t=e[1].length;if(!t)return;m=Math.max(m,t)}}return}let a=T(n.pattern);m=a>m?a:m})});let d=m+1,h=R(`0${d>0?".0":""}`,d),f=[];return s.forEach(e=>{(0,i.Range).foreach(e.range,(e,t)=>{let n=r.getValue(c,u,e,t);if(n){let r=T(n.pattern),i=R(n.pattern,r+1);i!==n.pattern&&f.push({row:e,col:t,pattern:i})}else f.push({row:e,col:t,pattern:h})})}),!!f.length&&await t.executeCommand(O.id,{values:f})},"handler")},U=[{label:"1930-08-05",suffix:"yyyy-MM-dd"},{label:"1930/08/05",suffix:"yyyy/MM/dd"},{label:"1930年08月05日",suffix:'yyyy"年"MM"月"dd"日"'},{label:"08-05",suffix:"MM-dd"},{label:"8月5日",suffix:'M"月"d"日"'},{label:"13:30:30",suffix:"h:mm:ss"},{label:"13:30",suffix:"h:mm"},{label:"下午01:30",suffix:"A/P hh:mm"},{label:"下午1:30",suffix:"A/P h:mm"},{label:"下午1:30:30",suffix:"A/P h:mm:ss"},{label:"08-05 下午 01:30",suffix:"MM-dd A/P hh:mm"}],D=[{label:"(1,235)",suffix:"#,##0_);(#,##0)"},{label:"(1,235) ",suffix:"#,##0_);[Red](#,##0)",color:"red"},{label:"1,234.56",suffix:"#,##0.00_);#,##0.00"},{label:"1,234.56",suffix:"#,##0.00_);[Red]#,##0.00",color:"red"},{label:"-1,234.56",suffix:"#,##0.00_);-#,##0.00"},{label:"-1,234.56",suffix:"#,##0.00_);[Red]-#,##0.00",color:"red"}],k=[{label:/* @__PURE__ */x(e=>`${e}1,235`,"label"),suffix:/* @__PURE__ */x(e=>`"${e}"#,##0.00_);"${e}"#,##0.00`,"suffix")},{label:/* @__PURE__ */x(e=>`${e}1,235`,"label"),suffix:/* @__PURE__ */x(e=>`"${e}"#,##0.00_);[Red]"${e}"#,##0.00`,"suffix"),color:"red"},{label:/* @__PURE__ */x(e=>`(${e}1,235)`,"label"),suffix:/* @__PURE__ */x(e=>`"${e}"#,##0.00_);("${e}"#,##0.00)`,"suffix")},{label:/* @__PURE__ */x(e=>`(${e}1,235)`,"label"),suffix:/* @__PURE__ */x(e=>`"${e}"#,##0.00_);[Red]("${e}"#,##0.00)`,"suffix"),color:"red"},{label:/* @__PURE__ */x(e=>`-${e}1,235`,"label"),suffix:/* @__PURE__ */x(e=>`"${e}"#,##0.00_);-"${e}"#,##0.00`,"suffix")},{label:/* @__PURE__ */x(e=>`-${e}1,235`,"label"),suffix:/* @__PURE__ */x(e=>`"${e}"#,##0.00_);[Red]-"${e}"#,##0.00`,"suffix"),color:"red"}],L=class{constructor(){N(this,"_currencySymbol$",new l.BehaviorSubject("US")),N(this,"currencySymbol$",this._currencySymbol$.asObservable())}setCurrencySymbolByCountryCode(e){this._currencySymbol$.next(e)}getCurrencySymbol(){return this._currencySymbol$.getValue()}};x(L,"MenuCurrencyService");let F={id:"sheet.command.numfmt.set.currency",type:i.CommandType.COMMAND,handler:/* @__PURE__ */x(async e=>{let t=e.get(i.ICommandService),n=e.get(a.SheetsSelectionsService),r=j[e.get(L).getCurrencySymbol()]||"$",l=n.getCurrentSelections();if(!l||!l.length)return!1;let s=[],o=k[4].suffix(r);return l.forEach(e=>{(0,i.Range).foreach(e.range,(e,t)=>{s.push({row:e,col:t,pattern:o,type:"currency"})})}),await t.executeCommand(O.id,{values:s})},"handler")},V={id:"sheet.command.numfmt.set.percent",type:i.CommandType.COMMAND,handler:/* @__PURE__ */x(async e=>{let t=e.get(i.ICommandService),n=e.get(a.SheetsSelectionsService).getCurrentSelections();if(!n||!n.length)return!1;let r=[];return n.forEach(e=>{(0,i.Range).foreach(e.range,(e,t)=>{r.push({row:e,col:t,pattern:"0%",type:"percent"})})}),await t.executeCommand(O.id,{values:r})},"handler")},H={id:"sheet.command.numfmt.subtract.decimal.command",type:i.CommandType.COMMAND,handler:/* @__PURE__ */x(async e=>{let t=e.get(i.ICommandService),n=e.get(a.SheetsSelectionsService),r=e.get(a.INumfmtService),l=e.get(i.IUniverInstanceService),s=n.getCurrentSelections();if(!s||!s.length)return!1;let o=(0,a.getSheetCommandTarget)(l);if(!o)return!1;let{unitId:c,subUnitId:u}=o,m=0;s.forEach(e=>{(0,i.Range).foreach(e.range,(e,t)=>{let n=r.getValue(c,u,e,t);if(!n){let n=o.worksheet.getCellRaw(e,t);if(!m&&n&&n.t===i.CellValueType.NUMBER&&n.v){let e=/\.(\d*)$/.exec(String(n.v));if(e){let t=e[1].length;if(!t)return;m=Math.max(m,t)}}return}let a=T(n.pattern);m=a>m?a:m})});let d=m-1,h=R(`0${d>0?".0":"."}`,d),f=[];return s.forEach(e=>{(0,i.Range).foreach(e.range,(e,t)=>{let n=r.getValue(c,u,e,t);if(n){let r=T(n.pattern);f.push({row:e,col:t,pattern:R(n.pattern,r-1)})}else f.push({row:e,col:t,pattern:h})})}),await t.executeCommand(O.id,{values:f})},"handler")},W={id:"sheet.operation.close.numfmt.panel",type:i.CommandType.OPERATION,handler:/* @__PURE__ */x(()=>!0,"handler")},B=(0,i.createIdentifier)("INumfmtController");(0,i.runOnLifecycle)(i.LifecycleStages.Rendered,B);let A={id:"sheet.operation.open.numfmt.panel",type:i.CommandType.OPERATION,handler:/* @__PURE__ */x(e=>(e.get(B).openPanel(),!0),"handler")},G="SHEET_NUMFMT_PLUGIN",K=/* @__PURE__ */x(e=>(0,i.numfmt).getInfo(e).type||"unknown","getPatternType"),z=/* @__PURE__ */x((e,t,n)=>{let r=(0,i.numfmt).getInfo(e),a=n===i.LocaleType.ZH_CN?"zh-CN":"en",l=r._partitions[1],s=(0,i.numfmt).format(e,t,{locale:a,throws:!1});return t<0?{result:s,color:l.color}:{result:s}},"getPatternPreview");var q,Y=Object.defineProperty,J=Object.getOwnPropertyDescriptor,X=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?J(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Y(t,n,a),a},"__decorateClass$7"),Z=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$7");let Q=(q=class extends i.Disposable{constructor(e,t,n,r,i,a){super(),this._instanceService=e,this._sheetInterceptorService=t,this._themeService=n,this._commandService=r,this._numfmtService=i,this._localeService=a,this._initInterceptorCellContent()}_initInterceptorCellContent(){let e=new i.ObjectMatrix;this.disposeWithMe(this._sheetInterceptorService.intercept(a.INTERCEPTOR_POINT.CELL_CONTENT,{handler:/* @__PURE__ */x((t,n,r)=>{let a;let l=n.unitId,s=n.subUnitId;if(null!=t&&t.s){let e=n.workbook.getStyles().get(t.s);null!=e&&e.n&&(a=e.n)}if(a||(a=this._numfmtService.getValue(l,s,n.row,n.col)),!a||!t||t.t!==i.CellValueType.NUMBER||null==t.v||Number.isNaN(t.v))return r(t);let o="",c=e.getValue(n.row,n.col);if(c&&c.parameters===`${t.v}_${a.pattern}`)return r({...t,...c.result});let u=z(a.pattern,Number(t.v),this._localeService.getCurrentLocale());if(!(o=u.result))return r(t);let m={v:o};if(u.color){let e=this._themeService.getCurrentTheme()[`${u.color}500`];e&&(m.interceptorStyle={cl:{rgb:e}})}return e.setValue(n.row,n.col,{result:m,parameters:`${t.v}_${a.pattern}`}),r({...t,...m})},"handler"),priority:a.InterceptCellContentPriority.NUMFMT})),this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===a.SetNumfmtMutation.id){let n=t.params;Object.keys(n.values).forEach(t=>{n.values[t].ranges.forEach(t=>{(0,i.Range).foreach(t,(t,n)=>{e.realDeleteValue(t,n)})})})}else if(t.id===a.SetRangeValuesMutation.id){let n=t.params;new(0,i.ObjectMatrix)(n.cellValue).forValue((t,n)=>{e.realDeleteValue(t,n)})}})),this.disposeWithMe(this._instanceService.getCurrentTypeOfUnit$(i.UniverInstanceType.UNIVER_SHEET).pipe((0,d.switchMap)(e=>{var t;return null!=(t=null==e?void 0:e.activeSheet$)?t:(0,u.of)(null)}),(0,m.skip)(1)).subscribe(()=>e.reset()))}},x(q,"SheetsNumfmtCellContentController"),q);Q=X([(0,i.OnLifecycle)(i.LifecycleStages.Rendered,Q),Z(0,i.IUniverInstanceService),Z(1,(0,i.Inject)(a.SheetInterceptorService)),Z(2,(0,i.Inject)(i.ThemeService)),Z(3,(0,i.Inject)(i.ICommandService)),Z(4,(0,i.Inject)(a.INumfmtService)),Z(5,(0,i.Inject)(i.LocaleService))],Q);var ee={exports:{}},et={},en=b&&b.__esModule?b.default:b,er=Symbol.for("react.element"),ei=Symbol.for("react.fragment"),ea=Object.prototype.hasOwnProperty,el=en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,es={key:!0,ref:!0,__self:!0,__source:!0};function eo(e,t,n){var r,i={},a=null,l=null;for(r in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(l=t.ref),t)ea.call(t,r)&&!es.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:er,type:e,key:a,ref:l,props:i,_owner:el.current}}x(eo,"q"),et.Fragment=ei,et.jsx=eo,et.jsxs=eo,ee.exports=et;var ec=ee.exports;let eu=(0,b.createContext)([]);var em,ed=Object.defineProperty,eh=Object.getOwnPropertyDescriptor,ef=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?eh(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&ed(t,n,a),a},"__decorateClass$6"),ep=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$6");let ev=(x(em=class{constructor(e){this._localStorageService=e}_getKey(e){return`userHabitController_${e}`}async addHabit(e,t){let n=this._getKey(e);return this._localStorageService.getItem(n).then(e=>{e||this._localStorageService.setItem(n,t)})}markHabit(e,t){let n=this._getKey(e);this._localStorageService.getItem(n).then(e=>{if(e){let r=e.findIndex(e=>e===t);r>-1&&e.splice(r,1),e.unshift(t),this._localStorageService.setItem(n,e)}})}async getHabit(e,t){let n=this._getKey(e),r=await this._localStorageService.getItem(n);if(t&&r){let e=r.map((e,t,n)=>({value:e,priority:n.length-t}));return t.sort((t,n)=>{var r,i;let a=(null==(r=e.find(e=>e.value===t))?void 0:r.priority)||-1;return((null==(i=e.find(e=>e.value===n))?void 0:i.priority)||-1)-a})}return r||[]}deleteHabit(e){this._localStorageService.removeItem(e)}},"UserHabitController"),em);ev=ef([ep(0,(0,i.Inject)(i.ILocalStorageService))],ev);let eg="numfmtCurrency",ey=/* @__PURE__ */x(e=>{let t=(0,i.useDependency)(ev),[n,r]=(0,b.useState)(E);return(0,b.useEffect)(()=>{t.addHabit("numfmtCurrency",[]).then(()=>{t.getHabit(eg,[...E]).then(t=>{r(t),e&&e(t)})})},[]),{userHabitCurrency:n,mark:/* @__PURE__ */x(e=>{t.markHabit(eg,e)},"mark")}},"useCurrencyOptions"),eb=/* @__PURE__ */x(()=>{let e=(0,b.useRef)([]),[t,n]=(0,b.useState)({});return(0,b.useEffect)(()=>{e.current.forEach(e=>{e()}),e.current=[]},[t]),/* @__PURE__ */x(t=>{e.current.push(t),n({})},"nextTick")},"useNextTick"),eS=/* @__PURE__ */x(e=>E.find(t=>e.includes(t)),"getCurrencyType"),e_=/* @__PURE__ */x(e=>!!eS(e)&&e.startsWith("_("),"isAccountingPanel"),eC=/* @__PURE__ */x(e=>{let[t,n]=(0,b.useState)(()=>T(e.defaultPattern||"",2)),r=(0,b.useContext)(eu),[a,l]=(0,b.useState)(()=>eS(e.defaultPattern)||r[0]),s=(0,b.useMemo)(()=>r.map(e=>({label:e,value:e})),[]),o=(0,i.useDependency)(i.LocaleService).t;e.action.current=()=>R(`_("${a}"* #,##0${t>0?".0":""}_)`,t);let c=/* @__PURE__ */x(n=>{l(n),e.onChange(R(`_("${n}"* #,##0${t>0?".0":""}_)`,t))},"onSelect"),u=/* @__PURE__ */x(t=>{let r=t||0;n(r),e.onChange(R(`_("${a}"* #,##0${r>0?".0":""}_)`,r))},"onDecimalChange");return /* @__PURE__ */ec.jsxs("div",{children:[/* @__PURE__ */ec.jsxs("div",{className:"m-t-16 options ",children:[/* @__PURE__ */ec.jsxs("div",{className:"option",children:[/* @__PURE__ */ec.jsx("div",{className:"label",children:o("sheet.numfmt.decimalLength")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8 w-120",children:/* @__PURE__ */ec.jsx(S.InputNumber,{value:t,max:20,min:0,onChange:u})})]}),/* @__PURE__ */ec.jsxs("div",{className:"option",children:[/* @__PURE__ */ec.jsx("div",{className:"label",children:o("sheet.numfmt.currencyType")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8 w-140",children:/* @__PURE__ */ec.jsx(S.Select,{onChange:c,options:s,value:a})})]})]}),/* @__PURE__ */ec.jsx("div",{className:"describe m-t-14",children:o("sheet.numfmt.accountingDes")})]})},"AccountingPanel"),eI=/* @__PURE__ */x(e=>k.map(t=>({label:t.label(e),value:t.suffix(e),color:t.color})),"getCurrencyFormatOptions"),ex=/* @__PURE__ */x(()=>U.map(e=>({label:e.label,value:e.suffix})),"getDateFormatOptions"),eN=/* @__PURE__ */x(()=>D.map(e=>({label:e.label,value:e.suffix,color:e.color})),"getNumberFormatOptions"),eE=/* @__PURE__ */x(e=>!!eS(e)&&!e.startsWith("_("),"isCurrencyPanel"),ej=/* @__PURE__ */x(e=>{let t=(0,i.useDependency)(i.LocaleService).t,n=(0,b.useContext)(eu),[r,a]=(0,b.useState)(()=>eS(e.defaultPattern)||n[0]),[l,s]=(0,b.useState)(()=>T(e.defaultPattern||"",2)),[o,c]=(0,b.useState)(()=>{var t;let n=eI(r);return(null==(t=n.find(t=>P(t.value,e.defaultPattern)))?void 0:t.value)||n[0].value}),u=(0,b.useMemo)(()=>eI(r),[r]),m=(0,b.useMemo)(()=>n.map(e=>({label:e,value:e})),[n]);e.action.current=()=>R(o,l);let d=/* @__PURE__ */x(t=>{if(void 0===t)return;a(t);let n=eI(t)[0].value;c(n),e.onChange(R(n,l))},"onSelect"),h=/* @__PURE__ */x(t=>{void 0!==t&&(c(t),e.onChange(R(t,l)))},"onChange"),f=/* @__PURE__ */x(t=>{s(t||0),e.onChange(R(o,t||0))},"onDecimalChange");return /* @__PURE__ */ec.jsxs("div",{children:[/* @__PURE__ */ec.jsxs("div",{className:"m-t-16 options ",children:[/* @__PURE__ */ec.jsxs("div",{className:"option",children:[/* @__PURE__ */ec.jsx("div",{className:"label",children:t("sheet.numfmt.decimalLength")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8 w-120",children:/* @__PURE__ */ec.jsx(S.InputNumber,{value:l,max:20,min:0,onChange:f})})]}),/* @__PURE__ */ec.jsxs("div",{className:"option",children:[/* @__PURE__ */ec.jsx("div",{className:"label",children:t("sheet.numfmt.currencyType")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8 w-140",children:/* @__PURE__ */ec.jsx(S.Select,{onChange:d,options:m,value:r})})]})]}),/* @__PURE__ */ec.jsx("div",{className:"m-t-16 label",children:t("sheet.numfmt.negType")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8",children:/* @__PURE__ */ec.jsx(S.SelectList,{onChange:h,options:u,value:o})}),/* @__PURE__ */ec.jsx("div",{className:"describe m-t-14",children:t("sheet.numfmt.currencyDes")})]})},"CurrencyPanel"),eT=/* @__PURE__ */x(e=>{let t=(0,i.numfmt).getInfo(e);return ex().map(e=>e.value).includes(e)||["date","datetime","time"].includes(t.type)},"isDatePanel"),eP=/* @__PURE__ */x(e=>{let t=(0,b.useMemo)(ex,[]),n=(0,i.useDependency)(i.LocaleService).t,[r,a]=(0,b.useState)(()=>{if(e.defaultPattern){let n=t.find(t=>t.value===e.defaultPattern);if(n)return n.value}return t[0].value});e.action.current=()=>r;let l=/* @__PURE__ */x(t=>{void 0!==t&&(a(t),e.onChange(t))},"onChange");return /* @__PURE__ */ec.jsxs("div",{children:[/* @__PURE__ */ec.jsx("div",{className:"m-t-16 label",children:n("sheet.numfmt.dateType")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8",children:/* @__PURE__ */ec.jsx(S.SelectList,{value:r,options:t,onChange:l})}),/* @__PURE__ */ec.jsx("div",{className:"describe m-t-14",children:n("sheet.numfmt.dateDes")})]})},"DatePanel"),eM=/* @__PURE__ */x(e=>!e,"isGeneralPanel"),eR=/* @__PURE__ */x(e=>{let t=(0,i.useDependency)(i.LocaleService).t;return e.action.current=()=>"",/* @__PURE__ */ec.jsx("div",{children:/* @__PURE__ */ec.jsx("div",{className:"describe m-t-14",children:t("sheet.numfmt.generalDes")})})},"GeneralPanel"),ew=/* @__PURE__ */x(e=>eN().some(t=>P(t.value,e)),"isThousandthPercentilePanel"),eO=/* @__PURE__ */x(e=>{let t=(0,i.useDependency)(i.LocaleService),n=(0,b.useMemo)(eN,[]),[r,a]=(0,b.useState)(()=>T(e.defaultPattern||"",0)),[l,s]=(0,b.useState)(()=>{let t=n.find(t=>P(t.value,e.defaultPattern||""));return(null==t?void 0:t.value)||n[0].value}),o=(0,b.useMemo)(()=>R(l,Number(r||0)),[l,r]),c=(0,b.useMemo)(()=>!w(l),[l]),u=/* @__PURE__ */x(t=>{a(t||0),e.onChange(R(l,Number(t||0)))},"handleDecimalChange"),m=/* @__PURE__ */x(t=>{void 0!==t&&(a(T(t,0)),s(t),e.onChange(t))},"handleClick");return e.action.current=()=>o,/* @__PURE__ */ec.jsxs("div",{children:[/* @__PURE__ */ec.jsx("div",{className:"m-t-16 label",children:t.t("sheet.numfmt.decimalLength")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8",children:/* @__PURE__ */ec.jsx(S.InputNumber,{disabled:c,value:r,max:20,min:0,onChange:u})}),/* @__PURE__ */ec.jsxs("div",{className:"m-t-16 label",children:[" ",t.t("sheet.numfmt.negType")]}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8",children:/* @__PURE__ */ec.jsx(S.SelectList,{onChange:m,options:n,value:l})}),/* @__PURE__ */ec.jsx("div",{className:"describe m-t-14",children:t.t("sheet.numfmt.thousandthPercentileDes")})]})},"ThousandthPercentilePanel");var e$=function(){return(e$=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},eU=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},eD=(0,b.forwardRef)(function(e,t){var n=e.icon,r=e.id,i=e.className,a=e.extend,l=eU(e,["icon","id","className","extend"]),s="univerjs-icon univerjs-icon-".concat(r," ").concat(i||"").trim(),o=(0,b.useRef)("_".concat(eV()));return ek(n,"".concat(r),{defIds:n.defIds,idSuffix:o.current},e$({ref:t,className:s},l),a)});function ek(e,t,n,r,i){return(0,b.createElement)(e.tag,e$(e$({key:t},eL(e,n,i)),r),(eF(e,n).children||[]).map(function(r,a){return ek(r,"".concat(t,"-").concat(e.tag,"-").concat(a),n,void 0,i)}))}function eL(e,t,n){var r=e$({},e.attrs);null!=n&&n.colorChannel1&&"colorChannel1"===r.fill&&(r.fill=n.colorChannel1);var i=t.defIds;return i&&0!==i.length&&("use"===e.tag&&r["xlink:href"]&&(r["xlink:href"]=r["xlink:href"]+t.idSuffix),Object.entries(r).forEach(function(e){var n=e[0],i=e[1];"string"==typeof i&&(r[n]=i.replace(/url\(#(.*)\)/,"url(#$1".concat(t.idSuffix,")")))})),r}function eF(e,t){var n,r=t.defIds;return r&&0!==r.length&&"defs"===e.tag&&!(null===(n=e.children)||void 0===n)&&n.length?e$(e$({},e),{children:e.children.map(function(e){return"string"==typeof e.attrs.id&&r&&r.indexOf(e.attrs.id)>-1?e$(e$({},e),{attrs:e$(e$({},e.attrs),{id:e.attrs.id+t.idSuffix})}):e})}):e}function eV(){return Math.random().toString(36).substring(2,8)}x(ek,"render"),x(eL,"replaceRuntimeIdsAndExtInAttrs"),x(eF,"replaceRuntimeIdsInDefs"),x(eV,"generateShortUuid"),eD.displayName="UniverIcon";var eH={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",fillRule:"evenodd",clipRule:"evenodd"}}]},eW=(0,b.forwardRef)(function(e,t){return(0,b.createElement)(eD,Object.assign({},e,{id:"check-mark-single",ref:t,icon:eH}))});eW.displayName="CheckMarkSingle";let eB={customFormatTitle:"univer-custom-format-title",customFormatInput:"univer-custom-format-input",customFormatHistoryList:"univer-custom-format-history-list",customFormatHistoryListItem:"univer-custom-format-history-list-item",customFormatHistoryListItemIconWrap:"univer-custom-format-history-list-item-icon-wrap",customFormatDes:"univer-custom-format-des"},eA="customFormat",eG="numfmt_custom_pattern";function eK(e){let{defaultPattern:t,action:n,onChange:r}=e,a=(0,i.useDependency)(ev),l=(0,i.useDependency)(i.ILocalStorageService),s=(0,i.useDependency)(i.LocaleService),[o,c]=(0,b.useState)(t);n.current=()=>(a.markHabit(eA,o),l.getItem(eG).then((e=[])=>{let t=[.../* @__PURE__ */new Set([o,...e||[]])].splice(0,10).filter(e=>!!e);l.setItem(eG,t)}),o);let[u,m]=(0,b.useState)([]);(0,b.useEffect)(()=>{l.getItem(eG).then(e=>{let t=[...k.map(e=>e.suffix("$")),...U.map(e=>e.suffix),...D.map(e=>e.suffix)];t.push(...e||[]),a.addHabit(eA,[]).finally(()=>{a.getHabit(eA,t).then(e=>{m([...new Set(e)])})})})},[]);let d=/* @__PURE__ */x(e=>{c(e),r(e)},"handleClick"),h=/* @__PURE__ */x(()=>{r(o)},"handleBlur");return /* @__PURE__ */ec.jsxs("div",{className:eB.customFormat,children:[/* @__PURE__ */ec.jsx("div",{className:eB.customFormatTitle,children:s.t("sheet.numfmt.customFormat")}),/* @__PURE__ */ec.jsx(S.Input,{placeholder:s.t("sheet.numfmt.customFormat"),onBlur:h,value:o,onChange:c,className:eB.customFormatInput}),/* @__PURE__ */ec.jsx("div",{className:eB.customFormatHistoryList,children:u.map(e=>/* @__PURE__ */ec.jsxs("div",{onClick:/* @__PURE__ */x(()=>d(e),"onClick"),className:eB.customFormatHistoryListItem,children:[/* @__PURE__ */ec.jsx("div",{className:eB.customFormatHistoryListItemIconWrap,children:o===e&&/* @__PURE__ */ec.jsx(eW,{})}),/* @__PURE__ */ec.jsx("div",{children:e})]},e))}),/* @__PURE__ */ec.jsx("div",{className:eB.customFormatDes,children:s.t("sheet.numfmt.customFormatDes")})]})}x(eK,"CustomFormat");let ez=/* @__PURE__ */x(e=>{let{defaultValue:t,defaultPattern:n,row:r,col:a}=e.value,l=(0,i.useDependency)(i.LocaleService),s=(0,b.useRef)(()=>""),o=l.t,c=eb(),u=(0,b.useMemo)(()=>[{label:"sheet.numfmt.general",component:eR},{label:"sheet.numfmt.accounting",component:eC},{label:"sheet.numfmt.currency",component:ej},{label:"sheet.numfmt.date",component:eP},{label:"sheet.numfmt.thousandthPercentile",component:eO},{label:"sheet.numfmt.customFormat",component:eK}].map(e=>({...e,label:o(e.label)})),[]),[m,d]=(0,b.useState)(y),[h,f]=(0,b.useState)(()=>`${r}_${a}`),{mark:p,userHabitCurrency:v}=ey(()=>f(`${r}_${a}_userCurrency'`)),g=(0,b.useMemo)(()=>{var e;return null==(e=u.find(e=>e.label===m))?void 0:e.component},[m]);function y(){return[eM,e_,eE,eT,ew].reduce((e,t,r)=>e||(t(n)?u[r].label:""),"")||u[0].label}x(y,"findDefaultType");let _=u.map(e=>({label:e.label,value:e.label})),C=/* @__PURE__ */x(t=>{d(t),c(()=>e.onChange({type:"change",value:s.current()||""}))},"handleSelect"),I=/* @__PURE__ */x(t=>{e.onChange({type:"change",value:t})},"handleChange"),N=/* @__PURE__ */x(()=>{let t=s.current()||"",n=eS(t);n&&p(n),e.onChange({type:"confirm",value:t})},"handleConfirm"),E=/* @__PURE__ */x(()=>{e.onChange({type:"cancel",value:""})},"handleCancel");return(0,b.useEffect)(()=>{d(y()),f(`${r}_${a}`)},[r,a]),/* @__PURE__ */ec.jsxs("div",{className:"numfmt-panel p-b-20",children:[/* @__PURE__ */ec.jsxs("div",{children:[/* @__PURE__ */ec.jsx("div",{className:"label m-t-14",children:o("sheet.numfmt.numfmtType")}),/* @__PURE__ */ec.jsx("div",{className:"m-t-8",children:/* @__PURE__ */ec.jsx(S.Select,{onChange:C,options:_,value:m,style:{width:"100%"}})}),/* @__PURE__ */ec.jsx("div",{children:g&&/* @__PURE__ */ec.jsx(eu.Provider,{value:v,children:/* @__PURE__ */(0,b.createElement)(g,{onChange:I,defaultValue:t,defaultPattern:n,action:s,key:h})})})]}),/* @__PURE__ */ec.jsxs("div",{className:"btn-list m-t-14 m-b-20",children:[/* @__PURE__ */ec.jsx(S.Button,{size:"small",onClick:E,className:"m-r-12",children:o("sheet.numfmt.cancel")}),/* @__PURE__ */ec.jsx(S.Button,{type:"primary",size:"small",onClick:N,children:o("sheet.numfmt.confirm")})]})]})},"SheetNumfmtPanel");var eq,eY=Object.defineProperty,eJ=Object.getOwnPropertyDescriptor,eX=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?eJ(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&eY(t,n,a),a},"__decorateClass$5"),eZ=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$5");let eQ=(eq=class extends i.Disposable{constructor(e,t,n,r,i,a,l,s,o,c){super(),N(this,"_previewPattern",""),N(this,"_sidebarDisposable",null),this._sheetInterceptorService=e,this._themeService=t,this._univerInstanceService=n,this._commandService=r,this._selectionManagerService=i,this._renderManagerService=a,this._numfmtService=l,this._componentManager=s,this._sidebarService=o,this._localeService=c,this._initRealTimeRenderingInterceptor(),this._initPanel(),this._initCommands(),this._initCloseListener(),this._commandExecutedListener()}openPanel(){var e;let t=this._sidebarService,n=this._selectionManagerService,r=this._commandService,a=this._univerInstanceService,l=this._numfmtService,s=this._localeService,o=((null==(e=n.getCurrentSelections())?void 0:e.map(e=>e.range))||[])[0];if(!o)return!1;let c=a.getCurrentUnitForType(i.UniverInstanceType.UNIVER_SHEET),u=c.getActiveSheet();if(!u)return!1;let m=u.getCellRaw(o.startRow,o.startColumn),d=l.getValue(c.getUnitId(),u.getSheetId(),o.startRow,o.startColumn),h="";d&&(h=d.pattern);let f=(null==m?void 0:m.t)===i.CellValueType.NUMBER?m.v:0xbc614e,p={onChange:/* @__PURE__ */x(e=>{var a;if("change"===e.type)this._previewPattern=e.value,this._forceUpdate();else if("confirm"===e.type){let l=(null==(a=n.getCurrentSelections())?void 0:a.map(e=>e.range))||[],s={values:[]},o=K(e.value);l.forEach(t=>{(0,i.Range).foreach(t,(t,n)=>{s.values.push({row:t,col:n,pattern:e.value,type:o})})}),r.executeCommand(O.id,s),t.close()}else"cancel"===e.type&&t.close()},"onChange"),value:{defaultPattern:h,defaultValue:f,row:o.startRow,col:o.startColumn}};return this._sidebarDisposable=t.open({header:{title:s.t("sheet.numfmt.title")},children:{label:G,...p},onClose:/* @__PURE__ */x(()=>{this._forceUpdate(),r.executeCommand(W.id)},"onClose")}),!0}_forceUpdate(e){var t;let n=this._renderManagerService.getRenderById(null!=e?e:this._univerInstanceService.getCurrentUnitForType(i.UniverInstanceType.UNIVER_SHEET).getUnitId());null==n||n.with(h.SheetSkeletonManagerService).reCalculate(),null==(t=null==n?void 0:n.mainComponent)||t.makeDirty()}_initCommands(){[$,H,F,V,A,W,O].forEach(e=>{this.disposeWithMe(this._commandService.registerCommand(e))})}_initPanel(){this._componentManager.register(G,ez)}_initRealTimeRenderingInterceptor(){let e=new c.Observable(e=>{this._commandService.onCommandExecuted(t=>{t.id===A.id&&e.next(!0),t.id===W.id&&e.next(!1)})}),t=(0,s.combineLatest)([e,this._selectionManagerService.selectionMoveEnd$.pipe((0,g.map)(e=>e?e.map(e=>e.range):[]))]);this.disposeWithMe((0,i.toDisposable)(t.pipe((0,d.switchMap)(([e,t])=>new c.Observable(n=>{let r=new i.DisposableCollection;return e&&t.length&&n.next({selectionRanges:t,disposableCollection:r}),()=>{r.dispose()}})),(0,y.tap)(()=>{this._previewPattern=null})).subscribe(({disposableCollection:e,selectionRanges:t})=>{var n,r;let l=this._univerInstanceService.getCurrentUnitForType(i.UniverInstanceType.UNIVER_SHEET);this.openPanel(),e.add(this._sheetInterceptorService.intercept(a.INTERCEPTOR_POINT.CELL_CONTENT,{priority:99,handler:/* @__PURE__ */x((e,n,r)=>{let{row:a,col:l}=n,s=r(e)||{};if(t.find(e=>e.startColumn<=l&&e.endColumn>=l&&e.startRow<=a&&e.endRow>=a)){let e=n.worksheet.getCellRaw(a,l),t=null==e?void 0:e.v,r=null==e?void 0:e.t;if(null==t||r!==i.CellValueType.NUMBER||null===this._previewPattern)return s;let o=z(this._previewPattern,t,this._localeService.getCurrentLocale());if(o.color){let e=this._themeService.getCurrentTheme()[`${o.color}500`];return{...s,v:o.result,t:i.CellValueType.STRING,s:{cl:{rgb:e}}}}return{...s,v:o.result,t:i.CellValueType.STRING}}return s},"handler")})),null==(r=null==(n=this._renderManagerService.getRenderById(l.getUnitId()))?void 0:n.mainComponent)||r.makeDirty()})))}_commandExecutedListener(){let e=[a.RemoveNumfmtMutation.id,a.SetNumfmtMutation.id];this.disposeWithMe(new(0,c.Observable)(t=>{let n=this._commandService.onCommandExecuted(n=>{if(e.includes(n.id)){let e=n.params;t.next(e.unitId)}});return()=>n.dispose()}).pipe((0,v.debounceTime)(16)).subscribe(e=>this._forceUpdate(e)))}_initCloseListener(){this._univerInstanceService.getCurrentTypeOfUnit$(i.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{var t;e||(null==(t=this._sidebarDisposable)||t.dispose(),this._sidebarDisposable=null)})}},x(eq,"NumfmtController"),eq);eQ=eX([(0,i.OnLifecycle)(i.LifecycleStages.Rendered,eQ),eZ(0,(0,i.Inject)(a.SheetInterceptorService)),eZ(1,(0,i.Inject)(i.ThemeService)),eZ(2,i.IUniverInstanceService),eZ(3,i.ICommandService),eZ(4,(0,i.Inject)(a.SheetsSelectionsService)),eZ(5,f.IRenderManagerService),eZ(6,a.INumfmtService),eZ(7,(0,i.Inject)(p.ComponentManager)),eZ(8,p.ISidebarService),eZ(9,(0,i.Inject)(i.LocaleService))],eQ);var e0=Object.defineProperty,e1=Object.getOwnPropertyDescriptor,e4=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?e1(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&e0(t,n,a),a},"__decorateClass$4"),e2=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$4");let e5=/* @__PURE__ */x(()=>{let e=[];return{add:/* @__PURE__ */x((t,n,r,i,a)=>e.push({unitId:t,subUnitId:n,row:r,col:i,value:a}),"add"),getEffects:/* @__PURE__ */x(()=>e,"getEffects"),clean:/* @__PURE__ */x(()=>{e=[]},"clean")}},"createCollectEffectMutation"),e3=(e8=class extends i.Disposable{constructor(e,t,n,r,i){super(),N(this,"_collectEffectMutation",e5()),this._sheetInterceptorService=e,this._numfmtService=t,this._univerInstanceService=n,this._injector=r,this._editorBridgeService=i,this._initInterceptorEditorStart(),this._initInterceptorEditorEnd(),this._initInterceptorCommands()}_initInterceptorEditorStart(){this._editorBridgeService&&this.disposeWithMe((0,i.toDisposable)(this._editorBridgeService.interceptor.intercept(this._editorBridgeService.interceptor.getInterceptPoints().BEFORE_CELL_EDIT,{handler:/* @__PURE__ */x((e,t,n)=>{let r=t.row,i=t.col,a=this._numfmtService.getValue(t.unitId,t.subUnitId,r,i);if(a)switch(K(a.pattern)){case"scientific":case"currency":case"grouped":case"number":return t.worksheet.getCellRaw(r,i);default:return n&&n(e)}return n(e)},"handler")})))}_initInterceptorEditorEnd(){this._editorBridgeService&&this.disposeWithMe((0,i.toDisposable)(this._editorBridgeService.interceptor.intercept(this._editorBridgeService.interceptor.getInterceptPoints().AFTER_CELL_EDIT,{handler:/* @__PURE__ */x((e,t,n)=>{var r;this._collectEffectMutation.clean();let a=this._numfmtService.getValue(t.unitId,t.subUnitId,t.row,t.col),l=null!=(r=a&&K(a.pattern))?r:"",s=/* @__PURE__ */x(()=>{a&&this._collectEffectMutation.add(t.unitId,t.subUnitId,t.row,t.col,null)},"clean");if(!(null!=e&&e.v))return n(e);let o=String(e.v),c=(0,i.numfmt).parseDate(o)||(0,i.numfmt).parseTime(o)||(0,i.numfmt).parseNumber(o);if(c){if(c.z){let n=Number(c.v);return this._collectEffectMutation.add(t.unitId,t.subUnitId,t.row,t.col,{pattern:c.z}),{...e,v:n,t:i.CellValueType.NUMBER}}}else(["date","time","datetime","percent"].includes(l)||!e6(o))&&s();return n(e)},"handler")})))}_initInterceptorCommands(){let e=this;this.disposeWithMe(this._sheetInterceptorService.interceptCommand({getMutations(t){var n;if(t.id===a.SetRangeValuesCommand.id){let t=e._univerInstanceService.getCurrentUnitForType(i.UniverInstanceType.UNIVER_SHEET),r=t.getUnitId(),l=null==(n=t.getActiveSheet())?void 0:n.getSheetId();if(!l)return{redos:[],undos:[]};let s=e._collectEffectMutation.getEffects();if(e._collectEffectMutation.clean(),!s.length)return{redos:[],undos:[]};let o=s.filter(e=>{var t;return!!(null!=(t=e.value)&&t.pattern)}).map(e=>({row:e.row,col:e.col,pattern:e.value.pattern})),c=s.filter(e=>{var t;return!(null!=(t=e.value)&&t.pattern)}).map(e=>({startRow:e.row,endColumn:e.col,startColumn:e.col,endRow:e.row})),u=[],m=[];if(o.length){let t={id:a.SetNumfmtMutation.id,params:(0,a.transformCellsToRange)(r,l,o)};u.push(t),m.push(...(0,a.factorySetNumfmtUndoMutation)(e._injector,t.params))}if(c.length){let t={id:a.RemoveNumfmtMutation.id,params:{unitId:r,subUnitId:l,ranges:c}};u.push(t),m.push(...(0,a.factoryRemoveNumfmtUndoMutation)(e._injector,t.params))}return{redos:u,undos:m.reverse()}}return{redos:[],undos:[]}}}))}},x(e8,"NumfmtEditorController"),e8);function e6(e){return/^-?\d+(\.\d+)?$/.test(e)}e3=e4([(0,i.OnLifecycle)(i.LifecycleStages.Rendered,e3),e2(0,(0,i.Inject)(a.SheetInterceptorService)),e2(1,(0,i.Inject)(a.INumfmtService)),e2(2,(0,i.Inject)(i.IUniverInstanceService)),e2(3,(0,i.Inject)(i.Injector)),e2(4,(0,i.Optional)(h.IEditorBridgeService))],e3),x(e6,"isNumeric");var e8,e7,e9=Object.defineProperty,te=Object.getOwnPropertyDescriptor,tt=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?te(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&e9(t,n,a),a},"__decorateClass$3"),tn=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$3");let tr=(x(e7=class extends i.Disposable{constructor(e){super(),this._localeService=e}},"NumfmtI18nController"),e7);tr=tt([(0,i.OnLifecycle)(i.LifecycleStages.Rendered,tr),tn(0,(0,i.Inject)(i.LocaleService))],tr);let ti=[{label:"sheet.numfmt.general",pattern:null},{label:"sheet.numfmt.text",pattern:_.DEFAULT_TEXT_FORMAT},"|",{label:"sheet.numfmt.number",pattern:"0"},"|",{label:"sheet.numfmt.accounting",pattern:'"¥" #,##0.00_);[Red]("¥"#,##0.00)'},{label:"sheet.numfmt.financialValue",pattern:"#,##0.00;[Red]#,##0.00"},{label:"sheet.numfmt.currency",pattern:'"¥"#,##0.00_);[Red]("¥"#,##0.00)'},{label:"sheet.numfmt.roundingCurrency",pattern:'"¥"#,##0;[Red]"¥"#,##0'},"|",{label:"sheet.numfmt.date",pattern:"yyyy-mm-dd;@"},{label:"sheet.numfmt.time",pattern:'am/pm h":"mm":"ss'},{label:"sheet.numfmt.dateTime",pattern:"yyyy-m-d am/pm h:mm"},{label:"sheet.numfmt.timeDuration",pattern:"h:mm:ss"},"|",{label:"sheet.numfmt.moreFmt",pattern:""}],ta="sheet.numfmt.moreNumfmtType",tl="sheet.numfmt.moreNumfmtType.options",ts=/* @__PURE__ */x(e=>{var t;let n=(0,i.useDependency)(i.LocaleService),r=null!=(t=e.value)?t:n.t("sheet.numfmt.general");return /* @__PURE__ */ec.jsx("span",{className:"more-numfmt-type",children:r})},"MoreNumfmtType"),to=/* @__PURE__ */x(()=>{let e=(0,i.useDependency)(i.ICommandService),t=(0,i.useDependency)(i.LocaleService),n=(0,i.useDependency)(p.ILayoutService);(0,i.useInjector)();let r=(0,i.useDependency)(a.SheetsSelectionsService),l=/* @__PURE__ */x(t=>{let a=r.getCurrentLastSelection();if(!a)return;let l=a.range,s=[];(0,i.Range).foreach(l,(e,n)=>{t?s.push({row:e,col:n,pattern:t,type:K(t)}):s.push({row:e,col:n})}),e.executeCommand(O.id,{values:s}),n.focus()},"setNumfmt"),s=/* @__PURE__ */x(t=>{if(0===t)l(null);else if(t===ti.length-1)e.executeCommand(A.id);else{let e=ti[t];e.pattern&&l(e.pattern)}},"handleOnclick");return /* @__PURE__ */ec.jsx("div",{className:"more-numfmt-type-options",children:ti.map((e,n)=>"|"===e?/* @__PURE__ */ec.jsx("div",{className:"line m-t-4",onClick:/* @__PURE__ */x(e=>e.stopPropagation(),"onClick")},n):/* @__PURE__ */ec.jsxs("div",{className:"option-item m-t-4",onClick:/* @__PURE__ */x(()=>{s(n)},"onClick"),children:[/* @__PURE__ */ec.jsx("div",{children:t.t(e.label)}),/* @__PURE__ */ec.jsx("div",{className:"m-l-26",children:e.pattern?z(e.pattern||"",1220,t.getCurrentLocale()).result:""})]},n))})},"Options"),tc=/* @__PURE__ */x(e=>({icon:new c.Observable(t=>{let n=e.get(L);function r(e){return({[j.US]:"DollarSingle",[j.RU]:"RoubleSingle",[j.CN]:"RmbSingle",[j.AT]:"EuroSingle"})[e]||"DollarSingle"}x(r,"getIconKey");let i=j[n.getCurrencySymbol()]||"$";return t.next(r(i)),n.currencySymbol$.subscribe(e=>{let n=j[e]||"$";t.next(r(n))})}),id:F.id,title:"sheet.numfmt.currency",tooltip:"sheet.numfmt.currency",type:p.MenuItemType.BUTTON,hidden$:(0,p.getMenuHiddenObservable)(e,i.UniverInstanceType.UNIVER_SHEET),disabled$:(0,h.getCurrentRangeDisable$)(e,{workbookTypes:[a.WorkbookEditablePermission],worksheetTypes:[a.WorksheetEditPermission,a.WorksheetSetCellStylePermission],rangeTypes:[a.RangeProtectionPermissionEditPoint]})}),"CurrencyMenuItem"),tu=/* @__PURE__ */x(e=>({icon:"AddDigitsSingle",id:$.id,title:"sheet.numfmt.addDecimal",tooltip:"sheet.numfmt.addDecimal",type:p.MenuItemType.BUTTON,hidden$:(0,p.getMenuHiddenObservable)(e,i.UniverInstanceType.UNIVER_SHEET),disabled$:(0,h.getCurrentRangeDisable$)(e,{workbookTypes:[a.WorkbookEditablePermission],worksheetTypes:[a.WorksheetEditPermission,a.WorksheetSetCellStylePermission],rangeTypes:[a.RangeProtectionPermissionEditPoint]})}),"AddDecimalMenuItem"),tm=/* @__PURE__ */x(e=>({icon:"ReduceDigitsSingle",id:H.id,title:"sheet.numfmt.subtractDecimal",tooltip:"sheet.numfmt.subtractDecimal",type:p.MenuItemType.BUTTON,hidden$:(0,p.getMenuHiddenObservable)(e,i.UniverInstanceType.UNIVER_SHEET),disabled$:(0,h.getCurrentRangeDisable$)(e,{workbookTypes:[a.WorkbookEditablePermission],worksheetTypes:[a.WorksheetEditPermission,a.WorksheetSetCellStylePermission],rangeTypes:[a.RangeProtectionPermissionEditPoint]})}),"SubtractDecimalMenuItem"),td=/* @__PURE__ */x(e=>({icon:"PercentSingle",id:V.id,title:"sheet.numfmt.percent",tooltip:"sheet.numfmt.percent",type:p.MenuItemType.BUTTON,hidden$:(0,p.getMenuHiddenObservable)(e,i.UniverInstanceType.UNIVER_SHEET),disabled$:(0,h.getCurrentRangeDisable$)(e,{workbookTypes:[a.WorkbookEditablePermission],worksheetTypes:[a.WorksheetEditPermission,a.WorksheetSetCellStylePermission],rangeTypes:[a.RangeProtectionPermissionEditPoint]})}),"PercentMenuItem"),th=/* @__PURE__ */x(e=>{let t=e.get(i.IUniverInstanceService),n=e.get(i.ICommandService),r=e.get(i.LocaleService),l=e.get(a.SheetsSelectionsService),s=(0,h.deriveStateFromActiveSheet$)(t,"",({workbook:e,worksheet:t})=>new c.Observable(i=>(0,o.merge)(l.selectionMoveEnd$,new c.Observable(e=>{let t=[a.RemoveNumfmtMutation.id,a.SetNumfmtMutation.id],r=n.onCommandExecuted(n=>{t.includes(n.id)&&e.next(null)});return()=>r.dispose()})).subscribe(()=>{var n,a;let s=l.getCurrentSelections();if(s&&s[0]){let l=s[0].range,o=l.startRow,c=l.startColumn,u=null==(a=e.getStyles().get(null==(n=t.getCell(o,c))?void 0:n.s))?void 0:a.n,m=null==u?void 0:u.pattern,d=r.t("sheet.numfmt.general");if(m){let e=ti.filter(e=>"object"==typeof e&&e.pattern).find(e=>P(m,e.pattern));d=e&&"object"==typeof e&&e.pattern?r.t(e.label):r.t("sheet.numfmt.moreFmt")}i.next(d)}})));return{label:ta,id:A.id,tooltip:"sheet.numfmt.title",type:p.MenuItemType.SELECTOR,selections:[{label:{name:tl,hoverable:!1}}],value$:s,hidden$:(0,p.getMenuHiddenObservable)(e,i.UniverInstanceType.UNIVER_SHEET),disabled$:(0,h.getCurrentRangeDisable$)(e,{workbookTypes:[a.WorkbookEditablePermission],worksheetTypes:[a.WorksheetSetCellStylePermission,a.WorksheetEditPermission],rangeTypes:[a.RangeProtectionPermissionEditPoint]})}},"FactoryOtherMenuItem"),tf={[p.RibbonStartGroup.FORMULAS_INSERT]:{[F.id]:{order:4,menuItemFactory:tc},[$.id]:{order:5,menuItemFactory:tu},[H.id]:{order:6,menuItemFactory:tm},[V.id]:{order:7,menuItemFactory:td},[A.id]:{order:8,menuItemFactory:th}}};var tp,tv=Object.defineProperty,tg=Object.getOwnPropertyDescriptor,ty=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?tg(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&tv(t,n,a),a},"__decorateClass$2"),tb=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$2");let tS=(x(tp=class extends i.Disposable{constructor(e,t,n){super(),this._injector=e,this._componentManager=t,this._menuManagerService=n,this._initMenu()}_initMenu(){this._menuManagerService.mergeMenu(tf),this.disposeWithMe(this._componentManager.register(ta,ts)),this.disposeWithMe(this._componentManager.register(tl,to))}},"NumfmtMenuController"),tp);tS=ty([(0,i.OnLifecycle)(i.LifecycleStages.Rendered,tS),tb(0,(0,i.Inject)(i.Injector)),tb(1,(0,i.Inject)(p.ComponentManager)),tb(2,p.IMenuManagerService)],tS);var t_,tC=Object.defineProperty,tI=Object.getOwnPropertyDescriptor,tx=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?tI(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&tC(t,n,a),a},"__decorateClass$1"),tN=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam$1");let tE=(x(t_=class extends i.Disposable{constructor(e){super(),N(this,"_currencySymbol$",new l.BehaviorSubject("US")),N(this,"currencySymbol$",this._currencySymbol$.asObservable()),this._injector=e}setCurrencySymbolByCountryCode(e){this._currencySymbol$.next(e)}getCurrencySymbol(){return this._currencySymbol$.getValue()}},"NumfmtCurrencyController"),t_);tE=tx([(0,i.OnLifecycle)(i.LifecycleStages.Rendered,tE),tN(0,(0,i.Inject)(i.Injector))],tE);let tj={};var tT,tP=Object.defineProperty,tM=Object.getOwnPropertyDescriptor,tR=/* @__PURE__ */x((e,t,n)=>t in e?tP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,"__defNormalProp"),tw=/* @__PURE__ */x((e,t,n,r)=>{for(var i,a=r>1?void 0:r?tM(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&tP(t,n,a),a},"__decorateClass"),tO=/* @__PURE__ */x((e,t)=>(n,r)=>t(n,r,e),"__decorateParam"),t$=/* @__PURE__ */x((e,t,n)=>tR(e,"symbol"!=typeof t?t+"":t,n),"__publicField");let tU=(x(tT=class extends i.Plugin{constructor(e=tj,t,n){super(),this._config=e,this._injector=t,this._configService=n;let{menu:r,...i}=this._config;r&&this._configService.setConfig("menu",r,{merge:!0}),this._configService.setConfig("sheets-numfmt.config",i)}onStarting(){this._injector.add([B,{useClass:eQ,lazy:!1}]),this._injector.add([e3]),this._injector.add([ev]),this._injector.add([Q]),this._injector.add([tr]),this._injector.add([L]),this._injector.add([tE]),this._injector.add([tS])}},"UniverSheetsNumfmtPlugin"),tT);t$(tU,"pluginName",G),t$(tU,"type",i.UniverInstanceType.UNIVER_SHEET),tU=tw([(0,i.DependentOn)(a.UniverSheetsPlugin,h.UniverSheetsUIPlugin),tO(1,(0,i.Inject)(i.Injector)),tO(2,i.IConfigService)],tU)}),n("6cCiq",function(n,r){e(n.exports,"tap",function(){return o});var i=t("im29J"),a=t("jaOYC"),l=t("hMcgT"),s=t("agvo5");function o(e,t,n){var r=(0,i.isFunction)(e)||t||n?{next:e,error:t,complete:n}:e;return r?(0,a.operate)(function(e,t){null===(n=r.subscribe)||void 0===n||n.call(r);var n,i=!0;e.subscribe((0,l.createOperatorSubscriber)(t,function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)},function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()},function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)},function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)}))}):s.identity}})}();
//# sourceMappingURL=es.6f3dd60a.js.map
